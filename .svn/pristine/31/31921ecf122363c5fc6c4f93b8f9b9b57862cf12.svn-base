{
"version":3,
"file":"Builder.js",
"sourceRoot":"file:///",
"sources":["K:/HaxeToolkit/haxe/std/js/_std/EReg.hx","K:/HaxeToolkit/haxe/std/js/_std/HxOverrides.hx","K:/HaxeToolkit/haxe/std/Lambda.hx","K:/HaxeToolkit/haxe/std/List.hx","K:/HaxeToolkit/haxe/std/js/_std/Reflect.hx","K:/HaxeToolkit/haxe/std/js/_std/Std.hx","K:/HaxeToolkit/haxe/std/StringBuf.hx","K:/HaxeToolkit/haxe/std/js/_std/Type.hx","K:/HaxeToolkit/haxe/std/UInt.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/Main.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/api/Api.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/api/Resources.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/game/GameManager.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/game/manager/ClippingManager.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/game/manager/Manager.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/game/manager/MapManager.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/game/manager/Maps.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/game/manager/RessourceManager.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/game/pooling/PoolObject.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/game/GameObject.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/game/StateMachine.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/game/StateGraphic.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/game/sprites/SpriteObject.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/game/sprites/Building.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/game/sprites/Citizen.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/game/sprites/Tile.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/game/sprites/buildings/Casino.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/game/sprites/buildings/Motel.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/game/sprites/buildings/RocketFactory.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/game/sprites/buildings/Temple.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/game/utils/TypeDefUtils.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/ui/CheatPanel.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/ui/UIComponent.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/ui/Screen.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/ui/GraphicLoader.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/ui/UIManager.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/ui/hud/Hud.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/ui/Popin.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/ui/popin/Confirm.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/ui/screens/TitleCard.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/ui/Button.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/ui/uimodule/BackButton.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/ui/uimodule/CreditsButton.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/ui/uimodule/PlayButton.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/builder/ui/uimodule/ShopButton1.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/Config.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/Debug.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/Localization.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/facebook/Facebook.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/game/Camera.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/game/CollisionManager.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/game/GameStage.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/game/factory/AnimFactory.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/game/factory/FlumpMovieAnimFactory.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/game/factory/MovieClipAnimFactory.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/game/iso/IsoManager.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/loader/GameLoader.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/sounds/SoundManager.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/system/DeviceCapabilities.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/ui/UIBuilder.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/ui/UIPosition.hx","K:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,1,1/src/flump/DisplayObjectKey.hx","K:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,1,1/src/flump/MoviePlayer.hx","K:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,1,1/src/flump/json/FlumpJSON.hx","K:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,1,1/src/flump/library/FlumpLibrary.hx","K:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,1,1/src/flump/library/Keyframe.hx","K:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,1,1/src/flump/library/Label.hx","K:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,1,1/src/flump/library/Layer.hx","K:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,1,1/src/flump/library/Symbol.hx","K:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,1,1/src/flump/library/MovieSymbol.hx","K:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,1,1/src/flump/library/Point.hx","K:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,1,1/src/flump/library/Rectangle.hx","K:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,1,1/src/flump/library/SpriteSymbol.hx","K:/HaxeToolkit/haxe/std/haxe/Http.hx","K:/HaxeToolkit/haxe/std/haxe/Timer.hx","K:/HaxeToolkit/haxe/std/haxe/ds/ArraySort.hx","K:/HaxeToolkit/haxe/std/haxe/ds/BalancedTree.hx","K:/HaxeToolkit/haxe/std/haxe/ds/EnumValueMap.hx","K:/HaxeToolkit/haxe/std/js/_std/haxe/ds/ObjectMap.hx","K:/HaxeToolkit/haxe/std/js/_std/haxe/ds/StringMap.hx","K:/HaxeToolkit/haxe/std/js/Boot.hx","K:/HaxeToolkit/haxe/std/js/Browser.hx","K:/HaxeToolkit/haxe/lib/Pathfinder/0,2,18/pathfinder/Coordinate.hx","K:/HaxeToolkit/haxe/lib/Pathfinder/0,2,18/pathfinder/Node.hx","K:/HaxeToolkit/haxe/lib/Pathfinder/0,2,18/pathfinder/Pathfinder.hx","K:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,1,1/src/pixi/display/FlumpMovie.hx","K:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,1,1/src/pixi/display/FlumpResource.hx","K:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,1,1/src/pixi/display/FlumpSprite.hx","K:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,1,1/src/pixi/display/PixiLayer.hx","K:/HaxeToolkit/haxe/lib/pixi-flump-runtime/0,1,1/src/pixi/loaders/FlumpParser.hx","K:/HaxeToolkit/haxe/std/js/_std/Math.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/events/EventType.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/events/FacebookEventType.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/events/LoadEventType.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/events/MouseEventType.hx","K:/Dropbox/Dropbox/Dropbox/haxe/Builder_project2/Deliveries/src/com/isartdigital/utils/events/TouchEventType.hx"],
"sourcesContent":["/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n@:coreApi class EReg {\n\n\tvar r : HaxeRegExp;\n\n\tpublic function new( r : String, opt : String ) : Void {\n\t\topt = opt.split(\"u\").join(\"\"); // 'u' (utf8) depends on page encoding\n\t\tthis.r = new HaxeRegExp(r, opt);\n\t}\n\n\tpublic function match( s : String ) : Bool {\n\t\tif( r.global ) r.lastIndex = 0;\n\t\tr.m = r.exec(s);\n\t\tr.s = s;\n\t\treturn (r.m != null);\n\t}\n\n\tpublic function matched( n : Int ) : String {\n\t\treturn if( r.m != null && n >= 0 && n < r.m.length ) r.m[n] else throw \"EReg::matched\";\n\t}\n\n\tpublic function matchedLeft() : String {\n\t\tif( r.m == null ) throw \"No string matched\";\n\t\treturn r.s.substr(0,r.m.index);\n\t}\n\n\tpublic function matchedRight() : String {\n\t\tif( r.m == null ) throw \"No string matched\";\n\t\tvar sz = r.m.index+r.m[0].length;\n\t\treturn r.s.substr(sz,r.s.length-sz);\n\t}\n\n\tpublic function matchedPos() : { pos : Int, len : Int } {\n\t\tif( r.m == null ) throw \"No string matched\";\n\t\treturn { pos : r.m.index, len : r.m[0].length };\n\t}\n\n\tpublic function matchSub( s : String, pos : Int, len : Int = -1):Bool {\n\t\treturn if (r.global) {\n\t\t\tr.lastIndex = pos;\n\t\t\tr.m = r.exec(len < 0 ? s : s.substr(0, pos + len));\n\t\t\tvar b = r.m != null;\n\t\t\tif (b) {\n\t\t\t\tr.s = s;\n\t\t\t}\n\t\t\tb;\n\t\t} else {\n\t\t\t// TODO: check some ^/$ related corner cases\n\t\t\tvar b = match( len < 0 ? s.substr(pos) : s.substr(pos,len) );\n\t\t\tif (b) {\n\t\t\t\tr.s = s;\n\t\t\t\tr.m.index += pos;\n\t\t\t}\n\t\t\tb;\n\t\t}\n\t}\n\n\tpublic function split( s : String ) : Array<String> {\n\t\t// we can't use directly s.split because it's ignoring the 'g' flag\n\t\tvar d = \"#__delim__#\";\n\t\treturn untyped s.replace(r,d).split(d);\n\t}\n\n\tpublic function replace( s : String, by : String ) : String {\n\t\treturn untyped s.replace(r,by);\n\t}\n\n\tpublic function map( s : String, f : EReg -> String ) : String {\n\t\tvar offset = 0;\n\t\tvar buf = new StringBuf();\n\t\tdo {\n\t\t\tif (offset >= s.length)\n\t\t\t\tbreak;\n\t\t\telse if (!matchSub(s, offset)) {\n\t\t\t\tbuf.add(s.substr(offset));\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tvar p = matchedPos();\n\t\t\tbuf.add(s.substr(offset, p.pos - offset));\n\t\t\tbuf.add(f(this));\n\t\t\tif (p.len == 0) {\n\t\t\t\tbuf.add(s.substr(p.pos, 1));\n\t\t\t\toffset = p.pos + 1;\n\t\t\t}\n\t\t\telse\n\t\t\t\toffset = p.pos + p.len;\n\t\t} while (r.global);\n\t\tif (!r.global && offset > 0 && offset < s.length)\n\t\t\tbuf.add(s.substr(offset));\n\t\treturn buf.toString();\n\t}\n}\n\n@:native(\"RegExp\")\nprivate extern class HaxeRegExp extends js.RegExp {\n\tvar m:js.RegExp.RegExpMatch;\n\tvar s:String;\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n@:noDoc\nclass HxOverrides {\n\n\tstatic function dateStr( date :Date ) : String {\n\t\tvar m = date.getMonth() + 1;\n\t\tvar d = date.getDate();\n\t\tvar h = date.getHours();\n\t\tvar mi = date.getMinutes();\n\t\tvar s = date.getSeconds();\n\t\treturn date.getFullYear()\n\t\t\t+\"-\"+(if( m < 10 ) \"0\"+m else \"\"+m)\n\t\t\t+\"-\"+(if( d < 10 ) \"0\"+d else \"\"+d)\n\t\t\t+\" \"+(if( h < 10 ) \"0\"+h else \"\"+h)\n\t\t\t+\":\"+(if( mi < 10 ) \"0\"+mi else \"\"+mi)\n\t\t\t+\":\"+(if( s < 10 ) \"0\"+s else \"\"+s);\n\t}\n\n\tstatic function strDate( s : String ) : Date {\n\t\tswitch( s.length ) {\n\t\tcase 8: // hh:mm:ss\n\t\t\tvar k = s.split(\":\");\n\t\t\tvar d : Date = untyped __new__(Date);\n\t\t\tuntyped d[\"setTime\"](0);\n\t\t\tuntyped d[\"setUTCHours\"](k[0]);\n\t\t\tuntyped d[\"setUTCMinutes\"](k[1]);\n\t\t\tuntyped d[\"setUTCSeconds\"](k[2]);\n\t\t\treturn d;\n\t\tcase 10: // YYYY-MM-DD\n\t\t\tvar k = s.split(\"-\");\n\t\t\treturn new Date(cast k[0],cast untyped k[1] - 1,cast k[2],0,0,0);\n\t\tcase 19: // YYYY-MM-DD hh:mm:ss\n\t\t\tvar k = s.split(\" \");\n\t\t\tvar y = k[0].split(\"-\");\n\t\t\tvar t = k[1].split(\":\");\n\t\t\treturn new Date(cast y[0],cast untyped y[1] - 1,cast y[2],cast t[0],cast t[1],cast t[2]);\n\t\tdefault:\n\t\t\tthrow \"Invalid date format : \" + s;\n\t\t}\n\t}\n\n\tstatic function cca( s : String, index : Int ) : Null<Int> {\n\t\tvar x = (cast s).charCodeAt(index);\n\t\tif( x != x ) // fast isNaN\n\t\t\treturn untyped undefined; // isNaN will still return true\n\t\treturn x;\n\t}\n\n\tstatic function substr( s : String, pos : Int, ?len : Int ) : String {\n\t\tif( pos != null && pos != 0 && len != null && len < 0 ) return \"\";\n\t\tif( len == null ) len = s.length;\n\t\tif( pos < 0 ){\n\t\t\tpos = s.length + pos;\n\t\t\tif( pos < 0 ) pos = 0;\n\t\t}else if( len < 0 ){\n\t\t\tlen = s.length + len - pos;\n\t\t}\n\n\t\treturn (untyped s).substr(pos, len);\n\t}\n\n\tstatic function indexOf<T>( a : Array<T>, obj : T, i : Int) {\n\t\tvar len = a.length;\n\t\tif (i < 0) {\n\t\t\ti += len;\n\t\t\tif (i < 0) i = 0;\n\t\t}\n\t\twhile (i < len)\n\t\t{\n\t\t\tif (untyped __js__(\"a[i] === obj\"))\n\t\t\t\treturn i;\n\t\t\ti++;\n\t\t}\n\t\treturn -1;\n\t}\n\n\tstatic function lastIndexOf<T>( a : Array<T>, obj : T, i : Int) {\n\t\tvar len = a.length;\n\t\tif (i >= len)\n\t\t\ti = len - 1;\n\t\telse if (i < 0)\n\t\t\ti += len;\n\t\twhile (i >= 0)\n\t\t{\n\t\t\tif (untyped __js__(\"a[i] === obj\"))\n\t\t\t\treturn i;\n\t\t\ti--;\n\t\t}\n\t\treturn -1;\n\t}\n\n\tstatic function remove<T>( a : Array<T>, obj : T ) {\n\t\tvar i = a.indexOf(obj);\n\t\tif( i == -1 ) return false;\n\t\ta.splice(i,1);\n\t\treturn true;\n\t}\n\n\tstatic function iter<T>( a : Array<T> ) : Iterator<T> untyped {\n\t\treturn {\n\t\t\tcur : 0,\n\t\t\tarr : a,\n\t\t\thasNext : function() {\n\t\t\t\treturn __this__.cur < __this__.arr.length;\n\t\t\t},\n\t\t\tnext : function() {\n\t\t\t\treturn __this__.arr[__this__.cur++];\n\t\t\t}\n\t\t};\n\t}\n\n\tstatic function __init__() untyped {\n#if !js_es5\n\t\t__feature__('HxOverrides.indexOf', if( Array.prototype.indexOf ) __js__(\"HxOverrides\").indexOf = function(a,o,i) return Array.prototype.indexOf.call(a, o, i));\n\t\t__feature__('HxOverrides.lastIndexOf', if( Array.prototype.lastIndexOf ) __js__(\"HxOverrides\").lastIndexOf = function(a,o,i) return Array.prototype.lastIndexOf.call(a, o, i));\n#end\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\n/**\n\tThe `Lambda` class is a collection of methods to support functional\n\tprogramming. It is ideally used with 'using Lambda' and then acts as an\n\textension to Iterable types.\n\n\tOn static platforms, working with the Iterable structure might be slower\n\tthan performing the operations directly on known types, such as Array and\n\tList.\n\n\tIf the first argument to any of the methods is null, the result is\n\tunspecified.\n**/\nclass Lambda {\n\n\t/**\n\t\tCreates an Array from Iterable `it`.\n\n\t\tIf `it` is an Array, this function returns a copy of it.\n\t**/\n\tpublic static function array<A>( it : Iterable<A> ) : Array<A> {\n\t\tvar a = new Array<A>();\n\t\tfor(i in it)\n\t\t\ta.push(i);\n\t\treturn a;\n\t}\n\n\t/**\n\t\tCreates a List form Iterable `it`.\n\n\t\tIf `it` is a List, this function returns a copy of it.\n\t**/\n\tpublic static function list<A>( it : Iterable<A> ) : List<A> {\n\t\tvar l = new List<A>();\n\t\tfor(i in it)\n\t\t\tl.add(i);\n\t\treturn l;\n\t}\n\n\t/**\n\t\tCreates a new List by applying function `f` to all elements of `it`.\n\n\t\tThe order of elements is preserved.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function map<A,B>( it : Iterable<A>, f : A -> B ) : List<B> {\n\t\tvar l = new List<B>();\n\t\tfor( x in it )\n\t\t\tl.add(f(x));\n\t\treturn l;\n\t}\n\n\t/**\n\t\tSimilar to map, but also passes the index of each element to `f`.\n\n\t\tThe order of elements is preserved.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function mapi<A,B>( it : Iterable<A>, f : Int -> A -> B ) : List<B> {\n\t\tvar l = new List<B>();\n\t\tvar i = 0;\n\t\tfor( x in it )\n\t\t\tl.add(f(i++,x));\n\t\treturn l;\n\t}\n\n\t/**\n\t\tTells if `it` contains `elt`.\n\n\t\tThis function returns true as soon as an element is found which is equal\n\t\tto `elt` according to the `==` operator.\n\n\t\tIf no such element is found, the result is false.\n\t**/\n\tpublic static function has<A>( it : Iterable<A>, elt : A ) : Bool {\n\t\tfor( x in it )\n\t\t\tif( x == elt )\n\t\t\t\treturn true;\n\t\treturn false;\n\t}\n\n\t/**\n\t\tTells if `it` contains an element for which `f` is true.\n\n\t\tThis function returns true as soon as an element is found for which a\n\t\tcall to `f` returns true.\n\n\t\tIf no such element is found, the result is false.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function exists<A>( it : Iterable<A>, f : A -> Bool ) {\n\t\tfor( x in it )\n\t\t\tif( f(x) )\n\t\t\t\treturn true;\n\t\treturn false;\n\t}\n\n\t/**\n\t\tTells if `f` is true for all elements of `it`.\n\n\t\tThis function returns false as soon as an element is found for which a\n\t\tcall to `f` returns false.\n\n\t\tIf no such element is found, the result is true.\n\n\t\tIn particular, this function always returns true if `it` is empty.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function foreach<A>( it : Iterable<A>, f : A -> Bool ) {\n\t\tfor( x in it )\n\t\t\tif( !f(x) )\n\t\t\t\treturn false;\n\t\treturn true;\n\t}\n\n\t/**\n\t\tCalls `f` on all elements of `it`, in order.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function iter<A>( it : Iterable<A>, f : A -> Void ) {\n\t\tfor( x in it )\n\t\t\tf(x);\n\t}\n\n\t/**\n\t\tReturns a List containing those elements of `it` for which `f` returned\n\t\ttrue.\n\n\t\tIf `it` is empty, the result is the empty List even if `f` is null.\n\n\t\tOtherwise if `f` is null, the result is unspecified.\n\t**/\n\tpublic static function filter<A>( it : Iterable<A>, f : A -> Bool ) {\n\t\tvar l = new List<A>();\n\t\tfor( x in it )\n\t\t\tif( f(x) )\n\t\t\t\tl.add(x);\n\t\treturn l;\n\t}\n\n\t/**\n\t\tFunctional fold on Iterable `it`, using function `f` with start argument\n\t\t`first`.\n\n\t\tIf `it` has no elements, the result is `first`.\n\n\t\tOtherwise the first element of `it` is passed to `f` alongside `first`.\n\t\tThe result of that call is then passed to `f` with the next element of\n\t\t`it`, and so on until `it` has no more elements.\n\n\t\tIf `it` or `f` are null, the result is unspecified.\n\t**/\n\tpublic static function fold<A,B>( it : Iterable<A>, f : A -> B -> B, first : B ) : B {\n\t\tfor( x in it )\n\t\t\tfirst = f(x,first);\n\t\treturn first;\n\t}\n\n\t/**\n\t\tReturns the number of elements in `it` for which `pred` is true, or the\n\t\ttotal number of elements in `it` if `pred` is null.\n\n\t\tThis function traverses all elements.\n\t**/\n\tpublic static function count<A>( it : Iterable<A>, ?pred : A -> Bool ) {\n\t\tvar n = 0;\n\t\tif( pred == null )\n\t\t\tfor( _ in it )\n\t\t\t\tn++;\n\t\telse\n\t\t\tfor( x in it )\n\t\t\t\tif( pred(x) )\n\t\t\t\t\tn++;\n\t\treturn n;\n\t}\n\n\t/**\n\t\tTells if Iterable `it` does not contain any element.\n\t**/\n\tpublic static function empty<T>( it : Iterable<T> ) : Bool {\n\t\treturn !it.iterator().hasNext();\n\t}\n\n\t/**\n\t\tReturns the index of the first element `v` within Iterable `it`.\n\n\t\tThis function uses operator `==` to check for equality.\n\n\t\tIf `v` does not exist in `it`, the result is -1.\n\t**/\n\tpublic static function indexOf<T>( it : Iterable<T>, v : T ) : Int {\n\t\tvar i = 0;\n\t\tfor( v2 in it ) {\n\t\t\tif( v == v2 )\n\t\t\t\treturn i;\n\t\t\ti++;\n\t\t}\n\t\treturn -1;\n\t}\n\n\t/**\n\t\tReturns the first element of `it` for which `f` is true.\n\n\t\tThis function returns as soon as an element is found for which a call to\n\t\t`f` returns true.\n\n\t\tIf no such element is found, the result is null.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function find<T>( it : Iterable<T>, f : T -> Bool ) : Null<T> {\n\t\tfor( v in it ) {\n\t\t\tif(f(v)) return v;\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t\tReturns a new List containing all elements of Iterable `a` followed by\n\t\tall elements of Iterable `b`.\n\n\t\tIf `a` or `b` are null, the result is unspecified.\n\t**/\n\tpublic static function concat<T>( a : Iterable<T>, b : Iterable<T> ) : List<T> {\n\t\tvar l = new List();\n\t\tfor( x in a )\n\t\t\tl.add(x);\n\t\tfor( x in b )\n\t\t\tl.add(x);\n\t\treturn l;\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n/**\n\tA linked-list of elements. The list is composed of two-elements arrays\n\tthat are chained together. It is optimized so that adding or removing an\n\telement does not imply copying the whole array content every time.\n**/\nclass List<T> {\n\n\tprivate var h : Array<Dynamic>;\n\tprivate var q : Array<Dynamic>;\n\n\t/**\n\t\tThe length of `this` List.\n\t**/\n\tpublic var length(default,null) : Int;\n\n\t/**\n\t\tCreates a new empty list.\n\t**/\n\tpublic function new() {\n\t\tlength = 0;\n\t}\n\n\t/**\n\t\tAdds element `item` at the end of `this` List.\n\n\t\t`this.length` increases by 1.\n\t**/\n\tpublic function add( item : T ) {\n\t\tvar x:Array<Dynamic> = #if neko untyped __dollar__array(item,null) #else [item] #end;\n\t\tif( h == null )\n\t\t\th = x;\n\t\telse\n\t\t\tq[1] = x;\n\t\tq = x;\n\t\tlength++;\n\t}\n\n\t/**\n\t\tAdds element `item` at the beginning of `this` List.\n\n\t\t`this.length` increases by 1.\n\t**/\n\tpublic function push( item : T ) {\n\t\tvar x : Array<Dynamic> = #if neko\n\t\t\tuntyped __dollar__array(item,h)\n\t\t#else\n\t\t\t[item,h]\n\t\t#end;\n\t\th = x;\n\t\tif( q == null )\n\t\t\tq = x;\n\t\tlength++;\n\t}\n\n\t/**\n\t\tReturns the first element of `this` List, or null if no elements exist.\n\n\t\tThis function does not modify `this` List.\n\t**/\n\tpublic function first() : Null<T> {\n\t\treturn if( h == null ) null else h[0];\n\t}\n\n\t/**\n\t\tReturns the last element of `this` List, or null if no elements exist.\n\n\t\tThis function does not modify `this` List.\n\t**/\n\tpublic function last() : Null<T> {\n\t\treturn if( q == null ) null else q[0];\n\t}\n\n\n\t/**\n\t\tReturns the first element of `this` List, or null if no elements exist.\n\n\t\tThe element is removed from `this` List.\n\t**/\n\tpublic function pop() : Null<T> {\n\t\tif( h == null )\n\t\t\treturn null;\n\t\tvar x = h[0];\n\t\th = h[1];\n\t\tif( h == null )\n\t\t\tq = null;\n\t\tlength--;\n\t\treturn x;\n\t}\n\n\t/**\n\t\tTells if `this` List is empty.\n\t**/\n\tpublic function isEmpty() : Bool {\n\t\treturn (h == null);\n\t}\n\n\t/**\n\t\tEmpties `this` List.\n\n\t\tThis function does not traverse the elements, but simply sets the\n\t\tinternal references to null and `this.length` to 0.\n\t**/\n\tpublic function clear() : Void {\n\t\th = null;\n\t\tq = null;\n\t\tlength = 0;\n\t}\n\n\t/**\n\t\tRemoves the first occurence of `v` in `this` List.\n\n\t\tIf `v` is found by checking standard equality, it is removed from `this`\n\t\tList and the function returns true.\n\n\t\tOtherwise, false is returned.\n\t**/\n\tpublic function remove( v : T ) : Bool {\n\t\tvar prev = null;\n\t\tvar l = h;\n\t\twhile( l != null ) {\n\t\t\tif( l[0] == v ) {\n\t\t\t\tif( prev == null )\n\t\t\t\t\th = l[1];\n\t\t\t\telse\n\t\t\t\t\tprev[1] = l[1];\n\t\t\t\tif( q == l )\n\t\t\t\t\tq = prev;\n\t\t\t\tlength--;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tprev = l;\n\t\t\tl = l[1];\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t\tReturns an iterator on the elements of the list.\n\t**/\n\tpublic inline function iterator() : ListIterator<T> {\n\t\treturn new ListIterator<T>(h);\n\t}\n\n\t/**\n\t\tReturns a string representation of `this` List.\n\n\t\tThe result is enclosed in { } with the individual elements being\n\t\tseparated by a comma.\n\t**/\n\tpublic function toString() {\n\t\tvar s = new StringBuf();\n\t\tvar first = true;\n\t\tvar l = h;\n\t\ts.add(\"{\");\n\t\twhile( l != null ) {\n\t\t\tif( first )\n\t\t\t\tfirst = false;\n\t\t\telse\n\t\t\t\ts.add(\", \");\n\t\t\ts.add(Std.string(l[0]));\n\t\t\tl = l[1];\n\t\t}\n\t\ts.add(\"}\");\n\t\treturn s.toString();\n\t}\n\n\t/**\n\t\tReturns a string representation of `this` List, with `sep` separating\n\t\teach element.\n\t**/\n\tpublic function join(sep : String) {\n\t\tvar s = new StringBuf();\n\t\tvar first = true;\n\t\tvar l = h;\n\t\twhile( l != null ) {\n\t\t\tif( first )\n\t\t\t\tfirst = false;\n\t\t\telse\n\t\t\t\ts.add(sep);\n\t\t\ts.add(l[0]);\n\t\t\tl = l[1];\n\t\t}\n\t\treturn s.toString();\n\t}\n\n\t/**\n\t\tReturns a list filtered with `f`. The returned list will contain all\n\t\telements for which `f(x) == true`.\n\t**/\n\tpublic function filter( f : T -> Bool ) {\n\t\tvar l2 = new List();\n\t\tvar l = h;\n\t\twhile( l != null ) {\n\t\t\tvar v = l[0];\n\t\t\tl = l[1];\n\t\t\tif( f(v) )\n\t\t\t\tl2.add(v);\n\t\t}\n\t\treturn l2;\n\t}\n\n\t/**\n\t\tReturns a new list where all elements have been converted by the\n\t\tfunction `f`.\n\t**/\n\tpublic function map<X>(f : T -> X) : List<X> {\n\t\tvar b = new List();\n\t\tvar l = h;\n\t\twhile( l != null ) {\n\t\t\tvar v = l[0];\n\t\t\tl = l[1];\n\t\t\tb.add(f(v));\n\t\t}\n\t\treturn b;\n\t}\n\n}\n\nprivate class ListIterator<T> {\n\tvar head:Array<Dynamic>;\n\tvar val:Dynamic;\n\n\tpublic inline function new(head:Array<Dynamic>) {\n\t\tthis.head = head;\n\t\tthis.val = null;\n\t}\n\n\tpublic inline function hasNext():Bool {\n\t\treturn head != null;\n\t}\n\n\tpublic inline function next():T {\n\t\tval = head[0];\n\t\thead = head[1];\n\t\treturn val;\n\t}\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n@:coreApi class Reflect {\n\n\tpublic inline static function hasField( o : Dynamic, field : String ) : Bool {\n\t\treturn untyped __js__('Object').prototype.hasOwnProperty.call(o, field);\n\t}\n\n\tpublic static function field( o : Dynamic, field : String ) : Dynamic {\n\t\ttry return untyped o[field] catch( e : Dynamic ) return null;\n\t}\n\n\tpublic inline static function setField( o : Dynamic, field : String, value : Dynamic ) : Void untyped {\n\t\to[field] = value;\n\t}\n\n\tpublic static inline function getProperty( o : Dynamic, field : String ) : Dynamic untyped {\n\t\tvar tmp;\n\t\treturn if( o == null ) __define_feature__(\"Reflect.getProperty\",null) else if( o.__properties__ && (tmp=o.__properties__[\"get_\"+field]) ) o[tmp]() else o[field];\n\t}\n\n\tpublic static inline function setProperty( o : Dynamic, field : String, value : Dynamic ) : Void untyped {\n\t\tvar tmp;\n\t\tif( o.__properties__ && (tmp=o.__properties__[\"set_\"+field]) ) o[tmp](value) else o[field] = __define_feature__(\"Reflect.setProperty\",value);\n\t}\n\n\tpublic inline static function callMethod( o : Dynamic, func : haxe.Constraints.Function, args : Array<Dynamic> ) : Dynamic untyped {\n\t\treturn func.apply(o,args);\n\t}\n\n\tpublic static function fields( o : Dynamic ) : Array<String> {\n\t\tvar a = [];\n\t\tif (o != null) untyped {\n\t\t\tvar hasOwnProperty = __js__('Object').prototype.hasOwnProperty;\n\t\t\t__js__(\"for( var f in o ) {\");\n\t\t\tif( f != \"__id__\" && f != \"hx__closures__\" && hasOwnProperty.call(o, f) ) a.push(f);\n\t\t\t__js__(\"}\");\n\t\t}\n\t\treturn a;\n\t}\n\n\tpublic static function isFunction( f : Dynamic ) : Bool untyped {\n\t\treturn __js__(\"typeof(f)\") == \"function\" && !(js.Boot.isClass(f) || js.Boot.isEnum(f));\n\t}\n\n\tpublic static function compare<T>( a : T, b : T ) : Int {\n\t\treturn ( a == b ) ? 0 : (((cast a) > (cast b)) ? 1 : -1);\n\t}\n\n\tpublic static function compareMethods( f1 : Dynamic, f2 : Dynamic ) : Bool {\n\t\tif( f1 == f2 )\n\t\t\treturn true;\n\t\tif( !isFunction(f1) || !isFunction(f2) )\n\t\t\treturn false;\n\t\treturn f1.scope == f2.scope && f1.method == f2.method && f1.method != null;\n\t}\n\n\tpublic static function isObject( v : Dynamic ) : Bool untyped {\n\t\tif( v == null )\n\t\t\treturn false;\n\t\tvar t = __js__(\"typeof(v)\");\n\t\treturn (t == \"string\" || (t == \"object\" && v.__enum__ == null)) || (t == \"function\" && (js.Boot.isClass(v) || js.Boot.isEnum(v)) != null);\n\t}\n\n\tpublic static function isEnumValue( v : Dynamic ) : Bool {\n\t\treturn v != null && v.__enum__ != null;\n\t}\n\n\tpublic static function deleteField( o : Dynamic, field : String ) : Bool untyped {\n\t\tif( !hasField(o,field) ) return false;\n\t\t__js__(\"delete\")(o[field]);\n\t\treturn true;\n\t}\n\n\tpublic static function copy<T>( o : T ) : T {\n\t\tvar o2 : Dynamic = {};\n\t\tfor( f in Reflect.fields(o) )\n\t\t\tReflect.setField(o2,f,Reflect.field(o,f));\n\t\treturn o2;\n\t}\n\n\t@:overload(function( f : Array<Dynamic> -> Void ) : Dynamic {})\n\tpublic static function makeVarArgs( f : Array<Dynamic> -> Dynamic ) : Dynamic {\n\t\treturn function() {\n\t\t\tvar a = untyped Array.prototype.slice.call(__js__(\"arguments\"));\n\t\t\treturn f(a);\n\t\t};\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport js.Boot;\n\n@:keepInit\n@:coreApi class Std {\n\n\tpublic static inline function is( v : Dynamic, t : Dynamic ) : Bool {\n\t\treturn untyped js.Boot.__instanceof(v,t);\n\t}\n\n\tpublic static inline function instance<T:{},S:T>( value : T, c : Class<S> ) : S {\n\t\treturn untyped __instanceof__(value, c) ? cast value : null;\n\t}\n\n\tpublic static function string( s : Dynamic ) : String {\n\t\treturn untyped js.Boot.__string_rec(s,\"\");\n\t}\n\n\tpublic static inline function int( x : Float ) : Int {\n\t\treturn (cast x) | 0;\n\t}\n\n\tpublic static function parseInt( x : String ) : Null<Int> {\n\t\tvar v = untyped __js__(\"parseInt\")(x, 10);\n\t\t// parse again if hexadecimal\n\t\tif( v == 0 && (x.charCodeAt(1) == 'x'.code || x.charCodeAt(1) == 'X'.code) )\n\t\t\tv = untyped __js__(\"parseInt\")(x);\n\t\tif( untyped __js__(\"isNaN\")(v) )\n\t\t\treturn null;\n\t\treturn cast v;\n\t}\n\n\tpublic static inline function parseFloat( x : String ) : Float {\n\t\treturn untyped __js__(\"parseFloat\")(x);\n\t}\n\n\tpublic static function random( x : Int ) : Int {\n\t\treturn untyped x <= 0 ? 0 : Math.floor(Math.random()*x);\n\t}\n\n\tstatic function __init__() : Void untyped {\n\t\t__feature__(\"js.Boot.getClass\",String.prototype.__class__ = __feature__(\"Type.resolveClass\",$hxClasses[\"String\"] = String,String));\n\t\t__feature__(\"js.Boot.isClass\",String.__name__ = __feature__(\"Type.getClassName\",[\"String\"],true));\n\t\t__feature__(\"Type.resolveClass\",$hxClasses[\"Array\"] = Array);\n\t\t__feature__(\"js.Boot.isClass\",Array.__name__ = __feature__(\"Type.getClassName\",[\"Array\"],true));\n\t\t__feature__(\"Date.*\", {\n\t\t\t__feature__(\"js.Boot.getClass\",__js__('Date').prototype.__class__ = __feature__(\"Type.resolveClass\",$hxClasses[\"Date\"] = __js__('Date'),__js__('Date')));\n\t\t\t__feature__(\"js.Boot.isClass\",__js__('Date').__name__ = [\"Date\"]);\n\t\t});\n\t\t__feature__(\"Int.*\",{\n\t\t\tvar Int = __feature__(\"Type.resolveClass\", $hxClasses[\"Int\"] = { __name__ : [\"Int\"] }, { __name__ : [\"Int\"] });\n\t\t});\n\t\t__feature__(\"Dynamic.*\",{\n\t\t\tvar Dynamic = __feature__(\"Type.resolveClass\", $hxClasses[\"Dynamic\"] = { __name__ : [\"Dynamic\"] }, { __name__ : [\"Dynamic\"] });\n\t\t});\n\t\t__feature__(\"Float.*\",{\n\t\t\tvar Float = __feature__(\"Type.resolveClass\", $hxClasses[\"Float\"] = __js__(\"Number\"), __js__(\"Number\"));\n\t\t\tFloat.__name__ = [\"Float\"];\n\t\t});\n\t\t__feature__(\"Bool.*\",{\n\t\t\tvar Bool = __feature__(\"Type.resolveEnum\",$hxClasses[\"Bool\"] = __js__(\"Boolean\"), __js__(\"Boolean\"));\n\t\t\tBool.__ename__ = [\"Bool\"];\n\t\t});\n\t\t__feature__(\"Class.*\",{\n\t\t\tvar Class = __feature__(\"Type.resolveClass\", $hxClasses[\"Class\"] = { __name__ : [\"Class\"] }, { __name__ : [\"Class\"] });\n\t\t});\n\t\t__feature__(\"Enum.*\",{\n\t\t\tvar Enum = {};\n\t\t});\n\t\t__feature__(\"Void.*\",{\n\t\t\tvar Void = __feature__(\"Type.resolveEnum\", $hxClasses[\"Void\"] = { __ename__ : [\"Void\"] }, { __ename__ : [\"Void\"] });\n\t\t});\n\n#if !js_es5\n\t\t__feature__(\"Array.map\",\n\t\t\tif( Array.prototype.map == null )\n\t\t\t\tArray.prototype.map = function(f) {\n\t\t\t\t\tvar a = [];\n\t\t\t\t\tfor( i in 0...__this__.length )\n\t\t\t\t\t\ta[i] = f(__this__[i]);\n\t\t\t\t\treturn a;\n\t\t\t\t}\n\t\t);\n\t\t__feature__(\"Array.filter\",\n\t\t\tif( Array.prototype.filter == null )\n\t\t\t\tArray.prototype.filter = function(f) {\n\t\t\t\t\tvar a = [];\n\t\t\t\t\tfor( i in 0...__this__.length ) {\n\t\t\t\t\t\tvar e = __this__[i];\n\t\t\t\t\t\tif( f(e) ) a.push(e);\n\t\t\t\t\t}\n\t\t\t\t\treturn a;\n\t\t\t\t}\n\t\t);\n#end\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n/**\n\tA String buffer is an efficient way to build a big string by appending small\n\telements together.\n\n\tIts cross-platform implementation uses String concatenation internally, but\n\tStringBuf may be optimized for different targets.\n\n\tUnlike String, an instance of StringBuf is not immutable in the sense that\n\tit can be passed as argument to functions which modify it by appending more\n\tvalues. However, the internal buffer cannot be modified.\n**/\nclass StringBuf {\n\n\tvar b:String;\n\n\t/**\n\t\tThe length of `this` StringBuf in characters.\n\t**/\n\tpublic var length(get,never) : Int;\n\n\t/**\n\t\tCreates a new StringBuf instance.\n\n\t\tThis may involve initialization of the internal buffer.\n\t**/\n\tpublic inline function new() {\n\t\tb = \"\";\n\t}\n\n\tinline function get_length() : Int {\n\t\treturn b.length;\n\t}\n\n\t/**\n\t\tAppends the representation of `x` to `this` StringBuf.\n\n\t\tThe exact representation of `x` may vary per platform. To get more\n\t\tconsistent behavior, this function should be called with\n\t\tStd.string(x).\n\n\t\tIf `x` is null, the String \"null\" is appended.\n\t**/\n\tpublic inline function add<T>( x : T ) : Void {\n\t\tb += x;\n\t}\n\n\t/**\n\t\tAppends the character identified by `c` to `this` StringBuf.\n\n\t\tIf `c` is negative or has another invalid value, the result is\n\t\tunspecified.\n\t**/\n\tpublic inline function addChar( c : Int ) : Void {\n\t\tb += String.fromCharCode(c);\n\t}\n\n\t/**\n\t\tAppends a substring of `s` to `this` StringBuf.\n\n\t\tThis function expects `pos` and `len` to describe a valid substring of\n\t\t`s`, or else the result is unspecified. To get more robust behavior,\n\t\t`this.add(s.substr(pos,len))` can be used instead.\n\n\t\tIf `s` or `pos` are null, the result is unspecified.\n\n\t\tIf `len` is omitted or null, the substring ranges from `pos` to the end\n\t\tof `s`.\n\t**/\n\tpublic inline function addSub( s : String, pos : Int, ?len : Int) : Void {\n\t\tb += (len == null ? s.substr(pos) : s.substr(pos, len));\n\t}\n\n\t/**\n\t\tReturns the content of `this` StringBuf as String.\n\n\t\tThe buffer is not emptied by this operation.\n\t**/\n\tpublic inline function toString() : String {\n\t\treturn b;\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nenum ValueType {\n\tTNull;\n\tTInt;\n\tTFloat;\n\tTBool;\n\tTObject;\n\tTFunction;\n\tTClass( c : Class<Dynamic> );\n\tTEnum( e : Enum<Dynamic> );\n\tTUnknown;\n}\n\n@:coreApi class Type {\n\n\tpublic static inline function getClass<T>( o : T ) : Class<T> {\n\t\treturn if (o == null) null else @:privateAccess js.Boot.getClass(o);\n\t}\n\n\tpublic static function getEnum( o : EnumValue ) : Enum<Dynamic> untyped {\n\t\tif( o == null )\n\t\t\treturn null;\n\t\treturn o.__enum__;\n\t}\n\n\tpublic static function getSuperClass( c : Class<Dynamic> ) : Class<Dynamic> untyped {\n\t\treturn c.__super__;\n\t}\n\n\n\tpublic static function getClassName( c : Class<Dynamic> ) : String {\n\t\tvar a : Array<String> = untyped c.__name__;\n\t\tif (a == null)\n\t\t\treturn null;\n\t\treturn a.join(\".\");\n\t}\n\n\tpublic static function getEnumName( e : Enum<Dynamic> ) : String {\n\t\tvar a : Array<String> = untyped e.__ename__;\n\t\treturn a.join(\".\");\n\t}\n\n\tpublic static function resolveClass( name : String ) : Class<Dynamic> untyped {\n\t\tvar cl : Class<Dynamic> = $hxClasses[name];\n\t\t// ensure that this is a class\n\t\tif( cl == null || !js.Boot.isClass(cl) )\n\t\t\treturn null;\n\t\treturn cl;\n\t}\n\n\tpublic static function resolveEnum( name : String ) : Enum<Dynamic> untyped {\n\t\tvar e : Dynamic = $hxClasses[name];\n\t\t// ensure that this is an enum\n\t\tif( e == null || !js.Boot.isEnum(e) )\n\t\t\treturn null;\n\t\treturn e;\n\t}\n\n\tpublic static function createInstance<T>( cl : Class<T>, args : Array<Dynamic> ) : T untyped {\n\t\tswitch( args.length ) {\n\t\tcase 0:\n\t\t\treturn __new__(cl);\n\t\tcase 1:\n\t\t\treturn __new__(cl,args[0]);\n\t\tcase 2:\n\t\t\treturn __new__(cl,args[0],args[1]);\n\t\tcase 3:\n\t\t\treturn __new__(cl,args[0],args[1],args[2]);\n\t\tcase 4:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3]);\n\t\tcase 5:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4]);\n\t\tcase 6:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4],args[5]);\n\t\tcase 7:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4],args[5],args[6]);\n\t\tcase 8:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4],args[5],args[6],args[7]);\n\t\tdefault:\n\t\t\tthrow \"Too many arguments\";\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic static function createEmptyInstance<T>( cl : Class<T> ) : T untyped {\n\t\t__js__(\"function empty() {}; empty.prototype = cl.prototype\");\n\t\treturn __js__(\"new empty()\");\n\t}\n\n\tpublic static function createEnum<T>( e : Enum<T>, constr : String, ?params : Array<Dynamic> ) : T {\n\t\tvar f:Dynamic = Reflect.field(e,constr);\n\t\tif( f == null ) throw \"No such constructor \"+constr;\n\t\tif( Reflect.isFunction(f) ) {\n\t\t\tif( params == null ) throw \"Constructor \"+constr+\" need parameters\";\n\t\t\treturn Reflect.callMethod(e,f,params);\n\t\t}\n\t\tif( params != null && params.length != 0 )\n\t\t\tthrow \"Constructor \"+constr+\" does not need parameters\";\n\t\treturn f;\n\t}\n\n\tpublic static function createEnumIndex<T>( e : Enum<T>, index : Int, ?params : Array<Dynamic> ) : T {\n\t\tvar c : String = (untyped e.__constructs__)[index];\n\t\tif( c == null ) throw index+\" is not a valid enum constructor index\";\n\t\treturn createEnum(e,c,params);\n\t}\n\n\tpublic static function getInstanceFields( c : Class<Dynamic> ) : Array<String> {\n\t\tvar a = [];\n\t\tuntyped __js__(\"for(var i in c.prototype) a.push(i)\");\n\t\ta.remove(\"__class__\");\n\t\ta.remove(\"__properties__\");\n\t\treturn a;\n\t}\n\n\tpublic static function getClassFields( c : Class<Dynamic> ) : Array<String> {\n\t\tvar a = Reflect.fields(c);\n\t\ta.remove(\"__name__\");\n\t\ta.remove(\"__interfaces__\");\n\t\ta.remove(\"__properties__\");\n\t\ta.remove(\"__super__\");\n\t\ta.remove(\"__meta__\");\n\t\ta.remove(\"prototype\");\n\t\treturn a;\n\t}\n\n\tpublic static function getEnumConstructs( e : Enum<Dynamic> ) : Array<String> {\n\t\tvar a : Array<String> = untyped e.__constructs__;\n\t\treturn a.copy();\n\t}\n\n\tpublic static function typeof( v : Dynamic ) : ValueType untyped {\n\t\tswitch( __js__(\"typeof\")(v) ) {\n\t\tcase \"boolean\": return TBool;\n\t\tcase \"string\": return TClass(String);\n\t\tcase \"number\":\n\t\t\t// this should handle all cases : NaN, +/-Inf and Floats outside range\n\t\t\tif( Math.ceil(v) == v%2147483648.0 )\n\t\t\t\treturn TInt;\n\t\t\treturn TFloat;\n\t\tcase \"object\":\n\t\t\tif( v == null )\n\t\t\t\treturn TNull;\n\t\t\tvar e = v.__enum__;\n\t\t\tif( e != null )\n\t\t\t\treturn TEnum(e);\n\t\t\tvar c = js.Boot.getClass(v);\n\t\t\tif( c != null )\n\t\t\t\treturn TClass(c);\n\t\t\treturn TObject;\n\t\tcase \"function\":\n\t\t\tif( js.Boot.isClass(v) || js.Boot.isEnum(v) )\n\t\t\t\treturn TObject;\n\t\t\treturn TFunction;\n\t\tcase \"undefined\":\n\t\t\treturn TNull;\n\t\tdefault:\n\t\t\treturn TUnknown;\n\t\t}\n\t}\n\n\tpublic static function enumEq<T>( a : T, b : T ) : Bool untyped {\n\t\tif( a == b )\n\t\t\treturn true;\n\t\ttry {\n\t\t\tif( a[0] != b[0] )\n\t\t\t\treturn false;\n\t\t\tfor( i in 2...a.length )\n\t\t\t\tif( !enumEq(a[i],b[i]) )\n\t\t\t\t\treturn false;\n\t\t\tvar e = a.__enum__;\n\t\t\tif( e != b.__enum__ || e == null )\n\t\t\t\treturn false;\n\t\t} catch( e : Dynamic ) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tpublic inline static function enumConstructor( e : EnumValue ) : String {\n\t\treturn untyped e[0];\n\t}\n\n\tpublic inline static function enumParameters( e : EnumValue ) : Array<Dynamic> {\n\t\treturn untyped e.slice(2);\n\t}\n\n\tpublic inline static function enumIndex( e : EnumValue ) : Int {\n\t\treturn untyped e[1];\n\t}\n\n\tpublic static function allEnums<T>( e : Enum<T> ) : Array<T> {\n\t\treturn untyped e.__empty_constructs__;\n\t}\n\n}\n\n","/*\n * Copyright (C)2005-2013 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\n#if ((flash || flash9doc || cs) && !doc_gen)\n/**\n\tThe unsigned Int type is only defined for Flash and C#. It's currently\n\thandled the same as a normal Int.\n**/\n@:coreType\n@:notNull\n@:runtimeValue\n@:analyzer(no_const_propagation)\nabstract UInt to Int from Int\n{\n\t@:commutative @:op(A+B) private static function addI(lhs:UInt, rhs:Int):UInt;\n\t@:commutative @:op(A+B) private static function addF(lhs:UInt, rhs:Float):Float;\n\t@:op(A+B) private static function add(lhs:UInt, rhs:UInt):UInt;\n\n\t@:commutative @:op(A*B) private static function mulI(lhs:UInt, rhs:Int):UInt;\n\t@:commutative @:op(A*B) private static function mulF(lhs:UInt, rhs:Float):Float;\n\t@:op(A*B) private static function mul(lhs:UInt, rhs:UInt):UInt;\n\n\t@:op(A%B) private static function modI(lhs:UInt, rhs:Int):UInt;\n\t@:op(A%B) private static function modF(lhs:UInt, rhs:Float):Float;\n\t@:op(A%B) private static function mod(lhs:UInt, rhs:UInt):UInt;\n\n\t@:op(A-B) private static function subI(lhs:UInt, rhs:Int):UInt;\n\t@:op(A-B) private static function subF(lhs:UInt, rhs:Float):Float;\n\t@:op(A-B) private static function sub(lhs:UInt, rhs:UInt):UInt;\n\n\t@:op(A/B) private static function divI(lhs:UInt, rhs:Int):Float;\n\t@:op(A/B) private static function divF(lhs:UInt, rhs:Float):Float;\n\t@:op(A/B) private static function div(lhs:UInt, rhs:UInt):Float;\n\n\t@:commutative @:op(A|B) private static function orI(lhs:UInt, rhs:Int):UInt;\n\t@:op(A|B) private static function or(lhs:UInt, rhs:UInt):UInt;\n\n\t@:commutative @:op(A^B) private static function xorI(lhs:UInt, rhs:Int):UInt;\n\t@:op(A^B) private static function xor(lhs:UInt, rhs:UInt):UInt;\n\n\t@:commutative @:op(A&B) private static function andI(lhs:UInt, rhs:Int):UInt;\n\t@:op(A&B) private static function and(lhs:UInt, rhs:UInt):UInt;\n\n\t@:op(A<<B) private static function shl(lhs:UInt, rhs:Int):UInt;\n\t@:op(A>>B) private static function shr(lhs:UInt, rhs:Int):UInt;\n\t@:op(A>>>B) private static function ushr(lhs:UInt, rhs:Int):UInt;\n\n\t@:op(A>B) private static function gt(lhs:UInt, rhs:UInt):Bool;\n\t@:op(A>=B) private static function gte(lhs:UInt, rhs:UInt):Bool;\n\t@:op(A<B) private static function lt(lhs:UInt, rhs:UInt):Bool;\n\t@:op(A<=B) private static function lte(lhs:UInt, rhs:UInt):Bool;\n\n\t@:op(A>B) private static function gtf(lhs:UInt, rhs:Float):Bool;\n\t@:op(A>B) private static function gtf(lhs:Float, rhs:UInt):Bool;\n\t@:op(A>=B) private static function gtef(lhs:UInt, rhs:Float):Bool;\n\t@:op(A>=B) private static function gtef(lhs:Float, rhs:UInt):Bool;\n\t@:op(A<B) private static function ltf(lhs:UInt, rhs:Float):Bool;\n\t@:op(A<B) private static function ltf(lhs:Float, rhs:UInt):Bool;\n\t@:op(A<=B) private static function ltef(lhs:UInt, rhs:Float):Bool;\n\t@:op(A<=B) private static function ltef(lhs:Float, rhs:UInt):Bool;\n\n\t@:op(~A) private static function bneg(t:UInt):UInt;\n\n\t@:commutative @:op(A == B) private static function equalsInt<T:Int>(a:UInt, b:T):Bool;\n\t@:commutative @:op(A != B) private static function notEqualsInt<T:Int>(a:UInt, b:T):Bool;\n\t@:commutative @:op(A == B) private static function equalsFloat<T:Float>(a:UInt, b:T):Bool;\n\t@:commutative @:op(A != B) private static function notEqualsFloat<T:Float>(a:UInt, b:T):Bool;\n\n\t@:op(++A) private function prefixIncrement():UInt;\n\t@:op(A++) private function postfixIncrement():UInt;\n\t@:op(--A) private function prefixDecrement():UInt;\n\t@:op(A--) private function postfixDecrement():UInt;\n}\n#else\n/**\n\tThe unsigned Int type is only defined for Flash and C#.\n\tSimulate it for other platforms.\n**/\nabstract UInt(Int) from Int to Int {\n\n\t@:op(A + B) private static inline function add(a:UInt, b:UInt):UInt {\n\t\treturn a.toInt() + b.toInt();\n\t}\n\n\t@:op(A / B) private static inline function div(a:UInt, b:UInt):Float {\n\t\treturn a.toFloat() / b.toFloat();\n\t}\n\n\t@:op(A * B) private static inline function mul(a:UInt, b:UInt):UInt {\n\t\treturn a.toInt() * b.toInt();\n\t}\n\n\t@:op(A - B) private static inline function sub(a:UInt, b:UInt):UInt {\n\t\treturn a.toInt() - b.toInt();\n\t}\n\n\t@:op(A > B) private static #if !js inline #end function gt(a:UInt, b:UInt):Bool {\n\t\tvar aNeg = a.toInt() < 0;\n\t\tvar bNeg = b.toInt() < 0;\n\t\treturn\n\t\t\tif( aNeg != bNeg ) aNeg;\n\t\t\telse a.toInt() > b.toInt();\n\t}\n\n\t@:op(A >= B) private static #if !js inline #end function gte(a:UInt, b:UInt):Bool {\n\t\tvar aNeg = a.toInt() < 0;\n\t\tvar bNeg = b.toInt() < 0;\n\t\treturn\n\t\t\tif( aNeg != bNeg ) aNeg;\n\t\t\telse a.toInt() >= b.toInt();\n\t}\n\n\t@:op(A < B) private static inline function lt(a:UInt, b:UInt):Bool {\n\t\treturn gt(b, a);\n\t}\n\n\t@:op(A <= B) private static inline function lte(a:UInt, b:UInt):Bool {\n\t\treturn gte(b, a);\n\t}\n\n\t@:op(A & B) private static inline function and(a:UInt, b:UInt):UInt {\n\t\treturn a.toInt() & b.toInt();\n\t}\n\n\t@:op(A | B) private static inline function or(a:UInt, b:UInt):UInt {\n\t\treturn a.toInt() | b.toInt();\n\t}\n\n\t@:op(A ^ B) private static inline function xor(a:UInt, b:UInt):UInt {\n\t\treturn a.toInt() ^ b.toInt();\n\t}\n\n\t@:op(A << B) private static inline function shl(a:UInt, b:Int):UInt {\n\t\treturn a.toInt() << b;\n\t}\n\n\t@:op(A >> B) private static inline function shr(a:UInt, b:Int):UInt {\n\t\treturn a.toInt() >> b;\n\t}\n\n\t@:op(A >>> B) private static inline function ushr(a:UInt, b:Int):UInt {\n\t\treturn a.toInt() >>> b;\n\t}\n\n\t@:op(A % B) private static inline function mod(a:UInt, b:UInt):UInt {\n\t\treturn Std.int( a.toFloat() % b.toFloat() );\n\t}\n\n\t@:commutative @:op(A + B) private static inline function addWithFloat(a:UInt, b:Float):Float {\n\t\treturn a.toFloat() + b;\n\t}\n\n\t@:commutative @:op(A * B) private static inline function mulWithFloat(a:UInt, b:Float):Float {\n\t\treturn a.toFloat() * b;\n\t}\n\n\t@:op(A / B) private static inline function divFloat(a:UInt, b:Float):Float {\n\t\treturn a.toFloat() / b;\n\t}\n\n\t@:op(A / B) private static inline function floatDiv(a:Float, b:UInt):Float {\n\t\treturn a / b.toFloat();\n\t}\n\n\t@:op(A - B) private static inline function subFloat(a:UInt, b:Float):Float {\n\t\treturn a.toFloat() - b;\n\t}\n\n\t@:op(A - B) private static inline function floatSub(a:Float, b:UInt):Float {\n\t\treturn a - b.toFloat();\n\t}\n\n\t@:op(A > B) private static inline function gtFloat(a:UInt, b:Float):Bool {\n\t\treturn a.toFloat() > b;\n\t}\n\n\t@:commutative @:op(A == B) private static inline function equalsInt<T:Int>(a:UInt, b:T):Bool {\n\t\treturn a.toInt() == b;\n\t}\n\n\t@:commutative @:op(A != B) private static inline function notEqualsInt<T:Int>(a:UInt, b:T):Bool {\n\t\treturn a.toInt() != b;\n\t}\n\n\t@:commutative @:op(A == B) private static inline function equalsFloat<T:Float>(a:UInt, b:T):Bool {\n        return a.toFloat() == b;\n    }\n\n    @:commutative @:op(A != B) private static inline function notEqualsFloat<T:Float>(a:UInt, b:T):Bool {\n        return a.toFloat() != b;\n    }\n\n\t@:op(A >= B) private static inline function gteFloat(a:UInt, b:Float):Bool {\n\t\treturn a.toFloat() >= b;\n\t}\n\n\n\t@:op(A > B) private static inline function floatGt(a:Float, b:UInt):Bool {\n\t\treturn a > b.toFloat();\n\t}\n\n\t@:op(A >= B) private static inline function floatGte(a:Float, b:UInt):Bool {\n\t\treturn a >= b.toFloat();\n\t}\n\n\t@:op(A < B) private static inline function ltFloat(a:UInt, b:Float):Bool {\n\t\treturn a.toFloat() < b;\n\t}\n\n\t@:op(A <= B) private static inline function lteFloat(a:UInt, b:Float):Bool {\n\t\treturn a.toFloat() <= b;\n\t}\n\n\t@:op(A < B) private static inline function floatLt(a:Float, b:UInt):Bool {\n\t\treturn a < b.toFloat();\n\t}\n\n\t@:op(A <= B) private static inline function floatLte(a:Float, b:UInt):Bool {\n\t\treturn a <= b.toFloat();\n\t}\n\n\t@:op(A % B) private static inline function modFloat(a:UInt, b:Float):Float {\n\t\treturn a.toFloat() % b;\n\t}\n\n\t@:op(A % B) private static inline function floatMod(a:Float, b:UInt):Float {\n\t\treturn a % b.toFloat();\n\t}\n\n\t@:op(~A) private inline function negBits():UInt {\n\t\treturn ~this;\n\t}\n\n\t@:op(++A) private inline function prefixIncrement():UInt {\n\t\treturn ++this;\n\t}\n\n\t@:op(A++) private inline function postfixIncrement():UInt {\n\t\treturn this++;\n\t}\n\n\t@:op(--A) private inline function prefixDecrement():UInt {\n\t\treturn --this;\n\t}\n\n\t@:op(A--) private inline function postfixDecrement():UInt {\n\t\treturn this--;\n\t}\n\n\t// TODO: radix is just defined to deal with doc_gen issues\n\tprivate inline function toString(?radix:Int):String {\n\t\treturn Std.string(toFloat());\n\t}\n\n\tprivate inline function toInt():Int {\n\t\treturn this;\n\t}\n\n\t@:to private #if (!js || analyzer) inline #end function toFloat():Float {\n\t\tvar int = toInt();\n\t\tif (int < 0) {\n\t\t\treturn 4294967296.0 + int;\n\t\t}\n\t\telse {\n\t\t\t// + 0.0 here to make sure we promote to Float on some platforms\n\t\t\t// In particular, PHP was having issues when comparing to Int in the == op.\n\t\t\treturn int + 0.0;\n\t\t}\n\t}\n}\n#end\n","package com.isartdigital.builder;\n\nimport com.isartdigital.builder.game.manager.RessourceManager;\nimport com.isartdigital.builder.game.manager.Ressources;\nimport com.isartdigital.builder.ui.GraphicLoader;\nimport com.isartdigital.builder.ui.screens.TitleCard;\nimport com.isartdigital.builder.ui.UIManager;\nimport com.isartdigital.builder.ui.uimodule.BackButton;\nimport com.isartdigital.builder.ui.uimodule.CreditsButton;\nimport com.isartdigital.builder.ui.uimodule.PlayButton;\nimport com.isartdigital.builder.ui.uimodule.ShopButton1;\nimport com.isartdigital.utils.Config;\nimport com.isartdigital.utils.Debug;\nimport com.isartdigital.utils.events.EventType;\nimport com.isartdigital.utils.events.LoadEventType;\nimport com.isartdigital.utils.facebook.Facebook;\nimport com.isartdigital.utils.game.factory.MovieClipAnimFactory;\nimport com.isartdigital.utils.game.GameStage;\nimport com.isartdigital.utils.game.GameStageScale;\nimport com.isartdigital.builder.game.GameManager;\nimport com.isartdigital.utils.game.StateGraphic;\nimport com.isartdigital.utils.loader.GameLoader;\nimport com.isartdigital.utils.system.DeviceCapabilities;\nimport com.isartdigital.utils.ui.UIBuilder;\nimport eventemitter3.EventEmitter;\nimport haxe.Http;\nimport js.Browser;\nimport pixi.core.display.Container;\nimport pixi.core.renderers.Detector;\nimport pixi.core.renderers.webgl.WebGLRenderer;\nimport pixi.interaction.EventTarget;\nimport pixi.loaders.Loader;\n\n/**\n * Classe d'initialisation et lancement du jeu\n * @author Mathieu ANTHOINE\n */\n\n// TODO: resolution <- ??\n\nclass Main extends EventEmitter\n{\n\t\n\tprivate var increase:Bool = true;\n\t/**\n\t * chemin vers le fichier de configuration\n\t */\n\tprivate static inline var CONFIG_PATH:String = \"config.json\";\t\n\t\n\t/**\n\t * instance unique de la classe Main\n\t */\n\tprivate static var instance: Main;\n\t\n\t/**\n\t * renderer (WebGL ou Canvas)\n\t */\n\tpublic var renderer:WebGLRenderer;\n\t\n\t/**\n\t * Element racine de la displayList\n\t */\n\tpublic var stage:Container;\n\t\n\t/**\n\t * initialisation générale\n\t */\n\tprivate static function main ():Void {\n\t\tMain.getInstance();\n\t}\n\n\t/**\n\t * Retourne l'instance unique de la classe, et la crée si elle n'existait pas au préalable\n\t * @return instance unique\n\t */\n\tpublic static function getInstance (): Main {\n\t\tif (instance == null) instance = new Main();\n\t\treturn instance;\n\t}\n\t\n\t/**\n\t * création du jeu et lancement du chargement du fichier de configuration\n\t */\n\tprivate function new () {\n\t\tsuper();\n\t\t\n\t\tif (Browser.getLocalStorage().getItem('token') == null) {\n\t\t\tBrowser.location.href = '../';\n\t\t}\n\n\t\tvar lOptions:RenderingOptions = {};\n\t\t//lOptions.antialias = true;\n\t\t//lOptions.autoResize = true;\n\t\tlOptions.backgroundColor = 0x999999;\n\t\t//lOptions.resolution = 1;\n\t\t//lOptions.transparent = false;\n\t\t//lOptions.preserveDrawingBuffer (pour dataToURL)\n\t\t\n\t\tDeviceCapabilities.scaleViewport();\n\t\t\n\t\trenderer = Detector.autoDetectRenderer(DeviceCapabilities.width, DeviceCapabilities.height, lOptions);\n\t\t\n\t\tBrowser.document.body.appendChild(renderer.view);\n\t\t\n\t\tstage = new Container();\n\t\t\n\t\tFacebook.onLogin = onFacebookLogin;\n\t\tFacebook.load(\"750435741727559\");\n\t\t\n\t\tvar lConfig:Loader = new Loader();\n\t\t\n\t\tlConfig.add(CONFIG_PATH);\n\t\tlConfig.once(LoadEventType.COMPLETE, preloadAssets);\n\t\t\n\t\tlConfig.load();\n\t}\n\t\n\t/**\n\t * charge les assets graphiques du preloader principal\n\t */\n\tprivate function preloadAssets(pLoader:Loader):Void {\n\t\t\n\t\t// initialise les paramètres de configuration\n\t\tConfig.init(Reflect.field(pLoader.resources,CONFIG_PATH).data);\n\t\t\n\t\t// Active le mode debug\n\t\tif (Config.debug) Debug.getInstance().init();\n\t\t// défini l'alpha des Boxes de collision\n\t\tif (Config.debug && Config.data.boxAlpha != null) StateGraphic.boxAlpha = Config.data.boxAlpha;\n\t\t// défini l'alpha des anims\n\t\tif (Config.debug && Config.data.animAlpha != null) StateGraphic.animAlpha = Config.data.animAlpha;\n\t\t\n\t\t// défini le mode de redimensionnement du Jeu\n\t\tGameStage.getInstance().scaleMode = GameStageScale.NO_SCALE;\n\t\t// initialise le GameStage et défini la taille de la safeZone\n\t\tGameStage.getInstance().init(render,1334, 750,true);\n\t\t\n\t\t// affiche le bouton FullScreen quand c'est nécessaire\n\t\tDeviceCapabilities.displayFullScreenButton();\n\t\tDeviceCapabilities.init();\n\t\t\n\t\t// Ajoute le GameStage au stage\n\t\tstage.addChild(GameStage.getInstance());\n\t\t\n\t\t// ajoute Main en tant qu'écouteur des évenements de redimensionnement\n\t\tBrowser.window.addEventListener(EventType.RESIZE, resize);\n\t\tresize();\n\t\t\n\t\t// lance le chargement des assets graphiques du preloader\n\t\tvar lLoader:GameLoader = new GameLoader();\n\t\tlLoader.addAssetFile(\"preload.png\");\n\t\tlLoader.addAssetFile(\"preload_bg.png\");\n\t\t\n\t\t\n\t\tlLoader.once(LoadEventType.COMPLETE, loadAssets);\n\t\tlLoader.load();\n\t\t\n\t}\t\n\t\n\t/**\n\t * lance le chargement principal\n\t */\n\tprivate function loadAssets (pLoader:GameLoader): Void {\n\t\t\n\t\tvar lLoader:GameLoader = new GameLoader();\n\t\t\t\t\n\t\t//lLoader.addTxtFile(\"boxes.json\");\n\t\tlLoader.addSoundFile(\"sounds.json\");\n\n\t\tlLoader.addJsonFile(\"basemap.json\");\n\t\tlLoader.addJsonFile(\"building.json\");\n\t\tlLoader.addAssetFile(\"graphics.json\");\n\t\tlLoader.addAssetFile(\"background.json\");\n\t\t\n\t\tlLoader.addTxtFile(\"hd/ui/textsUI.json\");\n\t\t\n\t\tlLoader.addAssetFile(\"Citizen.png\");\n\t\t\n\t\tlLoader.addAssetFile(DeviceCapabilities.textureType+\"/ingame/library.json\");\n\t\tlLoader.addAssetFile(DeviceCapabilities.textureType+\"/ui/library.json\");\n\t\t\n\t\tlLoader.addFontFile(\"fonts.css\");\n\t\t\n\t\tlLoader.on(LoadEventType.PROGRESS, onLoadProgress);\n\t\tlLoader.once(LoadEventType.COMPLETE, onLoadComplete);\n\t\t\n\t\t// affiche l'écran de préchargement\n\t\tUIManager.getInstance().openScreen(GraphicLoader.getInstance());\n\t\t\n\t\tBrowser.window.requestAnimationFrame(cast gameLoop);\n\t\t\n\t\tlLoader.load();\n\t\t\n\t}\n\t\n\t/**\n\t * transmet les paramètres de chargement au préchargeur graphique\n\t * @param\tpEvent evenement de chargement\n\t */\n\tprivate function onLoadProgress (pLoader:GameLoader): Void {\n\t\tGraphicLoader.getInstance().update(pLoader.progress/100);\n\t}\n\t\n\t/**\n\t * initialisation du jeu\n\t * @param\tpEvent evenement de chargement\n\t */\n\tprivate function onLoadComplete (pLoader:GameLoader): Void {\n\t\t\n\t\tpLoader.off(LoadEventType.PROGRESS, onLoadProgress);\n\t\t\n\t\t// transmet au StateGraphic la description des planches de Sprites utilisées par les instances de StateGraphic\n\t\tMovieClipAnimFactory.addTextures(GameLoader.getContent(\"graphics.json\"));\n\t\tMovieClipAnimFactory.addTextures(GameLoader.getContent(\"assets.json\"));\n\t\tMovieClipAnimFactory.addTextures(GameLoader.getContent(\"bakckground.json\"));\n\t\t///StateFlumpMoviaddTextures(GameLoader.getContent(\"library.json\"));\n\t\t// transmet au StateGraphic la description des boxes de collision utilisées par les instances de StateGraphic\n\t\tStateGraphic.addBoxes(GameLoader.getContent(\"\"));\n\t\t\n\t\t//initialise le builder d'UI\n\t\tUIBuilder.init(\"hd/ui/library.json\", \"com.isartdigital.builder.ui.uimodule\");\n\t\t\n\t\t// Ouvre la TitleClard\n\t\t//UIManager.getInstance().openScreen(TitleCard.getInstance());\n\t\tUIManager.getInstance().startGame();\n\t\tGameManager.getInstance().start();\n\t}\n\t\n\t/**\n\t * game loop\n\t */\n\tprivate function gameLoop() {\n\t\tBrowser.window.requestAnimationFrame(cast gameLoop);\n\t\t\n\t\trender();\t\t\n\t\temit(EventType.GAME_LOOP);\n\t}\n\t\n\t/**\n\t * Ecouteur du redimensionnement\n\t * @param\tpEvent evenement de redimensionnement\n\t */\n\tpublic function resize (pEvent:EventTarget = null): Void {\n\t\trenderer.resize(DeviceCapabilities.width, DeviceCapabilities.height);\n\t\tGameStage.getInstance().resize();\n\t}\n\t\n\t/**\n\t * fait le rendu de l'écran\n\t */\n\tprivate function render (): Void {\n\t\trenderer.render(stage);\n\t}\n\t\t\n\t/**\n\t * détruit l'instance unique et met sa référence interne à null\n\t */\n\tpublic function destroy (): Void {\n\t\tBrowser.window.removeEventListener(EventType.RESIZE, resize);\n\t\tinstance = null;\n\t}\n\t\n\tprivate static function importClasses():Void {\n\t\tPlayButton;\n\t\tCreditsButton;\n\t\tBackButton;\n\t\tShopButton1;\n\t}\n\t\n\t/**\n\t * Fonction appellé quand la connection à facebook est réussi\n\t */\n\tprivate function onFacebookLogin ():Void  {\n\t\t//Facebook.api(Facebook.uid, { fields: \"first_name,last_name,bio,email\" }, callBackApi);\n\t\t// Facebook.ui( { method: 'share', href: 'https://developers.facebook.com/docs/' }, callBackUI);\n\t}\n\t\n\tprivate function callBackApi(pData:Dynamic):Void {\n\t\tif (pData == null) trace(\"Erreur facebook API\");\n\t\telse if (pData.error != null) trace (pData.error);\n\t\telse trace(pData);\n\t}\n\t\n\tprivate function callBackUI(pData:Dynamic):Void {\n\t\tif (pData == null) trace(\"Erreur facebook API\");\n\t\telse if (pData.error_message != null) trace (pData.error_message);\n\t\telse trace(pData);\n\t}\n}","package com.isartdigital.builder.api;\r\nimport js.Browser;\r\n\r\n\t\r\n/**\r\n * ...\r\n * @author Flavien\r\n */\r\nclass Api \r\n{\t\r\n\t//public static var domain:String = \"https://fbgame.isartdigital.com/2017_builder/builder2/api/index.php/v1\";\r\n\tpublic static var domain:String = \"https://localhostbuilder.com/\";\r\n\t\r\n\tpublic static var pathApi:String = \"api/v1/\";\r\n\t\r\n\tpublic static var token:String;\r\n\t\r\n\tpublic static var resources:Resources;\r\n\t\r\n\t\t/**\r\n\t * instance unique de la classe Resources\r\n\t */\r\n\tprivate static var instance: Api;\r\n\t\r\n\t/**\r\n\t * Retourne l'instance unique de la classe, et la crée si elle n'existait pas au préalable\r\n\t * @return instance unique\r\n\t */\r\n\tpublic static function getInstance (): Api {\r\n\t\tif (instance == null) instance = new Api();\r\n\t\treturn instance;\r\n\t}\r\n\t\r\n\t/**\r\n\t * constructeur privé pour éviter qu'une instance soit créée directement\r\n\t */\r\n\tprivate function new() \r\n\t{\r\n\t\tinstance = this;\r\n\t\t\r\n\t\ttoken = Browser.getLocalStorage().getItem(\"token\");\r\n\t\t\r\n\t\tresources = Resources.getInstance();\r\n\t\t\r\n\t}\r\n}","package com.isartdigital.builder.api;\r\nimport haxe.Http;\r\nimport js.Browser;\r\n\r\n\t\r\n/**\r\n * ...\r\n * @author Flavien\r\n */\r\nclass Resources\r\n{\r\n\t\r\n\t/**\r\n\t * instance unique de la classe Resources\r\n\t */\r\n\tprivate static var instance: Resources;\r\n\t\r\n\t/**\r\n\t * Retourne l'instance unique de la classe, et la crée si elle n'existait pas au préalable\r\n\t * @return instance unique\r\n\t */\r\n\tpublic static function getInstance (): Resources {\r\n\t\tif (instance == null) instance = new Resources();\r\n\t\treturn instance;\r\n\t}\r\n\t\r\n\tprivate var resourcesPath:String = \"resources\";\r\n\tprivate var goldPath:String = \"/gold\";\r\n\tprivate var spicePath:String = \"/spice\";\r\n\tprivate var offeringPath:String = \"/offering\";\r\n\t\r\n\t/**\r\n\t * constructeur privé pour éviter qu'une instance soit créée directement\r\n\t */\r\n\tprivate function new() \r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function all (pCallBack:String->Void) {\r\n\t\t//notre requete en ajax\r\n\t\t\r\n\t\tvar requete = new Http(Api.domain + Api.pathApi + resourcesPath + \"?token=\" + Api.token);\r\n\t\t\r\n\t\trequete.onData = pCallBack;\r\n\t\trequete.request(false);\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function gold (pCallBack:String->Void) {\r\n\t\tvar requete = new Http(Api.domain + Api.pathApi + resourcesPath + goldPath + \"?token=\" + Api.token);\r\n\t\t\r\n\t\trequete.onData = pCallBack;\r\n\t\trequete.request(false);\r\n\t}\r\n\t\r\n\tpublic function spice (pCallBack:String->Void) {\r\n\t\tvar requete = new Http(Api.domain + Api.pathApi + resourcesPath + spicePath + \"?token=\" + Api.token);\r\n\t\t\r\n\t\trequete.onData = pCallBack;\r\n\t\trequete.request(false);\r\n\t}\r\n\t\r\n\tpublic function offering (pCallBack:String->Void) {\t\t\r\n\t\tvar requete = new Http(Api.domain + Api.pathApi + resourcesPath + offeringPath + \"?token=\" + Api.token);\r\n\t\t\r\n\t\trequete.onData = pCallBack;\r\n\t\trequete.request(false);\r\n\t}\r\n}","package com.isartdigital.builder.game;\n\nimport com.isartdigital.builder.api.Api;\nimport com.isartdigital.builder.api.DataDef;\nimport com.isartdigital.builder.game.def.BuildingDef;\nimport com.isartdigital.builder.game.def.BuildingSavedDef;\nimport com.isartdigital.builder.game.def.TileSavedDef;\nimport com.isartdigital.builder.game.manager.ClippingManager;\nimport com.isartdigital.builder.game.manager.MapManager;\nimport com.isartdigital.builder.game.pooling.PoolObject;\nimport com.isartdigital.builder.game.sprites.Building;\nimport com.isartdigital.builder.game.sprites.Citizen;\nimport com.isartdigital.builder.game.sprites.SpriteObject;\nimport com.isartdigital.builder.game.sprites.Tile;\nimport com.isartdigital.builder.game.utils.TypeDefUtils;\nimport com.isartdigital.builder.ui.CheatPanel;\nimport com.isartdigital.builder.ui.hud.Hud;\nimport com.isartdigital.builder.ui.UIManager;\nimport com.isartdigital.utils.Config;\nimport com.isartdigital.utils.Debug;\nimport com.isartdigital.utils.events.EventType;\nimport com.isartdigital.utils.events.MouseEventType;\nimport com.isartdigital.utils.facebook.Facebook;\nimport com.isartdigital.utils.game.Camera;\nimport com.isartdigital.utils.game.CollisionManager;\nimport com.isartdigital.utils.game.GameStage;\nimport com.isartdigital.utils.game.iso.IsoManager;\nimport com.isartdigital.utils.game.IStateMachine;\nimport com.isartdigital.utils.loader.GameLoader;\nimport com.isartdigital.utils.Localization;\nimport com.isartdigital.utils.system.DeviceCapabilities;\nimport haxe.Json;\nimport js.Browser;\nimport js.html.MouseEvent;\nimport pixi.core.math.Point;\nimport pixi.core.math.shapes.Rectangle;\nimport pixi.interaction.EventTarget;\nimport pixi.interaction.InteractionManager;\n\n/**\n * Manager (Singleton) en charge de gérer le déroulement d'une partie\n * @author Mathieu ANTHOINE\n */\nclass GameManager\n{\n\t\n\t/**\n\t * instance unique de la classe GameManager\n\t */\n\tprivate static var instance: GameManager;\n\t\n\tpublic var mousePosition:Point = new Point( -1, -1);\n\t\n\tpublic var screenRect:Rectangle;\n\t\n\tpublic function get_ScreenRect():Rectangle {\n\t\treturn screenRect;\n\t}\n\t\n\t\n\t/**\n\t * Retourne l'instance unique de la classe, et la crée si elle n'existait pas au préalable\n\t * @return instance unique\n\t */\n\tpublic static function getInstance (): GameManager {\n\t\tif (instance == null) instance = new GameManager();\n\t\treturn instance;\n\t}\n\t\n\tprivate function new() {\n\t\t\n\t}\n\t\n\tprivate function refreshMouseCoordinates(pEvent:MouseEvent) {\n\t\tvar position:Point = GameStage.getInstance().getGameContainer().toLocal(new Point(pEvent.layerX, pEvent.layerY));\n\t\tmousePosition.set(position.x, position.y);\n\t}\n\t\n\t//exemple callback pour api.user.create\n\tprivate function cb_createUser (pData:String): Void {\n\t\t//var jData:Json = Json.parse(pData);\n\t\tvar lData:DataDef = cast(Json.parse(pData));\n\t\t\n\t\tif (lData.error)\n\t\t{\n\t\t\ttrace(lData.errorMessage);\n\t\t\treturn;\n\t\t}\n\t}\n\t\n\tprivate function cb_resourceAll (pData:String) : Void\n\t{\n\t\tvar lData:DataDef = cast(Json.parse(pData));\n\t\t\n\t\tif (lData.error)\n\t\t{\n\t\t\tDebug.error(lData.errorMessage);\n\t\t\treturn;\n\t\t}\n\t\t\n\t\ttrace(lData.data);\n\t}\n\t\n\tpublic function start (): Void {\n\t\t\n\t\tApi.getInstance();\n\t\t\n\t\t//Localization.getInstance().selectJson(\"fr\");\n\t\t\n\t\t// Focus de la camera \n\t\tvar lCamera:Camera = Camera.getInstance();\n\t\t\n\t\tGameStage.getInstance().getGameContainer().addChild(lCamera.cameraFocus);\n\t\tlCamera.setTarget(GameStage.getInstance().getGameContainer());\n\t\tlCamera.setFocus(lCamera.cameraFocus);\n\t\t\n\t\t// Event de souris mouseMove\n\t\tBrowser.window.addEventListener(MouseEventType.MOUSE_MOVE, refreshMouseCoordinates);\n\t\t\n\t\t// Initialisation de l'isoManager\n\t\tIsoManager.init(Config.tileWidth, Config.tileHeight);\n\t\t\n\t\t// demande au Manager d'interface de se mettre en mode \"jeu\"\n\t\tUIManager.getInstance().startGame();\n\t\t\n\t\t// enregistre le GameManager en tant qu'écouteur de la gameloop principale\n\t\tMain.getInstance().on(EventType.GAME_LOOP, gameLoop);\t\n\t\t\n\t\t// début de l'initialisation du jeu\n\t\tCheatPanel.getInstance().ingame();\n\t\tMapManager.getInstance().generateMap();\n\t\t\n\t\t//Centre la caméra\n\t\tCamera.getInstance().centerView();\n\t\t\n\t\t//Défini le screen rect\n\t\tscreenRect = DeviceCapabilities.getScreenRect(GameStage.getInstance().getGameContainer());\n\t\n\t\t//new clipping\n\t\tvar lTypeDefArray:Array<Dynamic> = new Array<Dynamic> ();\n\t\tvar ltd:TileSavedDef = {x:null, y:null, isBuildable:null};\n\t\tvar lbd:BuildingSavedDef = {x:null, y:null , name:null, buildingLevel:null};\n\t\tlTypeDefArray.push(ltd);\n\t\tlTypeDefArray.push(lbd);\n\t\t\t\n\t\t//initialise le clipping\n\t\tClippingManager.getInstance().setOn(MapManager.getInstance().globalMap, [cast(Tile.list), cast(Building.list)], new Point(Config.tileWidth / 2, Config.tileHeight / 2), lTypeDefArray, [Tile, Building], get_ScreenRect);\n\t\t\n\t\tvar lCitizen:Citizen = new Citizen();\n\t\tGameStage.getInstance().getGameContainer().addChild(lCitizen);\n\t\t\n\t\tlCitizen.start();\n\t\t\n\t\t//Localization.getInstance().getText(\"title_screen_play\");\n\t\tClippingManager.getInstance().addAllObjetInView();\n\t\t\n\t\tHud.getInstance().refreshHUD();\n\t}\n\t\n\t/**\n\t * boucle de jeu (répétée à la cadence du jeu en fps)\n\t */\n\tpublic function gameLoop (pEvent:EventTarget): Void {\n\t\tscreenRect = DeviceCapabilities.getScreenRect(GameStage.getInstance().getGameContainer());\n\t\tscreenRect.x = Math.round(screenRect.x);\n\t\tscreenRect.y = Math.round(screenRect.y);\n\t\t\n\t\t// le renderer possède une propriété plugins qui contient une propriété interaction de type InteractionManager\n\t\t// les instances d'InteractionManager fournissent un certain nombre d'informations comme les coordonnées globales de la souris\n\t\tCamera.getInstance().move();\n\t\t\n\t\tClippingManager.getInstance().manage();\n\t\t\n\t\tdoActions(cast Building.list);\n\t\t\n\t\t// Pour le debug :\n\t\t// MapManager.getInstance().displayTilePositionUnderMouse();\n\t\t// moveCitizen();\n\t}\n\t\n\t\n\tprivate function doActions (list:Array<IStateMachine>) {\n\t\tfor (i in 0...list.length) list[i].doAction();\n\t}\n\t\n\t\n\tprivate function moveCitizen():Void {\n\t\tfor (lCitizen in Citizen.list) {\n\t\t\tlCitizen.doAction();\n\t\t}\n\t}\n\n\t\n\t/**\n\t * détruit l'instance unique et met sa référence interne à null\n\t */\n\tpublic function destroy (): Void {\n\t\tMain.getInstance().off(EventType.GAME_LOOP,gameLoop);\n\t\tinstance = null;\n\t}\n\n}","package com.isartdigital.builder.game.manager;\r\nimport com.isartdigital.builder.game.def.BuildingDef;\r\nimport com.isartdigital.builder.game.def.PointDef;\r\nimport com.isartdigital.builder.game.def.TileSavedDef;\r\nimport com.isartdigital.builder.game.pooling.IPoolObject;\r\nimport com.isartdigital.builder.game.pooling.PoolObject;\r\nimport com.isartdigital.builder.game.sprites.Building;\r\nimport com.isartdigital.builder.game.sprites.Tile;\r\nimport com.isartdigital.utils.Config;\r\nimport com.isartdigital.utils.Debug;\r\nimport com.isartdigital.utils.game.CollisionManager;\r\nimport com.isartdigital.utils.game.iso.IsoManager;\r\nimport js.html.Rect;\r\nimport pixi.core.math.shapes.Rectangle;\r\nimport pixi.core.math.Point;\r\n\r\n/**\r\n * Système de clipping d'objets\r\n * @author Flavien\r\n */\r\nclass ClippingManager\r\n{\r\n\tprivate static var Instance: ClippingManager = null;\r\n\t\r\n\tprivate static inline var SAFE_MARGE_VIEW:Float = 100;\r\n\tprivate static var SAFE_MARGE_MODEL:Float = 0;\r\n\t\r\n\tprivate var map:Map<String, Array<Dynamic>>;\r\n\tprivate var delta:Point = new Point();\r\n\tprivate var typeDefModels:Array<Dynamic> = new Array<Dynamic> ();\r\n\tprivate var classView:Array<Class<IPoolObject>> = new Array<Class<IPoolObject>> ();\r\n\tprivate var screenRectView:Void->Rectangle;\r\n\tprivate var objectListView:Array<Array<IPoolObject>> = new Array<Array<IPoolObject>>();\r\n\tprivate var screenRectModel:Rectangle;\r\n\t\r\n\tprivate var direction:String = \"UP\";\r\n\t\r\n\tprivate var clipInX:Int = 0;\r\n\tprivate var clipInY:Int = 0;\r\n\t\r\n\t/**\r\n\t * Retourne l'instance unique de la classe, et la crée si elle n'existait pas au préalable\r\n\t * @return instance unique\r\n\t */\r\n\tpublic static function getInstance (): ClippingManager {\r\n\t\tif (Instance == null) Instance = new ClippingManager();\r\n\t\treturn Instance;\r\n\t}\r\n\t\r\n\t//variable d'offset\r\n\tprivate var currentScreenPosition:Point = new Point();\r\n\tprivate var screenPosition:Point = new Point();\r\n\t\r\n\tprivate var TOP_RIGHT:Point = new Point();\r\n\tprivate var BOTTOM_LEFT:Point = new Point();\r\n\tprivate var BOTTOM_RIGHT:Point = new Point();\r\n\tprivate var BOTTOM_RIGHT_RIGHT:Point = new Point();\r\n\t\r\n\t\r\n\t\r\n\tprivate function new() \r\n\t{\r\n\r\n\t}\r\n\t\r\n\t/**\r\n\t * Configue le clipping.\r\n\t * les index de pBuilding doit correspondre aux index de pTypeDef\r\n\t * @param\tpMap Map de Modèle\r\n\t * @param\tpDelta delta de clipping\r\n\t * @param\tpDef TypeDef du modèle\r\n\t * @param\tpBuilding Class de sortie qui implémente le pooling\r\n\t * @param\tpScreeRectRef getter du carré de référence\r\n\t */\r\n\tpublic function setOn(pMapModel:Map<String, Array<Dynamic>>, pListView:Array<Array<IPoolObject>>, pDelta:Point, pDef:Array<Dynamic>, pBuilding:Array<Class<IPoolObject>>, pScreeRectRef:Void->Rectangle) : Void\r\n\t{\r\n\t\tif (typeDefModels.length != pBuilding.length && pBuilding.length != pListView.length)\r\n\t\t{\r\n\t\t\tDebug.error(\"SetOn Clipping -> pBuilding & pDef doesn't have the same length\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\t//TODO test pListView pareil que pBuilding\r\n\t\t\r\n\t\tmap = pMapModel;\r\n\t\tobjectListView = pListView;\r\n\t\tdelta = pDelta;\r\n\t\ttypeDefModels = pDef.copy();\r\n\t\tclassView = pBuilding.copy();\r\n\t\tscreenRectView = pScreeRectRef;\r\n\t\t//trace(\"set on \" + screenRectView().x);\r\n\t\tscreenPosition.set(screenRectView().x, screenRectView().y);\r\n\t\tSAFE_MARGE_MODEL = Math.round(SAFE_MARGE_VIEW / Config.tileHeight);\r\n\t\tSAFE_MARGE_MODEL = Math.round(SAFE_MARGE_VIEW / Config.tileHeight);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Fais le taff\r\n\t */\r\n\tpublic function manage () : Void\r\n\t{\r\n\t\tif (!hadToManage()) return;\r\n\t\t\r\n\t\t//Debug.info(\"Number of Tile : \" + Tile.list.length);\r\n\t\tremoveObject();\r\n\t\t//Debug.info(\"Number of Tile after remove : \" + Tile.list.length);\r\n\t\t//addAllObjetInView();\r\n\t\tif (clipInX > 10 || clipInY > 10) addAllObjetInView();\r\n\t\telse addObject();\r\n\t\t\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function addAllObjetInView():Void {\r\n\t\tsetScreenRectModel();\r\n\t\tcreateObjFromModel(getAllRow());\r\n\t}\r\n\t\r\n\tprivate function addObject ():Void {\r\n\t\tsetScreenRectModel();\r\n\t\t\r\n\t\tvar lArray:Array<Dynamic> = new Array<Dynamic> ();\r\n\t\tif (direction == \"UP\") lArray = getUpRow();\r\n\t\telse if (direction == \"DOWN\") lArray = getDownRow();\r\n\t\telse if (direction == \"LEFT\") lArray = getLeftCol();\r\n\t\telse if (direction == \"RIGHT\") lArray = getRightCol();\r\n\t\t\r\n\t\tcreateObjFromModel(lArray);\r\n\t}\r\n\t\r\n\tprivate function createObjFromModel (pArray:Array<Dynamic>): Void\r\n\t{\r\n\t\tfor (lModel in pArray)\r\n\t\t{\r\n\t\t\tvar i:Int = typeDefModels.length;\r\n\t\t\twhile (--i >= 0)\r\n\t\t\t{\t\t\t\t\r\n\t\t\t\tif (Reflect.hasField(lModel, \"buildingLevel\"))//si c'est un batiments...\r\n\t\t\t\t{\r\n\t\t\t\t\tif (modelExist(cast(Building.list), lModel)) continue;\r\n\t\t\t\t\tvar buildingDef:BuildingDef = Building.getBuildingDefByName(lModel.name);\r\n\t\t\t\t\tvar lObj:IPoolObject = PoolObject.create(Type.resolveClass(\"com.isartdigital.builder.game.sprites.buildings.\" + buildingDef.className));\r\n\t\t\t\t\tlObj.init(lModel);\r\n\t\t\t\t} else \r\n\t\t\t\t{\r\n\t\t\t\t\tif (modelExist(cast(Tile.list), lModel)) continue;\r\n\t\t\t\t\tvar lObj:IPoolObject = PoolObject.create(Tile);\r\n\t\t\t\t\tlObj.init(lModel);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate function modelExist(pList:Array<IPoolObject>, pModel:Dynamic) : Bool {\r\n\t\tfor (lObj in pList) {\r\n\t\t\tif (IsoManager.isoViewToModel(lObj.position).x != Reflect.getProperty(pModel, \"x\")) continue;\r\n\t\t\tif (IsoManager.isoViewToModel(lObj.position).y != Reflect.getProperty(pModel, \"y\")) continue;\r\n\t\t\t\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprivate function getAllRow () :Array<Dynamic> {\r\n\t\tvar lArray:Array<Dynamic> = new Array<Dynamic>();\r\n\t\t\r\n\t\tvar lPosition:String;\r\n\t\t\r\n\t\tvar it:Float = screenRectModel.height * 2 + 10;\r\n\t\twhile (it-- >= 0)\r\n\t\t{\r\n\t\t\tlPosition = (BOTTOM_RIGHT.x + 2 - Math.ceil(it/ 2) + it % 2) + \",\" + (BOTTOM_RIGHT.y + 2 - Math.ceil(it/ 2));\r\n\t\t\t\r\n\t\t\tfor (i in 0...cast(screenRectModel.width + 5)) {\t\t\t\r\n\t\t\t\tif (map.exists(lPosition))\r\n\t\t\t\t{\t\t\t\t\r\n\t\t\t\t\tfor (lObj in map.get(lPosition))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlArray.push(lObj);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlPosition = shiftHorizontal(lPosition);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\ttrace(\"length allRow : \" + lArray.length);\r\n\t\treturn lArray;\r\n\t}\r\n\t\r\n\tprivate function getLeftCol ():Array<Dynamic>\r\n\t{\r\n\t\t//marge\r\n\t\tif (clipInX < 2) clipInX = 2;\r\n\t\t\r\n\t\tvar lArray:Array<Dynamic> = new Array<Dynamic>();\r\n\t\t\r\n\t\tvar lPosition:String = BOTTOM_LEFT.x + \",\" + BOTTOM_LEFT.y;\r\n\t\t\r\n\t\twhile (clipInX-- > 0)\r\n\t\t{\r\n\t\t\tfor (i in 0...cast(screenRectModel.height + 5)) {\t\t\t\r\n\t\t\t\tif (map.exists(lPosition))\r\n\t\t\t\t{\t\t\t\t\r\n\t\t\t\t\tfor (lObj in map.get(lPosition))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlArray.push(lObj);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlPosition = shiftVertical(lPosition);\r\n\t\t\t}\r\n\t\t\tBOTTOM_LEFT.x++;\r\n\t\t\tlPosition = (BOTTOM_LEFT.x) + \",\" + (BOTTOM_LEFT.y);\r\n\t\t}\r\n\r\n\t\treturn lArray;\r\n\t}\r\n\t\r\n\tprivate function getRightCol ():Array<Dynamic>\r\n\t{\r\n\t\tvar lArray:Array<Dynamic> = new Array<Dynamic>();\r\n\t\t\r\n\t\tvar lPosition:String = BOTTOM_RIGHT_RIGHT.x + \",\" + BOTTOM_RIGHT_RIGHT.y;\r\n\r\n\t\twhile (clipInX-- >= 0)\r\n\t\t{\r\n\t\t\tfor (i in 0...cast(screenRectModel.height + 5)) {\t\t\t\r\n\t\t\t\tif (map.exists(lPosition))\r\n\t\t\t\t{\t\t\t\t\r\n\t\t\t\t\tfor (lObj in map.get(lPosition))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlArray.push(lObj);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlPosition = shiftVertical(lPosition);\r\n\t\t\t}\r\n\t\t\tBOTTOM_RIGHT_RIGHT.x--;\r\n\t\t\tlPosition = (BOTTOM_RIGHT_RIGHT.x) + \",\" + BOTTOM_RIGHT_RIGHT.y;\r\n\t\t}\r\n\t\t\r\n\t\treturn lArray;\r\n\t}\r\n\t\r\n\tprivate function getDownRow ():Array<Dynamic>\r\n\t{\r\n\t\tclipInY += 2;\r\n\t\t\r\n\t\tvar lArray:Array<Dynamic> = new Array<Dynamic>();\r\n\t\t\r\n\t\tvar lPosition:String = BOTTOM_RIGHT.x + \",\" + BOTTOM_RIGHT.y;// + SAFE_MARGE_MODEL;\r\n\t\t\r\n\t\twhile (clipInY-- >= 0)\r\n\t\t{\r\n\t\t\tfor (i in 0...cast(screenRectModel.width + 5)) {\t\t\t\r\n\t\t\t\tif (map.exists(lPosition))\r\n\t\t\t\t{\t\t\t\t\r\n\t\t\t\t\tfor (lObj in map.get(lPosition))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlArray.push(lObj);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlPosition = shiftHorizontal(lPosition);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tBOTTOM_RIGHT.y++;\r\n\t\t\tlPosition = BOTTOM_RIGHT.x + \",\" + (BOTTOM_RIGHT.y);\r\n\t\t\t//lPosition = (BOTTOM_RIGHT.x + 1 +clipInY % 2) + \",\" + (BOTTOM_RIGHT.y + clipInY % 2);\r\n\t\t}\r\n\t\t\r\n\t\treturn lArray;\r\n\t}\r\n\t\r\n\tprivate function getUpRow ():Array<Dynamic>\r\n\t{\r\n\t\tvar lArray:Array<Dynamic> = new Array<Dynamic>();\r\n\t\t\r\n\t\tvar lPosition:String = TOP_RIGHT.x + \",\" + TOP_RIGHT.y;\r\n\t\t\r\n\t\twhile (clipInY-- >= 0)\r\n\t\t{\r\n\t\t\tfor (i in 0...cast(screenRectModel.width + 5)) {\t\t\t\r\n\t\t\t\tif (map.exists(lPosition))\r\n\t\t\t\t{\t\t\t\t\r\n\t\t\t\t\tfor (lObj in map.get(lPosition))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlArray.push(lObj);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlPosition = shiftHorizontal(lPosition);\r\n\t\t\t}\r\n\t\t\tTOP_RIGHT.y--;\r\n\t\t\tlPosition = (TOP_RIGHT.x) + \",\" + (TOP_RIGHT.y);\r\n\t\t}\r\n\t\t\r\n\t\treturn lArray;\r\n\t}\r\n\t\r\n\tprivate function shiftHorizontal (pPoint:String) : String\r\n\t{\r\n\t\tvar lPos:Array<String> = pPoint.split(\",\");\r\n\t\tvar lNewPos:Array<Int> = new Array<Int>();\r\n\t\tlNewPos.push(Std.parseInt(lPos[0]));//--\r\n\t\tlNewPos.push(Std.parseInt(lPos[1]));//++\r\n\t\tlNewPos[0]--;\r\n\t\tlNewPos[1]++;\r\n\t\treturn lNewPos.join(\",\");\r\n\t}\r\n\t\r\n\tprivate function shiftVertical (pPoint:String) : String\r\n\t{\r\n\t\tvar lPos:Array<String> = pPoint.split(\",\");\r\n\t\tvar lNewPos:Array<Int> = new Array<Int>();\r\n\t\tlNewPos.push(Std.parseInt(lPos[0]));//--\r\n\t\tlNewPos.push(Std.parseInt(lPos[1]));//--\r\n\t\tlNewPos[0]--;\r\n\t\tlNewPos[1]--;\r\n\t\treturn lNewPos.join(\",\");\r\n\t}\r\n\t\r\n\tprivate function setScreenRectModel ():Void {\r\n\t\t//var lPosition:Point = IsoManager.isoViewToModel(new Point(screenRectView().x - SAFE_MARGE_MODEL, screenRectView().y - SAFE_MARGE_MODEL));\r\n\t\t\r\n\t\tvar lPosition:Point = IsoManager.isoViewToModel(new Point(screenRectView().x, screenRectView().y));\r\n\t\t\r\n\t\t//var lSize:Point = new Point(Math.round(screenRectView().width / Config.tileWidth) + SAFE_MARGE_MODEL * 2, Math.round(screenRectView().height / Config.tileWidth) + SAFE_MARGE_MODEL * 2);\r\n\t\t\r\n\t\tvar lSize:Point = new Point(Math.round(screenRectView().width / Config.tileWidth), Math.round(screenRectView().height / Config.tileHeight));\r\n\t\t\r\n\t\tscreenRectModel = new Rectangle(lPosition.x, lPosition.y, lSize.x, lSize.y);\r\n\t\t\r\n\t\tTOP_RIGHT.set(Math.round(screenRectView().x + screenRectView().width), Math.round(screenRectView().y));\r\n\t\tTOP_RIGHT = IsoManager.isoViewToModel(TOP_RIGHT);\r\n\t\t\r\n\t\tBOTTOM_LEFT.set(Math.round(screenRectView().x - SAFE_MARGE_VIEW * 1.5), Math.round(screenRectView().y + screenRectView().height + SAFE_MARGE_VIEW));\r\n\t\tBOTTOM_LEFT = IsoManager.isoViewToModel(BOTTOM_LEFT);\r\n\t\t\r\n\t\tBOTTOM_RIGHT.set(Math.round(screenRectView().x + screenRectView().width), Math.round(screenRectView().y + screenRectView().height) + SAFE_MARGE_VIEW / 2 );\t\t\t\r\n\t\tBOTTOM_RIGHT = IsoManager.isoViewToModel(BOTTOM_RIGHT);\r\n\r\n\t\tBOTTOM_RIGHT_RIGHT.set(Math.round(screenRectView().x + screenRectView().width + SAFE_MARGE_VIEW * 1.5), Math.round(screenRectView().y + screenRectView().height + SAFE_MARGE_VIEW ));\r\n\t\tBOTTOM_RIGHT_RIGHT = IsoManager.isoViewToModel(BOTTOM_RIGHT_RIGHT);\r\n\t}\r\n\t\r\n\tprivate function removeObject (): Void\r\n\t{\r\n\t\tfor (lArray in objectListView)\r\n\t\t{\r\n\t\t\tremoveInList(lArray);\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate function removeInList (pList:Array<IPoolObject>):Void\r\n\t{\r\n\t\tvar i:Int = pList.length;\r\n\t\twhile (i-- > 0)\r\n\t\t{\r\n\t\t\tvar lRect:Rectangle = new Rectangle(pList[i].x, pList[i].y, pList[i].width, pList[i].height);\r\n\t\t\tif (!rectIsInRect(screenRectView(), lRect)) pList[i].remove();\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate function rectIsInRect(pBase:Rectangle, pRect:Rectangle) : Bool\r\n\t{\r\n\t\t\r\n\t\tif (pBase.contains(pRect.x, pRect.y)) return true;\t\r\n\t\tif (pBase.contains(pRect.x, pRect.y + pRect.height)) return true;\t\r\n\t\tif (pBase.contains(pRect.x + pRect.width, pRect.y)) return true;\t\r\n\t\tif (pBase.contains(pRect.x - pRect.width, pRect.y)) return true;\t\r\n\t\tif (pBase.contains(pRect.x, pRect.y - pRect.height)) return true;\r\n\t\tif (pBase.contains(pRect.x, pRect.y + pRect.height)) return true;\r\n\t\t\r\n\t\t\r\n\t\t/*var lPoint:Point = new Point(pBase.x + pBase.width / 2, pBase.y + pBase.height / 2);\r\n\t\t\r\n\t\ttrace(distBetween(new Point (pRect.x, pRect.y), lPoint));\r\n\t\t\r\n\t\treturn (distBetween(new Point (pRect.x, pRect.y), lPoint) < pBase.width);\r\n\t\t*/\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\tprivate function distBetween(pPointA:Point, pPointB:Point) : Float\r\n\t{\r\n\t\treturn Math.sqrt(Math.pow(pPointB.x - pPointA.x, 2) - Math.pow(pPointB.y - pPointA.y, 2));\r\n\t}\r\n\t\r\n\t/**\r\n\t * Renvoie true si le dernier manage était assez loin\r\n\t * @return\r\n\t */\r\n\tprivate function hadToManage () : Bool\r\n\t{\r\n\t\tcurrentScreenPosition.set(screenRectView().x, screenRectView().y);\r\n\t\t\r\n\t\tif (Math.abs(currentScreenPosition.x - screenPosition.x) > delta.x)\r\n\t\t{\r\n\t\t\tdirection = currentScreenPosition.x - screenPosition.x > 0 ? \"RIGHT\" : \"LEFT\";\r\n\t\t\tclipInX = Math.ceil(Math.abs(currentScreenPosition.x - screenPosition.x) / delta.x);\r\n\t\t\tscreenPosition.x = screenRectView().x;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\tif (Math.abs(currentScreenPosition.y - screenPosition.y) > delta.y)\r\n\t\t{\r\n\t\t\tdirection = currentScreenPosition.y - screenPosition.y > 0 ? \"DOWN\" : \"UP\";\r\n\t\t\tclipInY = Math.ceil(Math.abs(currentScreenPosition.y - screenPosition.y) / delta.y);\r\n\t\t\tscreenPosition.y = screenRectView().y;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\treturn false;\r\n\t\t\r\n\t}\r\n}","package com.isartdigital.builder.game.manager;\r\n\r\n\t\r\n/**\r\n * ...\r\n * @author Dorian\r\n */\r\nclass Manager \r\n{\r\n\t\r\n\t/**\r\n\t * instance unique de la classe Manager\r\n\t */\r\n\tprivate static var instance: Manager;\r\n\t\r\n\tpublic var list:Array<Dynamic>;\r\n\t\r\n\t/**\r\n\t * Retourne l'instance unique de la classe, et la crée si elle n'existait pas au préalable\r\n\t * @return instance unique\r\n\t */\r\n\tpublic static function getInstance (): Manager {\r\n\t\tif (instance == null) instance = new Manager();\r\n\t\treturn instance;\r\n\t}\r\n\t\r\n\t/**\r\n\t * constructeur privé pour éviter qu'une instance soit créée directement\r\n\t */\r\n\tprivate function new() \r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * détruit l'instance unique et met sa référence interne à null\r\n\t */\r\n\tpublic function destroy (): Void {\r\n\t\tinstance = null;\r\n\t}\r\n\r\n}","package com.isartdigital.builder.game.manager;\r\nimport com.isartdigital.builder.game.def.BuildingDef;\r\nimport com.isartdigital.builder.game.def.BuildingSavedDef;\r\nimport com.isartdigital.builder.game.def.MapSavedDef;\r\nimport com.isartdigital.builder.game.def.PointDef;\r\nimport com.isartdigital.builder.game.def.SizeDef;\r\nimport com.isartdigital.builder.game.def.TileSavedDef;\r\nimport com.isartdigital.builder.game.pooling.PoolObject;\r\nimport com.isartdigital.builder.game.sprites.Building;\r\nimport com.isartdigital.builder.game.sprites.buildings.Casino;\r\nimport com.isartdigital.builder.game.sprites.buildings.Motel;\r\nimport com.isartdigital.builder.game.sprites.buildings.RocketFactory;\r\nimport com.isartdigital.builder.game.sprites.buildings.Temple;\r\nimport com.isartdigital.builder.game.sprites.Tile;\r\nimport com.isartdigital.builder.game.utils.TypeDefUtils;\r\nimport com.isartdigital.utils.Config;\r\nimport com.isartdigital.utils.Debug;\r\nimport com.isartdigital.utils.game.GameObject;\r\nimport com.isartdigital.utils.game.GameStage;\r\nimport com.isartdigital.utils.game.iso.IsoManager;\r\nimport com.isartdigital.utils.game.iso.IZSortable;\r\nimport com.isartdigital.utils.loader.GameLoader;\r\nimport haxe.Json;\r\nimport js.Browser;\r\nimport js.Lib;\r\nimport pixi.core.math.Point;\r\n\r\n\r\n/**\r\n * ...\r\n * @author Dorian\r\n */\r\nclass MapManager extends Manager\r\n{\r\n\t/**\r\n\t * instance unique de la classe MapManager\r\n\t */\r\n\tprivate static var instance: MapManager;\r\n\t\r\n\tpublic var isMapLoaded:Bool = false;\r\n\tpublic var mapSize:Int = 100;\r\n\t\r\n\tpublic var globalMap:Map<String, Array<Dynamic>> = new Map<String, Array<Dynamic>> ();\r\n\t//toundo\r\n\tpublic function get_globalMap (): Map<String, Array<Dynamic>>\r\n\t{\r\n\t\treturn globalMap;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Retourne l'instance unique de la classe, et la crée si elle n'existait pas au préalable\r\n\t * @return instance unique\r\n\t */\r\n\tpublic static function getInstance (): MapManager {\r\n\t\tif (instance == null) instance = new MapManager();\r\n\t\treturn instance;\r\n\t}\r\n\t\r\n\t/**\r\n\t * constructeur privé pour éviter qu'une instance soit créée directement\r\n\t */\r\n\tprivate function new() \r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Génère une nouvelle map de base si il n'y a pas de sauvegarde, sinon charge la sauvegarde\r\n\t * @return Success ou fail\r\n\t */\r\n\tpublic function generateMap():Bool {\r\n\t\tvar map:MapSavedDef;\r\n\t\t\r\n\t\t// Récupère les données dans le localstorage OU le json de base si il trouve rien\r\n\t\t/*if (isSaveAvailable()) {\r\n\t\t\tmap = cast (Json.parse(Browser.getLocalStorage().getItem(\"save\")));\r\n\t\t} else {*/\r\n\t\t\tmap = cast (GameLoader.getContent(\"json/basemap.json\"));\r\n\t\t//}\r\n\t\t\r\n\t\tloadMap(map);\r\n\t\t//saveMap();\r\n\t\tisMapLoaded = true;\r\n\t\r\n\t\t/*GameStage.getInstance().getBuildingsContainer().children.sort(function (a:IZSortable, b:IZSortable):Int {\r\n\t\t\ttrace(a);\r\n\t\t\treturn 0;\r\n\t\t});*/\r\n\t\t//trace(Test.definition);\r\n\t\t\r\n\t\tgetTileAtPosition(5, 5);\r\n\t\t\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Sauvegarde la map en cours\r\n\t * @return Success ou fail\r\n\t */\r\n\tpublic function saveMap():Bool {\r\n\t\tvar mapToSave:MapSavedDef = {\r\n\t\t\ttiles: new Array(),\r\n\t\t\tbuildings: new Array()\r\n\t\t};\r\n\t\t\r\n\t\tvar tile:Tile;\r\n\t\tvar tileSaved:TileSavedDef;\r\n\t\t\r\n\t\tvar building:Building;\r\n\t\tvar buildingSaved:BuildingSavedDef;\r\n\t\t\r\n\t\t\r\n\t\tfor (i in 0...Building.list.length) {\r\n\t\t\tbuildingSaved = { name:null, buildingLevel:null, x:null, y:null }\r\n\t\t\tbuilding = Building.list[i];\r\n\t\t\t\r\n\t\t\tbuildingSaved.name = building.definition.name;\r\n\t\t\tbuildingSaved.buildingLevel = building.buildingLevel;\r\n\t\t\t\r\n\t\t\tbuildingSaved.x = Std.int(building.toModel(true).x);\r\n\t\t\tbuildingSaved.y = Std.int(building.toModel(true).y);\r\n\t\t\t\r\n\t\t\tmapToSave.buildings.push(buildingSaved);\r\n\t\t}\r\n\t\t\r\n\t\tBrowser.getLocalStorage().setItem(\"save\", Json.stringify(mapToSave));\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Permet de savoir si un batiment est construisable à un endroit donnée\r\n\t * @param\tArray des tiles concerné\r\n\t * @return\r\n\t */\r\n\tpublic function isBuildable(pTiles:Array<TileSavedDef>):Bool {\r\n\t\tvar _isBuildable:Bool = true;\r\n\t\t\r\n\t\tif (pTiles == null) return false;\r\n\t\t\r\n\t\tfor (i in 0...pTiles.length) {\r\n\t\t\tif (!pTiles[i].isBuildable) {\r\n\t\t\t\t_isBuildable = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn _isBuildable;\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Récupère un tableau contenant les tiles sous une position avec une taille\r\n\t * @param\tpPosition\r\n\t * @param\tpSize\r\n\t * @return Array de tiles ou null si l'array exède les limitation de l'array\r\n\t */\r\n\tpublic function getTilesArray(pPosition:Point, pSize:SizeDef):Array<TileSavedDef> {\r\n\t\tvar tiles:Array<TileSavedDef> = new Array<TileSavedDef>();\r\n\t\tvar xIndex:Int;\r\n\t\tvar yIndex:Int;\r\n\t\t\r\n\t\tfor (x in 0...pSize.width) {\r\n\t\t\tfor (y in 0...pSize.height) {\r\n\t\t\t\txIndex = Std.int(pPosition.x) - x;\r\n\t\t\t\tyIndex = Std.int(pPosition.y) - y;\r\n\t\t\t\t\r\n\t\t\t\tif (isInsideGrid(xIndex, yIndex)) {\r\n\t\t\t\t\ttiles.push(getTileAtPosition(xIndex, yIndex));\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn tiles;\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Modifie la propriété isBuildable d'un array de tiles\r\n\t * @param\tArray<TileSavedDef>\r\n\t * @param\tisBuildable\r\n\t */\r\n\tpublic function setTilesBuildable(tiles:Array<TileSavedDef>, _isBuildable:Bool):Void {\r\n\t\tvar mapElements:Array<Dynamic>;\r\n\t\tvar tile:TileSavedDef;\r\n\t\tvar lTileSavedDefCompare:TileSavedDef = { x:null, y:null, isBuildable:null };\r\n\t\t\r\n\t\tfor (i in 0...tiles.length) {\r\n\t\t\ttile = tiles[i];\r\n\t\t\tmapElements = globalMap.get(tile.x + \",\" + tile.y);\r\n\t\t\t\r\n\t\t\tif (mapElements != null) {\r\n\t\t\t\tfor (j in 0...mapElements.length) {\r\n\t\t\t\t\tif (TypeDefUtils.compare(mapElements[j], lTileSavedDefCompare)) {\r\n\t\t\t\t\t\tglobalMap.get(tile.x + \",\" + tile.y)[j].isBuildable = _isBuildable;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Récupère une tile à la position indiqué\r\n\t * @param pPosition - Position de la grille\r\n\t * @return Tile récupéré\r\n\t */\r\n\tprivate function getTileAtPosition(x:Int, y:Int):TileSavedDef {\r\n\t\tvar lTileSavedDefCompare:TileSavedDef = {x:null, y:null, isBuildable:null};\r\n\t\t\r\n\t\tvar elements:Array<Dynamic> = new Array();\r\n\t\tvar lPosition:String = x + \",\" + y;\r\n\t\t\r\n\t\tif (globalMap.exists(lPosition)) {\r\n\t\t\telements = globalMap.get(lPosition);\r\n\t\t}\r\n\t\t\r\n\t\tfor (i in 0...elements.length) {\r\n\t\t\tif (TypeDefUtils.compare(elements[i], lTileSavedDefCompare)) return elements[i];\r\n\t\t}\r\n\t\t\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Charge la map sauvegardé\r\n\t * @return Si le chargement de la map a réussi ou non\r\n\t */\r\n\tprivate function loadMap(map:MapSavedDef):Bool {\r\n\t\t// Remplissage des tiles de la map dans le containeur de tiles\r\n\t\tvar tilePosition:String;\r\n\t\tvar tileSaved:TileSavedDef;\r\n\t\t\r\n\t\tfor (i in 0...mapSize) {\r\n\t\t\tfor (j in 0...mapSize) {\r\n\t\t\t\ttileSaved = {\r\n\t\t\t\t\tx: i,\r\n\t\t\t\t\ty: j,\r\n\t\t\t\t\tisBuildable: true\r\n\t\t\t\t};\r\n\t\t\t\t\r\n\t\t\t\ttilePosition = i + \",\" + j;\r\n\t\t\t\t\r\n\t\t\t\tif (!globalMap.exists(tilePosition)) {\r\n\t\t\t\t\tglobalMap.set(tilePosition, new Array<Dynamic>());\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tglobalMap.get(tilePosition).push(tileSaved);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// Remplissage des builginds de la map dans le containeur de builginds\r\n\t\tvar buildingSaved:BuildingSavedDef;\r\n\t\tvar buildingDef:BuildingDef;\r\n\t\t\r\n\t\tfor (i in 0...map.buildings.length) {\r\n\t\t\tbuildingSaved = map.buildings[i];\r\n\t\t\t\r\n\t\t\t//buildingDef = Building.getBuildingDefByName(buildingSaved.name);\r\n\t\t\t\r\n\t\t\t//PoolObject.create(Type.resolveClass(\"com.isartdigital.builder.game.sprites.buildings.\" + buildingDef.className));\r\n\t\t\t\r\n\t\t\tvar lPosition:String = buildingSaved.x + \",\" + buildingSaved.y;\r\n\t\t\t//sécurité si le batiment n'est pas placé sur une Tile\r\n\t\t\tif (globalMap.exists(lPosition)) {\r\n\t\t\t\tglobalMap.get(lPosition).push(buildingSaved);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Demande si une sauvegarde est disponible ou non\r\n\t * @return\r\n\t */\r\n\tprivate function isSaveAvailable():Bool {\r\n\t\tvar lSaveAvailable:Bool = true;\t\r\n\t\tif (Browser.getLocalStorage().getItem(\"save\") == null) {\r\n\t\t\tlSaveAvailable = false;\r\n\t\t}\r\n\t\treturn lSaveAvailable;\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Indique si la position est hors de la grille ou à l'interieur\r\n\t * @return\r\n\t */\r\n\tprivate function isInsideGrid(pX:Int, pY:Int):Bool {\r\n\t\tvar lMapManager:MapManager = MapManager.getInstance();\r\n\t\t\r\n\t\tif (pX >= 0 &&\r\n\t\t\tpY >= 0 &&\r\n\t\t\tpX < mapSize &&\r\n\t\t\tpY < mapSize) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Affiche la position de la tile sous la souris\r\n\t */\r\n\tpublic function displayTilePositionUnderMouse() {\r\n\t\tvar lPosition:Point = IsoManager.isoViewToModel(GameManager.getInstance().mousePosition);\r\n\t\t\r\n\t\tif (Math.floor(Math.random() * 25) == 0) trace(\"x : \" + Math.ceil(lPosition.x) + \" y : \" + Math.ceil(lPosition.y));\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Hack pour forcer l'exportation des class.\r\n\t * Mettre ici toutes les class non importer sinon cause le bug suivant : Uncaught TypeError: cl is not a function\r\n\t */\r\n\tprivate function importBuildingsClass():Void {\r\n\t\tMotel;\r\n\t\tCasino;\r\n\t\tRocketFactory;\r\n\t\tTemple;\r\n\t}\r\n}","package com.isartdigital.builder.game.manager;\r\nimport pathfinder.IMap;\r\n\r\n/**\r\n * ...\r\n * @author Thorcal\r\n */\r\nclass Maps implements IMap\r\n{\r\n    public var rows( default, null ):Int;\r\n    public var cols( default, null ):Int;\r\n\r\n    public function new( p_cols:Int, p_rows:Int )\r\n    {\r\n        cols = p_cols;\r\n        rows = p_rows;\r\n        // create an array of tiles, and determine if they are walkable or obstructed\r\n    }\r\n\r\n    public function isWalkable( p_x:Int, p_y:Int ):Bool\r\n    {\r\n        return true;\r\n    }\r\n}","package com.isartdigital.builder.game.manager;\r\n\r\n\t\r\n/**\r\n * ...\r\n * @author Thorcal\r\n */\r\nclass RessourceManager extends Manager \r\n{\r\n\t\r\n\tprivate var warehousesNb:Int = 1;\r\n\t\r\n\t//max stock per ressource\r\n\tpublic var maxStock:Int;\r\n\t\r\n\tpublic var ressources:Map<Ressources,Int> = new Map<Ressources, Int>();\r\n\t\r\n\t/**\r\n\t * instance unique de la classe RessourceManager\r\n\t */\r\n\tprivate static var instance: RessourceManager;\r\n\t\r\n\t/**\r\n\t * Retourne l'instance unique de la classe, et la crée si elle n'existait pas au préalable\r\n\t * @return instance unique\r\n\t */\r\n\tpublic static function getInstance (): RessourceManager {\r\n\t\tif (instance == null) instance = new RessourceManager();\r\n\t\treturn instance;\r\n\t}\r\n\t\r\n\t/**\r\n\t * constructeur privé pour éviter qu'une instance soit créée directement\r\n\t */\r\n\tprivate function new() \r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\t\r\n\tpublic function start():Void {\r\n\t\tressources = [\r\n\t\t\tRessources.DIAMONDS => 0,\r\n\t\t\tRessources.GOLD => 0,\r\n\t\t\tRessources.WOOD => 0\r\n\t\t];\r\n\t}\r\n\t\r\n\t/**\r\n\t * Renvoie le nombre de ressource pour la ressource donnée en parametre\r\n\t * @param\tpRessource\r\n\t */\r\n\tpublic function getRessources(pRessource:Ressources):Int {\r\n\t\treturn ressources[pRessource];\r\n\t}\r\n\t\r\n\t/**\r\n\t * Ajoute pNumber à pRessource\r\n\t * @param\tpRessource\r\n\t * @param\tpNumber\r\n\t */\r\n\tpublic function addRessources(pRessource:Ressources, pNumber:Int):Void {\r\n\t\tif (ressources[pRessource] < countMaxStock(pRessource)) {\r\n\t\t\tressources[pRessource] += pNumber;\r\n\t\t}else {\r\n\t\t\ttrace (\"Nombre de ressources maximal atteint\");\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Retire pNumber à pRessource\r\n\t * @param\tpRessource\r\n\t * @param\tpNumber\r\n\t */\r\n\tpublic function removeRessources(pRessource:Ressources, pNumber:Int):Void {\r\n\t\tif (ressources[pRessource] > 0) {\r\n\t\t\tressources[pRessource] -= pNumber;\r\n\t\t}else {\r\n\t\t\ttrace (\"Plus de ressources\");\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Renvoie le nombre maximum de ressource capable d'être stocké pour pRessource\r\n\t * @param\tpRessource\r\n\t */\r\n\tprivate function countMaxStock(pRessource:Ressources):Int {\r\n\t\tif (pRessource != Ressources.DIAMONDS) {\r\n\t\t\tmaxStock = 100 + (100 * warehousesNb);\r\n\t\t\treturn maxStock;\r\n\t\t}else {\r\n\t\t\tmaxStock = -1;\r\n\t\t\treturn maxStock;\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * détruit l'instance unique et met sa référence interne à null\r\n\t */\r\n\toverride public function destroy (): Void {\r\n\t\tinstance = null;\r\n\t}\r\n\r\n}","package com.isartdigital.builder.game.pooling;\r\nimport com.isartdigital.utils.Debug;\r\n\r\n//Deuxième itération du système de pooling\r\n/**\r\n * Système de Pooling\r\n * @author Flavien \r\n */\r\nclass PoolObject\r\n{\r\n\t/**\r\n\t * Map de liste de pooling\r\n\t */\r\n\tprivate static var poolList:Map<String, Array<Dynamic>> = new Map<String, Array<Dynamic>> ();\r\n\t\r\n\t/**\r\n\t * Nombre d'objet créé si une liste est vide\r\n\t */\r\n\tprivate static inline var objectMarge:Int = 10;\r\n\t\r\n\t/**\r\n\t * Nombre d'objet maximum dans une liste\r\n\t */\r\n\tprivate static inline var objectListLimit:Int = 1000;\r\n\t\r\n\t/**\r\n\t * Donne instance de pClass depuis une poolList\r\n\t * @param\tpClass la classe de l'objet a instancié\r\n\t * @return une instance de pClass\r\n\t */\r\n\tpublic static function create (pClass:Class<Dynamic>) : Dynamic\r\n\t{\r\n\t\tvar lName:String = Type.getClassName(pClass);\r\n\t\t\r\n\t\tif (!poolList.exists(lName)) createPoolList(pClass);\r\n\t\t\r\n\t\tif (poolList.get(lName).length == 0) addObjectToPoolList(lName, pClass);\r\n\t\t\r\n\t\treturn poolList.get(lName).shift();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Ajoute un Object a une poolList\r\n\t * @param\tpObject\r\n\t * @return false si l'objet ne peux pas être ajouté à une liste\r\n\t */\r\n\tpublic static function addPool(pObject:Dynamic) : Bool\r\n\t{\r\n\t\tvar lName:String = Type.getClassName(Type.getClass(pObject));\r\n\t\t\r\n\t\tif (!poolList.exists(lName)) return false;\r\n\t\t\r\n\t\tif (poolList.get(lName).length > objectListLimit) return false;\r\n\t\t\r\n\t\tpoolList.get(lName).push(pObject);\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Crée une liste de pooling de la classe pClass\r\n\t * @param\tpClass\r\n\t */\r\n\tpublic static function createPoolList (pClass:Class<Dynamic>)\r\n\t{\r\n\t\tvar lName:String = Type.getClassName(pClass);\r\n\t\tpoolList.set(lName, new Array<Dynamic>());\r\n\t\taddObjectToPoolList(lName, pClass);\r\n\t}\r\n\t\r\n\t/**\r\n\t * ajoute des objets à une liste de pooling\r\n\t * @param\tpName\r\n\t * @param\tpClass\r\n\t */\r\n\tprivate static function addObjectToPoolList (pName:String, pClass:Class<Dynamic>)\r\n\t{\r\n\t\tfor (i in 0...objectMarge) \r\n\t\t{\r\n\t\t\tvar lObject:Dynamic = Type.createInstance(pClass, []);\r\n\t\t\tpoolList.get(pName).push(Type.createInstance(pClass, []));\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate function new() \r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils.game;\r\n\r\nimport com.isartdigital.utils.events.EventType;\r\nimport pixi.core.display.Container;\r\n\r\n/**\r\n * Classe de base des objets interactifs dans le jeu\r\n * Met à jour automatiquement ses données internes de position et transformation\r\n * \r\n * @author Mathieu ANTHOINE\r\n */\r\nclass GameObject extends Container\r\n{\r\n\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\ton(EventType.ADDED, forceUpdateTransform);\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * Force la mise à jour de la matrices de transformation des éléments constituant le GameObject\r\n\t */\r\n\tprivate function forceUpdateTransform (): Void {\r\n\t\tuntyped updateTransform();\r\n\t}\r\n\t\r\n\t/**\r\n\t * nettoie et détruit l'instance\r\n\t */\r\n\toverride public function destroy (): Void {\r\n\t\toff(EventType.ADDED, forceUpdateTransform);\r\n\t\tsuper.destroy();\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils.game;\r\nimport pixi.core.display.Container;\r\n\r\n/**\r\n * Implémentation de base d'une Machine à état\r\n * expose de façon publique sa méthode doAction qui peut faire référence à différentes méthodes prévues (doActionVoid, doActionNormal) ou spécifiques définies par ses classes filles\r\n * Par convention le changement de référence de doAction se fait via des méthodes setMode (setModeVoid, setModeAction) qui peuvent aussi contenir des paramètres d'initialisation\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass StateMachine extends GameObject implements IStateMachine \r\n{\r\n\t\r\n\t/**\r\n\t * méthode appelée à chaque gameLoop. Elle peut faire référence à différentes méthodes au cours du temps\r\n\t */\r\n\tpublic var doAction:Void->Void;\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\tsetModeVoid();\t\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * applique le mode \"ne fait rien\"\r\n\t */\r\n\tprivate function setModeVoid (): Void {\r\n\t\tdoAction = doActionVoid;\r\n\t}\r\n\t\r\n\t/**\r\n\t * fonction vide destinée à maintenir la référence de doAction sans rien faire\r\n\t */\r\n\tprivate function doActionVoid (): Void {}\r\n\r\n\t\r\n\t/**\r\n\t * applique le mode normal (mode par defaut)\r\n\t */\r\n\tprivate function setModeNormal(): Void {\r\n\t\tdoAction = doActionNormal;\r\n\t}\r\n\t\r\n\t/**\r\n\t * fonction destinée à appliquer un comportement par defaut\r\n\t */\r\n\tprivate function doActionNormal (): Void {}\r\n\t\r\n\t/**\r\n\t * Activation\r\n\t */\r\n\tpublic function start (): Void {\r\n\t\tsetModeNormal();\r\n\t}\r\n\t\r\n\t/**\r\n\t * nettoie et détruit l'instance\r\n\t */\r\n\toverride public function destroy (): Void {\r\n\t\tsetModeVoid();\r\n\t\tsuper.destroy();\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils.game;\r\n\r\nimport com.isartdigital.utils.game.factory.AnimFactory;\r\nimport com.isartdigital.utils.game.iso.IsoManager;\r\nimport com.isartdigital.utils.system.DeviceCapabilities;\r\nimport haxe.Json;\r\nimport pixi.core.display.Container;\r\nimport pixi.core.graphics.Graphics;\r\nimport pixi.core.math.Point;\r\nimport pixi.core.math.shapes.Circle;\r\nimport pixi.core.math.shapes.Ellipse;\r\nimport pixi.core.math.shapes.Rectangle;\r\nimport pixi.extras.MovieClip;\r\n\r\n/**\r\n * Classe de base des objets interactifs ayant plusieurs états graphiques\r\n * Gère la représentation graphique (anim) et les conteneurs utiles au gamePlay (box) qui peuvent être de simples boites de collision ou beaucoup plus\r\n * suivant l'implémentation faite par le développeur dans les classes filles\r\n * @author Mathieu ANTHOINE\r\n * @version 0.11.0\r\n */\r\nclass StateGraphic extends StateMachine\r\n{\r\n\r\n\t/**\r\n\t * Fabrique d'anim\r\n\t */\r\n\tprivate var factory:AnimFactory;\r\n\t \r\n\t/**\r\n\t * anim de l'état courant\r\n\t */\r\n\tprivate var anim:Container;\r\n\t\r\n\t/**\r\n\t * box de l'état courant\r\n\t */\r\n\tprivate var box:Container;\r\n\t\r\n\t/**\r\n\t * suffixe du nom d'export des symboles Animés\r\n\t */\r\n\tprivate var ANIM_SUFFIX (default,null):String = \"\";\r\n\t\r\n\t/**\r\n\t * suffixe du nom d'export des symboles Box\r\n\t */\r\n\tprivate var BOX_SUFFIX (default,null):String = \"box\";\t\r\n\t\r\n\t/**\r\n\t * etat par défaut\r\n\t */\r\n\tprivate var DEFAULT_STATE (default, null): String = \"\";\r\n\t\r\n\t/**\r\n\t * Nom de l'asset (sert à identifier les textures à utiliser)\r\n\t * Prend le nom de la classe Fille par défaut\r\n\t */\r\n\tprivate var assetName:String;\r\n\t\r\n\t/**\r\n\t * état en cours\r\n\t */\r\n\tprivate var state:String;\r\n\t\r\n\t/**\r\n\t * Type de box de collision\r\n\t * Si boxType est égal à BoxType.NONE, aucune collision ne se fait, il n'est pas nécessaire d'avoir une boite de collision définie\r\n\t * Si boxType est égal à BoxType.SIMPLE, seul un symbole sert de Box pour tous les états, son nom d'export etant assetName+\"_\"+BOX_SUFFIX\r\n\t * Si boxType est égal à BoxType.MULTIPLE, chaque state correspond à une boite de collision, chaque state va cherche la boite assetName+\"_\"+ANIM_SUFFIX+\"_\"+BOX_SUFFIX\r\n\t * Si boxType est égal à BoxType.SELF, hitBox retourne le MovieClip anim\r\n\t */\r\n\tprivate var boxType:BoxType=BoxType.NONE;\r\n\t\r\n\t/**\r\n\t * niveau d'alpha des anim\r\n\t */\r\n\tpublic static var animAlpha:Float = 1;\r\n\t\r\n\t/**\r\n\t * niveau d'alpha des Boxes\r\n\t */\r\n\tpublic static var boxAlpha:Float = 0;\r\n\t\r\n\t/**\r\n\t * cache des boxes de tous les StateGraphic\r\n\t */\r\n\tprivate static var boxesCache:Map<String,Map<String,Dynamic>>;\r\n\t\r\n\t/**\r\n\t * l'anim est-elle terminée ?\r\n\t */\r\n\tpublic var isAnimEnd (default, null):Bool;\r\n\t\r\n\tprivate function setAnimEnd ():Void {\r\n\t\tisAnimEnd = true;\r\n\t}\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\t\r\n\t\r\n\t/**\t\t\r\n\t *\tChange l'asset à la volé par un asset personnalisé\t\t\r\n\t *  DEPRECATED\t\t\r\n\t */\t\t\r\n\tpublic function changeAsset (pAssetName:String, pState:String = \"\"):Void {\t\t\r\n\t\t//assetName = pAssetName;\t\t\r\n\t\t//cast(anim, MovieClip).textures = getTextures(pState);\t\t\r\n\t}\t\t\r\n\t\t\t\r\n\t/**\t\t\r\n\t * Conversion du modèle à la vue Isométrique du stateGraphic\t\t\r\n\t * @param\tpFloor Arrondi les valeur\t\t\r\n\t * @return point en x, y dans la vue\t\t\r\n\t */\t\t\r\n\tpublic function toModel(?pFloor:Bool = false):Point {\t\t\r\n\t\tvar positionIndex:Point = IsoManager.isoViewToModel(new Point(x, y));\t\t\r\n\t\tif (pFloor) {\t\t\r\n\t\t\tpositionIndex.x = Math.floor(positionIndex.x);\t\t\r\n\t\t\tpositionIndex.y = Math.floor(positionIndex.y);\t\t\r\n\t\t}\t\t\r\n\t\t\t\t\r\n\t\treturn positionIndex;\t\t\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * défini l'état courant du StateGraphic\r\n\t * @param\tpState nom de l'état (run, walk...)\r\n\t * @param\tpLoop l'anim boucle (isAnimEnd sera toujours false) ou pas\r\n\t * @param\tpAutoPlay lance l'anim automatiquement\r\n\t * @param\tpStart lance l'anim à cette frame\r\n\t */\r\n\tprivate function setState (pState:String, ?pLoop:Bool = false, ?pAutoPlay:Bool=true, ?pStart:UInt = 0): Void {\r\n\t\t\r\n\t\tif (factory == null) throw \"StateGraphic :: propriété fabrique non définie\";\r\n\t\t\r\n\t\tif (state == pState) return;\r\n\t\t\r\n\t\tif (anim != null) {\r\n\t\t\tremoveChild(anim);\r\n\t\t\tanim.destroy();\t\t\t\r\n\t\t\tanim = null;\r\n\t\t\t\r\n\t\t\tif (boxType == BoxType.SELF) {\r\n\t\t\t\tparent.removeChild(box);\r\n\t\t\t\tbox = null;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif (assetName == null) assetName = Type.getClassName(Type.getClass(this)).split(\".\").pop();\r\n\t\t\r\n\t\tstate = pState;\r\n\t\t\r\n\t\tanim = factory.getAnim();\r\n\t\t\r\n\t\tif (anim == null) {\t\t\t\r\n\t\t\tif (boxType == BoxType.SELF) {\r\n\t\t\t\tif (box !=null) removeChild(box);\r\n\t\t\t\tbox = null;\r\n\t\t\t}\r\n\t\t\tanim = factory.create(getID(state));\r\n\t\t\tanim.scale.set(1 /DeviceCapabilities.textureRatio , 1 / DeviceCapabilities.textureRatio);\r\n\t\t\tif (animAlpha < 1) anim.alpha = animAlpha;\r\n\t\t\taddChild(anim);\r\n\t\t} else {\r\n\t\t\tfactory.update(getID(state));\r\n\t\t}\r\n\r\n\t\tisAnimEnd = false;\r\n\t\t\r\n\t\tuntyped anim.loop = pLoop;\r\n\t\tfactory.setFrame(pAutoPlay, pStart);\r\n\t\t\r\n\t\tif (box == null) {\r\n\t\t\tif (boxType == BoxType.SELF) {\r\n\t\t\t\tbox = anim;\r\n\t\t\t\treturn;\r\n\t\t\t} else {\r\n\t\t\t\tbox = new Container();\r\n\t\t\t\tif (boxType != BoxType.NONE) createBox();\r\n\t\t\t}\r\n\t\t\taddChild(box);\r\n\t\t} else if (boxType == BoxType.MULTIPLE) {\r\n\t\t\tremoveChild(box);\r\n\t\t\tbox = new Container();\r\n\t\t\tcreateBox();\r\n\t\t\taddChild(box);\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t}\r\n\t\r\n\tprivate function changeTexture (pState:String):Void { }\r\n\t\r\n\t\r\n\t/**\r\n\t * retourne l'identifiant complet de l'animation\r\n\t * @param\tpState etat de l'anim\r\n\t * @return identifiant\r\n\t */\r\n\tprivate function getID(pState:String): String {\r\n\t\tif (pState == DEFAULT_STATE) return assetName+ANIM_SUFFIX;\r\n\t\treturn assetName+\"_\" + pState+ANIM_SUFFIX;\r\n\t}\r\n\t\r\n\t/**\r\n\t * crée la ou les box de collision de l'état\r\n\t */\r\n\tprivate function createBox ():Void {\r\n\t\tvar lBoxes:Map<String,Dynamic> = getBox((boxType == BoxType.MULTIPLE ? state+ \"_\": \"\" )  + BOX_SUFFIX);\r\n\t\tvar lChild:Graphics;\r\n\t\t\r\n\t\tfor (lBox in lBoxes.keys()) {\r\n\t\t\tlChild = new Graphics();\r\n\t\t\tlChild.beginFill(0xFF2222);\r\n\t\t\tif (Std.is(lBoxes[lBox], Rectangle)) {\r\n\t\t\t\tlChild.drawRect(lBoxes[lBox].x, lBoxes[lBox].y, lBoxes[lBox].width, lBoxes[lBox].height);\r\n\t\t\t}\r\n\t\t\telse if (Std.is(lBoxes[lBox], Ellipse)) {\r\n\t\t\t\tlChild.drawEllipse(lBoxes[lBox].x, lBoxes[lBox].y, lBoxes[lBox].width, lBoxes[lBox].height);\r\n\t\t\t}\r\n\t\t\telse if (Std.is(lBoxes[lBox], Circle)) {\r\n\t\t\t\tlChild.drawCircle(lBoxes[lBox].x,lBoxes[lBox].y,lBoxes[lBox].radius);\r\n\t\t\t}\r\n\t\t\telse if (Std.is(lBoxes[lBox], Point)) {\r\n\t\t\t\tlChild.drawCircle(0, 0, 10);\r\n\t\t\t}\r\n\t\t\tlChild.endFill();\r\n\t\t\t\r\n\t\t\tlChild.name = lBox;\r\n\t\t\tif (Std.is(lBoxes[lBox], Point)) lChild.position.set(lBoxes[lBox].x, lBoxes[lBox].y);\r\n\t\t\telse lChild.hitArea = lBoxes[lBox];\r\n\t\t\t \r\n\t\t\tbox.addChild(lChild);\r\n\t\t}\r\n\t\tif (boxAlpha == 0) box.renderable = false;\r\n\t\telse box.alpha= boxAlpha;\r\n\t}\t\t\r\n\t\r\n\t/**\r\n\t * Créer toutes les Boxes\r\n\t * @param\tpFile Nom du fichier contenant la description des boxes\r\n\t */\r\n\tstatic public function addBoxes (pJson:Json): Void {\r\n\t\t\r\n\t\tif (boxesCache == null) boxesCache = new Map<String,Map<String,Dynamic>>();\r\n\t\t\r\n\t\tvar lItem;\r\n\t\tvar lObj;\r\n\t\t\r\n\t\tfor (lName in Reflect.fields(pJson)) {\r\n\t\t\tlItem = Reflect.field(pJson, lName);\r\n\t\t\tboxesCache[lName] = new Map<String,Dynamic>();\t\t\t\r\n\t\t\t\r\n\t\t\tfor (lObjName in Reflect.fields(lItem)) {\r\n\t\t\t\tlObj = Reflect.field(lItem, lObjName);\r\n\t\t\t\t\r\n\t\t\t\tif (lObj.type == \"Rectangle\") boxesCache[lName][lObjName] = new Rectangle(lObj.x, lObj.y, lObj.width, lObj.height);\r\n\t\t\t\telse if (lObj.type == \"Ellipse\") boxesCache[lName][lObjName] = new Ellipse(lObj.x, lObj.y, lObj.width/2, lObj.height/2);\r\n\t\t\t\telse if (lObj.type == \"Circle\") boxesCache[lName][lObjName] = new Circle(lObj.x, lObj.y, lObj.radius);\r\n\t\t\t\telse if (lObj.type == \"Point\") boxesCache[lName][lObjName] = new Point(lObj.x, lObj.y);\r\n\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * Cherche dans le cache général des boxes, celle correspondant au state demandé\r\n\t * @param\tpState State de l'instance\r\n\t * @return\tla box correspondante\r\n\t * @return\r\n\t */\r\n\tpublic function getBox (pState:String):Map<String,Dynamic> {\r\n\t\treturn boxesCache[assetName+\"_\" +pState];\r\n\t}\t\t\r\n\t\r\n\t/**\r\n\t * met en pause l'anim\r\n\t */\r\n\tpublic function pause ():Void {\r\n\t\tif (anim != null) untyped anim.stop();\r\n\t}\r\n\t\r\n\t/**\r\n\t * relance l'anim\r\n\t */\r\n\tpublic function resume ():Void {\r\n\t\tif (anim != null) untyped anim.play();\r\n\t}\r\n\t\r\n\t/**\r\n\t * retourne la zone de hit de l'objet\r\n\t */\r\n\tpublic var hitBox (get, null):Container;\r\n\t \r\n\tprivate function get_hitBox (): Container {\r\n\t\treturn box;\r\n\t\t// Si on veut cibler une box plus précise: return box.getChildByName(\"nom d'instance du MovieClip de type Rectangle ou Circle dans Flash IDE\");\r\n\t}\r\n\r\n\t/**\r\n\t * retourne un tableau de points de collision dont les coordonnées sont exprimées dans le systeme global\r\n\t */\r\n\tpublic var hitPoints (get, null): Array<Point>;\r\n\t \r\n\tprivate function get_hitPoints (): Array<Point> {\r\n\t\treturn null;\r\n\t\t// liste de Points : return [box.toGlobal(box.getChildByName(\"nom d'instance du MovieClip de type Point dans Flash IDE\").position,box.toGlobal(box.getChildByName(\"nom d'instance du MovieClip de type Point dans Flash IDE\").position];\r\n\t}\r\n\t\r\n\t/**\r\n\t * nettoyage et suppression de l'instance\r\n\t */\r\n\toverride public function destroy (): Void {\r\n\t\tremoveChild(box);\r\n\t\tbox.destroy();\r\n\t\tbox = null;\r\n\t\tsuper.destroy();\r\n\t}\r\n\t\r\n}","package com.isartdigital.builder.game.sprites;\r\nimport com.isartdigital.builder.game.pooling.IPoolObject;\r\nimport com.isartdigital.builder.game.pooling.PoolObject;\r\nimport com.isartdigital.utils.game.StateGraphic;\r\n\r\n/**\r\n * ...\r\n * @author Flavien\r\n */\r\nclass SpriteObject extends StateGraphic implements IPoolObject\r\n{\r\n\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\t\r\n\tpublic function remove():Bool\r\n\t{\r\n\t\tif (!PoolObject.addPool(this)) return false;\r\n\t\t\r\n\t\tparent.removeChild(this);\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n\r\n\tpublic function init(pDefinition:Dynamic):Void {}\r\n}","package com.isartdigital.builder.game.sprites;\r\n\r\nimport com.isartdigital.builder.game.def.BuildingDef;\r\nimport com.isartdigital.builder.game.def.TileSavedDef;\r\nimport com.isartdigital.builder.game.manager.MapManager;\r\nimport com.isartdigital.builder.game.pooling.IPoolObject;\r\nimport com.isartdigital.utils.Config;\r\nimport com.isartdigital.utils.events.MouseEventType;\r\nimport com.isartdigital.utils.game.BoxType;\r\nimport com.isartdigital.utils.game.factory.FlumpMovieAnimFactory;\r\nimport com.isartdigital.utils.game.GameStage;\r\nimport com.isartdigital.utils.game.iso.IsoManager;\r\nimport com.isartdigital.utils.game.iso.IZSortable;\r\nimport com.isartdigital.utils.game.StateGraphic;\r\nimport com.isartdigital.utils.loader.GameLoader;\r\nimport eventemitter3.EventEmitter;\r\nimport js.html.EventTarget;\r\nimport js.html.MouseEvent;\r\nimport js.Lib;\r\nimport pixi.core.math.Point;\r\nimport pixi.display.FlumpMovie;\r\nimport pixi.extras.MovieClip;\r\n\r\n/**\r\n * ...\r\n * @author Dorian\r\n */\r\nclass Building extends SpriteObject implements IZSortable implements IPoolObject\r\n{\r\n\tpublic static var list:Array<Building> = new Array();\r\n\tpublic static var movingBuilding:Building;\r\n\t\r\n\tprivate var initialeModelPosition:Point = new Point(0, 0);\r\n\t\r\n\tpublic var definition:BuildingDef;\r\n\tpublic var buildingLevel:Int = 0;\r\n\t\r\n\tpublic var colMin:UInt;\r\n\tpublic var colMax:UInt;\r\n\tpublic var rowMin:UInt;\r\n\tpublic var rowMax:UInt;\r\n\t\r\n\tpublic function new()\r\n\t{\r\n\t\tsuper();\r\n\t\tfactory = new FlumpMovieAnimFactory();\r\n\t\tboxType = BoxType.NONE;\r\n\t\t\r\n\t\tinteractive = true;\r\n\t}\r\n\t\r\n\toverride public function init(pDefinition:Dynamic):Void \r\n\t{\r\n\t\tvar buildingPosition:Point = IsoManager.modelToIsoView(new Point(pDefinition.x, pDefinition.y));\r\n\t\tvar tilesUnderBuilding:Array<TileSavedDef>;\r\n\t\t\r\n\t\tlist.push(this);\r\n\t\tdefinition = getBuildingDefByName(pDefinition.name);\r\n\t\t\t\r\n\t\tcolMin = Math.floor(toModel().y);\r\n\t\tcolMax = Math.floor(toModel().y) + definition.size.height;\r\n\t\trowMin = Math.floor(toModel().x);\r\n\t\trowMax = Math.floor(toModel().x) + definition.size.width;\r\n\t\t\r\n\t\tx = buildingPosition.x;\r\n\t\ty = buildingPosition.y;\r\n\t\tbuildingLevel = pDefinition.buildingLevel;\r\n\t\t\r\n\t\tassetName = definition.spriteName;\r\n\t\t\r\n\t\ttilesUnderBuilding = MapManager.getInstance().getTilesArray(new Point(pDefinition.x, pDefinition.y), definition.size);\r\n\t\tMapManager.getInstance().setTilesBuildable(tilesUnderBuilding, false);\r\n\t\t\r\n\t\taddToStage();\r\n\t}\r\n\t\r\n\tprivate function addToStage():Void {\r\n\t\tsetState(DEFAULT_STATE);\r\n\t\tcast(anim, FlumpMovie).gotoAndStop(buildingLevel);\r\n\t\t\r\n\t\ton(MouseEventType.CLICK, buildingClick);\r\n\t\t\r\n\t\tGameStage.getInstance().getBuildingsContainer().addChild(this);\r\n\t\tstart();\r\n\t}\r\n\t\r\n\toverride public function remove() :Bool\r\n\t{\r\n\t\tif (!super.remove()) {\r\n\t\t\tdestroy();\r\n\t\t\treturn true;\r\n\t\t};\r\n\t\t\r\n\t\toff(MouseEventType.CLICK, buildingClick);\r\n\t\tlist.splice(list.indexOf(this), 1);\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\toverride function doActionNormal():Void {\r\n\t\tsuper.doActionNormal();\r\n\t\t\r\n\t\tif (movingBuilding == this) {\r\n\t\t\tmoveBuildingToCursor();\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Permet de récuperer le contenu de definiton d'un building (building.json) grâce à son nom\r\n\t * @param\tpName\r\n\t */\r\n\tpublic static function getBuildingDefByName(pName:String):BuildingDef {\r\n\t\tvar buildingsDef:Array<BuildingDef> = cast(GameLoader.getContent(\"json/building.json\"));\r\n\r\n\t\tfor (i in 0...buildingsDef.length) {\r\n\t\t\tif (buildingsDef[i].name == pName) {\r\n\t\t\t\treturn buildingsDef[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Upgrade un building\r\n\t */\r\n\tpublic function upgradeBuilding():Void {\r\n\t\tbuildingLevel++;\r\n\t\tcast(anim, FlumpMovie).gotoAndStop(buildingLevel);\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Commence le deplacement d'un batiment\r\n\t */\r\n\tpublic function buildingClick (event:Dynamic) {\r\n\t\t//trace('Event triggered');\r\n\t\t//trace(event);\r\n\t\tvar lMapManager:MapManager = MapManager.getInstance();\r\n\t\tvar tilesUnderBuilding:Array<TileSavedDef>;\r\n\t\t\r\n\t\tif (movingBuilding == this) {\r\n\t\t\tbuildingRequest();\r\n\t\t} else {\r\n\t\t\tinitialeModelPosition = toModel(true);\r\n\t\t\tmovingBuilding = this;\r\n\t\t\ttilesUnderBuilding = lMapManager.getTilesArray(initialeModelPosition, definition.size);\r\n\t\t\tlMapManager.setTilesBuildable(tilesUnderBuilding, true);\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Stop le deplacement d'un batiment\r\n\t */\r\n\tprivate function stopMoving () {\r\n\t\tmovingBuilding = null;\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Deplace le batiment sous le curseur de la souris\r\n\t */\r\n\tprivate function moveBuildingToCursor():Void {\r\n\t\tvar centerOfBuildingModel:Point = getBuildingPositionByCursor();\r\n\t\t\r\n\t\tcenterOfBuildingModel.x = Math.round(centerOfBuildingModel.x);\r\n\t\tcenterOfBuildingModel.y = Math.round(centerOfBuildingModel.y);\r\n\t\t\r\n\t\tposition = IsoManager.modelToIsoView(centerOfBuildingModel);\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Récupère la position du building qui ce place sous le curseur\r\n\t * @return Point de la position du building sous le curseur (Model, non tronqué)\r\n\t */\r\n\tprivate function getBuildingPositionByCursor():Point {\r\n\t\tvar mousePosition:Point = GameManager.getInstance().mousePosition;\r\n\t\tvar buildingOffset:Point = new Point(0, 0);\r\n\t\tvar centerOfBuilding:Point = new Point(0, 0);\r\n\t\t\r\n\t\tbuildingOffset.x = (definition.size.width - definition.size.height) / 2 * (Config.tileWidth / 2);\r\n\t\tbuildingOffset.y = (definition.size.width + definition.size.height) / 2 * (Config.tileHeight / 2);\r\n\t\t\r\n\t\tcenterOfBuilding.x = mousePosition.x + buildingOffset.x;\r\n\t\tcenterOfBuilding.y = mousePosition.y + buildingOffset.y;\r\n\r\n\t\treturn IsoManager.isoViewToModel(centerOfBuilding);\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Essaye de construire le building en dessous de la souris\r\n\t * Ne ce construit pas si la construction n'est pas possible\r\n\t */\r\n\tprivate function buildingRequest():Void {\r\n\t\tvar lMapManager:MapManager = MapManager.getInstance();\r\n\t\tvar buildingPosition:Point = getBuildingPositionByCursor();\r\n\t\tvar tilesOrigin:Array<TileSavedDef>;\r\n\t\tvar tilesDest:Array<TileSavedDef>;\r\n\t\tvar isBuildable:Bool;\r\n\t\t\r\n\t\tbuildingPosition.x = Math.round(buildingPosition.x);\r\n\t\tbuildingPosition.y = Math.round(buildingPosition.y);\r\n\t\t\r\n\t\ttilesDest = lMapManager.getTilesArray(buildingPosition, definition.size);\r\n\t\t\r\n\t\tisBuildable = lMapManager.isBuildable(tilesDest); // test si c'est buildable\r\n\t\t\r\n\t\tif (isBuildable) {\r\n\t\t\ttilesOrigin = lMapManager.getTilesArray(initialeModelPosition, definition.size);\r\n\t\t\t\r\n\t\t\tlMapManager.setTilesBuildable(tilesOrigin, true);\r\n\t\t\tlMapManager.setTilesBuildable(tilesDest, false);\r\n\t\t\t\r\n\t\t\tinitialeModelPosition = buildingPosition;\r\n\t\t\tcancelMoving();\r\n\t\t\tlMapManager.saveMap();\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Annule le deplacement du batiment actuellement en train de bouger et le remet à sa position initiale\r\n\t */\r\n\tprivate static function cancelMoving():Void {\r\n\t\tvar lMapManager:MapManager = MapManager.getInstance();\r\n\t\tvar tilesUnderBuilding:Array<TileSavedDef>;\r\n\t\t\r\n\t\tif (movingBuilding != null) {\r\n\t\t\ttilesUnderBuilding = lMapManager.getTilesArray(movingBuilding.initialeModelPosition, movingBuilding.definition.size);\r\n\t\t\tlMapManager.setTilesBuildable(tilesUnderBuilding, false);\r\n\t\t\t\r\n\t\t\tmovingBuilding.position = IsoManager.modelToIsoView(movingBuilding.initialeModelPosition);\r\n\t\t\tmovingBuilding = null;\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\toverride public function destroy():Void \r\n\t{\r\n\t\tsuper.destroy();\r\n\t\tlist.splice(list.indexOf(this), 1);\r\n\t\tMapManager.getInstance().saveMap();\r\n\t}\r\n\t\r\n}\r\n","package com.isartdigital.builder.game.sprites;\r\n\r\nimport com.isartdigital.builder.game.def.TileSavedDef;\r\nimport com.isartdigital.builder.game.manager.Maps;\r\nimport com.isartdigital.builder.game.manager.MapManager;\r\nimport com.isartdigital.utils.Config;\r\nimport com.isartdigital.utils.game.BoxType;\r\nimport com.isartdigital.utils.game.factory.FlumpMovieAnimFactory;\r\nimport com.isartdigital.utils.game.iso.IsoManager;\r\nimport com.isartdigital.utils.game.StateGraphic;\r\nimport js.Browser;\r\nimport pathfinder.Coordinate;\r\nimport pathfinder.EHeuristic;\r\nimport pathfinder.Pathfinder;\r\nimport pixi.core.math.Point;\r\nimport pixi.extras.MovieClip;\r\n\r\n/**\r\n * ...\r\n * @author Thorcal\r\n */\r\nclass Citizen extends StateGraphic\r\n{\r\n\tpublic static var list:Array<Citizen> = new Array<Citizen>();\r\n\tpublic var posInModel:Point;\r\n\tprivate var listPos:Array<Point> = new Array<Point>();\r\n\tprivate var nextPosModel:Point = new Point();\r\n\tprivate var nextPosIso:Point = new Point();\r\n\tprivate var speed:Point = new Point(2,1);\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t\r\n\t\tfactory = new FlumpMovieAnimFactory();\r\n\t\tassetName = \"Building_1x1\"; \r\n\t\tsetState(DEFAULT_STATE);\r\n\t\tboxType = BoxType.NONE;\r\n\t\tlist.push(this);\r\n\t\tposInModel = IsoManager.isoViewToModel(position);\r\n\t\tstartPathfinder();\r\n\t\tsetNextPos();\r\n\t}\r\n\t\r\n\tprivate function startPathfinder():Void {\r\n\t\tvar l_map = new Maps(30, 30); // Create a 30x30 map\r\n\t\tvar l_pathfinder = new Pathfinder(l_map); // Create a Pathfinder engine configured for our map\r\n\t\tvar l_startNode = new Coordinate(Std.int(posInModel.x), Std.int(posInModel.y)); //  The starting node\r\n\t\tvar l_destinationNode = new Coordinate(2, 7); // The destination node\r\n\t\tvar l_heuristicType = EHeuristic.PRODUCT; // The method of A Star used\r\n\t\tvar l_isDiagonalEnabled = false; // Set to true to ensure only up, left, down, right movements are allowed\r\n\t\tvar l_isMapDynamic = false; // Set to true to force fresh lookups from IMap.isWalkable() for each node's isWalkable property (e.g. for a dynamically changing map)\r\n\t\tvar l_path = l_pathfinder.createPath(l_startNode, l_destinationNode, l_heuristicType, l_isDiagonalEnabled, l_isMapDynamic);\r\n\t\t\r\n\t\tfor (i in 0...l_path.length)\r\n\t\t{\r\n\t\t\tlistPos.push(new Point(l_path[i].x, l_path[i].y));\r\n\t\t}\r\n\t}\r\n\t\r\n\toverride function doActionNormal():Void \r\n\t{\r\n\t\tsuper.doActionNormal();\r\n\t\t//trace (listPos);\r\n\t\tmoveTo();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Récupere le prochain point du model à atteindre dans listPos\r\n\t */\r\n\t\r\n\tprivate function setNextPos():Void {\r\n\t\tif (listPos.length != 0) {\r\n\t\t\tnextPosModel = listPos.shift();\r\n\t\t\tnextPosIso = IsoManager.modelToIsoView(nextPosModel);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Bouge le sprite vers une coordonnée du model grace à setNextPos\r\n\t */\r\n\tpublic function moveTo():Void {\r\n\t\tif (position.x < nextPosIso.x) {\r\n\t\t\tposition.x += speed.x;\r\n\t\t}else if (position.x > nextPosIso.x) {\r\n\t\t\tposition.x -= speed.x;\r\n\t\t}\r\n\t\tif (position.y < nextPosIso.y) {\r\n\t\t\tposition.y += speed.y;\r\n\t\t}else if (position.y > nextPosIso.y) {\r\n\t\t\tposition.y -= speed.y;\r\n\t\t}\r\n\t\tif (position.x == nextPosIso.x && position.y == nextPosIso.y) {\r\n\t\t\tsetNextPos();\r\n\t\t}\r\n\t}\r\n\t\r\n\toverride public function destroy():Void \r\n\t{\r\n\t\tlist.splice(list.indexOf(this), 1);\r\n\t\tsuper.destroy();\r\n\t}\r\n}","package com.isartdigital.builder.game.sprites;\r\n\r\nimport com.isartdigital.builder.game.pooling.IPoolObject;\r\nimport com.isartdigital.builder.game.pooling.PoolObject;\r\nimport com.isartdigital.utils.Debug;\r\nimport com.isartdigital.utils.events.MouseEventType;\r\nimport com.isartdigital.utils.game.BoxType;\r\nimport com.isartdigital.utils.game.factory.FlumpMovieAnimFactory;\r\nimport com.isartdigital.utils.game.GameStage;\r\nimport com.isartdigital.utils.game.iso.IsoManager;\r\nimport com.isartdigital.utils.game.iso.IZSortable;\r\nimport com.isartdigital.utils.game.StateGraphic;\r\nimport pixi.core.math.Point;\r\nimport pixi.display.FlumpMovie;\r\nimport pixi.extras.MovieClip;\r\nimport pixi.interaction.EventTarget;\r\n\r\n/**\r\n * Classe des tiles\r\n * @author Dorian MILLIERE\r\n */\r\nclass Tile extends SpriteObject implements IPoolObject\r\n{\r\n\tpublic static var list:Array<Tile> = new Array<Tile>();\r\n\t\r\n\tprivate var tilesCount:Int = 9;\r\n\tprivate var tileColor:Int;\r\n\r\n\tpublic var isBuildable:Bool = true;\r\n\tpublic var isWalkable:Bool = true;\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\tboxType = BoxType.NONE;\r\n\t\tinteractive = true;\r\n\t\tfactory = new FlumpMovieAnimFactory();\r\n\t}\r\n\t\r\n\toverride public function remove() :Bool\r\n\t{\r\n\t\tif (!super.remove()) \r\n\t\t{\r\n\t\t\tdestroy();\r\n\t\t\treturn true;\r\n\t\t};\r\n\t\tlist.splice(list.indexOf(this), 1);\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\toverride public function init(pDefiniton:Dynamic):Void \r\n\t{\t\r\n\t\tvar x:Float = Reflect.getProperty(pDefiniton, \"x\");\r\n\t\tvar y:Float = Reflect.getProperty(pDefiniton, \"y\");\r\n\t\tvar lPosition:Point = new Point(x, y);\r\n\t\tlPosition = IsoManager.modelToIsoView(lPosition);\r\n\t\tposition.set(lPosition.x, lPosition.y);\r\n\t\t\r\n\t\t\r\n\t\tisBuildable = Reflect.getProperty(pDefiniton, \"isBuildable\");\r\n\t\t\r\n\t\tTile.list.push(this);\r\n\r\n\t\tassetName = \"Ground\";\r\n\t\tsetState(DEFAULT_STATE);\r\n\t\t\r\n\t\tsetRandomColor();\r\n\r\n\t\tGameStage.getInstance().getTilesContainer().addChild(this);\r\n\t}\r\n\t\r\n\t\r\n\tprivate function setRandomColor():Void {\r\n\t\tvar random:Int = Math.floor(Math.random() * tilesCount);\r\n\t\ttileColor = random;\r\n\t\tcast(anim, FlumpMovie).gotoAndStop(tileColor);\r\n\t}\r\n\t\r\n\toverride public function destroy():Void \r\n\t{\r\n\t\tparent.removeChild(this);\r\n\t\tlist.splice(list.indexOf(this), 1);\r\n\t\tsuper.destroy();\r\n\t}\r\n\t\r\n}","package com.isartdigital.builder.game.sprites.buildings;\r\n\r\nimport com.isartdigital.builder.game.def.BuildingDef;\r\nimport com.isartdigital.builder.game.sprites.Building;\r\n\r\n/**\r\n * ...\r\n * @author Dorian\r\n */\r\nclass Casino extends Building\r\n{\r\n\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t\r\n\t}\r\n\t\r\n}","package com.isartdigital.builder.game.sprites.buildings;\r\nimport com.isartdigital.builder.game.def.BuildingDef;\r\n\r\n/**\r\n * ...\r\n * @author Dorian\r\n */\r\nclass Motel extends Building\r\n{\r\n\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\t\r\n}","package com.isartdigital.builder.game.sprites.buildings;\r\n\r\nimport com.isartdigital.builder.game.def.BuildingDef;\r\nimport com.isartdigital.builder.game.sprites.Building;\r\n\r\n/**\r\n * ...\r\n * @author Dorian\r\n */\r\nclass RocketFactory extends Building\r\n{\r\n\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t\r\n\t}\r\n\t\r\n}","package com.isartdigital.builder.game.sprites.buildings;\r\nimport com.isartdigital.builder.game.def.BuildingDef;\r\n\r\n/**\r\n * ...\r\n * @author Dorian\r\n */\r\nclass Temple extends Building\r\n{\r\n\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\t\r\n}","package com.isartdigital.builder.game.utils;\r\n\r\n/**\r\n * ...\r\n * @author Flavien\r\n */\r\nclass TypeDefUtils\r\n{\r\n\r\n\tpublic function new() \r\n\t{\r\n\t\t\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * \r\n\t * @param\tpTypeDef\r\n\t * @return\r\n\t */\r\n\tpublic static function getValue(pTypeDef:Dynamic) : Dynamic\r\n\t{\r\n\t\tif (Reflect.hasField(pTypeDef, \"x\")) trace(\"he got\");\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Test si deux typeDef sont identique ou non\r\n\t * Note : faire la comparaison entre deux instance de typedef\r\n\t * @param\tpType1\r\n\t * @param\tpType2\r\n\t * @return true si identique, sinon false\r\n\t */\r\n\tpublic static function compare(pType1:Dynamic, pType2:Dynamic) :Bool\r\n\t{\r\n\t\tvar lArray1:Array<String> = Reflect.fields(pType1);\r\n\t\tvar lArray2:Array<String> = Reflect.fields(pType2);\r\n\t\t\r\n\t\tif (lArray1.length != lArray2.length) return false;\r\n\t\t\r\n\t\tfor (lString in lArray1)\r\n\t\t{\r\n\t\t\tif (lArray2.indexOf(lString) < 0) return false;\r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n\t\r\n}","package com.isartdigital.builder.ui;\r\nimport com.isartdigital.utils.Config;\r\nimport com.isartdigital.utils.game.Camera;\r\nimport dat.gui.GUI;\r\n\r\n\t\r\n/**\r\n * Classe permettant de manipuler des parametres du projet au runtime\r\n * Si la propriété Config.debug et à false ou que la propriété Config.data.cheat est à false, aucun code n'est executé.\r\n * Il n'est pas nécessaire de retirer ou commenter le code du CheatPanel dans la version \"release\" du jeu\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass CheatPanel \r\n{\r\n\t\r\n\t/**\r\n\t * instance unique de la classe CheatPanel\r\n\t */\r\n\tprivate static var instance: CheatPanel;\r\n\t\r\n\t/**\r\n\t * instance de dat.GUI composée par le CheatPanel\r\n\t */\r\n\tprivate var gui:GUI;\r\n\t\r\n\t/**\r\n\t * Retourne l'instance unique de la classe, et la crée si elle n'existait pas au préalable\r\n\t * @return instance unique\r\n\t */\r\n\tpublic static function getInstance (): CheatPanel {\r\n\t\tif (instance == null) instance = new CheatPanel();\r\n\t\treturn instance;\r\n\t}\r\n\t\r\n\t/**\r\n\t * constructeur privé pour éviter qu'une instance soit créée directement\r\n\t */\r\n\tprivate function new() \r\n\t{\r\n\t\tinit();\r\n\t}\r\n\t\r\n\tprivate function init():Void {\r\n\t\tif (Config.debug && Config.data.cheat) gui = new GUI();\r\n\t}\r\n\t\r\n\t// exemple de méthode configurant le panneau de cheat suivant le contexte\r\n\tpublic function ingame (): Void {\r\n\t\t// ATTENTION: toujours intégrer cette ligne dans chacune de vos méthodes pour ignorer le reste du code si le CheatPanel doit être désactivé\r\n\t\tif (gui == null) return;\r\n\t\t\r\n\t\tvar lCamera:GUI = gui.addFolder(\"Camera\");\r\n\t\tlCamera.open();\r\n\t\tlCamera.add(Camera.getInstance(), \"speedLimite\", 0, 100).listen();\r\n\t\tlCamera.add(Camera.getInstance(), \"inertiaMax\", 0, 100).listen();\r\n\t\tlCamera.add(Camera.getInstance(), \"inertiaMin\", 0, 100).listen();\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * vide le CheatPanel\r\n\t */\r\n\tpublic function clear ():Void {\r\n\t\tif (gui == null) return;\r\n\t\tgui.destroy();\r\n\t\tinit();\r\n\t}\t\r\n\t\r\n\t/**\r\n\t * détruit l'instance unique et met sa référence interne à null\r\n\t */\r\n\tpublic function destroy (): Void {\r\n\t\tinstance = null;\r\n\t}\r\n\r\n}","package com.isartdigital.utils.ui;\r\n\r\nimport com.isartdigital.utils.events.EventType;\r\nimport com.isartdigital.utils.events.MouseEventType;\r\nimport com.isartdigital.utils.events.TouchEventType;\r\nimport com.isartdigital.utils.game.GameObject;\r\nimport com.isartdigital.utils.game.GameStage;\r\nimport com.isartdigital.utils.ui.UIPositionable;\r\nimport haxe.Timer;\r\nimport pixi.core.sprites.Sprite;\r\nimport pixi.core.textures.Texture;\r\nimport pixi.interaction.EventTarget;\r\n\r\n/**\r\n * Base de tous les conteneurs d'interface\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass UIComponent extends GameObject\r\n{\r\n\tprivate var positionables:Array<UIPositionable> = [];\r\n\t\r\n\tprivate var isOpened:Bool;\r\n\t\r\n\tprivate var modalZone:Sprite;\r\n\t\r\n\tprivate var _modal:Bool=true;\r\n\t\r\n\t// TODO: pouvoir le varier dynamiquement\r\n\tpublic var modalImage:String=\"assets/alpha_bg.png\";\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\t\r\n\t/**\r\n\t * permet de construire l'UIComponent à partir de l'UIBuilder\r\n\t */\r\n\tpublic function build () : Void {\r\n\t\tvar lClassName = Type.getClassName(Type.getClass(this));\r\n\t\tlClassName = lClassName.substring(lClassName.lastIndexOf(\".\") + 1);\r\n\t\t\r\n\t\tvar lItems:Array<UIPositionable> = UIBuilder.buildScreen(lClassName);\r\n\t\t\r\n\t\tfor (lItem in lItems) {\r\n\t\t\taddChild(lItem.item);\r\n\t\t\tif (lItem.align != \"\") positionables.push(lItem);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function open (): Void {\r\n\t\tif (isOpened) return;\r\n\t\tisOpened = true;\r\n\t\tmodal = _modal;\r\n\t\tGameStage.getInstance().on(EventType.RESIZE, onResize);\r\n\t\tonResize();\r\n\t}\r\n\t\r\n\t//TODO: verifier si y a besoin d'une variable privée ou si on peut utiliser modal direct\r\n\t\r\n\tpublic var modal (get, set):Bool;\r\n\t\r\n\tprivate function get_modal ():Bool {\r\n\t\treturn _modal;\r\n\t}\r\n\t\r\n\tprivate function set_modal (pModal:Bool):Bool {\r\n\t\t_modal = pModal;\r\n\t\t\r\n\t\tif (_modal) {\r\n\t\t\tif (modalZone == null) {\r\n\t\t\t\tmodalZone = new Sprite(Texture.fromImage(modalImage));\r\n\t\t\t\tmodalZone.interactive = true;\r\n\t\t\t\tmodalZone.on(MouseEventType.CLICK, stopPropagation);\r\n\t\t\t\tmodalZone.on(TouchEventType.TAP, stopPropagation);\r\n\t\t\t\tpositionables.unshift({ item:modalZone, align:UIPosition.FIT_SCREEN, offsetX:0, offsetY:0 });\r\n\t\t\t}\r\n\t\t\tif (parent != null) parent.addChildAt(modalZone, parent.getChildIndex(this));\r\n\t\t} else {\t\r\n\t\t\tif (modalZone != null) {\r\n\t\t\t\tif (modalZone.parent != null) modalZone.parent.removeChild(modalZone);\r\n\t\t\t\tmodalZone.off(MouseEventType.CLICK, stopPropagation);\r\n\t\t\t\tmodalZone.off(TouchEventType.TAP, stopPropagation);\r\n\t\t\t\tmodalZone = null;\r\n\t\t\t\tif (positionables[0].item == modalZone) positionables.shift();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn _modal;\r\n\t}\r\n\t\r\n\tprivate function stopPropagation (pEvent:EventTarget): Void {}\r\n\t\r\n\tpublic function close ():Void {\r\n\t\tif (!isOpened) return;\r\n\t\tisOpened = false;\r\n\t\tmodal = false;\r\n\t\tdestroy();\r\n\t}\r\n\t\r\n\t/**\r\n\t * déclenche le positionnement des objets\r\n\t * @param pEvent\r\n\t */\r\n\tprivate function onResize (pEvent:EventTarget = null): Void {\r\n\t\t//TODO: petit hack pour appliquer les bonnes dimensions du resize\r\n\t\tTimer.delay(setPositions, 10);\r\n\t}\r\n\t\r\n\t/**\r\n\t * repositionne les éléments\r\n\t * @param\tpEvent\r\n\t */\r\n\tprivate function setPositions (): Void {\r\n\t\tfor (lObj in positionables) {\r\n\t\t\tUIPosition.setPosition(lObj.item, lObj.align,lObj.offsetX,lObj.offsetY);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * nettoie l'instance\r\n\t */\r\n\toverride public function destroy (): Void {\r\n\t\tclose();\r\n\t\tGameStage.getInstance().off(EventType.RESIZE, onResize);\r\n\t\tsuper.destroy();\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils.ui;\r\n\r\n\r\n/**\r\n * Classe de base des Ecrans\r\n * Tous les écrans d'interface héritent de cette classe\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass Screen extends UIComponent \r\n{\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\tmodalImage = \"assets/black_bg.png\";\r\n\t\t\r\n\t}\r\n\t\r\n}","package com.isartdigital.builder.ui;\n\nimport com.isartdigital.utils.Config;\nimport com.isartdigital.utils.ui.Screen;\nimport pixi.core.sprites.Sprite;\nimport pixi.core.textures.Texture;\n\n/**\n * Preloader Graphique principal\n * @author Mathieu ANTHOINE\n */\nclass GraphicLoader extends Screen \n{\n\t\n\t/**\n\t * instance unique de la classe GraphicLoader\n\t */\n\tprivate static var instance: GraphicLoader;\n\n\tprivate var loaderBar:Sprite;\n\n\tpublic function new() \n\t{\n\t\tsuper();\n\t\tvar lBg:Sprite = new Sprite(Texture.fromImage(Config.assetsPath+\"preload_bg.png\"));\n\t\tlBg.anchor.set(0.5, 0.5);\n\t\taddChild(lBg);\n\t\t\n\t\tloaderBar = new Sprite (Texture.fromImage(Config.assetsPath+\"preload.png\"));\n\t\tloaderBar.anchor.y = 0.5;\n\t\tloaderBar.x = -loaderBar.width / 2;\n\t\taddChild(loaderBar);\n\t\tloaderBar.scale.x = 0;\n\t}\n\t\n\t/**\n\t * Retourne l'instance unique de la classe, et la crée si elle n'existait pas au préalable\n\t * @return instance unique\n\t */\n\tpublic static function getInstance (): GraphicLoader {\n\t\tif (instance == null) instance = new GraphicLoader();\n\t\treturn instance;\n\t}\n\t\n\t/**\n\t * mise à jour de la barre de chargement\n\t * @param\tpProgress\n\t */\n\tpublic function update (pProgress:Float): Void {\n\t\tloaderBar.scale.x = pProgress;\n\t}\n\t\n\t/**\n\t * détruit l'instance unique et met sa référence interne à null\n\t */\n\toverride public function destroy (): Void {\n\t\tinstance = null;\n\t\tsuper.destroy();\n\t}\n\n}","package com.isartdigital.builder.ui;\n\nimport com.isartdigital.builder.ui.hud.Hud;\nimport com.isartdigital.utils.game.GameStage;\nimport com.isartdigital.utils.ui.Popin;\nimport com.isartdigital.utils.ui.Screen;\nimport pixi.core.display.Container;\n\n/**\n * Manager (Singleton) en charge de gérer les écrans d'interface\n * @author Mathieu ANTHOINE\n */\nclass UIManager \n{\n\t\n\t/**\n\t * instance unique de la classe UIManager\n\t */\n\tprivate static var instance: UIManager;\n\t\n\t\n\t/**\n\t * tableau des popins ouverts\n\t */\n\tprivate var popins:Array<Popin>;\n\n\tpublic function new() \n\t{\n\t\tpopins = [];\n\t}\n\t\n\t/**\n\t * Retourne l'instance unique de la classe, et la crée si elle n'existait pas au préalable\n\t * @return instance unique\n\t */\n\tpublic static function getInstance (): UIManager {\n\t\tif (instance == null) instance = new UIManager();\n\t\treturn instance;\n\t}\n\t\n\t/**\n\t * Ajoute un écran dans le conteneur de Screens en s'assurant qu'il n'y en a pas d'autres\n\t * @param\tpScreen Screen à ouvrir\n\t */\n\tpublic function openScreen (pScreen: Screen): Void {\n\t\tcloseScreens();\n\t\tGameStage.getInstance().getScreensContainer().addChild(pScreen);\n\t\tpScreen.open();\n\t}\n\t\n\t/**\n\t * Supprime les écrans dans le conteneur de Screens\n\t */\n\tpublic function closeScreens (): Void {\n\t\tvar lContainer:Container = GameStage.getInstance().getScreensContainer();\n\t\twhile (lContainer.children.length > 0) {\n\t\t\tvar lCurrent:Screen = cast(lContainer.getChildAt(lContainer.children.length - 1), Screen);\n\t\t\tlCurrent.interactive = false;\n\t\t\tlContainer.removeChild(lCurrent);\n\t\t\tlCurrent.close();\n\t\t}\n\t}\n\t\n\t/**\n\t * Ajoute un popin dans le conteneur de Popin\n\t * @param\tpPopin Popin à ouvrir\n\t */\n\tpublic function openPopin (pPopin: Popin): Void {\n\t\tpopins.push(pPopin);\n\t\tGameStage.getInstance().getPopinsContainer().addChild(pPopin);\n\t\tpPopin.open();\n\t}\n\t\n\t/**\n\t * Supprime le popin dans le conteneur de Screens\n\t */\n\tpublic function closeCurrentPopin (): Void {\n\t\tif (popins.length == 0) return;\n\t\tvar lCurrent:Popin = popins.pop();\n\t\tlCurrent.interactive = false;\n\t\tGameStage.getInstance().getPopinsContainer().removeChild(lCurrent);\n\t\tlCurrent.close();\n\t\t\n\t}\n\t\n\t/**\n\t * Ajoute le hud dans le conteneur de Hud\n\t */\n\tpublic function openHud (): Void {\n\t\tGameStage.getInstance().getHudContainer().addChild(Hud.getInstance());\n\t\tHud.getInstance().open();\n\t}\n\t\n\t/**\n\t * Retire le hud du conteneur de Hud\n\t */\n\tpublic function closeHud (): Void {\n\t\tGameStage.getInstance().getHudContainer().removeChild(Hud.getInstance());\n\t\tHud.getInstance().close();\n\t}\n\t\n\t/**\n\t * met l'interface en mode jeu\n\t */\n\t public function startGame (): Void {\n\t\tcloseScreens();\n\t\topenHud();\n\t}\n\t\n\t/**\n\t * détruit l'instance unique et met sa référence interne à null\n\t */\n\tpublic function destroy (): Void {\n\t\tinstance = null;\n\t}\n\n}","package com.isartdigital.builder.ui.hud;\n\nimport com.isartdigital.builder.api.Api;\nimport com.isartdigital.builder.api.DataDef;\nimport com.isartdigital.utils.Config;\nimport com.isartdigital.utils.Debug;\nimport com.isartdigital.utils.ui.Screen;\nimport com.isartdigital.utils.ui.UIPosition;\nimport haxe.Json;\nimport pixi.core.display.Container;\nimport pixi.core.sprites.Sprite;\nimport pixi.core.text.Text;\nimport pixi.core.textures.Texture;\nimport pixi.interaction.EventTarget;\n\n/**\n * Classe en charge de gérer les informations du Hud\n * @author Mathieu ANTHOINE\n */\nclass Hud extends Screen \n{\n\t\n\t/**\n\t * instance unique de la classe Hud\n\t */\n\tprivate static var instance: Hud;\n\t\n\tprivate var hudRessources:Container;\n\t\n\tprivate var goldText:Text;\n\tprivate var spiceText:Text;\n\tprivate var offeringText:Text;\n\t\n\t/**\n\t * Retourne l'instance unique de la classe, et la crée si elle n'existait pas au préalable\n\t * @return instance unique\n\t */\n\tpublic static function getInstance (): Hud {\n\t\tif (instance == null) instance = new Hud();\n\t\treturn instance;\n\t}\t\n\t\n\tpublic function new() \n\t{\n\t\tsuper();\n\t\t_modal = false;\n\t\t\n\t\thudRessources = new Container();\t\n\n\t\t\n\t\tgoldText = new Text(\"Gold : \");\n\t\tgoldText.position.set(50, 50);\n\t\t\n\t\tspiceText = new Text(\"Spice : \");\n\t\tspiceText.position.set(50, 75);\n\t\t\n\t\tofferingText = new Text(\"Offering : \");\n\t\tofferingText.position.set(50,100);\n\t\t//lTxt2.position.set(20, -120);\n\t\thudRessources.addChild(goldText);\n\t\thudRessources.addChild(spiceText);\t\t\n\t\thudRessources.addChild(offeringText);\t\t\n\t\t\n\t\taddChild(hudRessources);\n\t\tUIPosition.setPosition(hudRessources, UIPosition.TOP);\n\t}\n\t\n\t/**\n\t * repositionne les éléments du Hud\n\t * @param\tpEvent\n\t */\n\toverride private function onResize (pEvent:EventTarget=null): Void {\n\t\t//repositionne l'élement de Hud concerné en haut à gauche\n\t\tUIPosition.setPosition(hudRessources, UIPosition.TOP);\n\t}\n\t\n\tpublic function refreshHUD () : Void {\n\t\tApi.resources.all(cb_resourceAll);\n\t}\n\t\n\tprivate function cb_resourceAll (pData:String) : Void\n\t{\n\t\tvar lData:DataDef = cast(Json.parse(pData));\n\t\t\n\t\tif (lData.error)\n\t\t{\n\t\t\tDebug.error(lData.errorMessage);\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tgoldText.text = \"Gold : \" + lData.data.gold;\n\t\tspiceText.text = \"Spice : \" + lData.data.spice;\n\t\tofferingText.text = \"Offering : \" + lData.data.offering;\n\t}\n\t\n\t/**\n\t * détruit l'instance unique et met sa référence interne à null\n\t */\n\toverride public function destroy (): Void {\n\t\tinstance = null;\n\t\tsuper.destroy();\n\t}\n\n}","package com.isartdigital.utils.ui;\r\n\r\n/**\r\n * Classe de base des PopIn\r\n * Toutes les popin d'interface héritent de cette classe\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass Popin extends UIComponent\r\n{\r\n\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\t\r\n}","package com.isartdigital.builder.ui.popin;\r\n\r\nimport com.isartdigital.utils.Config;\r\nimport com.isartdigital.utils.events.MouseEventType;\r\nimport com.isartdigital.utils.events.TouchEventType;\r\nimport com.isartdigital.utils.sounds.SoundManager;\r\nimport com.isartdigital.utils.ui.Popin;\r\nimport com.isartdigital.builder.game.GameManager;\r\nimport pixi.core.sprites.Sprite;\r\nimport pixi.core.textures.Texture;\r\nimport pixi.interaction.EventTarget;\r\n\r\n\r\n\t\r\n/**\r\n * Exemple de classe héritant de Popin\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass Confirm extends Popin \r\n{\r\n\t\r\n\tprivate var background:Sprite;\r\n\t\r\n\t/**\r\n\t * instance unique de la classe Confirm\r\n\t */\r\n\tprivate static var instance: Confirm;\r\n\t\r\n\t/**\r\n\t * Retourne l'instance unique de la classe, et la crée si elle n'existait pas au préalable\r\n\t * @return instance unique\r\n\t */\r\n\tpublic static function getInstance (): Confirm {\r\n\t\tif (instance == null) instance = new Confirm();\r\n\t\treturn instance;\r\n\t}\r\n\t\r\n\t/**\r\n\t * constructeur privé pour éviter qu'une instance soit créée directement\r\n\t */\r\n\tprivate function new() \r\n\t{\r\n\t\tsuper();\r\n\t\tbackground = new Sprite(Texture.fromImage(Config.assetsPath+\"Confirm.png\"));\r\n\t\tbackground.anchor.set(0.5, 0.5);\r\n\t\taddChild(background);\r\n\t\tinteractive = true;\r\n\t\tbuttonMode = true;\r\n\t\t\r\n\t\tonce(MouseEventType.CLICK,onClick);\r\n\t\tonce(TouchEventType.TAP,onClick);\r\n\t\t\r\n\t}\r\n\t\r\n\tprivate function test (pEvent:EventTarget):Void {\r\n\t\ttrace (pEvent);\r\n\t}\r\n\t\r\n\tprivate function onClick (pEvent:EventTarget): Void {\r\n\t\tSoundManager.getSound(\"click\").play();\r\n\t\tUIManager.getInstance().closeCurrentPopin();\r\n\t\tGameManager.getInstance().start();\r\n\t}\r\n\t\r\n\t/**\r\n\t * détruit l'instance unique et met sa référence interne à null\r\n\t */\r\n\toverride public function destroy (): Void {\r\n\t\tinstance = null;\r\n\t\tsuper.destroy();\r\n\t}\r\n\r\n}","package com.isartdigital.builder.ui.screens;\r\n\r\nimport com.isartdigital.builder.ui.popin.Confirm;\r\nimport com.isartdigital.utils.Config;\r\nimport com.isartdigital.utils.events.MouseEventType;\r\nimport com.isartdigital.utils.events.TouchEventType;\r\nimport com.isartdigital.utils.sounds.SoundManager;\r\nimport com.isartdigital.utils.ui.Screen;\r\nimport pixi.core.sprites.Sprite;\r\nimport pixi.core.textures.Texture;\r\nimport pixi.interaction.EventTarget;\r\n\r\n\t\r\n/**\r\n * Exemple de classe héritant de Screen\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass TitleCard extends Screen \r\n{\r\n\tprivate var background:Sprite;\r\n\t\r\n\t/**\r\n\t * instance unique de la classe TitleCard\r\n\t */\r\n\tprivate static var instance: TitleCard;\r\n\t\r\n\t/**\r\n\t * Retourne l'instance unique de la classe, et la crée si elle n'existait pas au préalable\r\n\t * @return instance unique\r\n\t */\r\n\tpublic static function getInstance (): TitleCard {\r\n\t\tif (instance == null) instance = new TitleCard();\r\n\t\treturn instance;\r\n\t}\r\n\t\r\n\t/**\r\n\t * constructeur privé pour éviter qu'une instance soit créée directement\r\n\t */\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\tbuild();\r\n\t}\r\n\t\r\n\t/**\r\n\t * détruit l'instance unique et met sa référence interne à null\r\n\t */\r\n\toverride public function destroy (): Void {\r\n\t\tinstance = null;\r\n\t\tsuper.destroy();\r\n\t}\r\n\r\n}","package com.isartdigital.utils.ui;\r\nimport com.isartdigital.utils.events.MouseEventType;\r\nimport com.isartdigital.utils.game.BoxType;\r\nimport com.isartdigital.utils.game.StateGraphic;\r\nimport pixi.core.text.Text;\r\nimport pixi.interaction.EventTarget;\r\n\r\n/**\r\n * Classe de base des boutons\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass Button extends StateGraphic\r\n{\r\n\t\r\n\tprivate static inline var UP:Int = 0;\r\n\tprivate static inline var OVER:Int = 1;\r\n\tprivate static inline var DOWN:Int = 2;\r\n\t\r\n\tprivate var txt:Text;\r\n\t\r\n\tprivate var upStyle:TextStyle;\r\n\tprivate var overStyle:TextStyle;\r\n\tprivate var downStyle:TextStyle;\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\t\r\n\t\tsuper();\r\n\t\tboxType = BoxType.SELF;\r\n\t\tinteractive = true;\r\n\t\tbuttonMode = true;\r\n\t\t\r\n\t\ton(MouseEventType.MOUSE_OVER, _mouseOver);\r\n\t\ton(MouseEventType.MOUSE_DOWN, _mouseDown);\r\n\t\ton(MouseEventType.CLICK, _click);\r\n\t\ton(MouseEventType.MOUSE_OUT, _mouseOut);\r\n\t\ton(MouseEventType.MOUSE_UP_OUTSIDE, _mouseOut);\r\n\r\n\t\tcreateText();\r\n\t\t\r\n\t\tstart();\r\n\t\t\r\n\t}\r\n\t\r\n\tprivate function createText ():Void {\r\n\t\tupStyle={ font: \"80px Arial\", fill: \"#000000\", align:\"center\"};\r\n\t\toverStyle={ font: \"80px Arial\", fill: \"#AAAAAA\", align:\"center\"};\r\n\t\tdownStyle = { font: \"80px Arial\", fill: \"#FFFFFF\", align:\"center\" };\r\n\t\ttxt = new Text(\"\",upStyle);\r\n\t\ttxt.anchor.set(0.5, 0.5);\r\n\t}\r\n\t\r\n\tpublic function setText(pText:String):Void {\r\n\t\ttxt.text=pText;\r\n\t}\r\n\t\r\n\toverride private function setModeNormal ():Void {\r\n\t\tsetState(DEFAULT_STATE);\t\t\r\n\t\tuntyped anim.gotoAndStop(UP);\r\n\t\taddChild(txt);\r\n\t\tsuper.setModeNormal();\r\n\t}\r\n\t\r\n\tprivate function _mouseVoid ():Void {}\r\n\r\n\tprivate function _click (pEvent:EventTarget): Void {\r\n\t\tuntyped anim.gotoAndStop(UP);\r\n\t\ttxt.style=upStyle;\r\n\t}\t\r\n\t\r\n\tprivate function _mouseDown (pEvent:EventTarget): Void {\r\n\t\tuntyped anim.gotoAndStop(DOWN);\r\n\t\ttxt.style=downStyle;\r\n\t}\r\n\t\r\n\tprivate function _mouseOver (pEvent:EventTarget): Void {\r\n\t\tuntyped anim.gotoAndStop(OVER);\r\n\t\ttxt.style=overStyle;\r\n\t}\r\n\t\r\n\tprivate function _mouseOut (pEvent:EventTarget): Void {\r\n\t\tuntyped anim.gotoAndStop(UP);\r\n\t\ttxt.style=upStyle;\r\n\t}\r\n\t\r\n\toverride public function destroy ():Void {\r\n\t\toff(MouseEventType.MOUSE_OVER, _mouseOver);\r\n\t\toff(MouseEventType.MOUSE_DOWN, _mouseDown);\r\n\t\toff(MouseEventType.CLICK, _click);\r\n\t\toff(MouseEventType.MOUSE_OUT, _mouseOut);\r\n\t\toff(MouseEventType.MOUSE_UP_OUTSIDE, _mouseOut);\r\n\t\tsuper.destroy();\r\n\t}\r\n}","package com.isartdigital.builder.ui.uimodule;\r\n\r\nimport com.isartdigital.utils.game.factory.FlumpMovieAnimFactory;\r\nimport com.isartdigital.utils.ui.Button;\r\n\r\n/**\r\n * ...\r\n * @author Thorcal\r\n */\r\nclass BackButton extends Button\r\n{\r\n\r\n\tpublic function new() \r\n\t{\r\n\t\tfactory = new FlumpMovieAnimFactory();\r\n\t\tsuper();\r\n\t\t\r\n\t}\r\n\t\r\n}","package com.isartdigital.builder.ui.uimodule;\r\n\r\nimport com.isartdigital.utils.game.factory.FlumpMovieAnimFactory;\r\nimport com.isartdigital.utils.ui.Button;\r\n\r\n/**\r\n * ...\r\n * @author Thorcal\r\n */\r\nclass CreditsButton extends Button\r\n{\r\n\r\n\tpublic function new() \r\n\t{\r\n\t\tfactory = new FlumpMovieAnimFactory();\r\n\t\tsuper();\r\n\t\t\r\n\t}\r\n\t\r\n}","package com.isartdigital.builder.ui.uimodule;\r\n\r\nimport com.isartdigital.builder.game.GameManager;\r\nimport com.isartdigital.utils.events.MouseEventType;\r\nimport com.isartdigital.utils.game.factory.FlumpMovieAnimFactory;\r\nimport com.isartdigital.utils.ui.Button;\r\nimport pixi.interaction.EventTarget;\r\n\r\n/**\r\n * ...\r\n * @author Thorcal\r\n */\r\nclass PlayButton extends Button\r\n{\r\n\r\n\tpublic function new() \r\n\t{\r\n\t\tfactory = new FlumpMovieAnimFactory();\r\n\t\tsuper();\r\n\t\tinteractive = true;\r\n\t\tbuttonMode = true;\r\n\t\tonce(MouseEventType.CLICK,onClick);\r\n\t}\r\n\t\r\n\tprivate function onClick (pEvent:EventTarget): Void {\r\n\t\t\r\n\t\tUIManager.getInstance().startGame();\r\n\t\tGameManager.getInstance().start();\r\n\t\t\r\n\t}\r\n\t\r\n}","package com.isartdigital.builder.ui.uimodule;\r\n\r\nimport com.isartdigital.utils.game.factory.FlumpMovieAnimFactory;\r\nimport com.isartdigital.utils.ui.Button;\r\n\r\n/**\r\n * ...\r\n * @author Roman CHEVASSU\r\n */\r\nclass ShopButton1 extends Button\r\n{\r\n\r\n\tpublic function new() \r\n\t{\r\n\t\tfactory = new FlumpMovieAnimFactory();\r\n\t\tsuper();\r\n\t\t\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils ;\r\nimport haxe.Json;\r\nimport js.Browser;\r\n\r\n\t\r\n/**\r\n * Classe utilitaire contenant les données de configuration du jeu\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass Config \r\n{\r\n\t\t\r\n\t/**\r\n\t * version de l'application\r\n\t */\r\n\tpublic static var version (get,never):String;\r\n\t\r\n\t/**\r\n\t * langue courante\r\n\t */\r\n\tpublic static var language (get,never): String;\r\n\t\r\n\t/**\r\n\t * langues disponibles\r\n\t */\r\n\tpublic static var languages (get,never): Array<String>;\r\n\t\r\n\t/**\r\n\t * défini si le jeu est en mode \"debug\" ou pas (si prévu dans le code du jeu)\r\n\t */\r\n\tpublic static var debug (get, never): Bool;\r\n\t\r\n\t/**\r\n\t * défini si il faut afficher les fps ou non\r\n\t */\r\n\tpublic static var fps (get,never): Bool;\r\n\r\n\t/**\r\n\t * défini si il faut afficher le qrcode ou non\r\n\t */\r\n\tpublic static var qrcode (get, never): Bool;\t\r\n\t\r\n\t/** \r\n\t * chemin du dossier de langues\r\n\t */\r\n\tpublic static var langPath (get, never): String;\r\n\t\r\n\t/** \r\n\t * chemin du dossier des fichiers textes\r\n\t */\r\n\tpublic static var txtsPath (get, never): String;\r\n\t\r\n\t/** \r\n\t * chemin du dossier d'assets graphiques\r\n\t */\r\n\tpublic static var assetsPath (get, never): String;\r\n\t\r\n\t\r\n\t\r\n\t/** \r\n\t * chemin du dossier de sons\r\n\t */\r\n\tpublic static var soundsPath (get, never): String;\r\n\t\r\n\t\r\n\t/** \r\n\t * chemin du dossier de sons\r\n\t */\r\n\tpublic static var jsonPath (get, never): String;\r\n\r\n\t\r\n\t/** \r\n\t * chemin du dossier des polices de caractères\r\n\t */\r\n\tpublic static var fontsPath (get, never): String;\t\r\n\t\r\n\t\r\n\t/**\r\n\t * Tailles (en px) des tiles\r\n\t */\r\n\tpublic static var tileWidth:UInt = 192;\r\n\tpublic static var tileHeight:UInt = 96;\r\n\t\r\n\t/**\r\n\t * conteneur des données de configuration\r\n\t */\r\n\tpublic static var data (get, never):Dynamic;\r\n\tprivate static var _data:Dynamic={};\r\n\t\r\n\tpublic static function init(pConfig:Json): Void {\t\t\r\n\t\tfor (i in Reflect.fields(pConfig)) Reflect.setField(_data, i, Reflect.field(pConfig, i));\r\n\t\t\r\n\t\t\r\n\t\tif (_data.version == null) _data.version = \"0.0.0\";\r\n\t\tif (_data.language == null) _data.language = Browser.window.navigator.language.substr(0, 2);\r\n\t\tif (_data.languages == []) _data.languages.push(_data.language);\r\n\t\tif (_data.debug == null) _data.debug = false;\r\n\t\tif (_data.fps == null) _data.fps = false;\r\n\t\tif (_data.qrcode == null) _data.qrcode = false;\r\n\r\n\t\tif (_data.langPath == null) _data.langPath = \"\";\r\n\t\tif (_data.txtsPath == null) _data.txtsPath = \"\";\r\n\t\tif (_data.assetsPath == null) _data.assetsPath = \"\";\r\n\t\tif (_data.fontsPath == null) _data.fontsPath = \"\";\r\n\t\tif (_data.soundsPath == null) _data.soundsPath = \"\";\r\n\t\tif (_data.jsonPath == null) _data.jsonPath = \"\";\r\n\t\t\t\r\n\t}\r\n\t\r\n\tprivate static function get_data ():Dynamic {\r\n\t\treturn _data;\r\n\t}\r\n\t\r\n\tprivate static function get_version ():String {\r\n\t\treturn _data.version;\r\n\t}\r\n\t\r\n\tprivate static function get_language ():String {\r\n\t\treturn data.language;\r\n\t}\r\n\t\r\n\tprivate static function get_languages ():Array<String> {\r\n\t\treturn data.languages;\r\n\t}\r\n\t\r\n\tprivate static function get_debug ():Bool {\r\n\t\treturn data.debug;\r\n\t}\r\n\t\r\n\tprivate static function get_fps ():Bool {\r\n\t\treturn data.fps;\r\n\t}\r\n\t\r\n\tprivate static function get_qrcode ():Bool {\r\n\t\treturn data.qrcode;\r\n\t}\r\n\t\r\n\tprivate static function get_langPath ():String {\r\n\t\treturn _data.langPath;\r\n\t}\r\n\r\n\tprivate static function get_txtsPath ():String {\r\n\t\treturn _data.txtsPath;\r\n\t}\t\r\n\t\r\n\tprivate static function get_assetsPath ():String {\r\n\t\treturn _data.assetsPath;\r\n\t}\r\n\t\r\n\tprivate static function get_fontsPath ():String {\r\n\t\treturn _data.fontsPath;\r\n\t}\r\n\t\r\n\tprivate static function get_soundsPath ():String {\r\n\t\treturn _data.soundsPath;\r\n\t}\r\n\t\r\n\tprivate static function get_jsonPath ():String {\r\n\t\treturn _data.jsonPath;\r\n\t}\r\n\r\n}","package com.isartdigital.utils;\r\n\r\nimport com.isartdigital.utils.system.DeviceCapabilities;\r\nimport js.Browser;\r\nimport js.html.Image;\r\nimport pixi.core.ticker.Ticker;\r\nimport jsfps.fpsmeter.FPSMeter;\r\n\r\n\r\n/**\r\n * Classe de Debug\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass Debug\r\n{\r\n\r\n\t/**\r\n\t * instance unique de la classe Main\r\n\t */\r\n\tprivate static var instance: Debug;\t\r\n\t\r\n\tpublic var fps:FPSMeter;\r\n\tprivate static inline var QR_SIZE:Float = 0.35;\r\n\tprivate var ticker:Ticker;\r\n\r\n\t/**\r\n\t * Retourne l'instance unique de la classe, et la crée si elle n'existait pas au préalable\r\n\t * @return instance unique\r\n\t */\r\n\tpublic static function getInstance (): Debug {\r\n\t\tif (instance == null) instance = new Debug();\r\n\t\treturn instance;\r\n\t}\t\r\n\t\r\n\tprivate function new() {}\r\n\t\r\n\t/**\r\n\t * initialisation du débogueur\r\n\t * @param\tpGameDispatcher\r\n\t */\r\n\tpublic function init():Void \r\n\t{\r\n\t\tif (Config.fps) \r\n\t\t{\r\n\t\t\tfps = new FPSMeter();\r\n\t\t\tfps.show();\r\n\t\t\tfps.showFps();\r\n\t\t\t\r\n\t\t\tticker = new Ticker();\r\n\t\t\tticker.add(updateFps);\r\n\t\t\tticker.start();\r\n\t\t}\r\n\t\t\r\n\t\tif (Config.qrcode) \r\n\t\t{\r\n\t\t\tvar lQr:Image = new Image();\r\n\t\t\tlQr.style.position = 'absolute';\r\n\t\t\tlQr.style.right = '0px';\r\n\t\t\tlQr.style.bottom = '0px';\r\n\t\t\tvar lSize:Int = Std.int(QR_SIZE * DeviceCapabilities.getSizeFactor());\r\n\t\t\tlQr.src = 'https://chart.googleapis.com/chart?chs='+lSize+'x'+lSize+'&cht=qr&chl=' + Browser.location.href + '&choe=UTF-8';\r\n\t\t\tBrowser.document.body.appendChild(lQr);\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate function updateFps ():Void {\r\n\t\tfps.tick();\r\n\t\tfps.tickStart();\r\n\t}\r\n\t\r\n\tpublic static function error (pArg:Dynamic): Void {\r\n\t\tuntyped console.error (pArg);\r\n\t}\r\n\t\r\n\tpublic static function warn (pArg:Dynamic): Void {\r\n\t\tuntyped console.warn (pArg);\r\n\t}\r\n\r\n\tpublic static function table (pArg:Dynamic): Void {\r\n\t\tuntyped console.table (pArg);\r\n\t}\r\n\r\n\tpublic static function info (pArg:Dynamic): Void {\r\n\t\tuntyped console.info (pArg);\r\n\t}\r\n\t\r\n\tpublic function destroy (): Void {\r\n\t\tticker.stop();\r\n\t}\r\n\r\n}","package com.isartdigital.utils;\r\nimport com.isartdigital.builder.game.def.LocalizationDef;\r\nimport com.isartdigital.utils.loader.GameLoader;\r\nimport haxe.Json;\r\nimport haxe.macro.Expr.Var;\r\n\r\n\t\r\n/**\r\n * ...\r\n * @author Thorcal\r\n */\r\nclass Localization \r\n{\r\n\t\r\n\tprivate var myJson:Map<String,String>;\r\n\t/**\r\n\t * instance unique de la classe Localization\r\n\t */\r\n\tprivate static var instance: Localization;\r\n\t\r\n\t/**\r\n\t * Retourne l'instance unique de la classe, et la crée si elle n'existait pas au préalable\r\n\t * @return instance unique\r\n\t */\r\n\tpublic static function getInstance (): Localization {\r\n\t\tif (instance == null) instance = new Localization();\r\n\t\treturn instance;\r\n\t}\r\n\t\r\n\t/**\r\n\t * constructeur privé pour éviter qu'une instance soit créée directement\r\n\t */\r\n\tprivate function new() \r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function selectJson(pLang:String):Void {\r\n\t\tvar json:String = cast (GameLoader.getContent(\"../localization/\" + pLang +\".json\"));\r\n\t\tmyJson = Json.parse(json);\r\n\t\ttrace (myJson);\r\n\t}\r\n\t\r\n\tpublic function getText(pLabel:String):Void {\r\n\t\ttrace(myJson[pLabel]);\r\n\t}\r\n\t\r\n\t/**\r\n\t * détruit l'instance unique et met sa référence interne à null\r\n\t */\r\n\tpublic function destroy (): Void {\r\n\t\tinstance = null;\r\n\t}\r\n\r\n}","package com.isartdigital.utils.facebook;\r\n\r\nimport com.isartdigital.utils.events.FacebookEventType;\r\nimport js.Browser;\r\nimport js.html.Element;\r\nimport js.html.HTMLDocument;\r\nimport js.html.ScriptElement;\r\nimport js.html.SourceElement;\r\n\r\n/**\r\n * Classe haxe permettant l'accès à l'api Facebook \r\n * @author Mathieu Anthoine\r\n */\r\nclass Facebook\r\n{\r\n\r\n\t/**\r\n\t * id de l'app\r\n\t */\r\n\tprivate static var appId:String;\r\n\t\r\n\t/**\r\n\t * informations de l'application une fois connectée\r\n\t */\r\n\tprivate static var authResponse:AuthResponse;\r\n\t\r\n\t/**\r\n\t * access token\r\n\t */\r\n\tpublic static var token (default, null):String;\r\n\r\n\t/**\r\n\t * user id\r\n\t */\r\n\tpublic static var uid (default, null):String;\t\r\n\t\r\n\t/**\r\n\t * permissions de l'application\r\n\t */\r\n\tprivate static var permissions:Permissions = { scope:\"user_friends,email\" };\r\n\t \r\n\t/**\r\n\t * callback de connexion\r\n\t */\r\n\tpublic static var onLogin:Void->Void;\r\n\t\r\n\t/**\r\n\t * Initialisation asynchrone de la lib Facebook\r\n\t */\r\n\tprivate static function init ():Void {\t\r\n\t\tuntyped FB.init({\r\n\t\t\tappId\t\t: appId,\r\n\t\t\txfbml\t\t: true,\r\n\t\t\tversion\t: \"v2.5\",\r\n\t\t\tcookie\t: true\r\n\t\t});\r\n\t\t\r\n\t\tuntyped FB.getLoginStatus(getLoginStatus);\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * Chargement et connexion à l'app Facebook\r\n\t * @param\tpAppId\r\n\t */\r\n\tpublic static function load (pAppId:String,?pPermissions:Permissions=null):Void {\r\n\t\tappId = pAppId;\r\n\t\tuntyped Browser.window.fbAsyncInit = init;\r\n\t\t\r\n\t\tvar lDoc:HTMLDocument = Browser.window.document;\r\n\t\tvar lScript:String = \"script\";\r\n\t\tvar lID:String = \"facebook-jssdk\";\r\n\t\tvar lJs:ScriptElement;\r\n\t\tvar lFjs:Element = lDoc.getElementsByTagName(lScript)[0];\r\n\t\t\t\t\r\n\t\tif (lDoc.getElementById(appId)!=null) return;\r\n\t\t\r\n\t\tif (pPermissions!=null) permissions = pPermissions;\t\t\r\n\t\t\r\n\t\tlJs = cast (lDoc.createElement(lScript),ScriptElement);\r\n\t\tlJs.id = lID;\r\n\t\tlJs.src = \"//connect.facebook.net/en_US/sdk.js\";\r\n\t\tlFjs.parentNode.insertBefore(lJs, lFjs);\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * Permet de déterminer su un utilisateur est loggé dans Facebook\r\n\t * @param\tpResponse\r\n\t */\r\n\tprivate static function getLoginStatus (pResponse:Response):Void {\r\n\t\tif (pResponse.status == FacebookEventType.CONNECTED) {\r\n\t\t\tauthResponse = pResponse.authResponse;\r\n\t\t\ttoken = authResponse.accessToken;\r\n\t\t\tuid = authResponse.userID;\r\n\t\t\tonLogin();\r\n\t\t} else {\r\n\t\t\tuntyped FB.login(getLoginStatus, permissions);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * permet un appel à Graph API\r\n\t * La méthode peut être appelée de différentes facons:\r\n\t * \r\n\t * Facebook.api (pPath,pCallBack);\r\n\t * Facebook.api (pPath,pParams,pCallBack);\r\n\t * Facebook.api (pPath,pMethod,pParams,pCallBack);\r\n\t * \r\n\t * @param\tpPath path de la graph API\r\n\t * @param\tpMethod méthode HTTP (\"get\",\"post\", \"delete\")\r\n\t * @param\tpParams paramètres à passer à l'appel\r\n\t * @param\tpCallBack fonction de retour\r\n\t */\r\n\tpublic static function api (pPath:String,pMethod:Dynamic,?pParams:Dynamic,?pCallBack:Dynamic): Void {\r\n\t\tuntyped FB.api(pPath, pMethod, pParams, pCallBack);\r\n\t}\r\n\t\r\n\t/**\r\n\t * permet de déclencher l'apparition de différentes fenêtres de dialogue UI\r\n\t * @param\tpParams paramètres de la fenêtre appelée\r\n\t * @param\tpCallBack function appelée à la fermeture de la fenêtre de dialogue\r\n\t */\r\n\tpublic static function ui (pParams:Dynamic,?pCallBack:Dynamic->Void): Void {\r\n\t\tuntyped FB.ui (pParams, pCallBack);\r\n\t}\r\n\r\n\t\r\n}\r\n\r\n\r\n","package com.isartdigital.utils.game;\r\n\r\nimport com.isartdigital.builder.game.GameManager;\r\nimport com.isartdigital.builder.game.manager.MapManager;\r\nimport com.isartdigital.builder.game.sprites.Tile;\r\nimport com.isartdigital.utils.events.MouseEventType;\r\nimport com.isartdigital.utils.game.iso.IsoManager;\r\nimport com.isartdigital.utils.system.DeviceCapabilities;\r\nimport js.Browser;\r\nimport js.html.MouseEvent;\r\nimport pixi.core.display.DisplayObject;\r\nimport pixi.core.math.Point;\r\nimport pixi.core.math.shapes.Rectangle;\r\n\r\n/**\r\n * Classe Camera\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass Camera\r\n{\r\n\r\n\tprivate var render:Dynamic;\r\n\t\r\n\tpublic var target (default,null):DisplayObject;\r\n\tpublic var focus (default, null):DisplayObject;\r\n\t\r\n\tpublic var cameraFocus:GameObject = new GameObject();\r\n\t\r\n\t//même valeur pour x/y pour simplifier les réglages\r\n\t//private var inertiaMax:Point = new Point(80, 80);\r\n\t//private var inertiaMin:Point = new Point(10, 10);\r\n\tprivate var inertiaMax:Float = 80;\r\n\tprivate var inertiaMin:Float = 10;\r\n\tprivate var countH:UInt = 10;\r\n\tprivate var delayH:UInt = 120;\r\n\tprivate var countV:UInt = 10;\r\n\tprivate var delayV:UInt = 120;\r\n\t\r\n\tprivate var startPosition:Point;\r\n\tprivate var positionLayer:Point = new Point();\r\n\t\r\n\tprivate var speedLimite:Float = 100;\r\n\t\r\n\t/**\r\n\t * instance unique de la classe GamePlane\r\n\t */\r\n\tprivate static var instance: Camera;\r\n\r\n\t/**\r\n\t * Retourne l'instance unique de la classe, et la crée si elle n'existait pas au préalable\r\n\t * @return instance unique\r\n\t */\r\n\tpublic static function getInstance (): Camera {\r\n\t\tif (instance == null) instance = new Camera();\r\n\t\treturn instance;\r\n\t}\t\r\n\t\r\n\tprivate function new() \r\n\t{\r\n\t\tBrowser.window.addEventListener(MouseEventType.MOUSE_DOWN, onDrag);\r\n\t\tBrowser.window.addEventListener(MouseEventType.MOUSE_UP, onUp);\r\n\t\tBrowser.window.addEventListener(MouseEventType.MOUSE_MOVE, refreshMouseCoordinates);\r\n\t}\r\n\t\r\n\tprivate function refreshMouseCoordinates(pEvent:MouseEvent) : Void \r\n\t{\r\n\t\tpositionLayer.set(GameManager.getInstance().mousePosition.x, GameManager.getInstance().mousePosition.y);\r\n\t}\r\n\t\r\n\tprivate function onDrag(?pEvent:MouseEvent): Void {\r\n\t\t//offSet = new Point(GameManager.getInstance().mousePosition.x, GameManager.getInstance().mousePosition.y);\r\n\t\tstartPosition = new Point(positionLayer.x + cameraFocus.x, positionLayer.y + cameraFocus.y);\r\n\t\t\r\n\t}\r\n\t\r\n\tprivate function onUp(pEvent:MouseEvent) : Void {\r\n\t\tstartPosition = null;\r\n\t}\r\n\t\r\n\tpublic function centerView() : Void { \r\n\t\tvar lMiddle:Int = Math.round(MapManager.getInstance().mapSize / 2);\r\n\t\tvar lIndex:String = lMiddle + \",\" + lMiddle;\r\n\t\tvar lPoint:Point = new Point(MapManager.getInstance().globalMap[lIndex][0].x, MapManager.getInstance().globalMap[lIndex][0].y);\r\n\t\tvar lPosition:Point = IsoManager.modelToIsoView(lPoint);\r\n\t\tcameraFocus.position.set(lPosition.x, lPosition.y);\r\n\t\tsetPosition();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Défini la cible de la caméra\r\n\t * @param\tpTarget cible\r\n\t */\r\n\tpublic function setTarget (pTarget:DisplayObject):Void {\r\n\t\ttarget = pTarget;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Défini l'élement à repositionner au centre de l'écran\r\n\t * @param\tpFocus focus\r\n\t */\r\n\tpublic function setFocus(pFocus:DisplayObject):Void {\r\n\t\tfocus = pFocus;\r\n\t}\r\n\t\r\n\t/**\r\n\t * recadre la caméra\r\n\t * @param\tpDelay si false, la caméra est recadrée instantannément\r\n\t */\r\n\tprivate function changePosition (?pDelay:Bool=true) :Void {\r\n\t\t\r\n\t\tcountH++;\r\n\t\tcountV++;\r\n\t\t\r\n\t\tvar lCenter:Rectangle = DeviceCapabilities.getScreenRect(target.parent);\t\t\t\t\r\n\t\tvar lFocus:Point = getFocusCoord();\r\n\t\tvar lInertiaX:Float = pDelay ? getInertiaX() : 1;\r\n\t\tvar lInertiaY:Float = pDelay ? getInertiaY() : 1;\r\n\t\t\r\n\t\tvar lDeltaX:Float = (lCenter.x + lCenter.width / 2 - lFocus.x - target.x) / lInertiaX;\r\n\t\tvar lDeltaY:Float = (lCenter.y + lCenter.height / 2 - lFocus.y - target.y) / lInertiaY;\r\n\t\t\r\n\t\t\r\n\t\tif (pDelay) lDeltaX = checkSpeedLimit(lDeltaX);\r\n\t\tif (pDelay) lDeltaY = checkSpeedLimit(lDeltaY);\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\ttarget.x+= lDeltaX;\r\n\t\ttarget.y+= lDeltaY;\r\n\t}\r\n\t\r\n\tprivate function checkSpeedLimit(pSpeed:Float) : Float\r\n\t{ \r\n\t\tif (Math.abs(pSpeed) < 0.01) return 0;\r\n\t\telse if (Math.abs(pSpeed) > speedLimite) return (pSpeed / Math.abs(pSpeed)) * speedLimite;\r\n\t\treturn pSpeed;\r\n\t}\r\n\t\r\n\t/**\r\n\t * retourne une inertie en X variable suivant le temps\r\n\t * @return inertie en X\r\n\t */\r\n\tprivate function getInertiaX() : Float {\r\n\t\tif (countH > delayH) return inertiaMin;\r\n\t\treturn inertiaMax + (inertiaMin-inertiaMax)*countH/delayH;\r\n\t}\r\n\r\n\t/**\r\n\t * retourne une inertie en Y variable suivant le temps\r\n\t * @return inertie en Y\r\n\t */\t\r\n\tprivate function getInertiaY() : Float {\r\n\t\tif (countV > delayV) return inertiaMin;\r\n\t\treturn inertiaMax + (inertiaMin-inertiaMax)*countV/delayV;\r\n\t}\r\n\t\r\n\t/**\r\n\t * cadre instantannément la caméra sur le focus\r\n\t */\r\n\tpublic function setPosition():Void {\r\n\t\tGameStage.getInstance().render();\r\n\t\tchangePosition(false);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Vérifie que la position donné est dans les limites du jeu\r\n\t * @param\tpPosition\r\n\t * @return\r\n\t */\r\n\tprivate function isInLimit(pPosition:Point) : Bool\r\n\t{\r\n\t\tvar lPoint:Point = IsoManager.isoViewToModel(pPosition);\r\n\t\t//return (MapManager.getInstance().getTileInMap(lPoint) != null);\r\n\t\treturn true;\r\n\t\t//TO DO : refaire les limites de la map en fonciton de la globalmap\r\n\t}\r\n\t\r\n\t/**\r\n\t * cadre la caméra sur le focus avec de l'inertie\r\n\t */\r\n\tpublic function move():Void {\r\n\t\t\r\n\t\tif (startPosition != null) {\r\n\t\t\t//if (isInLimit(new Point(Math.round(startPosition.x - positionLayer.x), Math.round(startPosition.y - positionLayer.y))))\r\n\t\t\t{\r\n\t\t\t\tcameraFocus.x = startPosition.x - positionLayer.x;\r\n\t\t\t\tcameraFocus.y = startPosition.y - positionLayer.y;\r\n\t\t\t}\r\n\t\t}\r\n\t\tchangePosition(true);\r\n\t}\r\n\t\r\n\t/**\r\n\t * remet à zéro le compteur qui fait passer la caméra de l'inertie en X maximum à minimum\r\n\t */\r\n\tpublic function resetX():Void {\r\n\t\tcountH = 0;\r\n\t}\r\n\r\n\t/**\r\n\t * remet à zéro le compteur qui fait passer la caméra de l'inertie en Y maximum à minimum\r\n\t */\r\n\tpublic function resetY():Void {\r\n\t\tcountV = 0;\r\n\t}\r\n\t\r\n\t/**\r\n\t * retourne les coordonnées du focus dans le repère de la target\r\n\t */\r\n\tpublic function getFocusCoord ():Point {\r\n\t\treturn target.toLocal(focus.position, focus.parent);\r\n\t}\r\n\t\r\n\t/**\r\n\t * détruit l'instance unique et met sa référence interne à null\r\n\t */\r\n\tpublic function destroy (): Void {\r\n\t\tinstance = null;\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils.game;\r\n\r\nimport pixi.core.display.Container;\r\nimport pixi.core.display.DisplayObject;\r\nimport pixi.core.graphics.Graphics;\r\nimport pixi.core.graphics.GraphicsData;\r\nimport pixi.core.math.Point;\r\nimport pixi.core.math.shapes.Rectangle;\r\nimport pixi.core.sprites.Sprite;\r\n\r\n/**\r\n * Classe utilitaire permettant de tester diverses collisions entre boites, formes et points\r\n * @author Mathieu ANTHOINE\r\n * @version 0.9.0\r\n */\r\nclass CollisionManager \r\n{\r\n\r\n\tprivate function new() {}\r\n\t\t\r\n\t/**\r\n\t * test la collision entre les boites englobantes de deux DisplayObject\r\n\t * @param\tpObjectA objet à tester\r\n\t * @param\tpObjectB objet à tester\r\n\t * @return résultat du test de collision\r\n\t */\r\n\tpublic static function hitTestObject(pObjectA:DisplayObject, pObjectB:DisplayObject):Bool {\r\n\t\t\r\n\t\treturn getIntersection(pObjectA.getBounds(), pObjectB.getBounds());\r\n\r\n\t}\r\n\t\r\n\t/**\r\n\t * test la collision entre l'objet et un point (prend en compte la hitArea si elle est définie). Légère adaptation de la méthode hitTest de la classe InteractionManager\r\n\t * @param\tpObject objet à tester\r\n\t * @param\tpPoint point exprimé en coordonnées globales\r\n\t * @return\trésultat du test de collision\r\n\t */\r\n\tpublic static function hitTestPoint (pItem:DisplayObject, pGlobalPoint:Point):Bool {\r\n\r\n\t\tvar lPoint:Point=pItem.toLocal(pGlobalPoint);\r\n\t\tvar x:Float = lPoint.x;\r\n\t\tvar y:Float = lPoint.y;\r\n\t\t\r\n\t\tif (pItem.hitArea != null && pItem.hitArea.contains != null) {\r\n\t\t\treturn pItem.hitArea.contains(x, y);\t\t\r\n\t\t}\r\n\t\telse if (Std.is(pItem, Sprite)) {\t\r\n\t\t\t\r\n\t\t\tvar lSprite:Sprite = cast(pItem, Sprite);\r\n\t\t\t\r\n\t\t\tvar lWidth:Float = lSprite.texture.frame.width;\r\n\t\t\tvar lHeight:Float = lSprite.texture.frame.height;\r\n\t\t\tvar lX1:Float = -lWidth * lSprite.anchor.x;\r\n\t\t\tvar lY1:Float;\r\n\t \r\n\t\t\tif (x > lX1 && x < lX1 + lWidth)\r\n\t\t\t{\r\n\t\t\t\tlY1 = -lHeight * lSprite.anchor.y;\r\n\t\t\t\tif (y > lY1 && y < lY1 + lHeight) return true;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (Std.is(pItem, Graphics)) {\r\n\t\t\tvar lGraphicsData:Array<GraphicsData> = untyped pItem.graphicsData;\t\t\r\n\t\t\tfor (i in 0...lGraphicsData.length) {\r\n\t\t\t\tvar lData = lGraphicsData[i];\r\n\t\t\t\t // only deal with fills..\r\n\t\t\t\tif (! untyped lData.fill) continue;\t\t\t\r\n\t\t\t\tif(lData.shape!=null && lData.shape.contains(x, y)) return true;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (Std.is (pItem, Container)) {\r\n\t\t\tvar lContainer:Container = cast(pItem, Container);\r\n\t\t\tvar lLength:Int = lContainer.children.length;\r\n\t\t\tfor (i in 0...lLength) {\r\n\t\t\t\tif (hitTestPoint(lContainer.children[i], pGlobalPoint)) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tpHitBoxA boite englobante principale\r\n\t * @param\tpHitBoxB boite englobante principale\r\n\t * @param\tpPointsA liste de points de collision\r\n\t * @param\tpPointsB liste de points de collision\r\n\t * @return  résultat de la collision\r\n\t */\r\n\tpublic static function hasCollision (pHitBoxA:DisplayObject, pHitBoxB:DisplayObject, pPointsA:Array<Point> = null, pPointsB:Array<Point> = null): Bool {\r\n\t\tif (pHitBoxA == null || pHitBoxB == null) return false;\r\n\t\t\r\n\t\t// test des boites de collision principale\r\n\t\tif (!hitTestObject(pHitBoxA,pHitBoxB)) return false;\r\n\t\t\r\n\t\t// si il n'y a pas de boites de collision plus précises on valide\r\n\t\tif (pPointsA == null && pPointsB == null) return true;\t\t\t\r\n\t\t\r\n\t\t// test points vers la forme de la boite principale \r\n\t\tif (pPointsA!=null) return testPoints(pPointsA, pHitBoxB);\r\n\t\tif (pPointsB!=null) return testPoints(pPointsB, pHitBoxA);\r\n\t\t\r\n\t\treturn false;\r\n\r\n\t}\r\n\t\r\n\t/**\r\n\t * teste l'intersection des boites englobantes\r\n\t * @param\tpRectA rectangle à tester\r\n\t * @param\tpRectB rectangle à tester\r\n\t * @return résultat de l'intersection\r\n\t */\r\n\tprivate static function getIntersection (pRectA:Rectangle, pRectB:Rectangle): Bool {\r\n\t\treturn !(pRectB.x > (pRectA.x + pRectA.width) || (pRectB.x + pRectB.width) < pRectA.x || pRectB.y > (pRectA.y + pRectA.height) || (pRectB.y + pRectB.height) < pRectA.y);\r\n\t}\r\n\t\r\n\t/**\r\n\t * \r\n\t * @param\tpHitPoints liste de points de collision (dont le repère est déjà converti en global)\r\n\t * @param\tpHitBox boite englobante\r\n\t * @return  résultat de la collision\r\n\t */\r\n\tprivate static function testPoints (pHitPoints:Array<Point>, pHitBox:DisplayObject): Bool {\r\n\t\tvar lLength:Int = pHitPoints.length;\r\n\t\tfor (i in 0...lLength) {\r\n\t\t\tif (hitTestPoint(pHitBox,pHitPoints[i])) return true;\r\n\t\t}\r\n\t\t\t\r\n\t\treturn false;\r\n\t\t\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils.game;\r\n\r\nimport com.isartdigital.utils.events.EventType;\r\nimport com.isartdigital.utils.system.DeviceCapabilities;\r\nimport pixi.core.display.Container;\r\nimport pixi.core.math.shapes.Rectangle;\r\n\r\n/**\r\n * Classe en charge de mettre en place la structure graphique du jeu (conteneurs divers)\r\n * et la gestion du redimensionnement de la zone de jeu en fonction du contexte\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass GameStage extends Container\r\n{\r\n\t\r\n\t/**\r\n\t * instance unique de la classe GameStage\r\n\t */\r\n\tprivate static var instance: GameStage;\r\n\r\n\tprivate var _alignMode: GameStageAlign = GameStageAlign.CENTER;\t\r\n\r\n\tprivate var _scaleMode: GameStageScale = GameStageScale.SHOW_ALL;\r\n\t\r\n\tprivate var _safeZone:Rectangle= new Rectangle(0,0,SAFE_ZONE_WIDTH,SAFE_ZONE_HEIGHT);\r\n\r\n\t/**\r\n\t * callback de render\r\n\t */\r\n\tprivate var _render:Void->Void;\t\r\n\t\r\n\t/**\r\n\t * largeur minimum pour le contenu visible par défaut\r\n\t */\r\n\tprivate static inline var SAFE_ZONE_WIDTH: Int = 2048;\r\n\r\n\t/**\r\n\t * hauteur minimum pour le contenu visible par défaut\r\n\t */\r\n\tprivate static inline var SAFE_ZONE_HEIGHT: Int = 1366;\r\n\t\t\r\n\t/**\r\n\t * conteneur des pop-in\r\n\t */\r\n\tprivate var popinsContainer:Container;\r\n\t\r\n\t/**\r\n\t * conteneur du Hud\r\n\t */\r\n\tprivate var hudContainer:Container;\r\n\t\r\n\t/**\r\n\t * conteneur des écrans d'interface\r\n\t */\r\n\tprivate var screensContainer:Container;\r\n\t\r\n\t/**\r\n\t * conteneur du jeu\r\n\t */\r\n\tprivate var gameContainer:Container;\r\n\t\r\n\t/**\r\n\t * conteneur des tiles\r\n\t */\r\n\tprivate var tilesContainer:Container;\r\n\t\r\n\t/**\r\n\t * conteneur des buildings\r\n\t */\r\n\tprivate var buildingsContainer:Container;\r\n\t\r\n\t/**\r\n\t * conteneur du background\r\n\t */\r\n\tprivate var backgroundContainer:Container;\r\n\t\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t\t\t\r\n\t\tgameContainer = new Container();\t\t\r\n\t\taddChild(gameContainer);\r\n\t\t\r\n\t\tscreensContainer = new Container();\r\n\t\taddChild(screensContainer);\r\n\t\t\r\n\t\thudContainer = new Container();\r\n\t\taddChild(hudContainer);\r\n\t\t\r\n\t\tpopinsContainer = new Container();\r\n\t\taddChild(popinsContainer);\r\n\t\t\r\n\t\ttilesContainer = new Container();\t\t\r\n\t\tgameContainer.addChild(tilesContainer);\t\t\r\n\t\t\t\t\r\n\t\tbuildingsContainer = new Container();\t\t\r\n\t\tgameContainer.addChild(buildingsContainer);\r\n\t\t\r\n\t\tbackgroundContainer = new Container();\r\n\t\tgameContainer.addChild(backgroundContainer);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Initialisation de la zone de jeu\r\n\t * @param   pRender Callback qui fait le rendu pour mettre à jour le système de coordonnées avant de reconstruire d'éventuels éléments\r\n\t * @param\tpSafeZoneWidth largeur de la safeZone\r\n\t * @param\tpSafeZoneHeight hauteur de la safeZone\r\n\t * @param\tcenterGameContainer centrer ou pas le conteneur des élements InGame\r\n\t * @param\tcenterScreensContainer centrer ou pas le conteneur des Ecrans\r\n\t * @param\tcenterPopinContainer centrer ou pas le conteneur des Popins\r\n\t */\r\n\tpublic function init (pRender:Void->Void, ?pSafeZoneWidth:UInt = SAFE_ZONE_WIDTH, ?pSafeZoneHeight:UInt = SAFE_ZONE_WIDTH, ?pCenterGameContainer:Bool = false, ?pCenterScreensContainer:Bool = true, ?pCenterPopinContainer:Bool = true):Void {\r\n\t\t\r\n\t\t_safeZone = new Rectangle (0, 0, pSafeZoneWidth, pSafeZoneHeight);\r\n\t\t\r\n\t\tif (pCenterGameContainer) {\r\n\t\t\tgameContainer.x = safeZone.width / 2;\r\n\t\t\tgameContainer.y = safeZone.height / 2;\r\n\t\t}\r\n\t\t\r\n\t\tif (pCenterScreensContainer) {\r\n\t\t\tscreensContainer.x = safeZone.width / 2;\r\n\t\t\tscreensContainer.y = safeZone.height / 2;\r\n\t\t}\r\n\t\t\r\n\t\tif (pCenterPopinContainer) {\r\n\t\t\tpopinsContainer.x = safeZone.width / 2;\r\n\t\t\tpopinsContainer.y = safeZone.height / 2;\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * Retourne l'instance unique de la classe, et la crée si elle n'existait pas au préalable\r\n\t * @return instance unique\r\n\t */\r\n\tpublic static function getInstance (): GameStage {\r\n\t\tif (instance == null) instance = new GameStage();\r\n\t\treturn instance;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Redimensionne la scène du jeu en fonction de la taille disponible pour l'affichage\r\n\t */\r\n\tpublic function resize (): Void {\r\n\t\t\r\n\t\tvar lWidth:UInt = DeviceCapabilities.width;\r\n\t\tvar lHeight:UInt = DeviceCapabilities.height;\r\n\t\t\t\t\r\n\t\tvar lRatio:Float = Math.round(10000 * Math.min( lWidth / safeZone.width, lHeight / safeZone.height)) / 10000;\r\n\t\t\r\n\t\tif (scaleMode == GameStageScale.SHOW_ALL) scale.set(lRatio, lRatio);\r\n\t\telse scale.set (DeviceCapabilities.textureRatio, DeviceCapabilities.textureRatio);\r\n\t\t\r\n\t\tif (alignMode == GameStageAlign.LEFT || alignMode == GameStageAlign.TOP_LEFT || alignMode == GameStageAlign.BOTTOM_LEFT) x = 0;\r\n\t\telse if (alignMode == GameStageAlign.RIGHT || alignMode == GameStageAlign.TOP_RIGHT || alignMode == GameStageAlign.BOTTOM_RIGHT) x = lWidth - safeZone.width * scale.x;\r\n\t\telse x = (lWidth - safeZone.width * scale.x) / 2;\r\n\t\t\r\n\t\tif (alignMode == GameStageAlign.TOP || alignMode == GameStageAlign.TOP_LEFT || alignMode == GameStageAlign.TOP_RIGHT) y = 0;\r\n\t\telse if (alignMode == GameStageAlign.BOTTOM || alignMode == GameStageAlign.BOTTOM_LEFT || alignMode == GameStageAlign.BOTTOM_RIGHT) y = lHeight - safeZone.height * scale.y;\r\n\t\telse y = (lHeight - safeZone.height * scale.y) / 2;\r\n\t\t\r\n\t\t\r\n\t\trender();\r\n\t\t\r\n\t\temit (EventType.RESIZE, { width:lWidth, height:lHeight } );\r\n\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * fait le rendu de l'écran\r\n\t */\r\n\tpublic function render (): Void {\r\n\t\tif (_render!=null) _render();\r\n\t}\t\r\n\t\r\n\t/*\r\n\t * style d'alignement au sein de l'écran\r\n\t */\r\n\tpublic var alignMode (get, set) : GameStageAlign;\r\n\t\r\n\tprivate function get_alignMode( ) { \r\n\t\treturn _alignMode;\r\n\t}\r\n\t\r\n\tprivate function set_alignMode(pAlign:GameStageAlign) {\r\n\t\t_alignMode = pAlign;\r\n\t\tresize();\r\n\t\treturn _alignMode;\r\n\t}\r\n\r\n\t/*\r\n\t * style de redimensionnement au sein de l'écran\r\n\t */\r\n\tpublic var scaleMode (get, set) : GameStageScale;\r\n\t\r\n\tprivate function get_scaleMode( ) { \r\n\t\treturn _scaleMode;\r\n\t}\r\n\t\r\n\tprivate function set_scaleMode(pScale:GameStageScale) {\r\n\t\t_scaleMode = pScale;\r\n\t\tresize();\r\n\t\treturn _scaleMode;\r\n\t}\t\r\n\t\r\n\t/**\r\n\t * Rectangle délimitant le contenu minimum visible\r\n\t */\r\n\tpublic var safeZone (get, never):Rectangle;\r\n\t\r\n\tprivate function get_safeZone () {\r\n\t\treturn _safeZone;\r\n\t}\r\n\r\n\t/**\r\n\t * accès en lecture au conteneur de jeu\r\n\t * @return gameContainer\r\n\t */\r\n\tpublic function getGameContainer (): Container {\r\n\t\treturn gameContainer;\r\n\t}\r\n\t\r\n\t/**\r\n\t * accès en lecture au conteneur d'écrans\r\n\t * @return screensContainer\r\n\t */\r\n\tpublic function getScreensContainer (): Container {\r\n\t\treturn screensContainer;\r\n\t}\r\n\t\r\n\t/**\r\n\t * accès en lecture au conteneur de hud\r\n\t * @return hudContainer\r\n\t */\r\n\tpublic function getHudContainer (): Container {\r\n\t\treturn hudContainer;\r\n\t}\r\n\t\r\n\t/**\r\n\t * accès en lecture au conteneur de PopIn\r\n\t * @return popinContainer\r\n\t */\r\n\tpublic function getPopinsContainer (): Container {\r\n\t\treturn popinsContainer;\r\n\t}\r\n\t\r\n\t\t\t\r\n\t/**\t\t\r\n\t * Accès en lecture au contenaure de tiles\t\t\r\n\t * @return conteneur de tiles\t\t\r\n\t */\t\t\r\n\tpublic function getTilesContainer ():Container {\t\t\r\n\t\treturn tilesContainer;\t\t\r\n\t}\t\t\r\n\t\t\t\r\n\t/**\t\t\r\n\t * Accès en lecture au contenaure de buildings\t\t\r\n\t * @return conteneur de buildings\t\t\r\n\t */\t\t\r\n\tpublic function getBuildingsContainer ():Container {\t\t\r\n\t\treturn buildingsContainer;\t\t\r\n\t}\t\r\n\t\r\n\t/**\t\t\r\n\t * Accès en lecture au contenaure de buildings\t\t\r\n\t * @return conteneur de background\t\t\r\n\t */\t\t\r\n\tpublic function getBackgroundContainer ():Container {\t\t\r\n\t\treturn backgroundContainer;\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * détruit l'instance unique et met sa référence interne à null\r\n\t */\r\n\toverride public function destroy (): Void {\r\n\t\tinstance = null;\r\n\t\tsuper.destroy(true);\r\n\t}\r\n\r\n}","package com.isartdigital.utils.game.factory;\r\n\r\nimport pixi.core.display.Container;\r\n\r\n/**\r\n * ...\r\n * @author Mathieu Anthoine\r\n */\r\nclass AnimFactory\r\n{\r\n\r\n\tprivate var anim:Container;\r\n\t\r\n\tprivate function new() \r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function getAnim ():Container {\r\n\t\treturn anim;\r\n\t}\r\n\t\r\n\tpublic function create (pID:String):Container {\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\tpublic function update (pId:String):Void {\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function setFrame (?pAutoPlay:Bool=true, ?pStart:UInt = 0): Void {\r\n\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils.game.factory;\r\n\r\nimport pixi.core.display.Container;\r\nimport pixi.display.FlumpMovie;\r\n\r\n\t\r\n/**\r\n * ...\r\n * @author Mathieu Anthoine\r\n */\r\nclass FlumpMovieAnimFactory extends AnimFactory \r\n{\r\n\t\r\n\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\t\r\n\toverride public function getAnim ():Container {\r\n\t\tif (anim !=null) {\r\n\t\t\tanim.parent.removeChild(anim);\r\n\t\t\tanim.destroy();\r\n\t\t\tanim = null;\r\n\t\t}\r\n\t\treturn super.getAnim();\r\n\t}\r\n\t\r\n\toverride public function create (pID:String):Container {\r\n\t\tanim = new FlumpMovie(pID);\r\n\t\treturn anim;\r\n\t}\r\n\t\r\n\toverride public function setFrame (?pAutoPlay:Bool=true, ?pStart:UInt = 0): Void {\r\n\t\tvar lAnim:FlumpMovie = cast(anim, FlumpMovie);\r\n\t\t\r\n\t\tif (lAnim.totalFrames > 1) {\r\n\t\t\tif (pAutoPlay) lAnim.gotoAndPlay(pStart);\r\n\t\t\telse lAnim.gotoAndStop(pStart);\r\n\t\t}\r\n\t\telse if (!pAutoPlay) lAnim.stop();\r\n\t}\r\n\r\n}","package com.isartdigital.utils.game.factory;\r\nimport haxe.Json;\r\nimport pixi.core.display.Container;\r\nimport pixi.core.textures.Texture;\r\nimport pixi.extras.MovieClip;\r\n\r\n/**\r\n * ...\r\n * @author Mathieu Anthoine\r\n */\r\nclass MovieClipAnimFactory extends AnimFactory\r\n{\r\n\r\n\t/**\r\n\t * longueur de la numérotation des textures\r\n\t */\r\n\tpublic static var textureDigits (default, set) :UInt = 4;\r\n\t\r\n\tprivate static function set_textureDigits (pDigits:UInt) : UInt {\r\n\t\tdigits = \"\";\r\n\t\tfor (i in 0...pDigits) digits += \"0\";\r\n\t\treturn textureDigits = pDigits;\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * définition des textures (nombre d'images)\r\n\t */\r\n\tprivate static var texturesDefinition:Map<String,Int>;\r\n\t\r\n\t/**\r\n\t * cache des textures de tous les StateGraphic\r\n\t */\r\n\tprivate static var texturesCache:Map<String,Array<Texture>>;\r\n\t\r\n\t/**\r\n\t * nombre de zéro a ajouter pour construire un nom de frame\r\n\t */\r\n\tprivate static var digits:String;\t\r\n\t\r\n\t/**\r\n\t * Analyse et crée les définitions de textures\r\n\t * @param\tpJson objet contenant la description des assets\r\n\t */\r\n\tstatic public function addTextures (pJson:Json): Void {\r\n\t\t\r\n\t\tvar lFrames:Dynamic = Reflect.field(pJson, \"frames\");\r\n\t\t\r\n\t\tif (texturesDefinition == null) texturesDefinition = new Map<String,Int>();\r\n\t\tif (digits == null) textureDigits = textureDigits;\r\n\t\t\r\n\t\tvar lID:String;\r\n\t\tvar lNum:Int;\r\n\t\t\r\n\t\tfor (lID in Reflect.fields(lFrames)) {\r\n\t\t\t\r\n\t\t\tlID = lID.split(\".\")[0];\r\n\t\t\tlNum = Std.parseInt(lID.substr(-1*textureDigits));\r\n\t\t\tif (lNum != null) lID = lID.substr(0, lID.length - textureDigits);\r\n\t\t\t\r\n\t\t\tif (texturesDefinition[lID] == null) texturesDefinition[lID] = lNum == null ? 1 : lNum;\r\n\t\t\telse if (lNum > texturesDefinition[lID]) texturesDefinition[lID] = lNum;\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\tif (texturesCache == null) texturesCache = new Map<String,Array<Texture>>();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Vide le cache de textures correspondant à la description passée en paramètres\r\n\t * @param\tpJson objet contenant la description des assets\r\n\t */\r\n\tstatic public function clearTextures (pJson:Json): Void {\r\n\t\t\r\n\t\tvar lFrames:Dynamic = Reflect.field(pJson, \"frames\");\r\n\t\t\r\n\t\tif (texturesDefinition == null) return;\r\n\t\t\r\n\t\tvar lID:String;\r\n\t\tvar lNum:Int;\r\n\t\t\r\n\t\tfor (lID in Reflect.fields(lFrames)) {\r\n\t\t\t\r\n\t\t\tlID = lID.split(\".\")[0];\r\n\t\t\tlNum = Std.parseInt(lID.substr(-1*textureDigits));\r\n\t\t\tif (lNum != null) lID = lID.substr(0, lID.length - textureDigits);\r\n\t\t\t\r\n\t\t\ttexturesDefinition[lID] = null;\r\n\t\t\ttexturesCache[lID] = null;\r\n\t\t}\r\n\t}\t\r\n\t\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t\r\n\t}\r\n\t\r\n\toverride public function create (pID:String):Container {\r\n\t\tanim = new MovieClip(getTextures(pID));\r\n\t\treturn anim;\r\n\t}\r\n\t\r\n\toverride public function update (pID:String):Void {\r\n\t\tcast(anim,MovieClip).textures = getTextures(pID);\r\n\t}\r\n\t\r\n\toverride public function setFrame (?pAutoPlay:Bool=true, ?pStart:UInt = 0): Void {\r\n\t\tvar lAnim:MovieClip = cast(anim, MovieClip);\r\n\t\t\r\n\t\tlAnim.gotoAndStop(pStart);\r\n\t\tif (pAutoPlay) lAnim.play();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Cherche dans le cache général de textures le tableau de textures correspondant au state et le retourne.\r\n\t * Si le tableau de texture n'éxiste pas, il le crée et le stocke dans le cache\r\n\t * @param\tpID ID complet de l'anim\r\n\t * @return\tle tableau de texture correspondant au state de l'instance\r\n\t */\r\n\tprivate function getTextures(pID:String):Array<Texture> {\r\n\t\t\r\n\t\tif (texturesCache[pID] == null) {\r\n\t\t\tvar lFrames:UInt = texturesDefinition[pID];\r\n\t\t\tif (lFrames == 1) texturesCache[pID] =[Texture.fromFrame(pID+\".png\")];\r\n\t\t\telse {\r\n\t\t\t\ttexturesCache[pID] = new Array<Texture>();\r\n\t\t\t\tfor (i in 1...lFrames+1) texturesCache[pID].push(Texture.fromFrame(pID+(digits + i).substr(-1*textureDigits) + \".png\"));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\treturn texturesCache[pID];\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils.game.iso;\r\nimport com.isartdigital.builder.game.GameManager;\r\nimport pixi.core.math.Point;\r\n\r\n/**\r\n * Manager Iso\r\n * @author Mathieu Anthoine\r\n */\r\nclass IsoManager\r\n{\t\r\n\t\r\n\tprivate static var halfWidth:Float;\r\n\tprivate static var halfHeight:Float;\r\n\t\r\n\t/**\r\n\t * Initialisation du Manager Iso\r\n\t * @param\tpTileWidth largeur des tuiles\r\n\t * @param\tpTileHeight hauteur des tuiles\r\n\t */\r\n\tpublic static function init (pTileWidth:UInt, pTileHeight:UInt): Void {\r\n\t\thalfWidth = pTileWidth / 2;\r\n\t\thalfHeight = pTileHeight / 2;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Conversion du modèle à la vue Isométrique\r\n\t * @param\tpPoint colonne et ligne dans le modèle\r\n\t * @return point en x, y dans la vue\r\n\t */\r\n\tpublic static function modelToIsoView(pPoint:Point):Point {\r\n\t\treturn new Point (\r\n\t\t\t(pPoint.x - pPoint.y)*halfWidth,\r\n\t\t\t(pPoint.x + pPoint.y)*halfHeight\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * Conversion de la vue Isométrique au modèle\r\n\t * @param\tpPoint coordonnées dans la vue\r\n\t * @return colonne et ligne dans le modèle (valeurs non arrondies)\r\n\t */\r\n\tpublic static function isoViewToModel(pPoint:Point):Point {\r\n\t\treturn new Point (\r\n\t\t\tMath.round((pPoint.y/halfHeight+pPoint.x/halfWidth)/2),\r\n\t\t\tMath.round((pPoint.y/halfHeight-pPoint.x/halfWidth)/2)\r\n\t\t);\r\n\t}\r\n\t\r\n\t/**\r\n\t * détermine si l'objet A est devant l'objet B\r\n\t * @param\tpA Objet \"Zsortable\" A\r\n\t * @param\tpB Objet \"Zsortable\" B\r\n\t * @return pA, pB ou null si les objets ne se superposent pas\r\n\t */\r\n\tpublic static function isInFrontOf(pA:IZSortable,pB:IZSortable):IZSortable {\r\n\t\t\r\n\t\t// test d'intersection\r\n\t\t// if ((pA.colMax < pB.colMin || pA.colMin > pB.colMax) && (pA.rowMax < pB.rowMin || pA.rowMin > pB.rowMax)) return null;\r\n\t\t\r\n\t\t// test sur col\r\n\t\tif (pA.colMax<pB.colMin || pA.colMin >pB.colMax) {\r\n\t\t\tif (pA.colMin >= pB.colMax) return pA;\r\n\t\t\tif (pB.colMin >= pA.colMax) return pB;\r\n\t\t}\r\n\t\t\r\n\t\t//test sur row\r\n\t\tif (pA.rowMax<pB.rowMin || pA.rowMin >pB.rowMax) {\r\n\t\t\tif (pA.rowMin >= pB.rowMax) return pA;\r\n\t\t\tif (pB.rowMin >= pA.rowMax) return pB;\r\n\t\t}\r\n\t\t\r\n\t\treturn pB;\r\n\r\n\t}\r\n\t\r\n\t/**\r\n\t * Détermine la profondeur de l'objet \r\n\t * @param\tpItem Objet \"Zsortable\"\r\n\t * @param\tpList tableau des objets \"Zsortable\" à l'écran\r\n\t * @return\tprofondeur \r\n\t */\r\n\tpublic static function getDepth (pItem:IZSortable, pList:Array<IZSortable>):UInt {\r\n\t\tfor (i in 0...pList.length) {\r\n\t\t\tif (pList[i] == isInFrontOf(pItem, pList[i])) return i;\r\n\t\t}\r\n\t\t\r\n\t\treturn pList.length;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Récupère l'index de la position de la souris dans la grille\r\n\t * @return\r\n\t */\r\n\tpublic static function getMousePositionIndex():Point {\r\n\t\tvar lGameManager:GameManager = GameManager.getInstance();\r\n\t\tvar mouseCoord:Point = isoViewToModel(lGameManager.mousePosition);\r\n\t\treturn mouseCoord;\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Tri tous les objet du jeu\r\n\t */\r\n\tpublic static function sortAll():Void {\r\n\t\t\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils.loader;\r\nimport com.isartdigital.utils.events.LoadEventType;\r\nimport com.isartdigital.utils.sounds.SoundDef;\r\nimport com.isartdigital.utils.sounds.SoundManager;\r\nimport haxe.Json;\r\nimport howler.Howl;\r\nimport howler.Howler;\r\nimport pixi.loaders.FlumpParser;\r\nimport pixi.loaders.Loader;\r\nimport pixi.loaders.Resource;\r\nimport pixi.loaders.ResourceLoader;\r\nimport webfont.WebFontLoader;\r\n\r\n/**\r\n * Classe de chargement\r\n * Cette classe permet de gérer des chargements par lot aussi bien de fichiers textes que de ressources graphiques ou du son\r\n * @author Mathieu ANTHOINE, Dorian\r\n * @version 0.2.0\r\n */\r\nclass GameLoader extends Loader\r\n{\r\n\r\n\t/**\r\n\t * liste des fichiers sons à charger\r\n\t */\r\n\tprivate var soundsList:Array<String>;\r\n\t\r\n\tprivate var soundsSpecs:Map<String,HowlOptions>;\r\n\t\r\n\t/**\r\n\t * liste des fichiers chargés\r\n\t */\r\n\tprivate static var txtLoaded:Map<String,Dynamic> = new Map<String,Dynamic>();\r\n\t\r\n\t/**\r\n\t* retourne le contenu chargé pour le chemin de fichier passé en paramètre\r\n\t* @param\tpFile chemin du fichier\r\n\t* @return\tfichier Json\r\n\t*/\r\n\tpublic static function getContent (pFile:String):Json {\r\n\t\treturn txtLoaded[Config.txtsPath+pFile];\r\n\t}\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsoundsList = [];\r\n\t\tsoundsSpecs = new Map();\r\n\t\tsuper();\r\n\t}\r\n\r\n\t/**\r\n\t* ajoute un fichier de type texte à la liste de chargement (actuellement seuls les JSon sont supportés)\r\n\t* @param\tpUrl chaine de caractères spécifiant le chemin vers le fichier\r\n\t*/\r\n\tpublic function addTxtFile (pUrl:String):Void {\r\n\t\tvar lUrl:String = Config.txtsPath + pUrl;\r\n\t\tadd(lUrl);\r\n\t}\t\r\n\t\r\n\t/**\r\n\t* ajoute un fichier d'assets à la liste de chargement\r\n\t* @param\tpUrl chaine de caractère spécifiant le nom du fichier\r\n\t*/\r\n\tpublic function addAssetFile (pUrl:String):Void {\t\r\n\t\tvar lUrl:String = Config.assetsPath + pUrl;\r\n\t\tadd(lUrl);\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t* ajoute un fichier json à la liste de chargement\r\n\t* @param\tpUrl chaine de caractère spécifiant le nom du fichier\r\n\t*/\r\n\tpublic function addJsonFile (pUrl:String):Void {\t\r\n\t\tvar lUrl:String = Config.jsonPath + pUrl;\r\n\t\tadd(lUrl);\r\n\t}\t\r\n\t\r\n\t\r\n\t/**\r\n\t* ajoute une liste de sons à la liste de chargement\r\n\t* @param\tpUrl chaine de caractère spécifiant le nom du fichier\r\n\t*/\r\n\tpublic function addSoundFile (pUrl:String):Void {\t\r\n\t\tvar lUrl:String = Config.soundsPath + pUrl;\r\n\t\tsoundsList.push(lUrl);\r\n\t\tadd(lUrl);\r\n\t}\r\n\t\r\n\t/**\r\n\t* ajoute un fichier css de polices de caractère\r\n\t* @param\tpUrl chaine de caractère spécifiant le nom du fichier\r\n\t*/\r\n\tpublic function addFontFile (pUrl:String):Void {\t\r\n\t\tvar lUrl:String = Config.fontsPath + pUrl;\r\n\t\tadd(lUrl);\t\t\r\n\t}\r\n\t\r\n\tprivate function parseData (pResource:Resource, pNext:Void->Void): Void {\r\n\t\t\r\n\t\ttrace (pResource.url + \" loaded\");\r\n\t\t\r\n\t\tif (pResource.url.indexOf(\".css\") > 0) {\r\n\t\t\t\r\n\t\t\tvar lData:Array<String> = pResource.data.split(\";\");\r\n\t\t\tvar lFamilies:Array<String> = [];\r\n\t\t\tvar lReg:EReg = ~/font-family:\\s?(.*)/; \r\n\t\t\t\r\n\t\t\tfor (i in 0...lData.length) {\r\n\t\t\t\tif (lReg.match(lData[i])) lFamilies.push(lReg.matched(1));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar lWebFontConfig = {\r\n\t\t\t\tcustom: {\r\n\t\t\t\t\tfamilies: lFamilies,\r\n\t\t\t\t\turls: [Config.fontsPath+\"fonts.css\"],\r\n\t\t\t\t},\r\n\r\n\t\t\t\tactive: pNext\r\n\t\t\t};\r\n\t\t   \r\n\t\t\tWebFontLoader.load(lWebFontConfig);\t\t\t\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif (pResource.isJson) {\r\n\t\t\t\r\n\t\t\ttxtLoaded[pResource.url] = pResource.data;\r\n\t\t\tif(Reflect.hasField(pResource.data,\"md5\") && Reflect.hasField(pResource.data,\"movies\") && Reflect.hasField(pResource.data,\"textureGroups\") && Reflect.hasField(pResource.data,\"frameRate\")) {\r\n\t\t\t\tFlumpParser.flumpParser(pResource, pNext);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse if (soundsList.length>0) { \r\n\t\t\t\r\n\t\t\t\tvar lData:SoundDef;\r\n\t\t\t\t\r\n\t\t\t\tfor (i in 0...soundsList.length) {\r\n\t\t\t\t\tif (pResource.url == soundsList[i]) {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tsoundsList.splice(i, 1);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlData = pResource.data;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tfor (j in 0...lData.extensions.length) {\r\n\t\t\t\t\t\t\tif (Howler.codecs(lData.extensions[j])) {\r\n\t\t\t\t\t\t\t\taddSounds(lData.fxs,false,lData.extensions,lData.extensions[i]);\r\n\t\t\t\t\t\t\t\taddSounds(lData.musics,true,lData.extensions,lData.extensions[i]);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\tpNext();\r\n\t}\r\n\t\r\n\tprivate function addSounds (pList:Dynamic, pLoop:Bool, pExtensions:Array<String>, pCodec:String): Void {\t\r\n\t\tvar lUrl:String;\r\n\t\tfor (lID in Reflect.fields(pList)) {\r\n\t\t\tlUrl = Config.soundsPath + lID + \".\" + pCodec;\r\n\t\t\tsoundsSpecs.set(lID, {urls:[lUrl],volume:Reflect.field(pList, lID) / 100, loop:pLoop} );\r\n\t\t\tadd(lUrl);\r\n\t\t}\r\n\t}\r\n\r\n\toverride public function load (?cb:Void -> Void):ResourceLoader {\r\n\t\tafter(parseData);\r\n\t\tonce(LoadEventType.COMPLETE, onComplete);\r\n\t\treturn super.load();\r\n\t}\r\n\t\r\n\tprivate function onComplete ():Void {\r\n\t\tfor (lID in soundsSpecs.keys()) {\r\n\t\t\tSoundManager.addSound(lID, new Howl (soundsSpecs[lID]));\r\n\t\t}\r\n\t}\r\n\t\r\n}","package com.isartdigital.utils.sounds;\r\n\r\nimport howler.Howl;\r\n\r\n\t\r\n/**\r\n * Manager centralisé de Sons Howler\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass SoundManager\r\n{\r\n\t/**\r\n\t * liste de tous les sons du jeu\r\n\t */\r\n\tprivate static var list (default,null):Map<String,Howl>;\r\n\t\r\n\tprivate function new() {\r\n\t}\r\n\t\r\n\t/**\r\n\t * ajoute un son à la liste\r\n\t * @param\tpName identifiant du son\r\n\t * @param\tpSound son\r\n\t */\r\n\tpublic static function addSound (pName:String,pSound:Howl):Void {\r\n\t\tif (list == null) list = new Map<String,Howl>();\r\n\t\tlist[pName] = pSound;\r\n\t}\r\n\t\r\n\t/**\r\n\t * retourne une référence vers le son par l'intermédiaire de son identifiant\r\n\t * @param\tpName identifiant du son\r\n\t * @return le son\r\n\t */\r\n\tpublic static function getSound(pName:String): Howl {\r\n\t\treturn list[pName];\r\n\t}\r\n\r\n}","package com.isartdigital.utils.system;\r\n\r\nimport com.isartdigital.utils.game.GameStage;\r\nimport js.Browser;\r\nimport js.html.Element;\r\nimport js.html.Event;\r\nimport js.html.Image;\r\nimport pixi.core.display.DisplayObject;\r\nimport pixi.core.math.Point;\r\nimport pixi.core.math.shapes.Rectangle;\r\n\t\r\n/**\r\n * Classe Utilitaire donnant accès à des propriétés du périphérique cible\r\n * Tous les périphériques ne se comportant pas comme on l'attend, DeviceCapabilities permet de\r\n * masquer les comportement différents et présenter une facade unique au reste du code\r\n * @version 0.3.0\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass DeviceCapabilities \r\n{\t\t\r\n\r\n\tpublic static inline var SYSTEM_ANDROID: String = \"Android\";\r\n\tpublic static inline var SYSTEM_IOS: String = \"iOS\";\r\n\tpublic static inline var SYSTEM_BLACKBERRY: String = \"BlackBerry\";\r\n\tpublic static inline var SYSTEM_BB_PLAYBOOK: String = \"BlackBerry PlayBook\";\r\n\tpublic static inline var SYSTEM_WINDOWS_MOBILE: String = \"IEMobile\";\r\n\tpublic static inline var SYSTEM_DESKTOP: String = \"Desktop\";\t\r\n\t\r\n\tprivate static var fullScreenButton:Image;\r\n\tprivate static inline var ICON_SIZE:Float = 0.075;\r\n\r\n\tpublic static inline var TEXTURE_NO_SCALE: String = \"\";\r\n\tpublic static inline var TEXTURE_HD: String = \"hd\";\r\n\tpublic static inline var TEXTURE_MD: String = \"md\";\r\n\tpublic static inline var TEXTURE_LD: String = \"ld\";\t\r\n\t\r\n\tprivate static var texturesRatios: Map<String,Float> = [\"hd\"=>1,\"md\"=>0.5,\"ld\"=>0.25];\r\n\t\r\n\tpublic static var textureRatio (default,null):Float = 1;\r\n\tpublic static var textureType (default,null):String = TEXTURE_NO_SCALE;\t\r\n\t\r\n\tprivate static var screenRatio:Float = 1;\r\n\t\r\n\t/**\r\n\t  * hauteur du Canvas (change avec l'orientation)\r\n\t  */\r\n\tpublic static var height (get, never) : UInt;\r\n\t\r\n\tprivate static function get_height () {\r\n\t\treturn Browser.window.innerHeight;\r\n\t}\r\n\t\r\n\t/**\r\n\t  * largeur du Canvas (change avec l'orientation)\r\n\t  */\r\n\tpublic static var width (get, never) : UInt;\r\n\t\r\n\tprivate static function get_width () {\r\n\t\treturn Browser.window.innerWidth;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Système d'exploitation du Device\r\n\t */\r\n\tpublic static var system (get, never) : String;\r\n\t\r\n\tprivate static function get_system( ) {\r\n\t\tif ( ~/IEMobile/i.match(Browser.navigator.userAgent)) return SYSTEM_WINDOWS_MOBILE;\t\r\n\t\telse if ( ~/iPhone|iPad|iPod/i.match(Browser.navigator.userAgent)) return SYSTEM_IOS;\r\n\t\telse if ( ~/BlackBerry/i.match(Browser.navigator.userAgent)) return SYSTEM_BLACKBERRY;\r\n\t\telse if ( ~/PlayBook/i.match(Browser.navigator.userAgent)) return SYSTEM_BB_PLAYBOOK;\r\n\t\telse if ( ~/Android/i.match(Browser.navigator.userAgent)) return SYSTEM_ANDROID;\r\n\t\telse return SYSTEM_DESKTOP;\r\n\t}\r\n\t\r\n\t/**\r\n\t * affiche le bouton de fullscreen\r\n\t */\r\n\tpublic static function displayFullScreenButton ():Void {\r\n\t\tif (!~/(iPad|iPhone|iPod)/g.match(Browser.navigator.userAgent) && !~/MSIE/i.match(Browser.navigator.userAgent) /*&& !(Browser.window.location.hash = !!Browser.window.MSInputMethodContext)*/) {\r\n\r\n\t\t\tBrowser.document.onfullscreenchange = onChangeFullScreen;\r\n\t\t\tuntyped Browser.document.onwebkitfullscreenchange = onChangeFullScreen;\r\n\t\t\tuntyped Browser.document.onmozfullscreenchange = onChangeFullScreen;\r\n\t\t\tuntyped Browser.document.onmsfullscreenchange = onChangeFullScreen;\r\n\t\t\t//Browser.document.addEventListener(\"MSFullscreenChange\", onChangeFullScreen );\r\n\t\t\t\r\n\t\t\tfullScreenButton = new Image();\r\n\t\t\tfullScreenButton.style.position = 'absolute';\r\n\t\t\tfullScreenButton.style.right = '0px';\r\n\t\t\tfullScreenButton.style.top = '0px';\r\n\t\t\tfullScreenButton.style.cursor = \"pointer\";\r\n\t\t\tfullScreenButton.width = Std.int(getSizeFactor()*ICON_SIZE);\r\n\t\t\tfullScreenButton.height = Std.int(getSizeFactor()*ICON_SIZE);\r\n\t\t\tfullScreenButton.onclick = enterFullscreen;\r\n\t\t\tfullScreenButton.src = Config.assetsPath+\"fullscreen.png\";\r\n\t\t\t\r\n\t\t\tBrowser.document.body.appendChild(fullScreenButton);\r\n\r\n\t\t}\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * entre dans le mode fullscreen\r\n\t * @param\tpEvent\r\n\t */\r\n\tprivate static function enterFullscreen(pEvent:Event):Void {\r\n\t\tvar lDocElm:Element = Browser.document.documentElement;\r\n\t\tif (lDocElm.requestFullscreen!=null) lDocElm.requestFullscreen();\r\n\t\telse if (untyped lDocElm.mozRequestFullScreen!=null) untyped lDocElm.mozRequestFullScreen();\r\n\t\telse if (untyped lDocElm.webkitRequestFullScreen!=null) untyped lDocElm.webkitRequestFullScreen();\r\n\t\telse if (untyped lDocElm.msRequestFullscreen!=null) untyped lDocElm.msRequestFullscreen();\r\n\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * sort du mode fullscreen\r\n\t */\r\n\tprivate static function exitFullscreen():Void {\r\n\t\tif (Browser.document.exitFullscreen!=null) Browser.document.exitFullscreen();\r\n\t\telse if (untyped Browser.document.mozCancelFullScreen!=null) untyped Browser.document.mozCancelFullScreen();\r\n\t\telse if (untyped Browser.document.webkitCancelFullScreen!=null) untyped Browser.document.webkitCancelFullScreen();\r\n\t\telse if (untyped Browser.document.msExitFullscreen) untyped Browser.document.msExitFullscreen();\r\n\t}\r\n\r\n\t/**\r\n\t * callback appelée sur changement d'état fullscreen\r\n\t * @param\tpEvent\r\n\t */\r\n\tprivate static function onChangeFullScreen (pEvent:Event):Void {\r\n\t\tif (untyped Browser.document.fullScreen || untyped Browser.document.mozFullScreen || untyped Browser.document.webkitIsFullScreen || untyped Browser.document.msFullscreenElement) {\r\n\t\t\tfullScreenButton.style.display = 'none';\r\n\t\t} else {\r\n\t\t\tfullScreenButton.style.display = 'block';\r\n\t\t}\r\n\t\tpEvent.preventDefault();\r\n\t}\r\n\r\n\t\r\n\t/**\r\n\t * Calcul la dimension idéale du bouton en fonction du device\r\n\t * @return fullscreen ideal size\r\n\t */\r\n\tpublic static function getSizeFactor ():Float {\r\n\t\tvar lSize:Float=Math.floor(Math.min(Browser.window.screen.width,Browser.window.screen.height));\r\n\t\tif (system==SYSTEM_DESKTOP) lSize/=3;\r\n\r\n\t\treturn lSize;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * retourne un objet Rectangle correspondant aux dimensions de l'écran dans le repère du DisplayObject passé en paramètre\r\n\t * @param pTarget repère cible\r\n\t * @return objet Rectangle\r\n\t */\r\n\tpublic static function getScreenRect(pTarget:DisplayObject):Rectangle {\r\n\r\n\t\tvar lTopLeft:Point = new Point (0, 0);\r\n\t\tvar lBottomRight:Point = new Point (width, height);\r\n\t\t\r\n\t\tlTopLeft = pTarget.toLocal(lTopLeft);\r\n\t\tlBottomRight = pTarget.toLocal(lBottomRight);\r\n\t\t\r\n\t\treturn new Rectangle(lTopLeft.x, lTopLeft.y, lBottomRight.x - lTopLeft.x, lBottomRight.y - lTopLeft.y);\r\n\t}\r\n\r\n\t/**\r\n\t * Calibre le viewport pour que le Browser affiche la résolution réeelle du Device\r\n\t */\r\n\tpublic static function scaleViewport (): Void {\r\n\t\tif (system == SYSTEM_WINDOWS_MOBILE) return;\r\n\t\t\r\n\t\tscreenRatio = Browser.window.devicePixelRatio;\r\n\t\tBrowser.document.write('<meta name=\"viewport\" content=\"initial-scale=' + Math.round(100 / screenRatio) / 100 + ', user-scalable=no, minimal-ui\">');\t\t\t\t\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * Défini les ratios de texture\r\n\t * @param\tpHd ratio texture pour HD\r\n\t * @param\tpMd ratio texture pour MD\r\n\t * @param\tpLd ratio texture pour LD\r\n\t */\r\n\tpublic static function init(?pHd:Float = 1, ?pMd:Float = 0.5, ?pLd:Float = 0.25):Void {\r\n\r\n\t\ttexturesRatios[TEXTURE_HD]=pHd;\r\n\t\ttexturesRatios[TEXTURE_MD]=pMd;\r\n\t\ttexturesRatios[TEXTURE_LD]=pLd;\r\n\t\t\r\n\t\tif (Config.data.texture != null && Config.data.texture!=\"\") textureType = Config.data.texture;\r\n\t\telse {\r\n\t\t\tvar lRatio:Float = Math.min(Browser.window.screen.width * screenRatio / GameStage.getInstance().safeZone.width, Browser.window.screen.height * screenRatio / GameStage.getInstance().safeZone.height);\r\n\t\t\tif (lRatio <= 0.25) textureType = TEXTURE_LD;\r\n\t\t\telse if (lRatio <= 0.5) textureType = TEXTURE_MD;\r\n\t\t\telse textureType = TEXTURE_HD;\r\n\t\t}\r\n\t\ttextureRatio = texturesRatios[textureType];\r\n\t\t\r\n\t}\r\n\r\n}","package com.isartdigital.utils.ui;\r\n\r\nimport com.isartdigital.utils.game.GameStage;\r\nimport com.isartdigital.utils.loader.GameLoader;\r\nimport com.isartdigital.utils.ui.UIPosition;\r\nimport flump.json.FlumpJSON;\r\nimport pixi.core.display.Container;\r\nimport pixi.core.math.Point;\r\nimport pixi.display.FlumpSprite;\r\n\r\n/**\r\n * ...\r\n * @author Mathieu Anthoine\r\n */\r\nclass UIBuilder\r\n{\r\n\t\r\n\t/**\r\n\t * fichier de description des assuets d'UI au format Flump\r\n\t */\r\n\tprivate static var description:String;\r\n\t\r\n\t/**\r\n\t * suffixe des FlumpSprite \"texte\"\r\n\t */\r\n\tprivate static inline var TXT_SUFFIX:String = \"_txt\";\r\n\t\r\n\t/**\r\n\t * suffixe des FlumpButton\r\n\t */\r\n\tprivate static inline var BTN_SUFFIX:String = \"Button\";\r\n\t\r\n\t/**\r\n\t * package des classes Button du projet\r\n\t */\r\n\tprivate static var btnPackage:String;\r\n\t\r\n\t/**\r\n\t * wrapper vers UIPosition\r\n\t */\r\n\tprivate static var uiPos:Map<String,String> =\r\n\t\t[\r\n\t\t\t\"L\" => UIPosition.LEFT,\r\n\t\t\t\"R\" => UIPosition.RIGHT,\r\n\t\t\t\"T\" => UIPosition.TOP,\r\n\t\t\t\"B\" => UIPosition.BOTTOM,\r\n\t\t\t\"TL\" => UIPosition.TOP_LEFT,\r\n\t\t\t\"TR\" => UIPosition.TOP_RIGHT,\r\n\t\t\t\"BL\" => UIPosition.BOTTOM_LEFT,\r\n\t\t\t\"BR\" => UIPosition.BOTTOM_RIGHT,\r\n\t\t\t\"FW\" => UIPosition.FIT_WIDTH,\r\n\t\t\t\"FH\" => UIPosition.FIT_HEIGHT,\r\n\t\t\t\"FS\" => UIPosition.FIT_SCREEN\r\n\t\t];\r\n\t\r\n\tprivate function new() {}\r\n\t\r\n\t/**\r\n\t * Initialise le parseur\r\n\t * @param\tpFile nom du fichier qui contient les données de mise en forme de l'UI\r\n\t * @param\tpPackage nom du package des boutons\r\n\t */\r\n\tpublic static function init(pFile:String,pPackage:String):Void {\r\n\t\tdescription = pFile;\r\n\t\tbtnPackage = pPackage;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Crée les éléments composant un Screen\r\n\t * @param\tpId Classe de l'écran\r\n\t */\r\n\tpublic static function buildScreen (pId:String) : Array<UIPositionable> {\r\n\t\treturn build(pId, true);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Crée les éléments composant une popIn\r\n\t * @param\tpId Classe de la popIn\r\n\t */\r\n\tpublic static function buildPopin (pId:String) : Array<UIPositionable> {\r\n\t\treturn build(pId, false);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Crée les éléments composant un Screen\r\n\t * @param\tpId assetName de l'écran\r\n\t */\r\n\tprivate static function build (pId:String, pScreen:Bool ) : Array<UIPositionable> {\r\n\t\t\r\n\t\tvar lData:FlumpJSON= cast GameLoader.getContent(description);\r\n\t\tvar lList:Array<Container>=[];\r\n\t\t\r\n\t\tvar lObj:Container;\r\n\t\tvar lItem;\r\n\t\t\r\n\t\tvar lUIPos:Array<UIPositionable>=[];\r\n\t\t\r\n\t\tfor (lMovie in lData.movies) {\r\n\t\t\tif (lMovie.id == pId) {\r\n\t\t\t\tfor (lItem in lMovie.layers) {\r\n\t\t\t\t\tif (lItem.name.indexOf(TXT_SUFFIX)==lItem.name.length-TXT_SUFFIX.length) {\r\n\t\t\t\t\t\t//TODO: A vous de le coder pour remplacer le texte statique en un texte dynamique localisable\r\n\t\t\t\t\t\tlObj = new FlumpSprite(lItem.keyframes[0].ref);\r\n\t\t\t\t\t} else if (lItem.name.indexOf(BTN_SUFFIX)==lItem.name.length-BTN_SUFFIX.length) {\t\r\n\t\t\t\t\t\tlObj = Type.createInstance(Type.resolveClass(btnPackage+\".\" + lItem.keyframes[0].ref), []);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t//TODO: traiter le cas des FlumpSprite et FlumpMovieClip\r\n\t\t\t\t\t\tlObj = new FlumpSprite(lItem.keyframes[0].ref);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tlObj.name = lItem.keyframes[0].ref;\r\n\t\t\t\t\tif (Reflect.hasField(lItem.keyframes[0],\"loc\")) lObj.position.set(lItem.keyframes[0].loc.x, lItem.keyframes[0].loc.y);\r\n\t\t\t\t\tif (Reflect.hasField(lItem.keyframes[0],\"scale\")) lObj.scale.set(lItem.keyframes[0].scale.x, lItem.keyframes[0].scale.y);\r\n\t\t\t\t\tif (Reflect.hasField(lItem.keyframes[0],\"pivot\")) lObj.pivot.set(lItem.keyframes[0].pivot.x, lItem.keyframes[0].pivot.y);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// REMARQUE: gère uniquement la rotation, skew pas encore supporté par pixi en natif, attendre la future version pour pouvoir en profiter\r\n\t\t\t\t\tif (Reflect.hasField(lItem.keyframes[0],\"skew\")) lObj.rotation = lItem.keyframes[0].skew.x;\r\n\t\t\t\t\t\r\n\t\t\t\t\tlUIPos.push(getUIPositionable(lObj,uiPos.get(lItem.name.split(\"_\")[0]),pScreen));\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn lUIPos;\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * retourne un UIPositionable correctement construit\r\n\t * @param\tpObj Item d'interface\r\n\t * @param\tpPosition ancrage \"UIPosition\"\r\n\t * @param\tpScreen Screen sinon Popin\r\n\t * @return un UIPositionable\r\n\t */\r\n\tprivate static function getUIPositionable (pObj:Container,pPosition:String,pScreen:Bool):UIPositionable {\r\n\t\t\r\n\t\tvar lOffset:Point = new Point (0, 0);\r\n\t\tvar lRef:Point = pScreen ? GameStage.getInstance().getScreensContainer().position : GameStage.getInstance().getPopinsContainer().position;\r\n\t\t\r\n\t\tif (\r\n\t\t\tpPosition != UIPosition.BOTTOM &&\r\n\t\t\tpPosition != UIPosition.BOTTOM_LEFT &&\r\n\t\t\tpPosition != UIPosition.BOTTOM_RIGHT &&\r\n\t\t\tpPosition != UIPosition.FIT_HEIGHT &&\r\n\t\t\tpPosition != UIPosition.FIT_SCREEN &&\r\n\t\t\tpPosition != UIPosition.FIT_WIDTH &&\r\n\t\t\tpPosition != UIPosition.LEFT &&\r\n\t\t\tpPosition != UIPosition.RIGHT &&\r\n\t\t\tpPosition != UIPosition.TOP &&\r\n\t\t\tpPosition != UIPosition.TOP_LEFT &&\r\n\t\t\tpPosition != UIPosition.TOP_RIGHT\r\n\t\t) pPosition = \"\";\r\n\t\telse {\r\n\t\t\tif (pPosition == UIPosition.TOP || pPosition == UIPosition.TOP_LEFT || pPosition == UIPosition.TOP_RIGHT) lOffset.y = pObj.y;\r\n\t\t\tif (pPosition == UIPosition.BOTTOM || pPosition == UIPosition.BOTTOM_LEFT || pPosition == UIPosition.BOTTOM_RIGHT) lOffset.y = GameStage.getInstance().safeZone.height-lRef.y - pObj.y;\r\n\t\t\tif (pPosition == UIPosition.LEFT || pPosition == UIPosition.TOP_LEFT || pPosition == UIPosition.BOTTOM_LEFT) lOffset.x = pObj.x;\r\n\t\t\tif (pPosition == UIPosition.RIGHT || pPosition == UIPosition.TOP_RIGHT || pPosition == UIPosition.BOTTOM_RIGHT) lOffset.x = GameStage.getInstance().safeZone.width-lRef.x - pObj.x;\t\t\r\n\t\t}\r\n\t\t\r\n\t\treturn {item:pObj, align:pPosition, offsetX:lOffset.x, offsetY:lOffset.y};\r\n\t}\r\n\t\r\n}\r\n\r\n","package com.isartdigital.utils.ui;\r\nimport com.isartdigital.utils.system.DeviceCapabilities;\r\nimport pixi.core.display.DisplayObject;\r\nimport pixi.core.math.Point;\r\nimport pixi.core.math.shapes.Rectangle;\r\n\r\n/**\r\n * Classe utilitaire permettant de gérer le repositionnement des élements d'interface dans l'écran\r\n * @author Mathieu ANTHOINE\r\n */\r\n\r\nclass UIPosition \r\n{\r\n\tpublic static inline var LEFT:String=\"left\";\r\n\tpublic static inline var RIGHT:String=\"right\";\r\n\tpublic static inline var TOP:String=\"top\";\r\n\tpublic static inline var BOTTOM:String=\"bottom\";\r\n\tpublic static inline var TOP_LEFT:String=\"topLeft\";\r\n\tpublic static inline var TOP_RIGHT:String=\"topRight\";\r\n\tpublic static inline var BOTTOM_LEFT:String=\"bottomLeft\";\r\n\tpublic static inline var BOTTOM_RIGHT:String=\"bottomRight\";\r\n\t\r\n\tpublic static inline var FIT_WIDTH:String=\"fitWidth\";\r\n\tpublic static inline var FIT_HEIGHT:String=\"fitHeight\";\r\n\tpublic static inline var FIT_SCREEN:String = \"fitScreen\";\r\n\t\r\n\tprivate function new() {}\r\n\t\r\n\t/**\r\n\t* \r\n\t* @param\tpTarget DisplayObject à positionner\r\n\t* @param\tpPosition type de positionnement\r\n\t* @param\tpOffsetX décalage en X (positif si c'est vers l'interieur de la zone de jeu sinon en négatif)\r\n\t* @param\tpOffsetY décalage en Y (positif si c'est vers l'interieur de la zone de jeu sinon en négatif)\r\n\t*/\r\n\tstatic public function setPosition (pTarget:DisplayObject, pPosition:String, pOffsetX:Float = 0, pOffsetY:Float = 0): Void {\r\n\t\t\t\t\r\n\t\tvar lScreen:Rectangle = DeviceCapabilities.getScreenRect(pTarget.parent);\r\n\t\t\r\n\t\tvar lTopLeft:Point = new Point (lScreen.x, lScreen.y);\r\n\t\tvar lBottomRight:Point = new Point (lScreen.x+lScreen.width,lScreen.y+lScreen.height);\r\n\t\t\r\n\t\tif (pPosition == TOP || pPosition == TOP_LEFT || pPosition == TOP_RIGHT) pTarget.y = lTopLeft.y + pOffsetY;\r\n\t\tif (pPosition == BOTTOM || pPosition == BOTTOM_LEFT || pPosition == BOTTOM_RIGHT) pTarget.y = lBottomRight.y - pOffsetY;\r\n\t\tif (pPosition == LEFT || pPosition == TOP_LEFT || pPosition == BOTTOM_LEFT) pTarget.x = lTopLeft.x + pOffsetX;\r\n\t\tif (pPosition == RIGHT || pPosition == TOP_RIGHT || pPosition == BOTTOM_RIGHT) pTarget.x = lBottomRight.x - pOffsetX;\r\n\t\t\r\n\t\tif (pPosition == FIT_WIDTH || pPosition == FIT_SCREEN) {\r\n\t\t\tpTarget.x = lTopLeft.x;\r\n\t\t\tuntyped pTarget.width = lBottomRight.x - lTopLeft.x;\r\n\t\t}\r\n\t\tif (pPosition == FIT_HEIGHT || pPosition == FIT_SCREEN) {\r\n\t\t\tpTarget.y = lTopLeft.y;\r\n\t\t\tuntyped pTarget.height = lBottomRight.y - lTopLeft.y;\r\n\t\t}\r\n\r\n\t}\r\n\t\r\n}\r\n","package flump;\n\nimport flump.library.Keyframe;\n\n\nclass DisplayObjectKey {\n\n\tpublic var symbolId:String;\n\n\n\tpublic function new(symbolId:String){\n\t\tthis.symbolId = symbolId;\n\t}\n\n}","package flump;\n\nimport flump.DisplayObjectKey;\nimport flump.IFlumpMovie;\nimport flump.library.MovieSymbol;\nimport flump.library.Layer;\nimport flump.library.Keyframe;\nimport flump.library.Label;\nusing Std;\n\n\nclass MoviePlayer{\n\n\tprivate var symbol:MovieSymbol;\n\tprivate var movie:IFlumpMovie;\n\n\tprivate var elapsed:Float = 0.0; // Total time that has elapsed\n\tprivate var previousElapsed:Float = 0.0;\n\tprivate var advanced:Float = 0.0; // Time advanced since the last frame\n\n\tpublic var independantTimeline:Bool = true;\n\tpublic var independantControl:Bool = false;\n\n\tprivate var state:String;\n\tprivate var STATE_PLAYING:String = \"playing\";\n\tprivate var STATE_LOOPING:String = \"looping\";\n\tprivate var STATE_STOPPED:String = \"stopped\";\n\t\t\n\tprivate var currentChildrenKey = new Map<Layer, DisplayObjectKey>();\n\tprivate var createdChildren = new Map<DisplayObjectKey, Bool>();\n\tprivate var childPlayers = new Map<DisplayObjectKey, MoviePlayer>();\n\n\tprivate var labelsToFire = new Array<Label>();\n\tprivate var dirty:Bool = false;\n\tprivate var fullyGenerated:Bool = false;\n\n\n\tpublic function new(symbol:MovieSymbol, movie:IFlumpMovie){\n\t\tthis.symbol = symbol;\n\t\tthis.movie = movie;\n\t\t\n\t\tfor(layer in symbol.layers){\n\t\t\tmovie.createLayer(layer);\n\t\t}\n\n\t\tstate = STATE_LOOPING;\n\t}\n\n\n\tpublic function getDisplayKey(layerId:String, keyframeIndex:UInt = 0):DisplayObjectKey{\n\t\tvar layer = symbol.getLayer(layerId);\n\t\tif(layer == null) throw(\"Layer \" + layerId + \" does not exist.\");\n\t\tvar keyframe = layer.getKeyframeForFrame(keyframeIndex);\n\t\tif(keyframe == null) throw(\"Keyframe does not exist at index \" + keyframeIndex);\n\t\tcreateChildIfNessessary(keyframe);\n\t\treturn keyframe.displayKey;\n\t}\n\n\n\tprivate function reset(){\n\t\telapsed = 0;\n\t\tpreviousElapsed = 0;\n\t}\n\n\n\tprivate var position(get, null):Float = 0.0;\n\tpublic function get_position():Float{\n\t\treturn (elapsed % symbol.duration + symbol.duration) % symbol.duration;\n\t}\n\n\n\tpublic var totalFrames (get, null) :UInt;\n\tprivate function get_totalFrames(){\n\t\treturn symbol.totalFrames;\n\t}\n\n\n\tpublic function play(){\n\t\tsetState(STATE_PLAYING);\n\t\treturn this;\n\t}\n\n\n\tpublic function loop(){\n\t\tsetState(STATE_LOOPING);\n\t\treturn this;\n\t}\n\n\n\tpublic function stop(){\n\t\tsetState(STATE_STOPPED);\n\t\treturn this;\n\t}\n\n\n\tpublic function goToLabel(label:String){\n\t\tif(!labelExists(label)) throw(\"Symbol \" + symbol.name + \" does not have label \" + label + \".\" );\n\t\tcurrentFrame = getLabelFrame(label);\n\t\treturn this;\n\t}\n\n\n\tpublic function goToFrame(frame:Int){\n\t\tcurrentFrame = frame;\n\t\treturn this;\n\t}\n\n\n\tpublic function goToPosition(time:Float){\n\t\telapsed = time;\n\t\tpreviousElapsed = time;\n\t\tclearLabels();\n\t\tfireLabels();\n\t\treturn this;\n\t}\n\n\n\tpublic var playing(get, null):Bool;\n\tprivate function get_playing(){\n\t\treturn state == STATE_PLAYING;\n\t}\n\n\n\tpublic var looping(get, null):Bool;\n\tprivate function get_looping(){\n\t\treturn state == STATE_LOOPING;\n\t}\n\n\n\tpublic var stopped(get, null):Bool;\n\tprivate function get_stopped(){\n\t\treturn state == STATE_STOPPED;\n\t}\n\n\n\tpublic function getLabelFrame(label:String):UInt{\n\t\tif(!labelExists(label)) throw(\"Symbol \" + symbol.name + \" does not have label \" + label + \".\" );\n\t\treturn symbol.labels.get(label).keyframe.index;\n\t}\n\t\n\n\tpublic var currentFrame(get, set):Int;\n\tprivate function get_currentFrame():Int{\n\t\treturn Std.int(position / symbol.library.frameTime);\n\t}\n\tprivate function set_currentFrame(value:Int):Int{\n\t\tgoToPosition( symbol.library.frameTime * value);\n\t\treturn value;\n\t}\n\n\n\tpublic function labelExists(label:String):Bool{\n\t\treturn symbol.labels.exists(\"label\");\n\t}\n\n\n\tpublic function advanceTime(ms:Float):Void{\n\t\tif(state != STATE_STOPPED){\n\t\t\telapsed += ms;\n\t\t\twhile(elapsed < 0){\n\t\t\t\telapsed += symbol.duration;\n\t\t\t\tpreviousElapsed += symbol.duration;\n\t\t\t}\n\t\t}\n\t\tadvanced += ms;\n\n\t\tif(state != STATE_STOPPED) fireLabels();\n\t\trender();\n\t}\n\n\n\tprivate function clearLabels(){\n\t\twhile(labelsToFire.length > 0) labelsToFire.pop();\n\t}\n\n\n\tprivate function fireLabels(){\n\t\tif(symbol.firstLabel == null) return;\n\t\tif(previousElapsed > elapsed) return;\n\t\t\n\t\t\n\t\tvar label:Label = previousElapsed <= elapsed\n\t\t\t? symbol.firstLabel\n\t\t\t: symbol.lastLabel;\n\t\t\n\t\tvar checking = true;\n\t\twhile(checking){\n\t\t\tif(label.keyframe.time > previousElapsed%symbol.duration){\n\t\t\t\tchecking = false;\n\t\t\t\t//trace(label.keyframe.index);\n\t\t\t\t//label = label.prev;\n\t\t\t}else if(label.next.keyframe.index <= label.keyframe.index){\n\t\t\t\tchecking = false;\n\t\t\t\tlabel = label.next;\n\t\t\t}else{\n\t\t\t\tlabel = label.next;\n\t\t\t}\n\t\t}\n\t\t\n\n\n\t\tvar firstChecked = label;\n\n\t\twhile(label != null){\n\t\t\tvar checkFrom = previousElapsed % symbol.duration;\n\t\t\tvar checkTo = elapsed % symbol.duration;\n\t\t\tif(label.keyframe.insideRangeStart(checkFrom, checkTo)){\n\t\t\t\tlabelsToFire.push(label);\n\t\t\t\t//trace(\"pushed: \" + label.keyframe.index + \" || \" + (checkFrom/symbol.library.frameTime) + \" : \" + (checkTo/symbol.library.frameTime));\n\t\t\t}\n\n\t\t\tlabel = label.next;\n\t\t\tif(label == firstChecked) label = null;\n\t\t}\n\t\t\n\n\t\twhile(labelsToFire.length > 0){\n\t\t\tmovie.labelPassed(labelsToFire.shift());\n\t\t}\n\n\t}\n\n\n\n\tprivate function render():Void{\n\t\tif(state == STATE_PLAYING){\n\t\t\tif(position < 0){\n\t\t\t\telapsed = 0;\n\t\t\t\tstop();\n\t\t\t\tmovie.onAnimationComplete();\n\t\t\t}else if(position >= symbol.duration - symbol.library.frameTime){\n\t\t\t\telapsed = symbol.duration - symbol.library.frameTime;\n\t\t\t\tstop();\n\t\t\t\tmovie.onAnimationComplete();\n\t\t\t}\n\t\t}\n\n\t\twhile(position < 0) position += symbol.duration;\n\t\t\n\t\tfor(layer in symbol.layers){\n\t\t\tvar keyframe = layer.getKeyframeForTime(position);\n\n\t\t\tif(keyframe.isEmpty == true){\n\t\t\t\tremoveChildIfNessessary(keyframe);\n\t\t\t}else if(keyframe.isEmpty == false){\n\t\t\t\tvar interped = getInterpolation(keyframe, position);\n\t\t\t\tvar next = keyframe.next;\n\t\t\t\tif(next.isEmpty) next = keyframe; // NASTY! FIX THIS!!\n\n\t\t\t\tmovie.renderFrame(\n\t\t\t\t\tkeyframe,\n\t\t\t\t\tkeyframe.location.x + (next.location.x - keyframe.location.x) * interped,\n\t\t\t\t\tkeyframe.location.y + (next.location.y - keyframe.location.y) * interped,\n\t\t\t\t\tkeyframe.scale.x + (next.scale.x - keyframe.scale.x) * interped,\n\t\t\t\t\tkeyframe.scale.y + (next.scale.y - keyframe.scale.y) * interped,\n\t\t\t\t\tkeyframe.skew.x + (next.skew.x - keyframe.skew.x) * interped,\n\t\t\t\t\tkeyframe.skew.y + (next.skew.y - keyframe.skew.y) * interped\n\t\t\t\t);\n\n\n\t\t\t\tif(currentChildrenKey.get(layer) != keyframe.displayKey){\n\t\t\t\t\tcreateChildIfNessessary(keyframe);\n\t\t\t\t\tremoveChildIfNessessary(keyframe);\n\t\t\t\t\taddChildIfNessessary(keyframe);\n\t\t\t\t}\n\n\t\t\t\tif(keyframe.symbol.is(MovieSymbol)){\n\t\t\t\t\tvar childMovie = movie.getChildPlayer(keyframe);\n\n\t\t\t\t\tif(childMovie.independantTimeline){\n\t\t\t\t\t\tchildMovie.advanceTime(advanced);\n\t\t\t\t\t\tchildMovie.render();\n\t\t\t\t\t}else{\n\t\t\t\t\t\tchildMovie.elapsed = position;\n\t\t\t\t\t\tchildMovie.render();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tadvanced = 0;\n\t\tpreviousElapsed = elapsed;\n\t}\n\n\n\tprivate function createChildIfNessessary(keyframe:Keyframe){\n\t\tif(keyframe.isEmpty) return;\n\t\tif(createdChildren.exists(keyframe.displayKey) == false){\n\t\t\tmovie.createFlumpChild(keyframe.displayKey);\n\t\t\tcreatedChildren[keyframe.displayKey] = true;\n\t\t}\n\t}\n\n\n\tprivate function removeChildIfNessessary(keyframe:Keyframe){\n\t\tif(currentChildrenKey.exists(keyframe.layer)){\n\t\t\tmovie.removeFlumpChild(keyframe.layer, keyframe.displayKey);\n\t\t\tcurrentChildrenKey.remove(keyframe.layer);\n\t\t}\n\t}\n\n\n\tprivate function addChildIfNessessary(keyframe:Keyframe){\n\t\tif(keyframe.isEmpty) return;\n\t\tcurrentChildrenKey[keyframe.layer] = keyframe.displayKey;\n\t\tmovie.addFlumpChild(keyframe.layer, keyframe.displayKey);\n\t}\n\n\n\t\n\t//////////////////////////////////////////////////////////////\n\t//\n\t//  Utilities\n\t//\n\t//////////////////////////////////////////////////////////////\n\n\tprivate function setState(state:String){\n\t\tthis.state = state;\n\n\t\tfor(layer in symbol.layers){\n\t\t\tvar keyframe = layer.getKeyframeForTime(position);\n\t\t\tcreateChildIfNessessary(keyframe);\n\n\t\t\tif(keyframe.symbol.is(MovieSymbol)){\n\t\t\t\tvar childMovie = movie.getChildPlayer(keyframe);\n\t\t\t\tif(childMovie.independantControl == false){\n\t\t\t\t\tchildMovie.setState(state);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\n\tprivate function timeForLabel(label:String):Float{\n\t\treturn symbol.labels[label].keyframe.time;\n\t}\n\n\n\tprivate function getInterpolation(keyframe:Keyframe, time:Float){\n\t\tif(keyframe.tweened == false) return 0.0;\n\t\t\n\t\tvar interped = (time - keyframe.time) / keyframe.duration;\n\t\tvar ease:Float = keyframe.ease;\n\t\tif (ease != 0) {\n\t\t\tvar t :Float;\n\t\t\tif (ease < 0) {\n\t\t\t\t// Ease in\n\t\t\t\tvar inv:Float = 1 - interped;\n\t\t\t\tt = 1 - inv * inv;\n\t\t\t\tease = -ease;\n\t\t\t} else {\n\t\t\t\t// Ease out\n\t\t\t\tt = interped * interped;\n\t\t\t}\n\t\t\tinterped = ease * t + (1 - ease) * interped;\n\t\t}\n\t\treturn interped;\n\t}\n\n\n}\n\n","package flump.json;\n\ntypedef FlumpJSON = {\n\tvar md5:String;\n\tvar movies:Array<MovieSpec>;\n\tvar textureGroups:Array<TextureGroupSpec>;\n\tvar frameRate: UInt;\n}\n\n\nabstract FlumpPointSpec(Array<Float>){\n\n\tpublic var x(get, never):Float;\n\tpublic var y(get, never):Float;\n\n\tinline public function get_x():Float{\n\t\treturn this[0];\n\t}\n\n\tinline public function get_y():Float{\n\t\treturn this[1];\n\t}\n}\n\n\nabstract FlumpRectSpec(Array<Float>){\n\n\tpublic var x(get, never):Float;\n\tpublic var y(get, never):Float;\n\tpublic var width(get, never):Float;\n\tpublic var height(get, never):Float;\n\n\tinline public function get_x():Float{\n\t\treturn this[0];\n\t}\n\n\tinline public function get_y():Float{\n\t\treturn this[1];\n\t}\n\n\tinline public function get_width():Float{\n\t\treturn this[2];\n\t}\n\n\tinline public function get_height():Float{\n\t\treturn this[3];\n\t}\n}\n\ntypedef MovieSpec = {\n\tvar layers:Array<LayerSpec>;\n\tvar id:ReferenceSpec;\n}\n\ntypedef ReferenceSpec = String;\n\ntypedef KeyframeSpec = {\n\tvar pivot:FlumpPointSpec;\n\tvar duration:UInt;\n\tvar loc:FlumpPointSpec;\n\tvar index:UInt;\n\tvar ref:ReferenceSpec;\n\tvar scale:FlumpPointSpec;\n\tvar skew:FlumpPointSpec;\n\tvar ease:Float;\n\tvar tweened:Bool;\n\tvar label:String;\n}\n\n\ntypedef TextureSpec = {\n\tvar symbol:ReferenceSpec;\n\tvar rect:FlumpRectSpec;\n\tvar origin:FlumpPointSpec;\n}\n\n\ntypedef TextureGroupSpec = {\n\tvar atlases:Array<AtlasSpec>;\n\tvar scaleFactor:UInt;\n}\n\n\ntypedef AtlasSpec = {\n\tvar file:String;\n\tvar textures:Array<TextureSpec>;\n}\n\n\ntypedef LayerSpec = {\n\tvar name:String;\n\tvar keyframes:Array<KeyframeSpec>;\n}\n\n\n\n","package flump.library;\n\nimport flump.DisplayObjectKey;\nimport flump.json.FlumpJSON;\nimport flump.library.Label;\nusing Lambda;\n\n\nclass FlumpLibrary{\n\n\tpublic var movies = new Map<String, MovieSymbol>();\n\tpublic var sprites = new Map<String, SpriteSymbol>();\n\tpublic var atlases = new Array<AtlasSpec>();\n\tpublic var framerate:Float;\n\tpublic var frameTime:Float;\n\tpublic var md5:String;\n\n\tfunction new(){}\n\n\n\tpublic static function create(flumpData:Dynamic):FlumpLibrary{\n\t\tvar lib:FlumpJSON = cast flumpData;\n\t\t\n\t\tvar spriteSymbols = new Map<String, SpriteSymbol>();\n\t\tvar movieSymbols = new Map<String, MovieSymbol>();\n\n\t\tvar flumpLibrary = new FlumpLibrary();\n\t\tflumpLibrary.sprites = spriteSymbols;\n\t\tflumpLibrary.movies = movieSymbols;\n\t\tflumpLibrary.framerate = lib.frameRate;\n\t\tflumpLibrary.frameTime = 1000/flumpLibrary.framerate;\t\t\n\t\tflumpLibrary.md5 = lib.md5;\n\n\t\tvar atlasSpecs = new Array<flump.json.FlumpJSON.AtlasSpec>();\n\t\tfor(textureGroup in lib.textureGroups){\n\t\t\tfor(atlas in textureGroup.atlases){\n\t\t\t\tflumpLibrary.atlases.push(atlas);\n\t\t\t\tatlasSpecs.push(atlas);\n\t\t\t}\n\t\t}\n\n\n\t\tfor(spec in atlasSpecs){\t\t\t\n\t\t\tfor(textureSpec in spec.textures){\n\t\t\t\tvar frame = new Rectangle(textureSpec.rect.x, textureSpec.rect.y, textureSpec.rect.width, textureSpec.rect.height);\n\t\t\t\tvar origin = new Point(textureSpec.origin.x, textureSpec.origin.y);\n\t\t\t\torigin.x = origin.x / frame.width;\n\t\t\t\torigin.y = origin.y / frame.height;\n\n\t\t\t\tvar symbol = new SpriteSymbol();\n\t\t\t\tsymbol.name = textureSpec.symbol;\n\t\t\t\tsymbol.origin = origin;\n\t\t\t\tsymbol.texture = textureSpec.symbol;\n\t\t\t\tspriteSymbols[symbol.name] = symbol;\n\t\t\t}\n\t\t}\n\n\t\tvar pendingSymbolAttachments = new Map<Keyframe, String>();\n\t\tfor(movieSpec in lib.movies){\n\t\t\tvar symbol = new MovieSymbol();\n\t\t\tsymbol.name = movieSpec.id;\n\t\t\tsymbol.library = flumpLibrary;\n\t\t\tfor(layerSpec in movieSpec.layers){\n\t\t\t\tvar layer = new Layer(layerSpec.name);\n\t\t\t\tlayer.movie = symbol;\n\t\t\t\tvar layerDuration:Float = 0;\n\t\t\t\tvar previousKeyframe:Keyframe = null;\n\t\t\t\tfor(keyframeSpec in layerSpec.keyframes){\n\t\t\t\t\tvar keyframe = new Keyframe();\n\t\t\t\t\tkeyframe.prev = previousKeyframe;\n\t\t\t\t\tif(previousKeyframe != null) previousKeyframe.next = keyframe;\n\t\t\t\t\tkeyframe.layer = layer;\n\t\t\t\t\tkeyframe.numFrames = keyframeSpec.duration;\n\t\t\t\t\tkeyframe.duration = keyframeSpec.duration * flumpLibrary.frameTime;\n\t\t\t\t\tkeyframe.index = keyframeSpec.index;\n\n\t\t\t\t\tvar time = keyframe.index * flumpLibrary.frameTime;\n\t\t\t\t\ttime *= 10;\n\t\t\t\t\ttime = Math.floor(time);\n\t\t\t\t\ttime /= 10;\n\t\t\t\t\tkeyframe.time = time;\n\t\t\t\t\t\n\t\t\t\t\tif(keyframeSpec.ref == null){\n\t\t\t\t\t\tkeyframe.isEmpty = true;\n\t\t\t\t\t}else{\n\t\t\t\t\t\tkeyframe.isEmpty = false;\n\t\t\t\t\t\tkeyframe.symbolId = keyframeSpec.ref;\n\t\t\t\t\t\tkeyframe.pivot = keyframeSpec.pivot == null ? new Point(0,0) : new Point( keyframeSpec.pivot.x, keyframeSpec.pivot.y );\n\t\t\t\t\t\tkeyframe.location = keyframeSpec.loc == null ? new Point(0,0) : new Point( keyframeSpec.loc.x, keyframeSpec.loc.y );\n\t\t\t\t\t\tkeyframe.tweened = keyframeSpec.tweened == false ? false : true;\n\t\t\t\t\t\tkeyframe.symbol = null;\n\t\t\t\t\t\tkeyframe.scale = keyframeSpec.scale == null ? new Point(1,1) : new Point(keyframeSpec.scale.x, keyframeSpec.scale.y);\n\t\t\t\t\t\tkeyframe.skew = keyframeSpec.skew == null ? new Point(0,0) : new Point(keyframeSpec.skew.x, keyframeSpec.skew.y);\n\t\t\t\t\t\t\n\t\t\t\t\t\tkeyframe.ease = keyframeSpec.ease == null ? 0 : keyframeSpec.ease;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(layer.keyframes.length == 0) layer.firstKeyframe = keyframe;\n\n\t\t\t\t\tif(keyframeSpec.label != null){\n\t\t\t\t\t\tkeyframe.label = new Label();\n\t\t\t\t\t\tkeyframe.label.keyframe = keyframe;\n\t\t\t\t\t\tkeyframe.label.name = keyframeSpec.label;\n\t\t\t\t\t\tsymbol.labels.set(keyframe.label.name, keyframe.label);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif(keyframe.time + keyframe.duration > layer.duration){\n\t\t\t\t\t\tlayerDuration = keyframe.time + keyframe.duration;\n\t\t\t\t\t}\n\n\t\t\t\t\tpendingSymbolAttachments[keyframe] = keyframeSpec.ref;\n\t\t\t\t\tlayer.keyframes.push(keyframe);\n\t\t\t\t\tpreviousKeyframe = keyframe;\n\t\t\t\t}\n\n\t\t\t\tlayer.lastKeyframe = layer.keyframes[layer.keyframes.length - 1];\n\t\t\t\tlayer.keyframes[0].prev = layer.lastKeyframe;\n\t\t\t\tlayer.lastKeyframe.next = layer.keyframes[0];\n\t\t\t\tsymbol.layers.push(layer);\n\n\t\t\t\tvar allAreEmpty = layer.keyframes.foreach(function(keyframe) return keyframe.isEmpty);\n\n\t\t\t\tif(allAreEmpty){\n\t\t\t\t\t\n\t\t\t\t}else{\n\t\t\t\t\tfor(keyframe in layer.keyframes){\n\t\t\t\t\t\tvar hasNonEmptySibling = layer.keyframes.exists(function(checkedKeyframe) return checkedKeyframe.isEmpty == false && checkedKeyframe != keyframe);\n\t\t\t\t\t\tif(hasNonEmptySibling){\n\t\t\t\t\t\t\tvar checked = keyframe.prev;\n\t\t\t\t\t\t\twhile(checked.isEmpty) checked = checked.prev;\n\t\t\t\t\t\t\tkeyframe.prevNonEmptyKeyframe = checked;\n\n\t\t\t\t\t\t\tchecked = keyframe.next;\n\t\t\t\t\t\t\twhile(checked.isEmpty) checked = checked.next;\n\t\t\t\t\t\t\tkeyframe.nextNonEmptyKeyframe = checked;\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tkeyframe.prevNonEmptyKeyframe = keyframe;\n\t\t\t\t\t\t\tkeyframe.nextNonEmptyKeyframe = keyframe;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Set up diplay keys\n\t\t\t\t\tvar firstNonEmpty = layer.keyframes.find(function(checkedKeyframe) return checkedKeyframe.isEmpty == false);\n\t\t\t\t\tif(firstNonEmpty != null) firstNonEmpty.displayKey = new DisplayObjectKey(firstNonEmpty.symbolId);\n\t\t\t\t\tvar checked = firstNonEmpty.nextNonEmptyKeyframe;\n\t\t\t\t\twhile(checked != firstNonEmpty){\n\t\t\t\t\t\tif(checked.symbolId == checked.prevNonEmptyKeyframe.symbolId) checked.displayKey = checked.prevNonEmptyKeyframe.displayKey;\n\t\t\t\t\t\telse checked.displayKey = new DisplayObjectKey(checked.symbolId);\n\t\t\t\t\t\tchecked = checked.nextNonEmptyKeyframe;\n\t\t\t\t\t}\n\t\t\t\t}\t\t\n\t\t\t}\n\n\t\t\tfunction getHighestFrameNumber(layer:Layer, accum:UInt){\n\t\t\t\tvar layerLength = layer.lastKeyframe.index + layer.lastKeyframe.numFrames;\n\t\t\t\treturn layerLength > accum\n\t\t\t\t\t? layerLength\n\t\t\t\t\t: accum;\n\t\t\t}\n\n\t\t\tsymbol.totalFrames = symbol.layers.fold( getHighestFrameNumber, 0 );\n\t\t\tsymbol.duration = symbol.totalFrames * flumpLibrary.frameTime;\n\n\t\t\tvar labels = new Array<Label>();\n\t\t\tfor(layer in symbol.layers){\n\t\t\t\tfor(keyframe in layer.keyframes){\n\t\t\t\t\tif(keyframe.label != null){\n\t\t\t\t\t\tlabels.push(keyframe.label);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\thaxe.ds.ArraySort.sort(labels, sortLabel);\n\t\t\tfor(i in 0...labels.length){\n\t\t\t\tvar nextIndex = i+1;\n\t\t\t\tif(nextIndex >= labels.length) nextIndex = 0;\n\n\t\t\t\tvar label = labels[i];\n\t\t\t\tvar nextLabel = labels[nextIndex];\n\t\t\t\tlabel.next = nextLabel;\n\t\t\t\tnextLabel.prev = label;\n\t\t\t}\n\t\t\tsymbol.firstLabel = labels[0];\n\t\t\tsymbol.lastLabel = labels[labels.length-1];\n\t\t\t\n\t\t\tmovieSymbols[symbol.name] = symbol;\t\t\t\n\t\t}\n\n\t\tfor(keyframe in pendingSymbolAttachments.keys()){\n\t\t\tvar symbolId = pendingSymbolAttachments[keyframe];\n\t\t\tkeyframe.symbol = spriteSymbols[symbolId] != null ? spriteSymbols[symbolId] : movieSymbols[symbolId];\n\t\t}\n\n\t\treturn flumpLibrary;\n\t}\n\n\n\tprivate static function sortLabel(a:Label, b:Label):Int{\n\t\tif(a.keyframe.index < b.keyframe.index) return -1;\n\t\telse if(a.keyframe.index > b.keyframe.index) return 1;\n\t\treturn 0;\n\t}\n\n\n\n}","package flump.library;\n\n\nclass Keyframe{\n\n\tpublic var layer:Layer;\n\tpublic var symbolId:String;\n\tpublic var pivot:Point;\n\t\n\tpublic var location:Point;\n\tpublic var tweened:Bool;\n\n\tpublic var index:UInt;\n\tpublic var numFrames:UInt;\n\n\tpublic var time:Float;\n\tpublic var duration:Float;\n\t\n\tpublic var symbol:Symbol;\n\tpublic var scale:Point;\n\tpublic var skew:Point;\n\tpublic var ease:Float;\n\tpublic var label:Label;\n\tpublic var isEmpty:Bool;\n\n\tpublic var next:Keyframe;\n\tpublic var prev:Keyframe;\n\tpublic var nextNonEmptyKeyframe:Keyframe;\n\tpublic var prevNonEmptyKeyframe:Keyframe;\n\tpublic var displayKey:DisplayObjectKey;\n\n\tpublic function new(){}\n\n\t// Does the time fall inside of the the keyframe frames\n\tpublic function timeInside(time:Float):Bool{\n\t\treturn (this.time <= time) && (this.time + duration) > time;\n\t}\n\n\t// Does the range fit inside of the keyframe frames\n\tpublic function rangeInside(from:Float, to:Float):Bool{\n\t\treturn timeInside(from) && timeInside(to);\n\t}\n\n\t// Does the range intersect with the keyframe frames\n\tpublic function rangeIntersect(from:Float, to:Float):Bool{\n\t\treturn timeInside(from) || timeInside(to);\n\t}\n\n\t// Does the start of the keyframe frames fall inside the range. (Checks for a range that wraps around)\n\tpublic function insideRangeStart(from:Float, to:Float):Bool{\n\t\tif(from == to && to == time) return true;\n\t\treturn from <= to \n\t\t\t? time > from && time <= to\n\t\t\t: time > from || time <= to;\n\t}\n\n\t// Does the end of the keyframe frames fall inside the range. (Checks for a range that wraps around, and assuming backward playback);\n\tpublic function insideRangeEnd(from:Float, to:Float):Bool{\n\t\tif(from == to && to == time + duration) return true;\n\t\treturn from > to\n\t\t\t? to <= time + duration && from > time + duration\n\t\t\t: to <= time + duration || from > time + duration;\n\t}\n\n}\n\n","package flump.library;\n\nclass Label{\n\n\tpublic var name:String;\n\tpublic var keyframe:Keyframe;\n\tpublic var next:Label;\n\tpublic var prev:Label;\n\n\tpublic static var LABEL_ENTER:String = \"labelEnter\";\n\tpublic static var LABEL_EXIT:String = \"labelExit\";\n\tpublic static var LABEL_UPDATE:String = \"labelUpdate\";\n\n\tpublic function new(){}\n\n}","package flump.library;\n\nclass Layer{\n\n\tpublic var keyframes = new Array<Keyframe>();\n\tpublic var duration:Float;\n\tpublic var name:String;\n\tpublic var movie:MovieSymbol;\n\tpublic var numFrames:UInt;\n\n\tpublic var firstKeyframe:Keyframe;\n\tpublic var lastKeyframe:Keyframe;\n\n\n\tpublic function new(name:String){\n\t\tthis.name = name;\n\t}\n\n\n\tpublic function getKeyframeForFrame(index:UInt):Keyframe{\n\t\tfor(keyframe in keyframes) if(keyframe.index == index) return keyframe;\n\t\treturn null;\n\t}\n\n\n\tpublic function getKeyframeForTime(time:Float){\n\t\tvar keyframe = lastKeyframe;\n\t\twhile(keyframe.time > time % movie.duration) keyframe = keyframe.prev;\n\t\treturn keyframe;\n\t}\n\n}","package flump.library;\n\n\nclass Symbol{\n\n\tpublic var name:String;\n\tpublic var origin:Point;\n\t\n\tpublic function new(){}\n\n}","package flump.library;\n\nimport flump.library.FlumpLibrary;\n\n\nclass MovieSymbol extends Symbol{\n\n\tpublic var layers = new Array<Layer>();\n\tpublic var labels = new Map<String, Label>();\n\tpublic var library:FlumpLibrary;\n\n\tpublic var duration:Float;\n\tpublic var totalFrames:UInt;\n\tpublic var firstLabel:Label;\n\tpublic var lastLabel:Label;\n\n\n\tpublic function new(){\n\t\tsuper();\n\t}\n\n\n\tpublic function getLayer(name:String):Layer{\n\t\tfor(layer in layers) if(layer.name == name) return layer;\n\t\treturn null;\n\t}\n\n\n\tpublic function debug(){\n\t\tvar largestLayerChars = Lambda.fold(layers, function(layer, result) return layer.name.length > result ? layer.name.length : result, 0);\n\n\t\tfunction repeat(character, amount){\n\t\t\tvar output = \"\";\n\t\t\twhile(amount > 0){\n\t\t\t\toutput += character;\n\t\t\t\tamount--;\n\t\t\t}\n\t\t\treturn output;\n\t\t}\n\n\t\t//◙◉◉◉◙◙○◌◌◌◙▸▸▸◙○◌◌\n\t\tvar output = \"asdfsadf\\n\";\n\n\t\toutput += repeat(\" \", largestLayerChars);\t\n\t\toutput += \"   \";\n\t\tfor(i in 0...totalFrames){\n\t\t\tif(i%5 == 0) output += i;\n\t\t\telse{\n\t\t\t\tif(i % 6 != 0 || i < 10) output += \" \";\n\t\t\t}\n\t\t}\n\t\toutput += \"\\n\";\n\n\t\toutput += repeat(\" \", largestLayerChars);\t\n\t\toutput += \"   \";\n\t\tfor(i in 0...totalFrames){\n\t\t\tif(i%5 == 0) output += \"▽\";\n\t\t\telse output += \" \";\n\t\t}\n\t\toutput += \"\\n\";\n\n\n\t\tfor(i in 0...layers.length){\n\t\t\tvar layer = layers[i];\n\n\t\t\toutput += layer.name + repeat(\" \", largestLayerChars-layer.name.length); \n\t\t\toutput += \" : \";\n\t\t\tfor(keyframe in layer.keyframes){\n\t\t\t\tif(keyframe.symbolId != null){\n\t\t\t\t\toutput += \"◙\";\n\t\t\t\t\tif(keyframe.tweened) output += repeat(\"▸\", keyframe.numFrames-1);\n\t\t\t\t\telse output += repeat(\"◉\", keyframe.numFrames-1) ;\n\t\t\t\t}else{\n\t\t\t\t\toutput += \"○\";\n\t\t\t\t\toutput += repeat(\"◌\", keyframe.numFrames-1);\n\t\t\t\t}\n\t\t\t}\n\t\t\toutput += '\\n';\n\t\t}\n\n\t\treturn output;\n\n\t}\n\n}","package flump.library;\n\nclass Point{\n\n\tpublic var x:Float;\n\tpublic var y:Float;\n\n\n\tpublic function new(x:Float, y:Float){\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t}\n\n}","package flump.library;\n\nclass Rectangle{\n\n\tpublic var x:Float;\n\tpublic var y:Float;\n\tpublic var width:Float;\n\tpublic var height:Float;\n\n\n\tpublic function new(x:Float, y:Float, width:Float, height:Float){\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t}\n\n}","package flump.library;\n\nclass SpriteSymbol extends Symbol{\n\n\tpublic var texture:String;\n\n\n\tpublic function new(){\n\t\tsuper();\n\t}\n\n}","/*\n * Copyright (C)2005-2013 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe;\n\n#if sys\n\nimport sys.net.Host;\nimport sys.net.Socket;\n\nprivate typedef AbstractSocket = {\n\tvar input(default,null) : haxe.io.Input;\n\tvar output(default,null) : haxe.io.Output;\n\tfunction connect( host : Host, port : Int ) : Void;\n\tfunction setTimeout( t : Float ) : Void;\n\tfunction write( str : String ) : Void;\n\tfunction close() : Void;\n\tfunction shutdown( read : Bool, write : Bool ) : Void;\n}\n\n#end\n\n/**\n\tThis class can be used to handle Http requests consistently across\n\tplatforms. There are two intended usages:\n\n\t- call haxe.Http.requestUrl(url) and receive the result as a String (not\n\tavailable on flash)\n\t- create a new haxe.Http(url), register your callbacks for onData, onError\n\tand onStatus, then call request().\n**/\nclass Http {\n\n\t/**\n\t\tThe url of `this` request. It is used only by the request() method and\n\t\tcan be changed in order to send the same request to different target\n\t\tUrls.\n\t**/\n\tpublic var url : String;\n\tpublic var responseData(default, null) : Null<String>;\n#if sys\n\tpublic var noShutdown : Bool;\n\tpublic var cnxTimeout : Float;\n\tpublic var responseHeaders : Map<String,String>;\n\tvar chunk_size : Null<Int>;\n\tvar chunk_buf : haxe.io.Bytes;\n\tvar file : { param : String, filename : String, io : haxe.io.Input, size : Int, mimeType : String };\n#elseif js\n\tpublic var async : Bool;\n#end\n\tvar postData : String;\n\tvar headers : List<{ header:String, value:String }>;\n\tvar params : List<{ param:String, value:String }>;\n\n\t#if sys\n\tpublic static var PROXY : { host : String, port : Int, auth : { user : String, pass : String } } = null;\n\t#end\n\n\t/**\n\t\tCreates a new Http instance with `url` as parameter.\n\n\t\tThis does not do a request until request() is called.\n\n\t\tIf `url` is null, the field url must be set to a value before making the\n\t\tcall to request(), or the result is unspecified.\n\n\t\t(Php) Https (SSL) connections are allowed only if the OpenSSL extension\n\t\tis enabled.\n\t**/\n\tpublic function new( url : String ) {\n\t\tthis.url = url;\n\t\theaders = new List<{ header:String, value:String }>();\n\t\tparams = new List<{ param:String, value:String }>();\n\n\t\t#if js\n\t\tasync = true;\n\t\t#elseif sys\n\t\tcnxTimeout = 10;\n\t\t#end\n\t\t#if php\n\t\tnoShutdown = ! untyped __call__('function_exists', 'stream_socket_shutdown');\n\t\t#end\n\t}\n\n\t/**\n\t\tSets the header identified as `header` to value `value`.\n\n\t\tIf `header` or `value` are null, the result is unspecified.\n\n\t\tThis method provides a fluent interface.\n\t**/\n\tpublic function setHeader( header : String, value : String ):Http {\n\t\theaders = Lambda.filter(headers, function(h) return h.header != header);\n\t\theaders.push({ header:header, value:value });\n\t\treturn this;\n\t}\n\n\tpublic function addHeader( header : String, value : String ):Http {\n\t\theaders.push({ header:header, value:value });\n\t\treturn this;\n\t}\n\n\t/**\n\t\tSets the parameter identified as `param` to value `value`.\n\n\t\tIf `header` or `value` are null, the result is unspecified.\n\n\t\tThis method provides a fluent interface.\n\t**/\n\tpublic function setParameter( param : String, value : String ):Http {\n\t\tparams = Lambda.filter(params, function(p) return p.param != param);\n\t\tparams.push({ param:param, value:value });\n\t\treturn this;\n\t}\n\n\tpublic function addParameter( param : String, value : String ):Http {\n\t\tparams.push({ param:param, value:value });\n\t\treturn this;\n\t}\n\n\t/**\n\t\tSets the post data of `this` Http request to `data`.\n\n\t\tThere can only be one post data per request. Subsequent calls overwrite\n\t\tthe previously set value.\n\n\t\tIf `data` is null, the post data is considered to be absent.\n\n\t\tThis method provides a fluent interface.\n\t**/\n\tpublic function setPostData( data : String ):Http {\n\t\tpostData = data;\n\t\treturn this;\n\t}\n\n\t#if (js || flash)\n\n\t#if js\n\tvar req:js.html.XMLHttpRequest;\n\t#elseif flash\n\tvar req:flash.net.URLLoader;\n\t#end\n\n\t/**\n\t\tCancels `this` Http request if `request` has been called and a response\n\t\thas not yet been received.\n\t**/\n\tpublic function cancel()\n\t{\n\t\tif (req == null) return;\n\t\t#if js\n\t\treq.abort();\n\t\t#elseif flash\n\t\treq.close();\n\t\t#end\n\t\treq = null;\n\t}\n\t#end\n\n\t/**\n\t\tSends `this` Http request to the Url specified by `this.url`.\n\n\t\tIf `post` is true, the request is sent as POST request, otherwise it is\n\t\tsent as GET request.\n\n\t\tDepending on the outcome of the request, this method calls the\n\t\tonStatus(), onError() or onData() callback functions.\n\n\t\tIf `this.url` is null, the result is unspecified.\n\n\t\tIf `this.url` is an invalid or inaccessible Url, the onError() callback\n\t\tfunction is called.\n\n\t\t(Js) If `this.async` is false, the callback functions are called before\n\t\tthis method returns.\n\t**/\n\tpublic function request( ?post : Bool ) : Void {\n\t\tvar me = this;\n\t#if js\n\t\tme.responseData = null;\n\t\tvar r = req = js.Browser.createXMLHttpRequest();\n\t\tvar onreadystatechange = function(_) {\n\t\t\tif( r.readyState != 4 )\n\t\t\t\treturn;\n\t\t\tvar s = try r.status catch( e : Dynamic ) null;\n\t\t\tif ( s != null ) {\n\t\t\t\t// If the request is local and we have data: assume a success (jQuery approach):\n\t\t\t\tvar protocol = js.Browser.location.protocol.toLowerCase();\n\t\t\t\tvar rlocalProtocol = ~/^(?:about|app|app-storage|.+-extension|file|res|widget):$/;\n\t\t\t\tvar isLocal = rlocalProtocol.match( protocol );\n\t\t\t\tif ( isLocal ) {\n\t\t\t\t\ts = r.responseText != null ? 200 : 404;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif( s == untyped __js__(\"undefined\") )\n\t\t\t\ts = null;\n\t\t\tif( s != null )\n\t\t\t\tme.onStatus(s);\n\t\t\tif( s != null && s >= 200 && s < 400 ) {\n\t\t\t\tme.req = null;\n\t\t\t\tme.onData(me.responseData = r.responseText);\n\t\t\t}\n\t\t\telse if ( s == null ) {\n\t\t\t\tme.req = null;\n\t\t\t\tme.onError(\"Failed to connect or resolve host\");\n\t\t\t}\n\t\t\telse switch( s ) {\n\t\t\tcase 12029:\n\t\t\t\tme.req = null;\n\t\t\t\tme.onError(\"Failed to connect to host\");\n\t\t\tcase 12007:\n\t\t\t\tme.req = null;\n\t\t\t\tme.onError(\"Unknown host\");\n\t\t\tdefault:\n\t\t\t\tme.req = null;\n\t\t\t\tme.responseData = r.responseText;\n\t\t\t\tme.onError(\"Http Error #\"+r.status);\n\t\t\t}\n\t\t};\n\t\tif( async )\n\t\t\tr.onreadystatechange = onreadystatechange;\n\t\tvar uri = postData;\n\t\tif( uri != null )\n\t\t\tpost = true;\n\t\telse for( p in params ) {\n\t\t\tif( uri == null )\n\t\t\t\turi = \"\";\n\t\t\telse\n\t\t\t\turi += \"&\";\n\t\t\turi += StringTools.urlEncode(p.param)+\"=\"+StringTools.urlEncode(p.value);\n\t\t}\n\t\ttry {\n\t\t\tif( post )\n\t\t\t\tr.open(\"POST\",url,async);\n\t\t\telse if( uri != null ) {\n\t\t\t\tvar question = url.split(\"?\").length <= 1;\n\t\t\t\tr.open(\"GET\",url+(if( question ) \"?\" else \"&\")+uri,async);\n\t\t\t\turi = null;\n\t\t\t} else\n\t\t\t\tr.open(\"GET\",url,async);\n\t\t} catch( e : Dynamic ) {\n\t\t\tme.req = null;\n\t\t\tonError(e.toString());\n\t\t\treturn;\n\t\t}\n\t\tif( !Lambda.exists(headers, function(h) return h.header == \"Content-Type\") && post && postData == null )\n\t\t\tr.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded\");\n\n\t\tfor( h in headers )\n\t\t\tr.setRequestHeader(h.header,h.value);\n\t\tr.send(uri);\n\t\tif( !async )\n\t\t\tonreadystatechange(null);\n\t#elseif flash\n\t\tme.responseData = null;\n\t\tvar loader = req = new flash.net.URLLoader();\n\t\tloader.addEventListener( \"complete\", function(e) {\n\t\t\tme.req = null;\n\t\t\tme.responseData = loader.data;\n\t\t\tme.onData( loader.data );\n\t\t});\n\t\tloader.addEventListener( \"httpStatus\", function(e:flash.events.HTTPStatusEvent){\n\t\t\t// on Firefox 1.5, Flash calls onHTTPStatus with 0 (!??)\n\t\t\tif( e.status != 0 )\n\t\t\t\tme.onStatus( e.status );\n\t\t});\n\t\tloader.addEventListener( \"ioError\", function(e:flash.events.IOErrorEvent){\n\t\t\tme.req = null;\n\t\t\tme.responseData = loader.data;\n\t\t\tme.onError(e.text);\n\t\t});\n\t\tloader.addEventListener( \"securityError\", function(e:flash.events.SecurityErrorEvent){\n\t\t\tme.req = null;\n\t\t\tme.onError(e.text);\n\t\t});\n\n\t\t// headers\n\t\tvar param = false;\n\t\tvar vars = new flash.net.URLVariables();\n\t\tfor( p in params ){\n\t\t\tparam = true;\n\t\t\tReflect.setField(vars,p.param,p.value);\n\t\t}\n\t\tvar small_url = url;\n\t\tif( param && !post ){\n\t\t\tvar k = url.split(\"?\");\n\t\t\tif( k.length > 1 ) {\n\t\t\t\tsmall_url = k.shift();\n\t\t\t\tvars.decode(k.join(\"?\"));\n\t\t\t}\n\t\t}\n\t\t// Bug in flash player 9 ???\n\t\tvar bug = small_url.split(\"xxx\");\n\n\t\tvar request = new flash.net.URLRequest( small_url );\n\t\tfor( h in headers )\n\t\t\trequest.requestHeaders.push( new flash.net.URLRequestHeader(h.header,h.value) );\n\n\t\tif( postData != null ) {\n\t\t\trequest.data = postData;\n\t\t\trequest.method = \"POST\";\n\t\t} else {\n\t\t\trequest.data = vars;\n\t\t\trequest.method = if( post ) \"POST\" else \"GET\";\n\t\t}\n\n\t\ttry {\n\t\t\tloader.load( request );\n\t\t}catch( e : Dynamic ){\n\t\t\tme.req = null;\n\t\t\tonError(\"Exception: \"+Std.string(e));\n\t\t}\n\t#elseif sys\n\t\tvar me = this;\n\t\tvar output = new haxe.io.BytesOutput();\n\t\tvar old = onError;\n\t\tvar err = false;\n\t\tonError = function(e) {\n\t\t\t#if neko\n\t\t\tme.responseData = neko.Lib.stringReference(output.getBytes());\n\t\t\t#else\n\t\t\tme.responseData = output.getBytes().toString();\n\t\t\t#end\n\t\t\terr = true;\n\t\t\t// Resetting back onError before calling it allows for a second \"retry\" request to be sent without onError being wrapped twice\n\t\t\tonError = old;\n\t\t\tonError(e);\n\t\t}\n\t\tcustomRequest(post,output);\n\t\tif( !err )\n\t\t#if neko\n\t\t\tme.onData(me.responseData = neko.Lib.stringReference(output.getBytes()));\n\t\t#else\n\t\t\tme.onData(me.responseData = output.getBytes().toString());\n\t\t#end\n\t#end\n\t}\n\n#if sys\n\n\t/**\n      Note: Deprecated in 4.0\n\t **/\n\t@:noCompletion\n\tinline public function fileTransfert( argname : String, filename : String, file : haxe.io.Input, size : Int, mimeType = \"application/octet-stream\" ) {\n\t    fileTransfer(argname, filename, file, size, mimeType);\n    }\n\n\tpublic function fileTransfer( argname : String, filename : String, file : haxe.io.Input, size : Int, mimeType = \"application/octet-stream\" ) {\n\t\tthis.file = { param : argname, filename : filename, io : file, size : size, mimeType : mimeType };\n\t}\n\n\tpublic function customRequest( post : Bool, api : haxe.io.Output, ?sock : AbstractSocket, ?method : String  ) {\n\t\tthis.responseData = null;\n\t\tvar url_regexp = ~/^(https?:\\/\\/)?([a-zA-Z\\.0-9_-]+)(:[0-9]+)?(.*)$/;\n\t\tif( !url_regexp.match(url) ) {\n\t\t\tonError(\"Invalid URL\");\n\t\t\treturn;\n\t\t}\n\t\tvar secure = (url_regexp.matched(1) == \"https://\");\n\t\tif( sock == null ) {\n\t\t\tif( secure ) {\n\t\t\t\t#if php\n\t\t\t\tsock = new php.net.SslSocket();\n\t\t\t\t#elseif java\n\t\t\t\tsock = new java.net.SslSocket();\n\t\t\t\t#elseif hxssl\n\t\t\t\t#if neko\n\t\t\t\tsock = new neko.tls.Socket();\n\t\t\t\t#else\n\t\t\t\tsock = new sys.ssl.Socket();\n\t\t\t\t#end\n\t\t\t\t#else\n\t\t\t\tthrow \"Https is only supported with -lib hxssl\";\n\t\t\t\t#end\n\t\t\t} else\n\t\t\t\tsock = new Socket();\n\t\t}\n\t\tvar host = url_regexp.matched(2);\n\t\tvar portString = url_regexp.matched(3);\n\t\tvar request = url_regexp.matched(4);\n\t\tif( request == \"\" )\n\t\t\trequest = \"/\";\n\t\tvar port = if ( portString == null || portString == \"\" ) secure ? 443 : 80 else Std.parseInt(portString.substr(1, portString.length - 1));\n\t\tvar data;\n\n\t\tvar multipart = (file != null);\n\t\tvar boundary = null;\n\t\tvar uri = null;\n\t\tif( multipart ) {\n\t\t\tpost = true;\n\t\t\tboundary = Std.string(Std.random(1000))+Std.string(Std.random(1000))+Std.string(Std.random(1000))+Std.string(Std.random(1000));\n\t\t\twhile( boundary.length < 38 )\n\t\t\t\tboundary = \"-\" + boundary;\n\t\t\tvar b = new StringBuf();\n\t\t\tfor( p in params ) {\n\t\t\t\tb.add(\"--\");\n\t\t\t\tb.add(boundary);\n\t\t\t\tb.add(\"\\r\\n\");\n\t\t\t\tb.add('Content-Disposition: form-data; name=\"');\n\t\t\t\tb.add(p.param);\n\t\t\t\tb.add('\"');\n\t\t\t\tb.add(\"\\r\\n\");\n\t\t\t\tb.add(\"\\r\\n\");\n\t\t\t\tb.add(p.value);\n\t\t\t\tb.add(\"\\r\\n\");\n\t\t\t}\n\t\t\tb.add(\"--\");\n\t\t\tb.add(boundary);\n\t\t\tb.add(\"\\r\\n\");\n\t\t\tb.add('Content-Disposition: form-data; name=\"');\n\t\t\tb.add(file.param);\n\t\t\tb.add('\"; filename=\"');\n\t\t\tb.add(file.filename);\n\t\t\tb.add('\"');\n\t\t\tb.add(\"\\r\\n\");\n\t\t\tb.add(\"Content-Type: \"+file.mimeType+\"\\r\\n\"+\"\\r\\n\");\n\t\t\turi = b.toString();\n\t\t} else {\n\t\t\tfor( p in params ) {\n\t\t\t\tif( uri == null )\n\t\t\t\t\turi = \"\";\n\t\t\t\telse\n\t\t\t\t\turi += \"&\";\n\t\t\t\turi += StringTools.urlEncode(p.param)+\"=\"+StringTools.urlEncode(p.value);\n\t\t\t}\n\t\t}\n\n\t\tvar b = new StringBuf();\n\t\tif( method != null ) {\n\t\t\tb.add(method);\n\t\t\tb.add(\" \");\n\t\t} else if( post )\n\t\t\tb.add(\"POST \");\n\t\telse\n\t\t\tb.add(\"GET \");\n\n\t\tif( Http.PROXY != null ) {\n\t\t\tb.add(\"http://\");\n\t\t\tb.add(host);\n\t\t\tif( port != 80 ) {\n\t\t\t\tb.add(\":\");\n\t\t\t\tb.add(port);\n\t\t\t}\n\t\t}\n\t\tb.add(request);\n\n\t\tif( !post && uri != null ) {\n\t\t\tif( request.indexOf(\"?\",0) >= 0 )\n\t\t\t\tb.add(\"&\");\n\t\t\telse\n\t\t\t\tb.add(\"?\");\n\t\t\tb.add(uri);\n\t\t}\n\t\tb.add(\" HTTP/1.1\\r\\nHost: \"+host+\"\\r\\n\");\n\t\tif( postData != null )\n\t\t\tb.add(\"Content-Length: \"+postData.length+\"\\r\\n\");\n\t\telse if( post && uri != null ) {\n\t\t\tif( multipart || !Lambda.exists(headers, function(h) return h.header == \"Content-Type\") ) {\n\t\t\t\tb.add(\"Content-Type: \");\n\t\t\t\tif( multipart ) {\n\t\t\t\t\tb.add(\"multipart/form-data\");\n\t\t\t\t\tb.add(\"; boundary=\");\n\t\t\t\t\tb.add(boundary);\n\t\t\t\t} else\n\t\t\t\t\tb.add(\"application/x-www-form-urlencoded\");\n\t\t\t\tb.add(\"\\r\\n\");\n\t\t\t}\n\t\t\tif( multipart )\n\t\t\t\tb.add(\"Content-Length: \"+(uri.length+file.size+boundary.length+6)+\"\\r\\n\");\n\t\t\telse\n\t\t\t\tb.add(\"Content-Length: \"+uri.length+\"\\r\\n\");\n\t\t}\n\t\tfor( h in headers ) {\n\t\t\tb.add(h.header);\n\t\t\tb.add(\": \");\n\t\t\tb.add(h.value);\n\t\t\tb.add(\"\\r\\n\");\n\t\t}\n\t\tb.add(\"\\r\\n\");\n\t\tif( postData != null)\n\t\t\tb.add(postData);\n\t\telse if( post && uri != null )\n\t\t\tb.add(uri);\n\t\ttry {\n\t\t\tif( Http.PROXY != null )\n\t\t\t\tsock.connect(new Host(Http.PROXY.host),Http.PROXY.port);\n\t\t\telse\n\t\t\t\tsock.connect(new Host(host),port);\n\t\t\tsock.write(b.toString());\n\t\t\tif( multipart ) {\n\t\t\t\tvar bufsize = 4096;\n\t\t\t\tvar buf = haxe.io.Bytes.alloc(bufsize);\n\t\t\t\twhile( file.size > 0 ) {\n\t\t\t\t\tvar size = if( file.size > bufsize ) bufsize else file.size;\n\t\t\t\t\tvar len = 0;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlen = file.io.readBytes(buf,0,size);\n\t\t\t\t\t} catch( e : haxe.io.Eof ) break;\n\t\t\t\t\tsock.output.writeFullBytes(buf,0,len);\n\t\t\t\t\tfile.size -= len;\n\t\t\t\t}\n\t\t\t\tsock.write(\"\\r\\n\");\n\t\t\t\tsock.write(\"--\");\n\t\t\t\tsock.write(boundary);\n\t\t\t\tsock.write(\"--\");\n\t\t\t}\n\t\t\treadHttpResponse(api,sock);\n\t\t\tsock.close();\n\t\t} catch( e : Dynamic ) {\n\t\t\ttry sock.close() catch( e : Dynamic ) { };\n\t\t\tonError(Std.string(e));\n\t\t}\n\t}\n\n\tfunction readHttpResponse( api : haxe.io.Output, sock : AbstractSocket ) {\n\t\t// READ the HTTP header (until \\r\\n\\r\\n)\n\t\tvar b = new haxe.io.BytesBuffer();\n\t\tvar k = 4;\n\t\tvar s = haxe.io.Bytes.alloc(4);\n\t\tsock.setTimeout(cnxTimeout);\n\t\twhile( true ) {\n\t\t\tvar p = sock.input.readBytes(s,0,k);\n\t\t\twhile( p != k )\n\t\t\t\tp += sock.input.readBytes(s,p,k - p);\n\t\t\tb.addBytes(s,0,k);\n\t\t\tswitch( k ) {\n\t\t\tcase 1:\n\t\t\t\tvar c = s.get(0);\n\t\t\t\tif( c == 10 )\n\t\t\t\t\tbreak;\n\t\t\t\tif( c == 13 )\n\t\t\t\t\tk = 3;\n\t\t\t\telse\n\t\t\t\t\tk = 4;\n\t\t\tcase 2:\n\t\t\t\tvar c = s.get(1);\n\t\t\t\tif( c == 10 ) {\n\t\t\t\t\tif( s.get(0) == 13 )\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tk = 4;\n\t\t\t\t} else if( c == 13 )\n\t\t\t\t\tk = 3;\n\t\t\t\telse\n\t\t\t\t\tk = 4;\n\t\t\tcase 3:\n\t\t\t\tvar c = s.get(2);\n\t\t\t\tif( c == 10 ) {\n\t\t\t\t\tif( s.get(1) != 13 )\n\t\t\t\t\t\tk = 4;\n\t\t\t\t\telse if( s.get(0) != 10 )\n\t\t\t\t\t\tk = 2;\n\t\t\t\t\telse\n\t\t\t\t\t\tbreak;\n\t\t\t\t} else if( c == 13 ) {\n\t\t\t\t\tif( s.get(1) != 10 || s.get(0) != 13 )\n\t\t\t\t\t\tk = 1;\n\t\t\t\t\telse\n\t\t\t\t\t\tk = 3;\n\t\t\t\t} else\n\t\t\t\t\tk = 4;\n\t\t\tcase 4:\n\t\t\t\tvar c = s.get(3);\n\t\t\t\tif( c == 10 ) {\n\t\t\t\t\tif( s.get(2) != 13 )\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\telse if( s.get(1) != 10 || s.get(0) != 13 )\n\t\t\t\t\t\tk = 2;\n\t\t\t\t\telse\n\t\t\t\t\t\tbreak;\n\t\t\t\t} else if( c == 13 ) {\n\t\t\t\t\tif( s.get(2) != 10 || s.get(1) != 13 )\n\t\t\t\t\t\tk = 3;\n\t\t\t\t\telse\n\t\t\t\t\t\tk = 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t#if neko\n\t\tvar headers = neko.Lib.stringReference(b.getBytes()).split(\"\\r\\n\");\n\t\t#else\n\t\tvar headers = b.getBytes().toString().split(\"\\r\\n\");\n\t\t#end\n\t\tvar response = headers.shift();\n\t\tvar rp = response.split(\" \");\n\t\tvar status = Std.parseInt(rp[1]);\n\t\tif( status == 0 || status == null )\n\t\t\tthrow \"Response status error\";\n\n\t\t// remove the two lasts \\r\\n\\r\\n\n\t\theaders.pop();\n\t\theaders.pop();\n\t\tresponseHeaders = new haxe.ds.StringMap();\n\t\tvar size = null;\n\t\tvar chunked = false;\n\t\tfor( hline in headers ) {\n\t\t\tvar a = hline.split(\": \");\n\t\t\tvar hname = a.shift();\n\t\t\tvar hval = if( a.length == 1 ) a[0] else a.join(\": \");\n\t\t\thval = StringTools.ltrim( StringTools.rtrim( hval ) );\n\t\t\tresponseHeaders.set(hname, hval);\n\t\t\tswitch(hname.toLowerCase())\n\t\t\t{\n\t\t\t\tcase \"content-length\":\n\t\t\t\t\tsize = Std.parseInt(hval);\n\t\t\t\tcase \"transfer-encoding\":\n\t\t\t\t\tchunked = (hval.toLowerCase() == \"chunked\");\n\t\t\t}\n\t\t}\n\n\t\tonStatus(status);\n\n\t\tvar chunk_re = ~/^([0-9A-Fa-f]+)[ ]*\\r\\n/m;\n\t\tchunk_size = null;\n\t\tchunk_buf = null;\n\n\t\tvar bufsize = 1024;\n\t\tvar buf = haxe.io.Bytes.alloc(bufsize);\n\t\tif( size == null ) {\n\t\t\tif( !noShutdown )\n\t\t\t\tsock.shutdown(false,true);\n\t\t\ttry {\n\t\t\t\twhile( true ) {\n\t\t\t\t\tvar len = sock.input.readBytes(buf,0,bufsize);\n\t\t\t\t\tif( chunked ) {\n\t\t\t\t\t\tif( !readChunk(chunk_re,api,buf,len) )\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else\n\t\t\t\t\t\tapi.writeBytes(buf,0,len);\n\t\t\t\t}\n\t\t\t} catch( e : haxe.io.Eof ) {\n\t\t\t}\n\t\t} else {\n\t\t\tapi.prepare(size);\n\t\t\ttry {\n\t\t\t\twhile( size > 0 ) {\n\t\t\t\t\tvar len = sock.input.readBytes(buf,0,if( size > bufsize ) bufsize else size);\n\t\t\t\t\tif( chunked ) {\n\t\t\t\t\t\tif( !readChunk(chunk_re,api,buf,len) )\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else\n\t\t\t\t\t\tapi.writeBytes(buf,0,len);\n\t\t\t\t\tsize -= len;\n\t\t\t\t}\n\t\t\t} catch( e : haxe.io.Eof ) {\n\t\t\t\tthrow \"Transfer aborted\";\n\t\t\t}\n\t\t}\n\t\tif( chunked && (chunk_size != null || chunk_buf != null) )\n\t\t\tthrow \"Invalid chunk\";\n\t\tif( status < 200 || status >= 400 )\n\t\t\tthrow \"Http Error #\"+status;\n\t\tapi.close();\n\t}\n\n\tfunction readChunk(chunk_re : EReg, api : haxe.io.Output, buf : haxe.io.Bytes, len ) {\n\t\tif( chunk_size == null ) {\n\t\t\tif( chunk_buf != null ) {\n\t\t\t\tvar b = new haxe.io.BytesBuffer();\n\t\t\t\tb.add(chunk_buf);\n\t\t\t\tb.addBytes(buf,0,len);\n\t\t\t\tbuf = b.getBytes();\n\t\t\t\tlen += chunk_buf.length;\n\t\t\t\tchunk_buf = null;\n\t\t\t}\n\t\t\t#if neko\n\t\t\tif( chunk_re.match(neko.Lib.stringReference(buf)) ) {\n\t\t\t#else\n\t\t\tif( chunk_re.match(buf.toString()) ) {\n\t\t\t#end\n\t\t\t\tvar p = chunk_re.matchedPos();\n\t\t\t\tif( p.len <= len ) {\n\t\t\t\t\tvar cstr = chunk_re.matched(1);\n\t\t\t\t\tchunk_size = Std.parseInt(\"0x\"+cstr);\n\t\t\t\t\tif( cstr == \"0\" ) {\n\t\t\t\t\t\tchunk_size = null;\n\t\t\t\t\t\tchunk_buf = null;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tlen -= p.len;\n\t\t\t\t\treturn readChunk(chunk_re,api,buf.sub(p.len,len),len);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// prevent buffer accumulation\n\t\t\tif( len > 10 ) {\n\t\t\t\tonError(\"Invalid chunk\");\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tchunk_buf = buf.sub(0,len);\n\t\t\treturn true;\n\t\t}\n\t\tif( chunk_size > len ) {\n\t\t\tchunk_size -= len;\n\t\t\tapi.writeBytes(buf,0,len);\n\t\t\treturn true;\n\t\t}\n\t\tvar end = chunk_size + 2;\n\t\tif( len >= end ) {\n\t\t\tif( chunk_size > 0 )\n\t\t\t\tapi.writeBytes(buf,0,chunk_size);\n\t\t\tlen -= end;\n\t\t\tchunk_size = null;\n\t\t\tif( len == 0 )\n\t\t\t\treturn true;\n\t\t\treturn readChunk(chunk_re,api,buf.sub(end,len),len);\n\t\t}\n\t\tif( chunk_size > 0 )\n\t\t\tapi.writeBytes(buf,0,chunk_size);\n\t\tchunk_size -= len;\n\t\treturn true;\n\t}\n\n#end\n\n\t/**\n\t\tThis method is called upon a successful request, with `data` containing\n\t\tthe result String.\n\n\t\tThe intended usage is to bind it to a custom function:\n\t\t`httpInstance.onData = function(data) { // handle result }`\n\t**/\n\tpublic dynamic function onData( data : String ) {\n\t}\n\n\t/**\n\t\tThis method is called upon a request error, with `msg` containing the\n\t\terror description.\n\n\t\tThe intended usage is to bind it to a custom function:\n\t\t`httpInstance.onError = function(msg) { // handle error }`\n\t**/\n\tpublic dynamic function onError( msg : String ) {\n\t}\n\n\t/**\n\t\tThis method is called upon a Http status change, with `status` being the\n\t\tnew status.\n\n\t\tThe intended usage is to bind it to a custom function:\n\t\t`httpInstance.onStatus = function(status) { // handle status }`\n\t**/\n\tpublic dynamic function onStatus( status : Int ) {\n\t}\n\n#if !flash\n\t/**\n\t\tMakes a synchronous request to `url`.\n\n\t\tThis creates a new Http instance and makes a GET request by calling its\n\t\trequest(false) method.\n\n\t\tIf `url` is null, the result is unspecified.\n\t**/\n\tpublic static function requestUrl( url : String ) : String {\n\t\tvar h = new Http(url);\n\t#if js\n\t\th.async = false;\n\t#end\n\t\tvar r = null;\n\t\th.onData = function(d){\n\t\t\tr = d;\n\t\t}\n\t\th.onError = function(e){\n\t\t\tthrow e;\n\t\t}\n\t\th.request(false);\n\t\treturn r;\n\t}\n#end\n\n}\n","/*\n * Copyright (C)2005-2013 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe;\n\n/**\n\tThe Timer class allows you to create asynchronous timers on platforms that\n\tsupport events.\n\n\tThe intended usage is to create an instance of the Timer class with a given\n\tinterval, set its run() method to a custom function to be invoked and\n\teventually call stop() to stop the Timer.\n\n\tNote that a running Timer may or may not prevent the program to exit\n\tautomatically when main() returns.\n\n\tIt is also possible to extend this class and override its run() method in\n\tthe child class.\n**/\nclass Timer {\n\t#if (flash || js || java || python)\n\n\t#if (flash || js)\n\t\tprivate var id : Null<Int>;\n\t#elseif java\n\t\tprivate var timer : java.util.Timer;\n\t\tprivate var task : java.util.TimerTask;\n\t#end\n\n\t/**\n\t\tCreates a new timer that will run every `time_ms` milliseconds.\n\n\t\tAfter creating the Timer instance, it calls `this].run` repeatedly,\n\t\twith delays of `time_ms` milliseconds, until `this.stop` is called.\n\n\t\tThe first invocation occurs after `time_ms` milliseconds, not\n\t\timmediately.\n\n\t\tThe accuracy of this may be platform-dependent.\n\t**/\n\tpublic function new( time_ms : Int ){\n\t\t#if flash\n\t\t\tvar me = this;\n\t\t\tid = untyped __global__[\"flash.utils.setInterval\"](function() { me.run(); },time_ms);\n\t\t#elseif js\n\t\t\tvar me = this;\n\t\t\tid = untyped setInterval(function() me.run(),time_ms);\n\t\t#elseif java\n\t\t\ttimer = new java.util.Timer();\n\t\t\ttimer.scheduleAtFixedRate(task = new TimerTask(this), haxe.Int64.ofInt(time_ms), haxe.Int64.ofInt(time_ms));\n\t\t#end\n\t}\n\n\t/**\n\t\tStops `this` Timer.\n\n\t\tAfter calling this method, no additional invocations of `this.run`\n\t\twill occur.\n\n\t\tIt is not possible to restart `this` Timer once stopped.\n\t**/\n\tpublic function stop() {\n\t\t#if (flash || js)\n\t\t\tif( id == null )\n\t\t\t\treturn;\n\t\t\t#if flash\n\t\t\t\tuntyped __global__[\"flash.utils.clearInterval\"](id);\n\t\t\t#elseif js\n\t\t\t\tuntyped clearInterval(id);\n\t\t\t#end\n\t\t\tid = null;\n\t\t#elseif java\n\t\t\ttimer.cancel();\n\t\t\ttimer = null;\n\t\t\ttask = null;\n\t\t#end\n\t}\n\n\t/**\n\t\tThis method is invoked repeatedly on `this` Timer.\n\n\t\tIt can be overridden in a subclass, or rebound directly to a custom\n\t\tfunction:\n\t\t\tvar timer = new haxe.Timer(1000); // 1000ms delay\n\t\t\ttimer.run = function() { ... }\n\n\t\tOnce bound, it can still be rebound to different functions until `this`\n\t\tTimer is stopped through a call to `this.stop`.\n\t**/\n\tpublic dynamic function run() {\n\n\t}\n\n\t/**\n\t\tInvokes `f` after `time_ms` milliseconds.\n\n\t\tThis is a convenience function for creating a new Timer instance with\n\t\t`time_ms` as argument, binding its run() method to `f` and then stopping\n\t\t`this` Timer upon the first invocation.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function delay( f : Void -> Void, time_ms : Int ) {\n\t\tvar t = new haxe.Timer(time_ms);\n\t\tt.run = function() {\n\t\t\tt.stop();\n\t\t\tf();\n\t\t};\n\t\treturn t;\n\t}\n\n\t#end\n\n\t/**\n\t\tMeasures the time it takes to execute `f`, in seconds with fractions.\n\n\t\tThis is a convenience function for calculating the difference between\n\t\tTimer.stamp() before and after the invocation of `f`.\n\n\t\tThe difference is passed as argument to Log.trace(), with \"s\" appended\n\t\tto denote the unit. The optional `pos` argument is passed through.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function measure<T>( f : Void -> T, ?pos : PosInfos ) : T {\n\t\tvar t0 = stamp();\n\t\tvar r = f();\n\t\tLog.trace((stamp() - t0) + \"s\", pos);\n\t\treturn r;\n\t}\n\n\t/**\n\t\tReturns a timestamp, in seconds with fractions.\n\n\t\tThe value itself might differ depending on platforms, only differences\n\t\tbetween two values make sense.\n\t**/\n\tpublic static function stamp() : Float {\n\t\t#if flash\n\t\t\treturn flash.Lib.getTimer() / 1000;\n\t\t#elseif (neko || php)\n\t\t\treturn Sys.time();\n\t\t#elseif js\n\t\t\treturn Date.now().getTime() / 1000;\n\t\t#elseif cpp\n\t\t\treturn untyped __global__.__time_stamp();\n\t\t#elseif sys\n\t\t\treturn Sys.time();\n\t\t#else\n\t\t\treturn 0;\n\t\t#end\n\t}\n\n}\n\n#if java\n@:nativeGen\nprivate class TimerTask extends java.util.TimerTask {\n\tvar timer:Timer;\n\tpublic function new(timer:Timer):Void {\n\t\tsuper();\n\t\tthis.timer = timer;\n\t}\n\n\t@:overload override public function run():Void {\n\t\ttimer.run();\n\t}\n}\n#end\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\npackage haxe.ds;\n\n/**\n\tArraySort provides a stable implementation of merge sort through its `sort`\n\tmethod. It should be used instead of `Array.sort` in cases where the order\n\tof equal elements has to be retained on all targets.\n**/\nclass ArraySort {\n\n\t/**\n\t\tSorts Array `a` according to the comparison function `cmp`, where\n\t\t`cmp(x,y)` returns 0 if `x == y`, a positive Int if `x > y` and a\n\t\tnegative Int if `x < y`.\n\n\t\tThis operation modifies Array `a` in place.\n\n\t\tThis operation is stable: The order of equal elements is preserved.\n\n\t\tIf `a` or `cmp` are null, the result is unspecified.\n\t**/\n\tstatic public function sort<T>(a:Array<T>, cmp:T -> T -> Int) {\n\t\trec(a, cmp, 0, a.length);\n\t}\n\n\tstatic function rec<T>(a:Array<T>, cmp, from, to) {\n\t\tvar middle = (from + to) >> 1;\n\t\tif (to - from < 12) {\n\t\t\tif (to <= from) return;\n\t\t\tfor (i in (from + 1)...to) {\n\t\t\t\tvar j = i;\n\t\t\t\twhile (j > from) {\n\t\t\t\t\tif (compare(a, cmp, j, j - 1) < 0)\n\t\t\t\t\t\tswap(a, j - 1, j);\n\t\t\t\t\telse\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tj--;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\trec(a, cmp, from, middle);\n\t\trec(a, cmp, middle, to);\n\t\tdoMerge(a, cmp, from, middle, to, middle - from, to - middle);\n\t}\n\n\tstatic function doMerge<T>(a:Array<T>, cmp, from, pivot, to, len1, len2) {\n\t\tvar first_cut, second_cut, len11, len22, new_mid;\n\t\tif (len1 == 0 || len2 == 0)\n\t\t\treturn;\n\t\tif (len1 + len2 == 2) {\n\t\t\tif (compare(a, cmp, pivot, from) < 0)\n\t\t\t\tswap(a, pivot, from);\n\t\t\treturn;\n\t\t}\n\t\tif (len1 > len2) {\n\t\t\tlen11 = len1 >> 1;\n\t\t\tfirst_cut = from + len11;\n\t\t\tsecond_cut = lower(a, cmp, pivot, to, first_cut);\n\t\t\tlen22 = second_cut - pivot;\n\t\t} else {\n\t\t\tlen22 = len2 >> 1;\n\t\t\tsecond_cut = pivot + len22;\n\t\t\tfirst_cut = upper(a, cmp, from, pivot, second_cut);\n\t\t\tlen11 = first_cut - from;\n\t\t}\n\t\trotate(a, cmp, first_cut, pivot, second_cut);\n\t\tnew_mid = first_cut + len22;\n\t\tdoMerge(a, cmp, from, first_cut, new_mid, len11, len22);\n\t\tdoMerge(a, cmp, new_mid, second_cut, to, len1 - len11, len2 - len22);\n\t}\n\n\tstatic function rotate<T>(a:Array<T>, cmp, from, mid, to) {\n\t\tvar n;\n\t\tif (from == mid || mid == to) return;\n\t\tn = gcd(to - from, mid - from);\n\t\twhile (n-- != 0) {\n\t\t\tvar val = a[from + n];\n\t\t\tvar shift = mid - from;\n\t\t\tvar p1 = from + n, p2 = from + n + shift;\n\t\t\twhile (p2 != from + n) {\n\t\t\t\ta[p1] = a[p2];\n\t\t\t\tp1 = p2;\n\t\t\t\tif (to - p2 > shift) p2 += shift;\n\t\t\t\telse p2 = from + (shift - (to - p2));\n\t\t\t}\n\t\t\ta[p1] = val;\n\t\t}\n\t}\n\n\tstatic function gcd(m, n) {\n\t\twhile (n != 0) {\n\t\t\tvar t = m % n;\n\t\t\tm = n;\n\t\t\tn = t;\n\t\t}\n\t\treturn m;\n\t}\n\n\tstatic function upper<T>(a:Array<T>, cmp, from, to, val) {\n\t\tvar len = to - from, half, mid;\n\t\twhile (len > 0) {\n\t\t\thalf = len >> 1;\n\t\t\tmid = from + half;\n\t\t\tif (compare(a, cmp, val, mid) < 0)\n\t\t\t\tlen = half;\n\t\t\telse {\n\t\t\t\tfrom = mid + 1;\n\t\t\t\tlen = len - half - 1;\n\t\t\t}\n\t\t}\n\t\treturn from;\n\t}\n\n\tstatic function lower<T>(a:Array<T>, cmp, from, to, val) {\n\t\tvar len = to - from, half, mid;\n\t\twhile (len > 0) {\n\t\t\thalf = len >> 1;\n\t\t\tmid = from + half;\n\t\t\tif (compare(a, cmp, mid, val) < 0) {\n\t\t\t\tfrom = mid + 1;\n\t\t\t\tlen = len - half - 1;\n\t\t\t} else\n\t\t\t\tlen = half;\n\t\t}\n\t\treturn from;\n\t}\n\n\tstatic function swap<T>(a:Array<T>, i, j) {\n\t\tvar tmp = a[i];\n\t\ta[i] = a[j];\n\t\ta[j] = tmp;\n\t}\n\n\tstatic inline function compare<T>(a:Array<T>, cmp, i, j) {\n\t\treturn cmp(a[i], a[j]);\n\t}\n}","/*\n * Copyright (C)2005-2013 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\npackage haxe.ds;\n\n/**\n\tBalancedTree allows key-value mapping with arbitrary keys, as long as they\n\tcan be ordered. By default, `Reflect.compare` is used in the `compare`\n\tmethod, which can be overridden in subclasses.\n\n\tOperations have a logarithmic average and worst-case cost.\n\n\tIteration over keys and values, using `keys` and `iterator` respectively,\n\tare in-order.\n**/\nclass BalancedTree<K,V> {\n\tvar root:TreeNode<K,V>;\n\n\t/**\n\t\tCreates a new BalancedTree, which is initially empty.\n\t**/\n\tpublic function new() { }\n\n\t/**\n\t\tBinds `key` to `value`.\n\n\t\tIf `key` is already bound to a value, that binding disappears.\n\n\t\tIf `key` is null, the result is unspecified.\n\t**/\n\tpublic function set(key:K, value:V) {\n\t\troot = setLoop(key, value, root);\n\t}\n\n\t/**\n\t\tReturns the value `key` is bound to.\n\n\t\tIf `key` is not bound to any value, `null` is returned.\n\n\t\tIf `key` is null, the result is unspecified.\n\t**/\n\tpublic function get(key:K):Null<V> {\n\t\tvar node = root;\n\t\twhile (node != null) {\n\t\t\tvar c = compare(key, node.key);\n\t\t\tif (c == 0) return node.value;\n\t\t\tif (c < 0) node = node.left;\n\t\t\telse node = node.right;\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t\tRemoves the current binding of `key`.\n\n\t\tIf `key` has no binding, `this` BalancedTree is unchanged and false is\n\t\treturned.\n\n\t\tOtherwise the binding of `key` is removed and true is returned.\n\n\t\tIf `key` is null, the result is unspecified.\n\t**/\n\tpublic function remove(key:K) {\n\t\ttry {\n\t\t\troot = removeLoop(key, root);\n\t\t\treturn true;\n\t\t}\n\t\tcatch (e:String) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t\tTells if `key` is bound to a value.\n\n\t\tThis method returns true even if `key` is bound to null.\n\n\t\tIf `key` is null, the result is unspecified.\n\t**/\n\tpublic function exists(key:K) {\n\t\tvar node = root;\n\t\twhile (node != null) {\n\t\t\tvar c = compare(key, node.key);\n\t\t\tif (c == 0) return true;\n\t\t\telse if (c < 0) node = node.left;\n\t\t\telse node = node.right;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t\tIterates over the bound values of `this` BalancedTree.\n\n\t\tThis operation is performed in-order.\n\t**/\n\tpublic function iterator():Iterator<V> {\n\t\tvar ret = [];\n\t\titeratorLoop(root, ret);\n\t\treturn ret.iterator();\n\t}\n\n\t/**\n\t\tIterates over the keys of `this` BalancedTree.\n\n\t\tThis operation is performed in-order.\n\t**/\n\tpublic function keys():Iterator<K> {\n\t\tvar ret = [];\n\t\tkeysLoop(root, ret);\n\t\treturn ret.iterator();\n\t}\n\n\tfunction setLoop(k:K, v:V, node:TreeNode<K,V>) {\n\t\tif (node == null) return new TreeNode<K,V>(null, k, v, null);\n\t\tvar c = compare(k, node.key);\n\t\treturn if (c == 0) new TreeNode<K,V>(node.left, k, v, node.right, node.get_height());\n\t\telse if (c < 0) {\n\t\t\tvar nl = setLoop(k, v, node.left);\n\t\t\tbalance(nl, node.key, node.value, node.right);\n\t\t} else {\n\t\t\tvar nr = setLoop(k, v, node.right);\n\t\t\tbalance(node.left, node.key, node.value, nr);\n\t\t}\n\t}\n\n\tfunction removeLoop(k:K, node:TreeNode<K,V>) {\n\t\tif (node == null) throw \"Not_found\";\n\t\tvar c = compare(k, node.key);\n\t\treturn if (c == 0) merge(node.left, node.right);\n\t\telse if (c < 0) balance(removeLoop(k, node.left), node.key, node.value, node.right);\n\t\telse balance(node.left, node.key, node.value, removeLoop(k, node.right));\n\t}\n\n\tfunction iteratorLoop(node:TreeNode<K,V>, acc:Array<V>) {\n\t\tif (node != null) {\n\t\t\titeratorLoop(node.left, acc);\n\t\t\tacc.push(node.value);\n\t\t\titeratorLoop(node.right, acc);\n\t\t}\n\t}\n\n\tfunction keysLoop(node:TreeNode<K,V>, acc:Array<K>) {\n\t\tif (node != null) {\n\t\t\tkeysLoop(node.left, acc);\n\t\t\tacc.push(node.key);\n\t\t\tkeysLoop(node.right, acc);\n\t\t}\n\t}\n\n\tfunction merge(t1, t2) {\n\t\tif (t1 == null) return t2;\n\t\tif (t2 == null) return t1;\n\t\tvar t = minBinding(t2);\n\t\treturn balance(t1, t.key, t.value, removeMinBinding(t2));\n\t}\n\n\tfunction minBinding(t:TreeNode<K,V>) {\n\t\treturn if (t == null) throw \"Not_found\";\n\t\telse if (t.left == null) t;\n\t\telse minBinding(t.left);\n\t}\n\n\tfunction removeMinBinding(t:TreeNode<K,V>) {\n\t\treturn if (t.left == null) t.right;\n\t\telse balance(removeMinBinding(t.left), t.key, t.value, t.right);\n\t}\n\n\tfunction balance(l:TreeNode<K,V>, k:K, v:V, r:TreeNode<K,V>):TreeNode<K,V> {\n\t\tvar hl = l.get_height();\n\t\tvar hr = r.get_height();\n\t\treturn if (hl > hr + 2) {\n\t\t\tif (l.left.get_height() >= l.right.get_height()) new TreeNode<K,V>(l.left, l.key, l.value, new TreeNode<K,V>(l.right, k, v, r));\n\t\t\telse new TreeNode<K,V>(new TreeNode<K,V>(l.left,l.key, l.value, l.right.left), l.right.key, l.right.value, new TreeNode<K,V>(l.right.right, k, v, r));\n\t\t} else if (hr > hl + 2) {\n\t\t\tif (r.right.get_height() > r.left.get_height()) new TreeNode<K,V>(new TreeNode<K,V>(l, k, v, r.left), r.key, r.value, r.right);\n\t\t\telse new TreeNode<K,V>(new TreeNode<K,V>(l, k, v, r.left.left), r.left.key, r.left.value, new TreeNode<K,V>(r.left.right, r.key, r.value, r.right));\n\t\t} else {\n\t\t\tnew TreeNode<K,V>(l, k, v, r, (hl > hr ? hl : hr) + 1);\n\t\t}\n\t}\n\n\tfunction compare(k1:K, k2:K) {\n\t\treturn Reflect.compare(k1, k2);\n\t}\n\n\tpublic function toString() {\n\t\treturn root == null ? '{}' : '{${root.toString()}}';\n\t}\n}\n\nclass TreeNode<K,V> {\n\tpublic var left : TreeNode<K,V>;\n\tpublic var right : TreeNode<K,V>;\n\tpublic var key : K;\n\tpublic var value : V;\n\t#if as3\n\tpublic\n\t#end\n\tvar _height : Int;\n\n\tpublic function new(l, k, v, r, h = -1) {\n\t\tleft = l;\n\t\tkey = k;\n\t\tvalue = v;\n\t\tright = r;\n\t\tif (h == -1)\n\t\t\t_height = (left.get_height() > right.get_height() ? left.get_height() : right.get_height()) + 1;\n\t\telse\n\t\t\t_height = h;\n\t}\n\n\t@:extern public inline function get_height() return this == null ? 0 : _height;\n\n\tpublic function toString() {\n\t\treturn (left == null ? \"\" : left.toString() + \", \") + '$key=$value' + (right == null ? \"\" : \", \" +right.toString());\n\t}\n}","/*\n * Copyright (C)2005-2013 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\npackage haxe.ds;\n\n/**\n\tEnumValueMap allows mapping of enum value keys to arbitrary values.\n\n\tKeys are compared by value and recursively over their parameters. If any\n\tparameter is not an enum value, `Reflect.compare` is used to compare them.\n**/\nclass EnumValueMap<K:EnumValue, V> extends haxe.ds.BalancedTree<K, V> implements haxe.Constraints.IMap<K,V> {\n\n\toverride function compare(k1:EnumValue, k2:EnumValue):Int {\n\t\tvar d = k1.getIndex() - k2.getIndex();\n\t\tif (d != 0) return d;\n\t\tvar p1 = k1.getParameters();\n\t\tvar p2 = k2.getParameters();\n\t\tif (p1.length == 0 && p2.length == 0) return 0;\n\t\treturn compareArgs(p1, p2);\n\t}\n\n\tfunction compareArgs(a1:Array<Dynamic>, a2:Array<Dynamic>):Int {\n\t\tvar ld = a1.length - a2.length;\n\t\tif (ld != 0) return ld;\n\t\tfor (i in 0...a1.length) {\n\t\t\tvar d = compareArg(a1[i], a2[i]);\n\t\t\tif (d != 0) return d;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tfunction compareArg(v1:Dynamic, v2:Dynamic):Int {\n\t\treturn if (Reflect.isEnumValue(v1) && Reflect.isEnumValue(v2)) {\n\t\t\tcompare(v1, v2);\n\t\t} else if (Std.is(v1, Array) && Std.is(v2, Array)) {\n\t\t\tcompareArgs(v1, v2);\n\t\t} else {\n\t\t\tReflect.compare(v1, v2);\n\t\t}\n\t}\n}","/*\n * Copyright (C)2005-2013 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of h software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and h permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\npackage haxe.ds;\n\n@:coreApi\nclass ObjectMap<K:{ }, V> implements haxe.Constraints.IMap<K,V> {\n\n\tstatic var count = 0;\n\n\tstatic inline function assignId(obj: { } ):Int {\n\t\treturn untyped obj.__id__ = ++count;\n\t}\n\n\tstatic inline function getId(obj: { } ):Int {\n\t\treturn untyped obj.__id__;\n\t}\n\n\tvar h : { };\n\n\tpublic function new() : Void {\n\t\th = { };\n\t\tuntyped h.__keys__ = { };\n\t}\n\n\tpublic function set(key:K, value:V):Void untyped {\n\t\tvar id : Int = untyped key.__id__ || assignId(key);\n\t\th[id] = value;\n\t\th.__keys__[id] = key;\n\t}\n\n\tpublic inline function get(key:K):Null<V> {\n\t\treturn untyped h[getId(key)];\n\t}\n\n\tpublic inline function exists(key:K):Bool {\n\t\treturn untyped h.__keys__[getId(key)] != null;\n\t}\n\n\tpublic function remove( key : K ) : Bool {\n\t\tvar id = getId(key);\n\t\tif ( untyped h.__keys__[id] == null ) return false;\n\t\tuntyped  __js__(\"delete\")(h[id]);\n\t\tuntyped  __js__(\"delete\")(h.__keys__[id]);\n\t\treturn true;\n\t}\n\n\tpublic function keys() : Iterator<K> {\n\t\tvar a = [];\n\t\tuntyped {\n\t\t\t__js__(\"for( var key in this.h.__keys__ ) {\");\n\t\t\t\tif( h.hasOwnProperty(key) )\n\t\t\t\t\ta.push(h.__keys__[key]);\n\t\t\t__js__(\"}\");\n\t\t}\n\t\treturn a.iterator();\n\t}\n\n\tpublic function iterator() : Iterator<V> {\n\t\treturn untyped {\n\t\t\tref : h,\n\t\t\tit : keys(),\n\t\t\thasNext : function() { return __this__.it.hasNext(); },\n\t\t\tnext : function() { var i = __this__.it.next(); return __this__.ref[getId(i)]; }\n\t\t};\n\t}\n\n\tpublic function toString() : String {\n\t\tvar s = new StringBuf();\n\t\ts.add(\"{\");\n\t\tvar it = keys();\n\t\tfor( i in it ) {\n\t\t\ts.add(Std.string(i));\n\t\t\ts.add(\" => \");\n\t\t\ts.add(Std.string(get(i)));\n\t\t\tif( it.hasNext() )\n\t\t\t\ts.add(\", \");\n\t\t}\n\t\ts.add(\"}\");\n\t\treturn s.toString();\n\t}\n}","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe.ds;\n\nprivate class StringMapIterator<T> {\n\tvar map : StringMap<T>;\n\tvar keys : Array<String>;\n\tvar index : Int;\n\tvar count : Int;\n\tpublic inline function new(map:StringMap<T>, keys:Array<String>) {\n\t\tthis.map = map;\n\t\tthis.keys = keys;\n\t\tthis.index = 0;\n\t\tthis.count = keys.length;\n\t}\n\tpublic inline function hasNext() {\n\t\treturn index < count;\n\t}\n\tpublic inline function next() {\n\t\treturn map.get(keys[index++]);\n\t}\n}\n\n@:coreApi class StringMap<T> implements haxe.Constraints.IMap<String,T> {\n\n\tprivate var h : Dynamic;\n\tprivate var rh : Dynamic;\n\n\tpublic inline function new() : Void {\n\t\th = {};\n\t}\n\n\tinline function isReserved(key:String) : Bool {\n\t\treturn untyped __js__(\"__map_reserved\")[key] != null;\n\t}\n\n\tpublic inline function set( key : String, value : T ) : Void {\n\t\tif( isReserved(key) )\n\t\t\tsetReserved(key, value);\n\t\telse\n\t\t\th[cast key] = value;\n\t}\n\n\tpublic inline function get( key : String ) : Null<T> {\n\t\tif( isReserved(key) )\n\t\t\treturn getReserved(key);\n\t\treturn h[cast key];\n\t}\n\n\tpublic inline function exists( key : String ) : Bool {\n\t\tif( isReserved(key) )\n\t\t\treturn existsReserved(key);\n\t\treturn h.hasOwnProperty(key);\n\t}\n\n\tfunction setReserved( key : String, value : T ) : Void {\n\t\tif( rh == null ) rh = {};\n\t\trh[cast \"$\"+key] = value;\n\t}\n\n\tfunction getReserved( key : String ) : Null<T> {\n\t\treturn rh == null ? null : rh[cast \"$\"+key];\n\t}\n\n\tfunction existsReserved( key : String ) : Bool {\n\t\tif( rh == null ) return false;\n\t\treturn untyped rh.hasOwnProperty(\"$\"+key);\n\t}\n\n\tpublic function remove( key : String ) : Bool {\n\t\tif( isReserved(key) ) {\n\t\t\tkey = \"$\" + key;\n\t\t\tif( rh == null || !rh.hasOwnProperty(key) ) return false;\n\t\t\tuntyped __js__(\"delete\")(rh[key]);\n\t\t\treturn true;\n\t\t} else {\n\t\t\tif( !h.hasOwnProperty(key) )\n\t\t\t\treturn false;\n\t\t\tuntyped __js__(\"delete\")(h[key]);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tpublic function keys() : Iterator<String> {\n\t\treturn arrayKeys().iterator();\n\t}\n\t\n\tfunction arrayKeys() : Array<String> {\n\t\tvar out = [];\n\t\tuntyped {\n\t\t\t__js__(\"for( var key in this.h ) {\");\n\t\t\t\tif( h.hasOwnProperty(key) )\n\t\t\t\t\tout.push(key);\n\t\t\t__js__(\"}\");\n\t\t}\n\t\tif( rh != null ) untyped {\n\t\t\t__js__(\"for( var key in this.rh ) {\");\n\t\t\t\tif( key.charCodeAt(0) == \"$\".code )\n\t\t\t\t\tout.push(key.substr(1));\n\t\t\t__js__(\"}\");\n\t\t}\n\t\treturn out;\n\t}\n\n\tpublic inline function iterator() : Iterator<T> {\n\t\treturn new StringMapIterator(this, arrayKeys());\n\t}\n\n\tpublic function toString() : String {\n\t\tvar s = new StringBuf();\n\t\ts.add(\"{\");\n\t\tvar keys = arrayKeys();\n\t\tfor( i in 0...keys.length ) {\n\t\t\tvar k = keys[i];\n\t\t\ts.add(k);\n\t\t\ts.add(\" => \");\n\t\t\ts.add(Std.string(get(k)));\n\t\t\tif( i < keys.length )\n\t\t\t\ts.add(\", \");\n\t\t}\n\t\ts.add(\"}\");\n\t\treturn s.toString();\n\t}\n\n\tstatic function __init__() : Void {\n\t\tuntyped __js__(\"var __map_reserved = {}\");\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage js;\n\nprivate class HaxeError extends js.Error {\n\n\tvar val:Dynamic;\n\n\tpublic function new(val:Dynamic) untyped {\n\t\tsuper();\n\t\tthis.val = __define_feature__(\"js.Boot.HaxeError\", val);\n\t\tthis.message = String(val);\n\t\tif (js.Error.captureStackTrace) js.Error.captureStackTrace(this, HaxeError);\n\t}\n}\n\n@:dox(hide)\nclass Boot {\n\n\tprivate static function __unhtml(s : String) {\n\t\treturn s.split(\"&\").join(\"&amp;\").split(\"<\").join(\"&lt;\").split(\">\").join(\"&gt;\");\n\t}\n\n\tprivate static function __trace(v,i : haxe.PosInfos) {\n\t\tuntyped {\n\t\t\tvar msg = if( i != null ) i.fileName+\":\"+i.lineNumber+\": \" else \"\";\n\t\t\t#if jsfl\n\t\t\tmsg += __string_rec(v,\"\");\n\t\t\tfl.trace(msg);\n\t\t\t#else\n\t\t\tmsg += __string_rec(v, \"\");\n\t\t\tif( i != null && i.customParams != null )\n\t\t\t\tfor( v in i.customParams )\n\t\t\t\t\tmsg += \",\" + __string_rec(v, \"\");\n\t\t\tvar d;\n\t\t\tif( __js__(\"typeof\")(document) != \"undefined\" && (d = document.getElementById(\"haxe:trace\")) != null )\n\t\t\t\td.innerHTML += __unhtml(msg)+\"<br/>\";\n\t\t\telse if( __js__(\"typeof console\") != \"undefined\" && __js__(\"console\").log != null )\n\t\t\t\t__js__(\"console\").log(msg);\n\t\t\t#end\n\t\t}\n\t}\n\n\tprivate static function __clear_trace() {\n\t\tuntyped {\n\t\t\t#if jsfl\n\t\t\tfl.outputPanel.clear();\n\t\t\t#else\n\t\t\tvar d = document.getElementById(\"haxe:trace\");\n\t\t\tif( d != null )\n\t\t\t\td.innerHTML = \"\";\n\t\t\t#end\n\t\t}\n\t}\n\n\tstatic inline function isClass(o:Dynamic) : Bool {\n\t\treturn untyped __define_feature__(\"js.Boot.isClass\", o.__name__);\n\t}\n\n\tstatic inline function isEnum(e:Dynamic) : Bool {\n\t\treturn untyped __define_feature__(\"js.Boot.isEnum\", e.__ename__);\n\t}\n\n\tstatic function getClass(o:Dynamic) : Dynamic {\n\t\tif (Std.is(o, Array))\n\t\t\treturn Array;\n\t\telse {\n\t\t\tvar cl = untyped __define_feature__(\"js.Boot.getClass\", o.__class__);\n\t\t\tif (cl != null)\n\t\t\t\treturn cl;\n\t\t\tvar name = __nativeClassName(o);\n\t\t\tif (name != null)\n\t\t\t\treturn __resolveNativeClass(name);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t@:ifFeature(\"has_enum\")\n\tprivate static function __string_rec(o,s:String) {\n\t\tuntyped {\n\t\t\tif( o == null )\n\t\t\t    return \"null\";\n\t\t\tif( s.length >= 5 )\n\t\t\t\treturn \"<...>\"; // too much deep recursion\n\t\t\tvar t = __js__(\"typeof(o)\");\n\t\t\tif( t == \"function\" && (isClass(o) || isEnum(o)) )\n\t\t\t\tt = \"object\";\n\t\t\tswitch( t ) {\n\t\t\tcase \"object\":\n\t\t\t\tif( __js__(\"o instanceof Array\") ) {\n\t\t\t\t\tif( o.__enum__ ) {\n\t\t\t\t\t\tif( o.length == 2 )\n\t\t\t\t\t\t\treturn o[0];\n\t\t\t\t\t\tvar str = o[0]+\"(\";\n\t\t\t\t\t\ts += \"\\t\";\n\t\t\t\t\t\tfor( i in 2...o.length ) {\n\t\t\t\t\t\t\tif( i != 2 )\n\t\t\t\t\t\t\t\tstr += \",\" + __string_rec(o[i],s);\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tstr += __string_rec(o[i],s);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn str + \")\";\n\t\t\t\t\t}\n\t\t\t\t\tvar l = o.length;\n\t\t\t\t\tvar i;\n\t\t\t\t\tvar str = \"[\";\n\t\t\t\t\ts += \"\\t\";\n\t\t\t\t\tfor( i in 0...l )\n\t\t\t\t\t\tstr += (if (i > 0) \",\" else \"\")+__string_rec(o[i],s);\n\t\t\t\t\tstr += \"]\";\n\t\t\t\t\treturn str;\n\t\t\t\t}\n\t\t\t\tvar tostr;\n\t\t\t\ttry {\n\t\t\t\t\ttostr = untyped o.toString;\n\t\t\t\t} catch( e : Dynamic ) {\n\t\t\t\t\t// strange error on IE\n\t\t\t\t\treturn \"???\";\n\t\t\t\t}\n\t\t\t\tif( tostr != null && tostr != __js__(\"Object.toString\") && __typeof__(tostr) == \"function\" ) {\n\t\t\t\t\tvar s2 = o.toString();\n\t\t\t\t\tif( s2 != \"[object Object]\")\n\t\t\t\t\t\treturn s2;\n\t\t\t\t}\n\t\t\t\tvar k : String = null;\n\t\t\t\tvar str = \"{\\n\";\n\t\t\t\ts += \"\\t\";\n\t\t\t\tvar hasp = (o.hasOwnProperty != null);\n\t\t\t\t__js__(\"for( var k in o ) {\");\n\t\t\t\t\tif( hasp && !o.hasOwnProperty(k) )\n\t\t\t\t\t\t__js__(\"continue\");\n\t\t\t\t\tif( k == \"prototype\" || k == \"__class__\" || k == \"__super__\" || k == \"__interfaces__\" || k == \"__properties__\" )\n\t\t\t\t\t\t__js__(\"continue\");\n\t\t\t\t\tif( str.length != 2 )\n\t\t\t\t\t\tstr += \", \\n\";\n\t\t\t\t\tstr += s + k + \" : \"+__string_rec(o[k],s);\n\t\t\t\t__js__(\"}\");\n\t\t\t\ts = s.substring(1);\n\t\t\t\tstr += \"\\n\" + s + \"}\";\n\t\t\t\treturn str;\n\t\t\tcase \"function\":\n\t\t\t\treturn \"<function>\";\n\t\t\tcase \"string\":\n\t\t\t\treturn o;\n\t\t\tdefault:\n\t\t\t\treturn String(o);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate static function __interfLoop(cc : Dynamic,cl : Dynamic) {\n\t\tif( cc == null )\n\t\t\treturn false;\n\t\tif( cc == cl )\n\t\t\treturn true;\n\t\tvar intf : Dynamic = cc.__interfaces__;\n\t\tif( intf != null )\n\t\t\tfor( i in 0...intf.length ) {\n\t\t\t\tvar i : Dynamic = intf[i];\n\t\t\t\tif( i == cl || __interfLoop(i,cl) )\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\treturn __interfLoop(cc.__super__,cl);\n\t}\n\n\t@:ifFeature(\"typed_catch\") private static function __instanceof(o : Dynamic,cl : Dynamic) {\n\t\tif( cl == null )\n\t\t\treturn false;\n\t\tswitch( cl ) {\n\t\tcase Int:\n\t\t\treturn (untyped __js__(\"(o|0) === o\"));\n\t\tcase Float:\n\t\t\treturn (untyped __js__(\"typeof\"))(o) == \"number\";\n\t\tcase Bool:\n\t\t\treturn (untyped __js__(\"typeof\"))(o) == \"boolean\";\n\t\tcase String:\n\t\t\treturn (untyped __js__(\"typeof\"))(o) == \"string\";\n\t\tcase Array:\n\t\t\treturn (untyped __js__(\"(o instanceof Array)\")) && o.__enum__ == null;\n\t\tcase Dynamic:\n\t\t\treturn true;\n\t\tdefault:\n\t\t\tif( o != null ) {\n\t\t\t\t// Check if o is an instance of a Haxe class or a native JS object\n\t\t\t\tif( (untyped __js__(\"typeof\"))(cl) == \"function\" ) {\n\t\t\t\t\tif( untyped __js__(\"o instanceof cl\") )\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tif( __interfLoop(getClass(o),cl) )\n\t\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\telse if ( (untyped __js__(\"typeof\"))(cl) == \"object\" && __isNativeObj(cl) ) {\n\t\t\t\t\tif( untyped __js__(\"o instanceof cl\") )\n\t\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// do not use isClass/isEnum here\n\t\t\tuntyped __feature__(\"Class.*\",if( cl == Class && o.__name__ != null ) return true);\n\t\t\tuntyped __feature__(\"Enum.*\",if( cl == Enum && o.__ename__ != null ) return true);\n\t\t\treturn o.__enum__ == cl;\n\t\t}\n\t}\n\n\t@:ifFeature(\"typed_cast\") private static function __cast(o : Dynamic, t : Dynamic) {\n\t\tif (__instanceof(o, t)) return o;\n\t\telse throw \"Cannot cast \" +Std.string(o) + \" to \" +Std.string(t);\n\t}\n\n\tstatic var __toStr = untyped __js__(\"{}.toString\");\n\t// get native JS [[Class]]\n\tstatic function __nativeClassName(o:Dynamic):String {\n\t\tvar name = untyped __toStr.call(o).slice(8, -1);\n\t\t// exclude general Object and Function\n\t\t// also exclude Math and JSON, because instanceof cannot be called on them\n\t\tif (name == \"Object\" || name == \"Function\" || name == \"Math\" || name == \"JSON\")\n\t\t\treturn null;\n\t\treturn name;\n\t}\n\n\t// check for usable native JS object\n\tstatic function __isNativeObj(o:Dynamic):Bool {\n\t\treturn __nativeClassName(o) != null;\n\t}\n\n\t// resolve native JS class in the global scope:\n\tstatic function __resolveNativeClass(name:String) untyped {\n\t\treturn untyped Function('return typeof $name != \"undefined\" ? $name : null')();\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage js;\n\nimport js.html.Storage;\nimport js.html.XMLHttpRequest;\n\nclass Browser {\n\t/** The global window object. */\n\tpublic static var window(get, never):js.html.Window;\n\tinline static function get_window() return untyped __js__(\"window\");\n\n\t/** Shortcut to Window.document. */\n\tpublic static var document(get, never):js.html.HTMLDocument;\n\tinline static function get_document() return untyped __js__(\"window.document\");\n\n\t/** Shortcut to Window.location. */\n\tpublic static var location(get, never):js.html.Location;\n\tinline static function get_location() return untyped __js__(\"window.location\");\n\n\t/** Shortcut to Window.navigator. */\n\tpublic static var navigator(get, never):js.html.Navigator;\n\tinline static function get_navigator() return untyped __js__(\"window.navigator\");\n\n\t/** Shortcut to Window.console. */\n\tpublic static var console(get, never):js.html.Console;\n\tinline static function get_console() return untyped __js__(\"window.console\");\n\n\t/**\n\t * True if a window object exists, false otherwise.\n\t *\n\t * This can be used to check if the code is being executed in a non-browser\n\t * environment such as node.js.\n\t */\n\tpublic static var supported(get, never):Bool;\n\tinline static function get_supported() return untyped __typeof__(window) != \"undefined\";\n\n\t/**\n\t * Safely gets the browser's local storage, or returns null if localStorage is unsupported or\n\t * disabled.\n\t */\n\tpublic static function getLocalStorage() : Storage\n\t{\n\t\ttry {\n\t\t\tvar s = window.localStorage;\n\t\t\ts.getItem(\"\");\n\t\t\treturn s;\n\t\t} catch( e : Dynamic ) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Safely gets the browser's session storage, or returns null if sessionStorage is unsupported\n\t * or disabled.\n\t */\n\tpublic static function getSessionStorage() : Storage\n\t{\n\t\ttry {\n\t\t\tvar s = window.sessionStorage;\n\t\t\ts.getItem(\"\");\n\t\t\treturn s;\n\t\t} catch( e : Dynamic ) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Creates an XMLHttpRequest, with a fallback to ActiveXObject for ancient versions of Internet\n\t * Explorer.\n\t */\n\tpublic static function createXMLHttpRequest() : XMLHttpRequest\n\t{\n\t\tif( untyped __js__(\"typeof XMLHttpRequest\") != \"undefined\" ) {\n\t\t\treturn new XMLHttpRequest();\n\t\t}\n\t\tif( untyped __js__(\"typeof ActiveXObject\") != \"undefined\" ) {\n\t\t\treturn untyped __new__(\"ActiveXObject\",\"Microsoft.XMLHTTP\");\n\t\t}\n\t\tthrow \"Unable to create XMLHttpRequest object.\";\n\t}\n\n\t/**\n\t\tDisplay an alert message box containing the given message. See also `Window.alert()`.\n\t**/\n\tpublic static function alert( v : Dynamic ) {\n\t\t@:privateAccess window.alert(Boot.__string_rec(v,\"\"));\n\t}\n}\n","/*                  __  __    _____           __\r\n *     ____  ____ _/ /_/ /_  / __(_)___  ____/ /__  _____\r\n *    / __ \\/ __ `/ __/ __ \\/ /_/ / __ \\/ __  / _ \\/ ___/\r\n *   / /_/ / /_/ / /_/ / / / __/ / / / / /_/ /  __/ /\r\n *  / .___/\\__,_/\\__/_/ /_/_/ /_/_/ /_/\\__,_/\\___/_/\r\n * /_/\r\n *\r\n * Copyright (c) 2013, Robert Fell\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\r\n\r\npackage pathfinder;\r\n\r\n/**\r\n * @author Statm\thttps://github.com/statm/haxe-astar\r\n * @author Robert Fell\r\n */\r\n\r\nclass Coordinate\r\n{\r\n\tpublic var x:Int;\r\n\tpublic var y:Int;\r\n\r\n\tpublic function new( p_x:Int = 0, p_y:Int = 0 )\r\n\t{\r\n\t\tx = p_x;\r\n\t\ty = p_y;\r\n\t}\r\n\r\n\tpublic function isEqualTo( p_coordinate:Coordinate ):Bool\r\n\t{\r\n\t\treturn ( ( x == p_coordinate.x ) && ( y == p_coordinate.y ) );\r\n\t}\r\n\r\n\tpublic function toString():String\r\n\t{\r\n\t\treturn \"(\" + x + \",\" + y + \")\";\r\n\t}\r\n\r\n\tpublic function clone():Coordinate\r\n\t{\r\n\t\treturn new Coordinate( x, y );\r\n\t}\r\n}","/*                  __  __    _____           __\r\n *     ____  ____ _/ /_/ /_  / __(_)___  ____/ /__  _____\r\n *    / __ \\/ __ `/ __/ __ \\/ /_/ / __ \\/ __  / _ \\/ ___/\r\n *   / /_/ / /_/ / /_/ / / / __/ / / / / /_/ /  __/ /\r\n *  / .___/\\__,_/\\__/_/ /_/_/ /_/_/ /_/\\__,_/\\___/_/\r\n * /_/\r\n *\r\n * Copyright (c) 2013, Robert Fell\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\r\n\r\npackage pathfinder;\r\n\r\n/**\r\n * @author Statm\thttps://github.com/statm/haxe-astar\r\n * @author Robert Fell\r\n */\r\n\r\nclass Node extends Coordinate\r\n{\r\n\tpublic var parent:Node;\r\n\tpublic var isWalkable:Bool;\r\n\tpublic var f:Float;\r\n\tpublic var g:Float;\r\n\r\n\tpublic function new( p_x:Int, p_y:Int, p_isWalkable:Bool = true )\r\n\t{\r\n\t\tisWalkable = p_isWalkable;\r\n\t\tsuper( p_x, p_y );\r\n\t}\r\n\r\n\toverride public function toString():String\r\n\t{\r\n\t\tvar l_result:String;\r\n\t\tl_result = \"[Node(\" + x + \",\" + y + \")\";\r\n\t\tif ( parent != null )\r\n\t\t{\r\n\t\t\tl_result += \", parent=(\" + parent.x + \",\" + parent.y + \")\";\r\n\t\t}\r\n\t\tl_result += \", \" + ( isWalkable ? \"W\" : \"X\" );\r\n\t\tl_result += \", f=\" + f;\r\n\t\tl_result += \", g=\" + g;\r\n\t\tl_result += \"]\";\r\n\t\treturn l_result;\r\n\t}\r\n}\r\n","/*                  __  __    _____           __\r\n *     ____  ____ _/ /_/ /_  / __(_)___  ____/ /__  _____\r\n *    / __ \\/ __ `/ __/ __ \\/ /_/ / __ \\/ __  / _ \\/ ___/\r\n *   / /_/ / /_/ / /_/ / / / __/ / / / / /_/ /  __/ /\r\n *  / .___/\\__,_/\\__/_/ /_/_/ /_/_/ /_/\\__,_/\\___/_/\r\n * /_/\r\n *\r\n * Copyright (c) 2013, Robert Fell\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\r\n\r\npackage pathfinder;\r\nimport haxe.Timer;\r\n\r\n/**\r\n * A class to find an optimized A Star path across an IMap boolean grid.\r\n * @author Statm\thttps://github.com/statm/haxe-astar\r\n * @author Robert Fell\r\n */\r\n\r\nclass Pathfinder\r\n{\r\n\tprivate inline static var _COST_ADJACENT:Int = 10;\r\n\tprivate inline static var _COST_DIAGIONAL:Int = 14;\r\n\r\n\tprivate var _map:IMap;\r\n\tprivate var _timeOutDuration:Int;\r\n\tprivate var _openList:Array<Node>;\r\n\tprivate var _closedList:Array<Node>;\r\n\tprivate var _isCompleted:Bool;\r\n\tprivate var _nodes:Array<Array<Node>>;\r\n\tprivate var _startNode:Node;\r\n\tprivate var _destNode:Node;\r\n\tprivate var _cols:Int;\r\n\tprivate var _rows:Int;\r\n\tprivate var _info:{ heuristic:EHeuristic, timeElapsed:Int, pathLength:Int, isDiagonalEnabled:Bool };\r\n\r\n\t/**\r\n\t * Creates a new pathfinder class\r\n\t * @param\tp_map\tThe boolean coordinate map\r\n\t * @param\tp_timeOutDuration\tThe maximum time spent to find a path\r\n\t */\r\n\tpublic function new( p_map:IMap, p_timeOutDuration:Int = 10000 )\r\n\t{\r\n\t\tconfigure( p_map, p_timeOutDuration );\r\n\t}\r\n\r\n\t/**\r\n\t * Reconfigures an existing pathfinder class\r\n\t * @param\tp_map\tThe boolean coordinate map\r\n\t * @param\tp_timeOutDuration\tThe maximum time spent to find a path\r\n\t */\r\n\tpublic function configure( p_map:IMap, p_timeOutDuration:Int = 10000 )\r\n\t{\r\n\t\t_map = p_map;\r\n\t\t_timeOutDuration = p_timeOutDuration;\r\n\t\t_nodes = new Array<Array<Node>>();\r\n\t\t_cols = _map.cols;\r\n\t\t_rows = _map.rows;\r\n\t\tfor ( l_ix in 0..._map.cols )\r\n\t\t{\r\n\t\t\tvar l_line = _nodes[l_ix] = new Array<Node>();\r\n\t\t\tfor ( l_iy in 0..._map.rows )\r\n\t\t\t{\r\n\t\t\t\tl_line[l_iy] = new Node( l_ix, l_iy, _map.isWalkable( l_ix, l_iy ) );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate inline function _getCost( p_node1:Node, p_node2:Node, p_heuristic:EHeuristic ):Float\r\n\t{\r\n\t\treturn switch( p_heuristic )\r\n\t\t{\r\n\t\t\tcase DIAGONAL : _getCostDiagonal( p_node1, p_node2 );\r\n\t\t\tcase PRODUCT : _getCostProduct( p_node1, p_node2 );\r\n\t\t\tcase EUCLIDIAN : _getCostEuclidian( p_node1, p_node2 );\r\n\t\t\tcase MANHATTAN : _getCostManhattan( p_node1, p_node2 );\r\n\t\t}\r\n\t}\r\n\r\n\tprivate inline function _getCostDiagonal( p_node1:Node, p_node2:Node ):Float\r\n\t{\r\n\t\tvar l_dx:Int = _intAbs( p_node1.x - p_node2.x );\r\n\t\tvar l_dy:Int = _intAbs( p_node1.y - p_node2.y );\r\n\t\tvar l_diag:Int = _intMin( l_dx, l_dy );\r\n\t\tvar l_straight:Int = l_dx + l_dy;\r\n\t\treturn ( _COST_ADJACENT * ( l_straight - ( 2 * l_diag ) ) ) + ( _COST_DIAGIONAL * l_diag );\r\n\t}\r\n\r\n\tprivate inline function _getCostProduct( p_node1:Node, p_node2:Node ):Float\r\n\t{\r\n\t\tvar l_dx1:Int = _intAbs( p_node1.x - _destNode.x );\r\n\t\tvar l_dy1:Int = _intAbs( p_node1.y - _destNode.y );\r\n\t\tvar l_dx2:Int = _intAbs( _startNode.x - _destNode.x );\r\n\t\tvar l_dy2:Int = _intAbs( _startNode.y - _destNode.y );\r\n\t\tvar l_cross:Float = _intAbs( ( l_dx1 * l_dy2 ) - ( l_dx2 * l_dy1 ) ) * .01;\r\n\t\treturn _getCostDiagonal( p_node1, p_node2 ) + l_cross;\r\n\t}\r\n\r\n\tprivate inline function _getCostEuclidian( p_node1:Node, p_node2:Node ):Float\r\n\t{\r\n\t\tvar l_dx:Int = _intAbs( p_node1.x - p_node2.x );\r\n\t\tvar l_dy:Int = _intAbs( p_node1.y - p_node2.y );\r\n\t\treturn Math.sqrt( ( l_dx * l_dx ) + ( l_dy * l_dy ) ) * _COST_ADJACENT;\r\n\t}\r\n\r\n\tprivate inline function _getCostManhattan( p_node1:Node, p_node2:Node ):Float\r\n\t{\r\n\t\tvar l_dx:Int = p_node1.x - p_node2.x;\r\n\t\tvar l_dy:Int = p_node1.y - p_node2.y;\r\n\t\treturn ( ( l_dx > 0 ? l_dx : -l_dx ) + ( l_dy > 0 ? l_dy : -l_dy ) ) * _COST_ADJACENT;\r\n\t}\r\n\r\n\t/**\r\n\t * Calculates an A Star path between two nodes on a boolean map\r\n\t * @param\tp_start\tThe starting node\r\n\t * @param\tp_dest\tThe destination node\r\n\t * @param\tp_heuristic\tThe method of A Star used\r\n\t * @param\tp_isDiagonalEnabled\tSet to true to ensure only up, left, down, right movements are allowed\r\n\t * @param\tp_isMapDynamic\tSet to true to force fresh lookups from IMap.isWalkable() for each node's isWalkable property (e.g. for a dynamically changing map)\r\n\t * @return\tAn array of coordinates from start to destination, or null if no path was found within the time limit\r\n\t */\r\n\tpublic function createPath( p_start:Coordinate, p_dest:Coordinate, ?p_heuristic:EHeuristic, p_isDiagonalEnabled:Bool = true, p_isMapDynamic:Bool = false ):Array<Coordinate>\r\n\t{\r\n\t\tif ( p_heuristic == null )\r\n\t\t{\r\n\t\t\tp_heuristic = EHeuristic.PRODUCT;\r\n\t\t}\r\n\t\t_info =\r\n\t\t{\r\n\t\t\theuristic:p_heuristic,\r\n\t\t\ttimeElapsed:0,\r\n\t\t\tpathLength:0,\r\n\t\t\tisDiagonalEnabled:p_isDiagonalEnabled\r\n\t\t};\r\n\t\tif ( !_map.isWalkable( p_start.x, p_start.y ) || !_map.isWalkable( p_dest.x, p_dest.y ) || p_start.isEqualTo( p_dest ) )\r\n\t\t{\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\t_openList = new Array<Node>();\r\n\t\t_closedList = new Array<Node>();\r\n\t\t_startNode = _nodes[p_start.x][p_start.y];\r\n\t\t_destNode = _nodes[p_dest.x][p_dest.y];\r\n\t\t_startNode.g = 0;\r\n\t\t_startNode.f = _getCost( _startNode, _destNode, p_heuristic );\r\n\t\t_openList.push( _startNode );\r\n\t\treturn _searchPath( p_heuristic, p_isDiagonalEnabled, p_isMapDynamic );\r\n\t}\r\n\r\n\tprivate inline function _getPath():Array<Coordinate>\r\n\t{\r\n\t\tvar l_path:Array<Coordinate> = new Array<Coordinate>();\r\n\t\tvar l_node:Node = _destNode;\r\n\t\tl_path[0] = l_node.clone();\r\n\t\tdo\r\n\t\t{\r\n\t\t\tl_node = l_node.parent;\r\n\t\t\tl_path.unshift( l_node.clone() );\r\n\t\t\tif ( l_node == _startNode )\r\n\t\t\t{\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\twhile ( true );\r\n\t\treturn l_path;\r\n\t}\r\n\r\n\tprivate function _searchPath( p_heuristic:EHeuristic, p_isDiagonalEnabled:Bool = true, p_isMapDynamic:Bool = false ):Array<Coordinate>\r\n\t{\r\n\t\tvar l_minX:Int, l_maxX:Int, l_minY:Int, l_maxY:Int;\r\n\t\tvar l_isWalkable:Bool;\r\n\t\tvar l_g:Float, l_f:Float, l_cost:Float;\r\n\t\tvar l_nextNode:Node = null;\r\n\t\tvar l_currentNode:Node = _startNode;\r\n\t\tvar l_startTime = Timer.stamp();\r\n\t\t_isCompleted = false;\r\n\t\twhile ( !_isCompleted )\r\n\t\t{\r\n\t\t\tl_minX = l_currentNode.x - 1 < 0 ? 0 : l_currentNode.x - 1;\r\n\t\t\tl_maxX = l_currentNode.x + 1 >= _cols ? _cols - 1 : l_currentNode.x + 1;\r\n\t\t\tl_minY = l_currentNode.y - 1 < 0 ? 0 : l_currentNode.y - 1;\r\n\t\t\tl_maxY = l_currentNode.y + 1 >= _rows ? _rows - 1 : l_currentNode.y + 1;\r\n\t\t\tfor ( l_iy in l_minY...( l_maxY + 1 ) )\r\n\t\t\t{\r\n\t\t\t\tfor ( l_ix in l_minX...( l_maxX + 1 ) )\r\n\t\t\t\t{\r\n\t\t\t\t\tl_nextNode = _nodes[l_ix][l_iy];\r\n\t\t\t\t\tl_isWalkable = ( !p_isMapDynamic && l_nextNode.isWalkable ) || ( p_isMapDynamic && _map.isWalkable( l_ix, l_iy ) );\r\n\t\t\t\t\tif ( ( l_nextNode == l_currentNode ) || !l_isWalkable )\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tl_cost = _COST_ADJACENT;\r\n\t\t\t\t\tif ( !( ( l_currentNode.x == l_nextNode.x ) || ( l_currentNode.y == l_nextNode.y ) ) )\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif ( !p_isDiagonalEnabled  )\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tl_cost = _COST_DIAGIONAL;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tl_g = l_currentNode.g + l_cost;\r\n\t\t\t\t\tl_f = l_g + _getCost( l_nextNode, _destNode, p_heuristic );\r\n\t\t\t\t\tif ( ( _openList.indexOf( l_nextNode ) != -1 ) || ( _closedList.indexOf( l_nextNode ) != -1 ) )\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif ( l_nextNode.f > l_f )\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tl_nextNode.f = l_f;\r\n\t\t\t\t\t\t\tl_nextNode.g = l_g;\r\n\t\t\t\t\t\t\tl_nextNode.parent = l_currentNode;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tl_nextNode.f = l_f;\r\n\t\t\t\t\t\tl_nextNode.g = l_g;\r\n\t\t\t\t\t\tl_nextNode.parent = l_currentNode;\r\n\t\t\t\t\t\t_openList.push( l_nextNode );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t_info.timeElapsed = Std.int( ( Timer.stamp() - l_startTime ) * 1000 );\r\n\t\t\t\tif ( _info.timeElapsed > _timeOutDuration )\r\n\t\t\t\t{\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t_closedList.push( l_currentNode );\r\n\t\t\tif ( _openList.length == 0 )\r\n\t\t\t{\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\t_openList.sort( _sort );\r\n\t\t\tl_currentNode = _openList.shift();\r\n\t\t\tif ( l_currentNode == _destNode )\r\n\t\t\t{\r\n\t\t\t\t_isCompleted = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\t_info.timeElapsed = Std.int( ( Timer.stamp() - l_startTime ) * 1000 );\r\n\t\tvar l_path = _getPath();\r\n\t\t_info.pathLength = l_path.length;\r\n\t\treturn l_path;\r\n\t}\r\n\t\r\n\tprivate function _sort( p_x:Node, p_y:Node ):Int\r\n\t{\r\n\t\treturn ( p_x.f > p_y.f ) ? 1 : ( p_x.f < p_y.f ) ? -1 : 0;\r\n\t}\r\n\t\r\n\tprivate inline function _intAbs( p_value:Int ):Int\r\n\t{\r\n\t\treturn ( p_value < 0 ) ? -p_value : p_value;\r\n\t}\r\n\r\n\tprivate inline function _intMin( p_v1:Int, p_v2:Int ):Int\r\n\t{\r\n\t\treturn ( p_v1 < p_v2 ) ? p_v1 : p_v2;\r\n\t}\r\n\r\n\t/**\r\n\t * A string to interpret the success of the latest path created\r\n\t * @return\tInformation string\r\n\t */\r\n\tpublic function getInfo():String\r\n\t{\r\n\t\treturn _isCompleted ? \"Success using \" + _info.heuristic + ( !_info.isDiagonalEnabled ? \" (and diagonals disabled )\" : \"\" ) + \" with a path length of \" + _info.pathLength + \" taking \" + _info.timeElapsed + \"ms\" : \"Fail\";\r\n\t}\r\n}\r\n","package pixi.display;\n\nimport flump.*;\nimport flump.DisplayObjectKey;\nimport flump.library.*;\nimport flump.library.MovieSymbol;\nimport pixi.display.FlumpResource;\nimport pixi.extras.MovieClip;\nimport pixi.core.display.Container;\nimport pixi.core.display.DisplayObject;\nimport pixi.core.math.Point;\nimport pixi.core.ticker.Ticker;\n\n\n@:access(pixi.display.FlumpResource)\nclass FlumpMovie extends Container implements IFlumpMovie {\n\n\tpublic var player:MoviePlayer;\n\tprivate var symbol:MovieSymbol;\n\tprivate var layers = new Map<Layer, PixiLayer>();\n\tprivate var layerLookup = new Map<String, Container>();\n\tprivate var movieChildren = new Map<DisplayObjectKey, DisplayObject>();\n\tprivate var displaying = new Map<Layer, DisplayObjectKey>();\n\tprivate var ticker:Ticker = untyped __js__ (\"PIXI.ticker.shared\");\n\tprivate var master:Bool;\n\n\tprivate var resource:FlumpResource;\n\tprivate var resourceId:String;\n\t\n\n\tpublic function new(symbolId:String, resourceId:String = null){\n\t\tsuper();\n\t\tthis.resourceId = resourceId;\n\n\t\tif(resourceId == null){\n\t\t\tresource = FlumpResource.getResourceForMovie(symbolId);\n\t\t\tif(resource == null) throw(\"Flump movie does not exist: \" + symbolId);\n\t\t}else{\n\t\t\tresource = FlumpResource.get(resourceId);\n\t\t\tif(resource == null) throw(\"Flump resource does not exist: \" + resourceId);\n\t\t}\n\n\t\tthis.symbol = resource.library.movies.get(symbolId);\n\t\t\n\t\tplayer = new MoviePlayer(symbol, this);\t\n\t\tthis.loop = true;\n\n\t\tmaster = true;\n\t\tonce(\"added\", onAdded);\n\t}\n\n\n\tprivate function disableAsMaster(){\n\t\tmaster = false;\n\t\toff(\"added\", onAdded);\n\t}\n\n\n\t/////////////////////////////////////////////////////\n\t//\n\t//   API\n\t//\n\t/////////////////////////////////////////////////////\n\n\tpublic var animationSpeed(default, default):Float = 1.0;\n\n\tpublic function getLayer(layerId:String):Container{\n\t\tif(layerLookup.exists(layerId) == false) throw(\"Layer \" + layerId + \"does not exist\");\n\t\treturn layerLookup[layerId];\n\t}\n\n\n\tpublic function getChildDisplayObject(layerId:String, keyframeIndex:UInt = 0):DisplayObject{\n\t\tvar key = player.getDisplayKey(layerId, keyframeIndex);\n\t\treturn movieChildren[key];\n\t}\n\n\n\tpublic function getChildMovie(layerId, keyframeIndex:UInt = 0):FlumpMovie{\n\t\tvar child = getChildDisplayObject(layerId, keyframeIndex);\n\t\tif(Std.is(child, FlumpMovie) == false) throw(\"Child on layer \" + layerId + \" at keyframeIndex \" + keyframeIndex + \" is not of type FlumpMovie!\");\n\t\treturn cast child;\n\t}\n\n\n\tpublic var symbolId(get, null):String;\n\tprivate function get_symbolId(){\n\t\treturn symbol.name;\n\t}\n\n\tpublic var loop(default, set):Bool;\n\tprivate function set_loop(value){\n\t\tif(value && player.playing) player.loop();\n\t\telse if(value == false && player.looping) player.play();\n\t\treturn loop = value;\n\t}\n\n\n\tpublic var onComplete(default, set):Void -> Void;\n\tprivate function set_onComplete(value){\n\t\treturn onComplete = value;\n\t}\n\n\tpublic var currentFrame(get, set):Int;\n\tprivate function set_currentFrame(value){\n\t\tplayer.currentFrame = value;\n\t\treturn value;\n\t}\n\tprivate function get_currentFrame():Int{\n\t\treturn player.currentFrame;\n\t}\n\n\tpublic var playing(get, null):Bool;\n\tprivate function get_playing(){\n\t\treturn player.playing || player.looping;\n\t}\n\n\n\tpublic var independantTimeline(get, set):Bool;\n\tprivate function get_independantTimeline(){\n\t\treturn player.independantTimeline;\n\t}\n\tprivate function set_independantTimeline(value:Bool){\n\t\tplayer.independantTimeline = value;\n\t\treturn value;\n\t}\n\n\n\tpublic var independantControl(get, set):Bool;\n\tprivate function get_independantControl(){\n\t\treturn player.independantControl;\n\t}\n\tprivate function set_independantControl(value:Bool){\n\t\tplayer.independantControl = value;\n\t\treturn value;\n\t}\n\n\n\tpublic var totalFrames(get, null):Int;\n\tprivate function get_totalFrames(){\n\t\treturn player.totalFrames;\n\t}\n\n\n\tpublic function stop():Void{\n\t\tplayer.stop();\n\t}\n\n\n\tpublic function play():Void{\n\t\tif(loop) player.loop();\n\t\telse player.play();\n\t}\n\n\n\tpublic function gotoAndStop(frameNumber:Int):Void{\n\t\tif(!loop){\n\t\t\tif(frameNumber > player.totalFrames-1) frameNumber = player.totalFrames - 1;\n\t\t\telse if(frameNumber < 0) frameNumber = 0;\n\t\t}\n\t\tplayer.goToFrame(frameNumber).stop();\n\t}\n\n\n\tpublic function gotoAndPlay(frameNumber:Int):Void{\n\t\tif(!loop){\n\t\t\tif(frameNumber > player.totalFrames-1) frameNumber = player.totalFrames - 1;\n\t\t\telse if(frameNumber < 0) frameNumber = 0;\n\t\t}\n\t\tif(loop) player.goToFrame(frameNumber).loop();\n\t\telse player.goToFrame(frameNumber).play();\n\t}\n\n\n\tpublic function getLabelFrame(label:String):UInt{\n\t\treturn player.getLabelFrame(label);\n\t}\n\n\n\t/////////////////////////////////////////////////////\n\t//\n\t//   Other\n\t//\n\t/////////////////////////////////////////////////////\n\n\tprivate function tick(){\n\t\tplayer.advanceTime(ticker.elapsedMS * animationSpeed);\n\t}\n\n\n\tprivate function onAdded(to){\n\t\tonce(\"removed\", onRemoved);\n\t\tticker.add(tick);\n\t}\n\n\n\tprivate function onRemoved(from){\n\t\tonce(\"added\", onAdded);\n\t\tticker.remove(tick);\n\t}\n\n\n\n\t/////////////////////////////////////////////////////\n\t//\n\t//   IFlumpMovie\n\t//\n\t/////////////////////////////////////////////////////\n\n\t\n\t\n\tprivate function createLayer(layer:Layer):Void{\n\t\tlayers[layer] = new PixiLayer();\n\t\tlayerLookup[layer.name] = layers[layer];\n\t\taddChild(layers[layer]);\n\t}\n\n\n\tprivate function getChildPlayer(keyframe:Keyframe):MoviePlayer{\n\t\tvar movie:FlumpMovie = cast movieChildren[keyframe.displayKey];\n\t\treturn movie.player;\n\t}\n\n\n\tprivate function createFlumpChild(displayKey:DisplayObjectKey):Void{\n\t\tmovieChildren[displayKey] = resource.createDisplayObject(displayKey.symbolId);\n\t}\n\n\n\tprivate function removeFlumpChild(layer:Layer, displayKey:DisplayObjectKey):Void{\n\t\tvar layer = layers[layer];\n\t\tlayer.removeChildren();\n\t}\n\n\n\tprivate function addFlumpChild(layer:Layer, displayKey:DisplayObjectKey):Void{\n\t\tvar layer = layers[layer];\n\t\tlayer.addChild( movieChildren[displayKey] );\n\t}\n\n\n\tprivate function onAnimationComplete():Void{\n\t\tif(onComplete != null) onComplete();\n\t}\n\n\n\tprivate function renderFrame(keyframe:Keyframe, x:Float, y:Float, scaleX:Float, scaleY:Float, skewX:Float, skewY:Float):Void{\n\t\tvar layer = layers[keyframe.layer];\n\t\tlayer.x = x;\n\t\tlayer.y = y;\n\t\tlayer.scale.x = scaleX;\n\t\tlayer.scale.y = scaleY;\n\t\tlayer.skew.x = skewX;\n\t\tlayer.skew.y = skewY;\n\t\tlayer.pivot.x = keyframe.pivot.x;\n\t\tlayer.pivot.y = keyframe.pivot.y;\n\t}\n\n\n\tprivate function labelPassed(label:Label){\n\t\temit(\"labelPassed\", label.name);\n\t}\n\t\n\toverride public function destroy(): Void {\n\t\tstop();\n\t\tonComplete = null;\n\t\tfor (layer in layers) layer.removeChildren();\n\t\tsymbol = null;\n\t\tplayer = null;\n\t\tsuper.destroy(true);\n\t}\n\n\n}","package pixi.display;\n\nimport flump.library.FlumpLibrary;\nimport flump.library.SpriteSymbol;\nimport flump.library.MovieSymbol;\nimport flump.library.Point;\nimport pixi.core.math.shapes.Rectangle;\nimport pixi.core.display.DisplayObject;\nimport pixi.core.sprites.Sprite;\nimport pixi.core.textures.BaseTexture;\nimport pixi.core.textures.Texture;\nimport pixi.core.ticker.Ticker;\nimport pixi.loaders.Resource;\nimport pixi.loaders.Loader;\n\n\n@:access(pixi.display.FlumpMovie)\nclass FlumpResource{\n\t\n\tprivate var library:FlumpLibrary;\n\tprivate var textures:Map<String, Texture>;\n\tprivate var resourceId:String;\n\n\n\n\tprivate static var resources = new Map<String, FlumpResource>();\n\n\n\tpublic static function exists(resourceName:String){\n\t\treturn resources.exists(resourceName);\n\t}\n\n\n\tpublic static function destroy(resourceName:String){\n\t\tif(resources.exists(resourceName) == false) throw(\"Cannot destroy FlumpResource: \" + resourceName + \" as it does not exist.\");\n\t\t\n\t\tvar resource = resources[resourceName];\n\t\tfor(texture in resource.textures)texture.destroy();\n\t\tresource.library = null;\n\t\tresources.remove(resourceName);\n\t}\n\n\n\tpublic static function flumpParser(resource:Resource, next:Void->Void){\n\t\tif(resource.data == null || resource.isJson == false) return;\n\t\tif(!resource.data.hasField(\"md5\") || !resource.data.hasField(\"movies\") || !resource.data.hasField(\"textureGroups\") || !resource.data.hasField(\"frameRate\")) return;\n\t\t\n\t\tvar lib:FlumpLibrary = FlumpLibrary.create(resource.data);\n\t\tvar textures = new Map<String, Texture>();\n\t\t\n\t\tvar atlasLoader = new Loader();\n\t\tatlasLoader.baseUrl = ~/\\/(.[^\\/]*)$/i.replace(resource.url, \"\");\n\n\t\tfor(atlasSpec in lib.atlases){\n\t\t\tatlasLoader.add(atlasSpec.file, function(atlasResource){\n\t\t\t\tvar atlasTexture = new BaseTexture(atlasResource.data);\n\n\t\t\t\tfor(textureSpec in atlasSpec.textures){\n\t\t\t\t\tvar frame = new Rectangle(textureSpec.rect.x, textureSpec.rect.y, textureSpec.rect.width, textureSpec.rect.height);\n\t\t\t\t\tvar origin = new Point(textureSpec.origin.x, textureSpec.origin.y);\n\t\t\t\t\torigin.x = origin.x / frame.width;\n\t\t\t\t\torigin.y = origin.y / frame.height;\n\t\t\t\t\ttextures[textureSpec.symbol] = new Texture(atlasTexture, frame);\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tatlasLoader.once(\"complete\", function(loader:Loader){\n\t\t\tvar flumpResource = new FlumpResource(lib, textures, resource.name);\n\t\t\tif(resource.name != null) FlumpResource.resources[resource.name] = flumpResource;\n\t\t\tresource.data = flumpResource;\n\t\t\tnext();\n\t\t});\n\t\tatlasLoader.load();\n\t}\n\n\n\tprivate static function get(resourceName:String){\n\t\tif(!resources.exists(resourceName)) throw(\"Flump resource: \" + resourceName + \" does not exist.\");\n\t\treturn resources[resourceName];\n\t}\n\n\t\n\tprivate static function getResourceForMovie(symbolId:String):FlumpResource{\n\t\tfor(resource in resources){\n\t\t\tif(resource.library.movies.exists(symbolId)){\n\t\t\t\treturn resource;\n\t\t\t}\n\t\t}\n\t\tthrow(\"Movie: \" + symbolId + \"does not exists in any loaded flump resources.\");\n\t}\n\n\n\tprivate static function getResourceForSprite(symbolId:String):FlumpResource{\n\t\tfor(resource in resources){\n\t\t\tif(resource.library.sprites.exists(symbolId)){\n\t\t\t\treturn resource;\n\t\t\t}\n\t\t}\n\t\tthrow(\"Sprite: \" + symbolId + \"does not exists in any loaded flump resources.\");\n\t}\n\t\n\n\n\tprivate function new(library:FlumpLibrary, textures:Map<String, Texture>, resourceId:String){\n\t\tthis.library = library;\n\t\tthis.textures = textures;\n\t\tthis.resourceId = resourceId;\n\t}\n\n\n\tprivate function createMovie(id:String):FlumpMovie{\n\t\tvar movie = new FlumpMovie(id, this.resourceId);\n\t\tmovie.disableAsMaster();\n\t\treturn movie;\n\t}\n\n\n\tprivate function createSprite(id:String):Sprite{\n\t\treturn new FlumpSprite(id, this.resourceId);\n\t}\n\n\n\tprivate function createDisplayObject(id:String):DisplayObject{\n\t\treturn library.movies.exists(id)\n\t\t? createMovie(id)\n\t\t: createSprite(id);\n\t}\n\n}","package pixi.display;\n\nimport flump.library.FlumpLibrary;\nimport pixi.core.sprites.Sprite;\n\n\n@:access(pixi.display.FlumpResource)\nclass FlumpSprite extends Sprite{\n\n\tpublic var symbolId:String;\n\tpublic var resourceId:String;\n\t\n\n\tpublic function new(symbolId:String, resourceId:String = null){\n\t\tthis.symbolId = symbolId;\n\t\tthis.resourceId = resourceId;\n\n\t\tvar resource:FlumpResource;\n\t\tif(resourceId != null){\n\t\t\tresource = FlumpResource.get(resourceId);\n\t\t\tif(resource == null) throw(\"Library: \" + resourceId + \"does has not been loaded.\");\n\t\t}else{\n\t\t\tresource = FlumpResource.getResourceForSprite(symbolId);\n\t\t}\n\n\t\tvar symbol = resource.library.sprites[symbolId];\n\t\tvar texture = resource.textures[symbol.texture];\n\t\tsuper(texture);\n\n\t\tpivot.x = symbol.origin.x;\n\t\tpivot.y = symbol.origin.y;\n\t}\n\n\n}","package pixi.display;\n\nimport pixi.core.display.Container;\nimport pixi.core.math.Point;\n\n\nclass PixiLayer extends Container{\n\n    public var skew = new Point();\n    \n    override public function updateTransform(){\n        untyped __js__('\n            if (!this.visible)\n            {\n                return;\n            }');\n\n\n        untyped __js__('\n             // create some matrix refs for easy access\n            var pt = this.parent.worldTransform;\n            var wt = this.worldTransform;\n\n            // temporary matrix variables\n            var a, b, c, d, tx, ty,\n                rotY = this.rotation + this.skew.y,\n                rotX = this.rotation + this.skew.x;\n        ');\n\n        untyped __js__('\n            // so if rotation is between 0 then we can simplify the multiplication process..\n            if (rotY % (Math.PI*2) || rotX % (Math.PI*2))\n            {\n                // check to see if the rotation is the same as the previous render. This means we only need to use sin and cos when rotation actually changes\n                if (rotX !== this._cachedRotX || rotY !== this._cachedRotY)\n                {\n                    // cache new values\n                    this._cachedRotX = rotX;\n                    this._cachedRotY = rotY;\n\n                    // recalculate expensive ops\n                    this._crA = Math.cos(rotY);\n                    this._srB = Math.sin(rotY);\n\n                    this._srC = Math.sin(-rotX);\n                    this._crD = Math.cos(rotX);\n                }\n\n                // get the matrix values of the displayobject based on its transform properties..\n                a  = this._crA * this.scale.x;\n                b  = this._srB * this.scale.x;\n                c  = this._srC * this.scale.y;\n                d  = this._crD * this.scale.y;\n                tx = this.position.x;\n                ty = this.position.y;\n\n                // check for pivot.. not often used so geared towards that fact!\n                //if (this.pivot.x || this.pivot.y)\n                //{\n                    tx -= this.pivot.x * a + this.pivot.y * c;\n                    ty -= this.pivot.x * b + this.pivot.y * d;\n                //}\n\n                // concat the parent matrix with the objects transform.\n                wt.a  = a  * pt.a + b  * pt.c;\n                wt.b  = a  * pt.b + b  * pt.d;\n                wt.c  = c  * pt.a + d  * pt.c;\n                wt.d  = c  * pt.b + d  * pt.d;\n                wt.tx = tx * pt.a + ty * pt.c + pt.tx;\n                wt.ty = tx * pt.b + ty * pt.d + pt.ty;\n            }\n            else\n            {\n                // lets do the fast version as we know there is no rotation..\n                a  = this.scale.x;\n                d  = this.scale.y;\n\n                tx = this.position.x - this.pivot.x * a;\n                ty = this.position.y - this.pivot.y * d;\n\n                wt.a  = a  * pt.a;\n                wt.b  = a  * pt.b;\n                wt.c  = d  * pt.c;\n                wt.d  = d  * pt.d;\n                wt.tx = tx * pt.a + ty * pt.c + pt.tx;\n                wt.ty = tx * pt.b + ty * pt.d + pt.ty;\n            }\n        ');\n\n        untyped __js__('\n\n            // multiply the alphas..\n            this.worldAlpha = this.alpha * this.parent.worldAlpha;\n\n            // reset the bounds each time this is called!\n            this._currentBounds = null;\n        ');\n\n        untyped __js__('\n            for (var i = 0, j = this.children.length; i < j; ++i)\n            {\n                this.children[i].updateTransform();\n            }   \n        ');\n\n    }\n}","package pixi.loaders;\n\nimport flump.library.FlumpLibrary;\nimport pixi.display.FlumpResource;\nimport js.Browser;\nimport js.html.Image;\nimport pixi.core.math.Point;\nimport pixi.core.math.shapes.Rectangle;\nimport pixi.core.textures.Texture;\nimport pixi.core.textures.BaseTexture;\nimport pixi.core.ticker.Ticker;\nimport pixi.loaders.Loader;\nimport pixi.loaders.Resource;\n\nusing Reflect;\n\n\n@:access(pixi.display.FlumpResource)\nclass FlumpParser{\n\n\n\tpublic static function flumpParser(resource:Resource, next:Void->Void){\n\t\tif(resource.data == null || resource.isJson == false) return;\n\t\tif(!resource.data.hasField(\"md5\") || !resource.data.hasField(\"movies\") || !resource.data.hasField(\"textureGroups\") || !resource.data.hasField(\"frameRate\")) return;\n\t\t\n\t\tvar lib:FlumpLibrary = FlumpLibrary.create(resource.data);\n\t\tvar textures = new Map<String, Texture>();\n\t\t\n\t\tvar atlasLoader = new Loader();\n\t\tatlasLoader.baseUrl = ~/\\/(.[^\\/]*)$/i.replace(resource.url, \"\");\n\n\t\tfor(atlasSpec in lib.atlases){\n\t\t\tatlasLoader.add(atlasSpec.file, function(atlasResource){\n\t\t\t\tvar atlasTexture = new BaseTexture(atlasResource.data);\n\n\t\t\t\tfor(textureSpec in atlasSpec.textures){\n\t\t\t\t\tvar frame = new Rectangle(textureSpec.rect.x, textureSpec.rect.y, textureSpec.rect.width, textureSpec.rect.height);\n\t\t\t\t\tvar origin = new Point(textureSpec.origin.x, textureSpec.origin.y);\n\t\t\t\t\torigin.x = origin.x / frame.width;\n\t\t\t\t\torigin.y = origin.y / frame.height;\n\t\t\t\t\ttextures[textureSpec.symbol] = new Texture(atlasTexture, frame);\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tatlasLoader.once(\"complete\", function(loader:Loader){\n\t\t\tvar flumpResource = new FlumpResource(lib, textures, resource.name);\n\t\t\tif(resource.name != null) FlumpResource.resources[resource.name] = flumpResource;\n\t\t\tresource.data = flumpResource;\n\t\t\tnext();\n\t\t});\n\t\tatlasLoader.load();\n\t}\n\n\n}","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage;\n\n// Can't enable @:coreApi because some fields are now inline getters\n// @:coreApi\n@:keepInit\nextern class Math\n{\n\tstatic var PI(default,null) : Float;\n\n\tstatic var NEGATIVE_INFINITY(get, null) : Float;\n\tprivate static inline function get_NEGATIVE_INFINITY () : Float {\n\t\treturn -(untyped __js__(\"Infinity\"));\n\t}\n\n\tstatic var POSITIVE_INFINITY(get,null) : Float;\n\tprivate static inline function get_POSITIVE_INFINITY () : Float {\n\t\treturn (untyped __js__(\"Infinity\"));\n\t}\n\n\tstatic var NaN(get, null) : Float;\n\tprivate static inline function get_NaN () : Float {\n\t\treturn (untyped __js__(\"NaN\"));\n\t}\n\n\tstatic function abs(v:Float):Float;\n\tstatic function acos(v:Float):Float;\n\tstatic function asin(v:Float):Float;\n\tstatic function atan(v:Float):Float;\n\tstatic function atan2(y:Float, x:Float):Float;\n\tstatic function ceil(v:Float):Int;\n\tstatic function cos(v:Float):Float;\n\tstatic function exp(v:Float):Float;\n\tstatic function floor(v:Float):Int;\n\tstatic function log(v:Float):Float;\n\tstatic function max(a:Float, b:Float):Float;\n\tstatic function min(a:Float, b:Float):Float;\n\tstatic function pow(v:Float, exp:Float):Float;\n\tstatic function random() : Float;\n\tstatic function round(v:Float):Int;\n\tstatic function sin(v:Float):Float;\n\tstatic function sqrt(v:Float):Float;\n\tstatic function tan(v:Float):Float;\n\n\tstatic inline function ffloor( v : Float ) : Float {\n\t\treturn floor(v);\n\t}\n\n\tstatic inline function fceil( v : Float ) : Float {\n\t\treturn ceil(v);\n\t}\n\n\tstatic inline function fround( v : Float ) : Float {\n\t\treturn round(v);\n\t}\n\n\tstatic inline function isFinite( f : Float ) : Bool {\n\t\treturn (untyped __js__(\"isFinite\"))(f);\n\t}\n\n\tstatic inline function isNaN( f : Float ) : Bool {\n\t\treturn (untyped __js__(\"isNaN\"))(f);\n\t}\n\n\tstatic function __init__() : Void {\n\t\tuntyped __feature__(\"Type.resolveClass\", $hxClasses[\"Math\"] = Math);\n\t}\n}\n","package com.isartdigital.utils.events;\r\n\r\n/**\r\n * @author Mathieu ANTHOINE\r\n */\r\n\r\nclass EventType \r\n{\r\n\t\r\n\tpublic static inline var GAME_LOOP:String = \"gameLoop\";\r\n\tpublic static inline var RESIZE:String = \"resize\";\r\n\t\r\n\tpublic static inline var ADDED:String = \"added\";\r\n\tpublic static inline var REMOVED:String = \"removed\";\r\n\t\r\n}","package com.isartdigital.utils.events;\r\n\r\n/**\r\n * ...\r\n * @author Mathieu Anthoine\r\n */\r\nclass FacebookEventType extends EventType\r\n{\r\n\r\n\tpublic static inline var CONNECTED:String = \"connected\";\r\n\tpublic static inline var NOT_AUTHORIZED:String = \"not_authorized\";\r\n\tpublic static inline var UNKNOWN:String = \"unknown\";\r\n\t\r\n}","package com.isartdigital.utils.events;\r\n\r\n/**\r\n * ...\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass LoadEventType extends EventType\r\n{\r\n\r\n\tpublic static inline var COMPLETE:String = \"complete\";\r\n\tpublic static inline var LOADED:String = \"load\";\r\n\tpublic static inline var PROGRESS:String = \"progress\";\r\n\t\r\n}","package com.isartdigital.utils.events;\r\n\r\n/**\r\n * ...\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass MouseEventType extends EventType\r\n{\r\n\t\r\n\tpublic static inline var MOUSE_MOVE:String = \"mousemove\";\r\n\tpublic static inline var MOUSE_DOWN:String = \"mousedown\";\r\n\tpublic static inline var MOUSE_OUT:String = \"mouseout\";\r\n\tpublic static inline var MOUSE_OVER:String = \"mouseover\";\r\n\tpublic static inline var MOUSE_UP:String = \"mouseup\";\r\n\tpublic static inline var MOUSE_UP_OUTSIDE:String = \"mouseupoutside\";\r\n\tpublic static inline var CLICK:String = \"click\";\r\n\t\r\n\tpublic static inline var RIGHT_DOWN:String = \"rightdown\";\r\n\tpublic static inline var RIGHT_UP:String = \"rightup\";\r\n\tpublic static inline var RIGHT_UP_OUTSIDE:String = \"rightupoutside\";\r\n\tpublic static inline var RIGHT_CLICK:String = \"rightclick\";\r\n\t\r\n}","package com.isartdigital.utils.events;\r\n\r\n/**\r\n * ...\r\n * @author Mathieu ANTHOINE\r\n */\r\nclass TouchEventType extends EventType\r\n{\r\n\r\n\tpublic static inline var TOUCH_START:String = \"touchstart\";\r\n\tpublic static inline var TOUCH_MOVE:String = \"touchmove\";\r\n\tpublic static inline var TOUCH_END:String = \"touchend\";\r\n\tpublic static inline var TOUCH_END_OUTSIDE:String = \"touchendoutside\";\r\n\tpublic static inline var TAP:String = \"tap\";\r\n\t\r\n}"],
"names":[],
"mappings":"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"
}